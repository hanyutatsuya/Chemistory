====================================================================
標　題：[保守作業]ケミストリー【暫定運用】
差出人：横田 克夫; 総研検査システム２課
宛　先：横田 克夫; 総研検査システム２課, 羽生 達哉; 総研検査システム２課, 上原 洋樹; 総研検査システム２課, 小林 洋一; 総研検査システム２課, 佐藤 聡; 総研検査システム２課, 新井 由香; 総研検査システム２課, 古河 ゆり; 総研検査システム２課, 保科 三紀夫; 総研検査システム１課, 島村 健汰; 総研検査システム１課, 清水 竜也; 総研検査システム１課, 赤澤 啓; 総研検査システム１課, 松津 健; 総研検査システム２課, 寺尾 哲; 総研検査システム２課, 黒木 俊博; 総研検査システム１課
通知解除：羽生 達哉; 総研検査システム２課
作成日時：2021年06月12日（土） 11:36
最終更新：2023年04月02日（日） 17:37

保守作業記録用の社内メールです。

・運用ルール
　・保守対応は全て記録する。
　・記録した内容について疑義がある場合は、直接会話するなどし、保守記録用の
　　社内メール上でのやり取りは行わない。
　・デヂエに記入できそうな内容は可能な限りデヂエにも登録する。
　・調査に複数日かかる時でも、まず登録する。

・記述内容
　１行目：問合者=○○,対応時間(分)=××
　２行目：具体的な内容。基本、自由。

＜クライアントセットアップの手順＞
\\10.1.103.226\NAS_Backup\総研システム部\総研システム３課\01_ケミストリ\99_資料\02_手順書\Win10用クライアントSetup\手順.txt

＜保守連絡先＞
　０８０－８７５８－３８８８＜２０２１年７月から運用開始予定＞
　※　清水主任(7月)→横田(8月)→羽生主事(9月)
　　→清水主任(10月)→横田(11月)→羽生主事(12月)
　　→清水主任(1月)→横田(2月)→羽生主事(3月)
　　→清水主任(4月)→横田(5月)→羽生主事(6月)

＜各種ログファイル覚書＞
・ＢＭ用オンラインプロセスログ
	[kea00iaw21～kea00iaw24]/home/kea00sys/appl/src/kns/DD201/dat/Log/*.log
・ＬＡＢＯ用オンラインプロセスログ
	[kea00iaw21～kea00iaw24]/home/kea00sys/appl/src/kns/DD203/dat/Log/*.log
・ＺＳ用ログ
	kea00apa:/apdata/aplog/MD*
・尿電解質専用ＬＡＢＯ用オンラインプロセスログ
	[kea00iaw21～kea00iaw24]/home/kea00sys/appl/src/kns/DD204/dat/Log/*.log
・日次処理ログ
	[kea00apa]/apdata/oldday/YYYY-MM-DD/daily.log
・アプリケーションログ
	[kea00apa]/apdata/aplog/*.log
・ＤＢ２ログ
	[kea00dba]/var/log/db2/db2inst1/db2dump
	[KEA00IAW08]/home/db2inst1/sqllib/db2dump
・クライアントログ
　　　\\10.1.181.166\share\CL_BIN\log
　※他、必要に応じて追加します。

2022/4/5
　クライアントセットアップの手順を小林氏が更新してくれたので、反映しました。
2023/4/2
　保守当番は、羽生主事(奇数月)と清水主任(偶数月)で持ち回りとさせて頂きました。（横田）

ケミストリ_今後の体制.xlsx

====================================================================
1：横田 克夫; 総研検査システム２課
2021年06月12日（土） 11:39

各位

２課で運用している保守作業記録用の社内メールを、ケミストリー用に作成しました。
対応内容は、こちらに記載をお願いします。

先日説明した暫定的な保守体制を添付しておきます。

横田

ケミストリ_今後の体制.xlsx

--------------------------------------------------------------------
3：横田 克夫; 総研検査システム２課
2021年06月14日（月） 08:01

問合者=藤本課長(6/10 16時頃),対応時間(分)=30
下記の問合せ有り。
　ＢＭでタイムアウトエラーが稀に発生する。
　日設担当者によると、上位サーバからＡＣＫが来ない事が理由との事。
　関家に見てもらったところ、上位サーバとしては通信仕様通りに応答しているとの事。
　相反する説明のため、ロガーを設置していたところ、タイムアウトエラーが発生し日設が調査を実施。
　日設の言い分が証明されたので、対応をお願いしたい。
→次の内容で藤本課長に回答。
　おそらく通信経路上で、データの衝突が発生している。
　一般的には、ＡＣＫが来ない場合はリトライするが、日設にはリトライ機能が無い模様。
　日設の糟谷さんから下記の連絡あり。
　　送信データが２つのフレームに分割された時にACKが来ない事が多く発生している模様。
　　BM11号機と12号機は5/10頃にフレーム分割時のインターバルを長くして様子見としている。
　BM11号機と12号機で5/10以降にタイムアウトが発生していないか、現場に確認してもらいたい。
→藤本課長から日本電子宛に以下のメール有り。
　昨日の打ち合わせにありましたBM11号機と12号機の設定について
　夜勤者に確認したところ、5/10以降（設定した日？）タイムアウトエラーは
　出ていないとのことでした。
 　その2台の設定ならエラー出ないかもしれないで、
　他の号機へも展開してもらえますか。
→2021年06月13日（日） 16:17　日本電子　糟谷様からのメール
　フレーム間の時間は5秒に延長設定を入れてみます。
　月曜に設定入れます。


（対応はここまで。続報があればご連絡します。）


20210612132729.pdf

--------------------------------------------------------------------
4：清水 竜也; 総研検査システム１課
2021年06月14日（月） 10:05

2021年06月10日（木）　大阪(営) 宮田さま

ユーザーより、電解質CLについて、単位を変える以下の換算を知りたいと問合せがあった。
なお、ユーザーは同項目を弊社へ出検しているわけではなく、院内検査しているとも言っていた。

最初、検査室に問い合わせたそうだが、システムに確認して欲しいと言われたとのことでTELあり。
システムに答えを求めるのはおかしいと思ったが、調べてみますねと一旦終話。

調べた結果、以下のメールをした。
ネットで調べれば色々載っていたり、二式のうち一方へ代入すれば導けるが
検査側が答えるべき内容のため、そこはあえて答えなかった。

その後、宮田さんからは検査室やインターネットでも調べてみます、と返信あり。

　　　　　　　　　　　　　随時（一般尿）
 103　クロール(Cl)－尿　　 ｇ／L
1003  クロール(Cl)－*尿　　ｍEｑ／L

------------------
差出人 	 ：  	"清水竜也" <shimizu@bml.co.jp> 
送信日時 	 ：  	2021年06月10日（木） 16:47
To   	 ：  	"宮田 千種" <Chigusa_Miyata@bml.co.jp>
Cc   	 ：  	"横田 克夫" <k-yokota@bml.co.jp>

宮田様

お疲れ様です。総研検査システムの清水といいます。

電解質の換算式についての問合せは、宮田様（このアドレス)であってますでしょうか。

システム（ケミストリーシステム）のマスターを調べたところ、項目103, 1003 それぞれを
システム内で設定した分析機の実測項目(0900103)から算出していました。

直接103から、1003に変換する直接の計算式はシステム内には設定がありませんでした。

システム上の計算式は、検査の方が示したものをシステムで表現しているに過ぎませんので
やはり臨床的意義を理解されている検査の方などから答えていただくのがよろしいかと思います。

① 0000103 = [0900103]*0.0355
② 0001003 = [0900103]

----------------------------------------------
項目コード     材料　　　計算式
"0000103",　"001 ",　"([0900103]*0.0355)"
"0001003",　"001 ",　"([0900103])"


中途半端な答え方ですみません。

総研検査システム：清水

--------------------------------------------------------------------
6：横田 克夫; 総研検査システム２課
2021年06月20日（日） 13:27

問合者=6/20 12:38 辻主任,対応時間(分)=30

再検ワークシート出力中にパソコンがフリーズ。(ワークシートは183)
パソコンを再起動し再度ワークシートの出力を試みたが、「現在ワークシート出力処理が行われています。しばらく待ってから実行してください」といった旨のメッセージが表示される。
対応をお願いします。

→関家に連絡が取れたので対応を依頼。以下、対応内容の記録。
→ワークシート出力時「検査SEQ採番管理情報テーブル（KNSSEQKNRI）」に「KNSGRP」が「KEA00SYS」のレコードをインサートし、出力処理を行っている。
　当該条件のレコードを削除後、再度ワークシート出力と内容確認を辻主任に依頼。
　問題無しのため、リカバリ完了とした。


20210620_ワークシート出力中にPCフリーズ.xlsx

--------------------------------------------------------------------
8：小林 洋一; 総研検査システム２課
2021年06月25日（金） 10:28

横田課長
お疲れ様です。小林です。

ケミストリーのサーバを確認しました。
HUBとUPSにエラーが出ています。
HUBは他のHUBと同様だと思いますが内部のコイン電池が切れていると思われます。

ハード障害なので羽生主事に依頼したところエラーの調査をするように言われました。
見つけた人が担当するのでしょうか。
他の作業に影響が出る可能性がありますので回答をお願いします。

ケミストリーの保守がどうなっているのかわかりかねますが
ケミストリサーバ1.jpgの12号機 テスト機に日次のバックアップHDDが繋がっています。
Pentium4なので15年以上前のサーバです。
日次のバックアップは保守に入っているサーバに変えた方が良いかと思います。

以上

ケミストリHUB上段.jpg
ケミストリHUB下段.jpg
UPS.jpg
ケミストリサーバ1.jpg
ケミストリサーバ2.jpg

--------------------------------------------------------------------
10：清水 竜也; 総研検査システム１課
2021年06月25日（金） 19:45

問合者：菅野主任　6/24 18時過ぎにTEL連絡あり　6/25に対応

ユーザーからデータ疑義問合せあり、その説明資料のためのデータ抽出依頼。
-------
抽出対象：セクションコードA（ケミストリー）で、
　　　　　結果エリアに＊339（検出不可）を含む検体の
　　　　　受日と依頼書№の一覧。
　　　　　項目名はこちらで調べますが、一緒に抜いていただければ非常に助かります。

抽出期間：直近6か月分

抽出期限：6/29（火）に施設説明が必要なため
　　　　　できれば今週中にお願いいたします。
------
累積ＤＢより、以下のSQLで抽出。
１～３月、４～６月に２回に分けて抽出。１回あたり４分程度かかった。cpu負荷は70～80％台で推移。

SQL:
connect to kea00dbn user db2inst1 using db2inst1
select UTKYMD, IRINO, KMKCD, KNSSU, KNSKKA2KBN, KNSKKA2, KKACMT1, KNSFLG, SSTCD from rui_kekka 
where knskisymd>='2021-01-01' 
and    knskisymd<='2021-03-31' 
and  KNSFLG='E' 
and  KNSKKA2KBN='0' 
and  KNSKKA2 like '0339%' 
order by 1,2,3,4 for read only with ur

※注  項目マスター(KMKMST)：ＷＳコード毎に同じ項目のレコードあり（正規化していない）

ケミストリー339_一覧.xlsx
KMKMST.csv
km.xlsx

--------------------------------------------------------------------
11：横田 克夫; 総研検査システム２課
2021年06月29日（火） 16:15

問合者=6/29 15:30 菅野主任,対応時間(分)=30
マルチ用前読み装置に、ＺＳ用トレーを載せてしまった。
このままだとＺＳ用トレーの測定が出来ないため、前読み操作のクリアをお願いしたい。

→ＱＡ表のＮｏ２１に相当。
　　\\10.1.103.226\NAS_Backup\総研システム部\総研システム３課\01_ケミストリ\引継ぎ\ケミストリ引継ぎ_QA表.xlsx

→下記の手順書を確認
　\\10.1.103.226\NAS_Backup\総研システム部\総研システム３課\01_ケミストリ\99_資料\01_各種設計_定義書\オンライン関連_ZS050\資料\トレー登録リセット処理.txt

→フロンティア分注ＯＫ以外のトレーである事を確認し、下記の対応を実施。
　(1)データバックアップ
　select * from KENORDER where KNSKISYMD='2021-06-28' and TRID in ('20930002','2MAA0004')
　select * from KENPOS where KNSKISYMD='2021-06-28' and TRID in ('20930002','2MAA0004')
　(2)パッチ
　　①KENORDERの更新
		UPDATE
		    KENORDER
		SET
		    ASYRCKID = '____0000',
		    ASYRCKPOS = 0,
		    KNSJKFLG = ' '
		WHERE
		    KNSKISYMD = '2021-06-28' AND
		    TRID in ('20930002','2MAA0004') AND
		    KNSJKFLG <> ' '
　　②KENPOSの削除
		DELETE FROM
		        KENPOS 
		WHERE
		        KNSKISYMD = '2021-06-28' AND
		        TRID in ('20930002','2MAA0004') AND
		        RAKITJHO = 'A'

→菅野主任に連絡し、復旧している事、データに問題無い事を確認して頂き、リカバリ完了とした。

20210629_ケミストリトレイ前読みキャンセル.xlsx

--------------------------------------------------------------------
12：横田 克夫; 総研検査システム２課
2021年06月29日（火） 16:44

問合者=6/29 9:30 検査管理　馬場氏(福島課長経由),対応時間(分)=30
夜間、ＢＭ８０６０の２２号機と２３号機で、測定が出来なかった。
調査をお願いしたい。

→ＢＭのオンラインプログラムを特定。
　\\10.1.103.226\NAS_Backup\総研システム部\総研システム３課\01_ケミストリ\99_資料
　　　\ケミストリーシステム_サーバディレクトリ構成図_2104.xlsx
　　　　\ディレクトリ構成図_IAサーバ_プログラム
　　　　　→「DD201」

→稼働しているIAサーバの特定方法が不明なので、psコマンドで調査
	[kea00sys@KEA00IAW21 ~]$ ps -ef | grep DD
	kea00sys  5174     1  8 11:15 ?        00:26:37 DD201 23
	kea00sys 12355     1  8 11:33 ?        00:25:03 DD201 22
	kea00sys 16958     1  8 Jun28 ?        01:39:47 DD201 10
	kea00sys 16961     1  8 Jun28 ?        01:41:35 DD201 11
	kea00sys 16964     1  8 Jun28 ?        01:40:46 DD201 12
	kea00sys 31718 28607  0 16:28 pts/6    00:00:00 grep DD
	→「ＩＡサーバ１号機」

→ログ調査
	/home/kea00sys/appl/src/kns/DD201/dat/Log
	-rw-r--r-- 1 kea00sys users 8362965  6月 29 09:45 2021 com_10.log
	-rw-r--r-- 1 kea00sys users 1110216  6月 29 06:49 2021 com_11.log
	-rw-r--r-- 1 kea00sys users 5897376  6月 29 09:44 2021 com_12.log
	-rw-r--r-- 1 kea00sys users   29836  6月 29 02:12 2021 com_22.log
	-rw-r--r-- 1 kea00sys users   16983  6月 29 01:26 2021 com_23.log

→com_22.logとcom_23.logを確認
	特にエラーは出ていないので、分析機側からの問合せが無いと考え、藤本課長に連絡。
	日設担当者に見てもらい、分析機側PCの再起動で復旧を確認。


--------------------------------------------------------------------
13：横田 克夫; 総研検査システム２課
2021年06月29日（火） 18:51

問合者=6/29 18:00 エラーメール,対応時間(分)=50
[2021年 6月 29日 火曜日 18:00:08 JST]検査結果 フラグ異常 確認
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2021年06月29日（火） 18:00
To （2件）  	 ： 	multi_log@bml.co.jp, multi_error@bml.co.jp （←宛先を隠す）

20210628,"00006289000","0002696"

上記、測定結果のフラグがおかしい検体があります。
（ 検査フラグ M、結果状況コード 3 ）

→シェルを探す。
　kea00apa:/home/kea00sys/shell/cron/chk_KNSFLG.sh
→下記のデータをチェックしている。
　SELECT  DISTINCT UTKYMD, IRINO, KMKCD 
　FROM    KEKKA 
　WHERE   SRIYMD IN (SELECT DISTINCT KJNSRIYMD FROM SYSKNRMST) 
　AND             KNSFLG = 'M' 
　AND             KKAJKCD = '3' 
　ORDER BY UTKYMD, IRINO, KMKCD 
　for read only with ur
→依頼書№0062890,項目CD=0002696: ｽｲｻﾝGFRの結果に”ＮＡＮ”が入っていた。
→現場に連絡。海老島さんにご確認頂いたところ、クレアチニンがマイナス値のため、
　「計算不可」で報告する旨、ユーザに了承してもらっている項目との事。
→このままではマズイので、修正報告をして頂いた後、ホスト照会で「計算不可」となった事を確認。
→なぜ”ＮＡＮ”で報告されたのかは、不明。現場でのオペミスの可能性もあるとの事。
→次回、同様の事象を検知したら、現場に連絡する運用とする。（海老島氏 快諾）
※このcronは朝5～7時台が5分間隔。日中は9，12，15，18時に動作するので、
　上記データへのパッチは実施しない事とした。

--------------------------------------------------------------------
14：小林 洋一; 総研検査システム２課
2021年06月30日（水） 18:27

ABC検診のソースは上原さんがNASに保存していました。
下記フォルダに保存されています。
\\10.1.103.226\nas_backup\総研システム部\総研システム２課\30_システム仕様管理\I00_ELISA\70_環境整備\ABC検診除菌歴対応2017年版\ソース

--------------------------------------------------------------------
15：小林 洋一; 総研検査システム２課
2021年07月02日（金） 08:25

各位
お疲れ様です。小林です。

ケミストリーの課題管理表を作成しました。
\\10.1.103.226\NAS_Backup\総研システム部\総研システム３課\01_ケミストリ\引継ぎ\課題管理表(ケミストリ).xls

--------------------------------------------------------------------
16：清水 竜也; 総研検査システム１課
2021年07月02日（金） 12:25

異常通知メール対応：

 [2021年 7月 2日 金曜日 11:40:06 JST]マルチ異常報告
差出人 	 ：  	kensys@bml.co.jp 
送信日時 	 ：  	2021年07月02日（金） 11:40
To （2件）   	 ：  	multi_log@bml.co.jp ... （→宛先をすべて表示する）

ND102 オーダーラック登録

上記プロセスが起動していません。確認してください。
----------------
①proc.sh を起動

稼働確認のモードで、検査サーバー側を表示

最下段に「ND102      オーダーラック登録」が停止していた。

②ログ確認：

共有メモリの操作に失敗しました、と出ている。

kea00sys@kea00apa:/apdata/aplog/ND102_20210702.log

       ファイル処理開始[/apdata/today/file/KEA00/kea00ap/rack/02113433570_52689_5.dat]
2021/07/02      11:32:16        T       kea00apa        41209   kea00sys        ND102   ND102.c mainFunction    296             00000000
       ファイル処理完了[/apdata/today/file/KEA00/kea00ap/rack/OK/02113433570_52689_5.dat]
2021/07/02      11:36:50        E       kea00apa        41209   kea00sys        ND102   ND102.c shmat   558             00000000        >
共有メモリの操作に失敗しました
2021/07/02      11:36:50        T       kea00apa        41209   kea00sys        ND102   ND102.c         453             00000000        >
プログラム終了
2021/07/02      12:03:02        T       kea00apa        8137    kea00sys        ND102   ND102.c         102             00000000        >
プログラム起動
2021/07/02      12:03:02        T       kea00apa        8137    kea00sys        ND102   ND102.c mainFunction    246             00000000
       ファイル処理開始[/apdata/today/file/KEA00/kea00ap/rack/02113747511_85865_01.dat]
2021/07/02      12:03:02        T       kea00apa        8137    kea00sys        ND102   ND102.c mainFunction    296             00000000
       ファイル処理完了


③proc.sh を起動

プロセス起動にて、同プロセスを起動した。

--------------------------------------------------------------------
17：島村 健汰; 総研検査システム１課
2021年07月02日（金） 15:02

本日、CSの設定変更を行いました。
対象はZS 4号機～6号機を接続している"KEA00MCS10"
	
FTPのサービスを有効にし、設定を書き込みました。
					
①(conf)# enable ftpd					
②(conf)# write

CSの再起動を行い、4号機から6号機でコントロールを測定してもらう。
その後、結果取り込みに失敗したため、ZS用の常駐プロセスの再起動を実施。

/home/kea00sys/shell/daily/prcZS_onoff.sh

①停止：prcZS_onoff.sh -STOP
②起動：prcZS_onoff.sh -START

常駐の再起動後にコントロールの再送を依頼し、クライアント端末から
取り込み状況を確認してもらった。
正常に結果を取り込めたので、次に通常の検体を測定してもらった。
こちらも正常に取り込めたので、異常なしと判断した。

今後、CSの再起動を行う際は常駐プロセスを止める事

--------------------------------------------------------------------
18：島村 健汰; 総研検査システム１課
2021年07月02日（金） 15:03

>>17
設定変更後、FTP接続ができる事を確認済み
設定ファイル一式を取得済み

--------------------------------------------------------------------
19：清水 竜也; 総研検査システム１課
2021年07月02日（金） 16:18

@:羽生 達哉; 総研検査システム２課, 横田 克夫; 総研検査システム２課

>>17
ZS側を停止した時、同じような時間帯に 
>16 記載の「ND102 オーダーラック登録」が起動していない旨の異常通知メールが来
関係性があるかないか、ログを調べたところ、時刻が完全に一致していました。

2021/07/02      11:36:50        E       kea00apa        41209   kea00sys        ND102   ND102.c shmat   558             00000000        >
共有メモリの操作に失敗しました
2021/07/02      11:36:50        T       kea00apa        41209   kea00sys        ND102   ND102.c         453             00000000        >
プログラム終了

ZS側：
2021/07/02      11:36:50        T       kea00apa        41349   kea00sys        MD102   MD102.c         483
       00000000        プログラム終了


そして、ND102 を含む、常駐処理の起動＆停止の sh( proc.sh )と
ＺＳ用プロセス起動停止のsh( prcZS_onoff.sh )を調べたところ

共有メモリのアドレス（1万4千番台) がバッティングしていることがわかりました。

14001 14002：常駐側で言うと ND101, ND102

これ、NG ですよね。

#
# prcZS_onoff.sh ＺＳ用プロセス起動停止
#
##################################################################
PROC_ZS_ID=(MD101 MD101 MD102 MD102 MD103 MD104 MD105 )
PROC_ZS_INI=(MD101_L1 MD101_L2 MD102_L1 MD102_L2 MD103 MD104 MD105 )
PROC_ZS_NM=(ＺＳオンライン１号機 ＺＳオンライン２号機 ＺＳ再検判定１号機 ＺＳ再検判定２号機 ＺＳ用投入トレー登録 ＺＳ用
収納トレー登録 ＺＳ用結果情報登録)
# PROC_ZS_BG詳細 0:起動しない,1:起動する
PROC_ZS_BG=(1 1 1 1 1 1 1)
PROC_ZS_SM=(14001 14006 14002 14007 14003 14004 14005)

EXEC_BIN=$HOME/bin
PEOC_STOP=${EXEC_BIN}/ZD999stop

-------------
proc.sh

#
# 2007-06-07 Update 鎌倉 LABO10号機削除
#                   鎌倉 BM  10号機追加
#
# 2008-04-04 Update 守屋 新フロンティア対応
#                   守屋 ３ＩＤ受信(AD107)、３ＩＤ展開(AD108)追加
#
# 2008-11-21 Update 守屋 自動校正(FD103)追加
#
# 2009-01-05 Update 守屋 緊急関連PG追加
#
##################################################################
IA_COM="/home/kea00sys/bin/IAcom"
PROC_Z_ID=(AD102 AD103 AD105 AD107 AD108 AD301 BD301 BD302 BD401 DD401 FD101 FD103 JD112 GD102 GD105 ZD101 LD101 LD103 LD104 LD105 LD106 ND101 ND102)
PROC_Z_NM=(依頼展開 患者展開 分注展開 ３ＩＤ受信 ３ＩＤ展開 要求カード作成 供給ストッカ 回収ストッカ サンプラ 結果登録 監視バッチ 自動校正 検査進行状況
集計 HULFT送信 検査結果報告 ログ出力 属性エラーチェック 属性修正展開 結果要求カード作成 他結果情報登録 再計算処理 フロンティアラック登録 オーダーラック
登録)
PROC_Z_ST=(0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0)
# PROC_Z_BG詳細
#  0:通常起動、1:バックグラウンド起動、2:日次で起動しないもの(緊急など)
PROC_Z_BG=(1 1 0 0 0 1 0 0 0 0 1 0 1 1 0 0 0 0 0 0 0 0 0)
PROC_Z_SM=(5102 5103 5105 5107 5108 5301 6301 6302 6401 7401 9101 9103 11112 10102 10105 12101 13001 13003 13004 13005 13006 14001 14002)


--------------------------------------------------------------------
20：清水 竜也; 総研検査システム１課
2021年07月03日（土） 10:36

異常通知メール対応：日次の裏処理・累積への追加が終わらない症状

[ /apdata/aplog/FATAL_imp_rui.log ]
-------------------------------------------------------------------
2021年 7月 3日 土曜日 05:34:54 JST ERROR : KEKKA のIMPORTに失敗しました
-------------------------------------------------------------------

上記、エラーログが存在しています。確認してください。

-------------
対応：

① 日次のプロセスの有無を確認。

kea00sys@kea00apa:/apdata/work/smz> ps -ef | grep dai
kea00sys  3713  3619  0  7月02 pts/0   00:00:00 sh /home/kea00sys/shell/daily/daily.sh db2inst1 db2inst1
kea00sys 19684  3713  0 05:34 pts/0    00:00:00 sh /home/kea00sys/shell/daily/imp_shu.sh KEA00DBN db2inst1 db2inst1

② ２つをkillする。※■今回、子sh からkill したが、同時か、親の「daily.sh」からkillしたほうが良さそう。日次の次のstepが起動されてしまったことから。

kea00sys@kea00apa:/apdata/work/smz> kill -9 19684
kea00sys@kea00apa:/apdata/work/smz> kill -9 3713

kill後 、別の 処理が動き始めた。

kea00sys 46009     1  0 09:29 ?        00:00:00 sh /home/kea00sys/shell/daily/del_mhk_dbn.sh KEA00DBN db2inst1 db2
inst1 /apdata/oldday/2021-07-01
kea00sys 46153 17772  0 09:29 pts/1    00:00:00 grep --color=auto dai

ps -ef | grep dai
kea00sys 46009     1  0 09:29 ?        00:00:00 sh /home/kea00sys/shell/daily/del_mhk_dbn.sh KEA00DBN db2inst1 db2
inst1 /apdata/oldday/2021-07-01
kea00sys 56265 55913  0 09:43 pts/6    00:00:00 view daily.log
kea00sys 60163 47730  0 09:48 pts/4    00:00:00 tail -f daily.log
kea00sys 60854 59667  0 09:49 pts/9    00:00:00 view daily.log
kea00sys 61617 48803  0 09:50 pts/5    00:00:00 view /home/kea00sys/shell/daily/daily_recover_rui.sh
kea00sys 63752 17772  0 09:52 pts/1    00:00:00 grep --color=auto dai

②-2
「daily_recover_rui.sh」は、不要データの削除処理のようで、この後、
実行する「daily_recover_rui.s」の中で、実行されることから強制終了した。

kea00sys@kea00apa:/apdata/work/smz> kill -9 46009

kea00sys@kea00apa:/apdata/work/smz> !ps
ps -ef | grep dai
kea00sys 56265 55913  0 09:43 pts/6    00:00:00 view daily.log
kea00sys 60163 47730  0 09:48 pts/4    00:00:00 tail -f daily.log
kea00sys 60854 59667  0 09:49 pts/9    00:00:00 view daily.log
kea00sys 63827 17772  0 09:52 pts/1    00:00:00 grep --color=auto dai

③ ＤＢエンジンを停止する。

[db2inst1@KEA00IAW08 shell]$ sh /home/db2inst1/shell/dbn_force.sh
DB20000I  The FORCE APPLICATION command completed successfully.
DB21024I  This command is asynchronous and may not be effective immediately.

[db2inst1@KEA00IAW08 shell]$ db2 list application

Auth Id  Application    Appl.      Application Id                                                 DB       # of
         Name           Handle                                                                    Name    Agents
-------- -------------- ---------- -------------------------------------------------------------- -------- -----
DB2INST1 db2bp          30644      10.1.42.15.48602.210703002927                                  KEA00DBN 1
DB2INST1 db2bp          30280      10.1.42.15.45052.210702203455


[db2inst1@KEA00IAW08 shell]$ db2 list application

Auth Id  Application    Appl.      Application Id                                                 DB       # of
         Name           Handle                                                                    Name    Agents
-------- -------------- ---------- -------------------------------------------------------------- -------- -----
DB2INST1 db2bp          30644      10.1.42.15.48602.210703002927                                  KEA00DBN 1
DB2INST1 db2bp          30280      10.1.42.15.45052.210702203455                                  KEA00DBN 1

③-2 ＤＢコネクションがなくなるまで、若干時間がかかった。 
[db2inst1@KEA00IAW08 shell]$
[db2inst1@KEA00IAW08 shell]$ db2 list application
SQL1611W  No data was returned by Database System Monitor.
[db2inst1@KEA00IAW08 shell]$


④ DBエンジンを再起動する。

sh /home/db2inst1/shell/dbn_rebootforce.sh
SQL1064N  DB2STOP processing was successful.
SQL1063N  DB2START processing was successful.


⑤ＡＰサーバで、日次の累積リカバリー用のシェルを実行

/home/kea00sys/shell/daily/daily_recover_rui.sh db2inst1 db2inst1

  途中、(y/n)を数回聞いてくるので、適宜、 y で答える。
  また、対象の「元処理日」を聞いてくる。 西暦８桁ベタで入力する。


○imp_rui_work.sh を用いて累積ＤＢへのインポートをやり直します。

よろしいですか？(y/n)==>
y
やり直しを行う元処理日を入力してください(20210702) :
20210701
処理日[2021-07-01]分の累積インポートをやり直します。よろしいですか(y/n)
y
  2021/07/03 09:58:50▼▼ 累積インポートリカバリー処理 --- 開始 ▼▼
  2021/07/03 09:58:50▼▼ 累積に追加＆累積から未報告分削除 --- 開始 ▼▼


--------------------------------------------------------------------
22：横田 克夫; 総研検査システム２課
2021年07月03日（土） 11:03

IAサーバのDBのログが肥大化しているので下記の対応を実施。
su - db2inst1
cd /home/db2inst1/sqllib/db2dump
mv db2diag.log db2diag.log.20210703
touch db2diag.log 
chmod 666 db2diag.log

--------------------------------------------------------------------
25：横田 克夫; 総研検査システム２課
2021年07月03日（土） 18:00

問合者=7/3 13時頃 自動分析課 竹澤さん,対応時間(分)=300分
未報告確認リストを出力したが、ホストに結果が入っているものまでリストに印刷されている。
調査・対応をお願いします。

■原因調査
→昨晩、日替処理後に、当日ＤＢから累積ＤＢにデータを移動する処理の性能が低下し、データの移動が未完了だった。
　（データを移動する処理は、清水主任が今日の午前中にリカバリ済み）
→データ移動処理が低速で動作している間に、属性修正を受信。
　属性修正を受信すると、累積ＤＢから当日ＤＢにデータを移動する処理が動作する。
→この処理の競合により、レコードによっては以下の状態になっていた。
　　当日依頼情報　　＝あり・累積依頼情報　　＝あり
　　当日結果情報　　＝なし・累積結果情報　　＝あり
　　当日オーダー情報＝なし・累積オーダー情報＝あり
→依頼情報、結果情報、オーダー情報は当日ＤＢか累積ＤＢに揃っている必要がある。
　当日ＤＢを参照し依頼情報のみだと、「未報告」としてリストに出力される。
→なお、「未報告確認リスト」を出力するクライアントのプログラムは、
「報告転送状況照会・再転送」メニューから起動する「未報告データ確認」。
　プログラム名は「JS117.exe」

■リカバリ
(1)属性修正を受信した時の下記ログファイルをFTPでローカルＰＣにダウンロード
　kea00apa:/apdata/aplog/LD103_20210703.log
(2)ファイル内を「累積分の情報を当日分へ戻しました。」でGrep。
(3)「(2)」の検索結果を使って、SQLの条件句を作成
(4)累積ＤＢのデータをＣＳＥでエクスポート
　select * from RUI_IRAI where 「(3)」
　select * from RUI_KEKKA where 「(3)」
　select * from RUI_KENORDER where 「(3)」
　→rui_irai.csv、rui_kekka.csv、rui_kenorder.csv
(5)「(4)」のファイルを、当日ＤＢ(IRAIテーブル、KEKKAテーブル、KENORDERテーブル)にインポート
　※状況によっては、インポートで重複するケースがあるが、当日ＤＢを優先し特別な対処は不要。
(6)現場担当者に「未報告確認リスト」を再出力してもらい、復旧を確認
(7)累積ＤＢのデータを削除しておく
　delete from RUI_IRAI where 「(3)」
　delete from RUI_KEKKA where 「(3)」
　delete from RUI_KENORDER where 「(3)」

■今後の課題
・夜のエラー対応が遅れた。
　→課題管理表(ケミストリ).xls　№11に記載。
・累積ＤＢはフェデレーションでＩＡのＤＢを参照。性能低下するなら定期的に再起動するか？
　→課題管理表(ケミストリ).xls　№12に記載。
・累積ＤＢへの移動が遅くならなくても、属性修正を受信すると同じ事象が発生する。
　→課題管理表(ケミストリ).xls　№13に記載。

※辞めた関家に連絡したところ、快く電話で対応方法を教えてもらいました。感謝感激...

(2)Grep結果.txt
(3)SQL条件句.txt
未報告確認リスト.pdf
rui_kenorder.csv
LD103_20210703.log
xxx_SQLログ.txt
rui_kekka.csv
rui_irai.csv

--------------------------------------------------------------------
26：小林 洋一; 総研検査システム２課
2021年07月05日（月） 13:53

問合者=自動分析課金山,対応時間(分)=120分
食塩摂取量計算ツールで下記の依頼が結果更新できないので対応してほしい。
受日:2021/06/30
依頼書NO:0352489
項目コード:0013094(食塩摂取量)

運用概要
①新_食塩摂取量計算ツール.xlsm (2)を開く
②日付を2021/06/30に変更して検索(基幹からデータを取得)
③未報告の行の対象外の□対象外をダブルクリックして■対象にする。
④送信を実行する。
⑤C:\Program Files\BML\NxtGene01\DS349.exeが起動し送信対象をケミストリのDBから検索している。
　結果が入っているものは除外している。

食塩摂取量を手入力して報告してもらうように依頼。
→属性エラーチェック(LS101.exe)が再計算入力済みにならない。
　再計算入力済みになったら報告できる。
　→コメント結果であれば更新できるが今回の結果はコメント結果にはならない。

対応内容
属性エラーチェック(LS101.exe)のソースを確認。
保留依頼情報(HKHRIRAI)を更新していることがわかりました。
①kea00dbaにdb2inst1でログインし下記のコマンドを実行し保留依頼情報(HKHRIRAI)をバックアップ
cd /db2dbf/data/db2inst1/work/kobayashi/20210705
./export.sh
②CSEで保留依頼情報(HKHRIRAI)の報告保留区分(HKKHRKBN)を3(再計算待ち)から0(報告保留解除済み)に更新する。
select * from HKHRIRAI where utkymd='2021-06-30' and irino='00035248900' and kmkcd='0013094'
update HKHRIRAI set hkkhrkbn='0' where utkymd='2021-06-30' and irino='00035248900' and kmkcd='0013094'

再度報告するよう依頼し、ホスト照会を確認。
報告されたことを確認しました。
食塩摂取量の結果入力は海老島様(5811)が実施していたので
どのような手順で更新したか確認するように依頼しました。



--------------------------------------------------------------------
28：小林 洋一; 総研検査システム２課
2021年07月05日（月） 20:14

問合者=自動分析課菅野主任,対応時間(分)=120分
受付日:2021/7/2の計算結果がケミストリーに取り込めていないので対応してほしい。
受付日2021/7/2の1:属性未入力有、2:属性範囲異常有(属性未入力無)を0:報告保留解除済みに更新。
select * from HKHRIRAI where utkymd='2021-07-02' and hkkhrkbn in('1','2')
update HKHRIRAI set hkkhrkbn='0' where utkymd='2021-07-02' and hkkhrkbn in('1','2')

下記の対応を現場へ依頼しました。
①ケミストリの属性修正、再計算
②報告処理

訂正前
属性修正がされれば自動で計算される仕組みが入っているそうですが
7/3時点で動いていなかったため下記暫定対応を実施予定です。
当日処理日の/apdata/aplog/LD103_YYYYMMDD.log
が1行であった場合はエラー通知メールを出すようにします。
時間等は調整します。
訂正後
前日のログを確認したところ1行の場合も正常だということがわかったため
エラーメール送信時に電算課のパトランプを点灯するようにシェルを修正しました。

修正前後
kea00sys@kea00apa:~/shell/cron> diff chk_FATAL_Log.sh chk_FATAL_Log.sh_20210705
82,83d81
<       # パトランプ点灯を追加 20210705
<       /usr/bin/rsh -l root 10.1.51.157 ACOP 01010000
kea00sys@kea00apa:~/shell/cron>

以上

--------------------------------------------------------------------
29：清水 竜也; 総研検査システム１課
2021年07月06日（火） 00:06

異常通知メール対応：　2021/07/05  23:05 ～

-----
[ /apdata/aplog/FATAL_DAILY_2021-07-03.log ]
-------------------------------------------------------------------
日次が正常に終わっていない可能性があります。
2021-07-03 ログを確認して下さい。
[2021年  7月  5日 月曜日 22:57:48 JST] 230000 / 543860 件削除しました。
[2021年  7月  5日 月曜日 22:57:56 JST] 240000 / 543860 件削除しました。
[2021年  7月  5日 月曜日 22:58:06 JST] 250000 / 543860 件削除しました。
[2021年  7月  5日 月曜日 22:58:14 JST] 260000 / 543860 件削除しました。
[2021年  7月  5日 月曜日 22:58:21 JST] 270000 / 543860 件削除しました。
[2021年  7月  5日 月曜日 22:58:32 JST] 280000 / 543860 件削除しました。
[2021年  7月  5日 月曜日 22:58:41 JST] 290000 / 543860 件削除しました。
[2021年  7月  5日 月曜日 22:58:51 JST] 300000 / 543860 件削除しました。
[2021年  7月  5日 月曜日 22:58:59 JST] 310000 / 543860 件削除しました。
[2021年  7月  5日 月曜日 22:59:08 JST] 320000 / 543860 件削除しました。
[2021年  7月  5日 月曜日 22:59:16 JST] 330000 / 543860 件削除しました。
[2021年  7月  5日 月曜日 22:59:25 JST] 340000 / 543860 件削除しました。
[2021年  7月  5日 月曜日 22:59:33 JST] 350000 / 543860 件削除しました。
[2021年  7月  5日 月曜日 22:59:45 JST] 360000 / 543860 件削除しました。
[2021年  7月  5日 月曜日 22:59:55 JST] 370000 / 543860 件削除しました。
-------------------------------------------------------------------

上記、エラーログが存在しています。確認してください。

----
対応：

①日次ログを確認

前日の業務日なので
/apdata/oldday/2021-07-03　下　の　daily.log　を確認

kea00sys@kea00apa:/apdata/oldday/2021-07-03> tail -11 daily.log
 データベース・サーバー = DB2/LINUXZ64 11.1.4.4
 SQL 許可 ID            = DB2INST1
 ローカル・データベース別名 = KEA00DB

[2021年  7月  5日 月曜日 23:11:48 JST][RUI_CTRLKKA] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
[2021年  7月  5日 月曜日 23:15:14 JST][SHUSEI_KANJYA] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
DB20000I  TERMINATE コマンドが正常に完了しました。
  2021/07/05 23:15:14▲▲ 累積集計情報runstats --- 終了 ▲▲
2021/07/05 23:15:14▲▲ 日次処理 --- 終了 ▲▲
kea00sys@kea00apa:/apdata/oldday/2021-07-03>


「▲▲ 累積集計情報runstats --- 終了 」と出ている。

② 日次のプロセスを ps コマンドで念のため確認

ps -ef | grep dai


特に裏Jobの累積DBへの追加「/imp_shu.sh」 が無いかどうか確認

kea00sys@kea00apa:/apdata/oldday/2021-07-03> ps -ef | grep dai
kea00sys  8561 50599  0 00:03 pts/2    00:00:00 grep --color=auto dai
kea00sys 31637 31543  0  7月05 pts/0   00:00:00 sh /home/kea00sys/shell/daily/daily.sh db2inst1 db2inst1

いないので、問題なしと判断。

IMG_20210705.jpg

--------------------------------------------------------------------
30：横田 克夫; 総研検査システム２課
2021年07月06日（火） 15:56

問合者=自動分析課菅野主任,対応時間(分)=20分
7/2受 037-3644 項目13185:CCR-ｺｯｸｸﾛﾌﾄ の報告が出来ない。
→下記の順で操作して頂いたところ、パッチをせず、報告できた。
(1)属性修正内容を手動で入力
(2)EXCELで結果入力、及び登録
(3)しばらく待つ。
保留依頼情報テーブル(HKHRIRAI)の報告保留区分(HKKHRKBN)が、3(再計算待ち)から0(報告保留解除済み)に変わった。

--------------------------------------------------------------------
31：羽生 達哉; 総研検査システム２課
2021年07月07日（水） 11:47

電算課よりパトライト点灯連絡

[ /apdata/aplog/FATAL_DAILY_2021-07-05.log ]
-------------------------------------------------------------------
日次が正常に終わっていない可能性があります。
2021-07-05 ログを確認して下さい。

[2021年  7月  6日 火曜日 22:59:59 JST] SELECT AFTER START --------------------------------->

> SELECT COUNT(KNSKISYMD) FROM RUI_AUTOKOSICTRL WHERE KNSKISYMD = '2019-07-06'

[2021年  7月  6日 火曜日 22:59:59 JST] RUI_AUTOKOSICTRL 削除後 0 件 です。

[2021年  7月  6日 火曜日 22:59:59 JST] SELECT AFTER END -----------------------------------<


●○● [2021年  7月  6日 火曜日 22:59:59 JST] 2年間保管テーブル削除処理 END   ●○● ==========================<


[2021年  7月  6日 火曜日 22:59:59 JST] DB2 TERMINATE START -------------------------------->

-------------------------------------------------------------------

上記、エラーログが存在しています。確認してください。

日次処理のログを確認。

kea00sys@kea00apa:/apdata/oldday/2021-07-05/daily.log

タイムスタンプがメール通知時より進んでいることを確認し、
問題なしと判断。

--------------------------------------------------------------------
32：清水 竜也; 総研検査システム１課
2021年07月07日（水） 13:10

異常通知メール対応：

送信日時 	 ：  	2021年07月06日（火） 20:40
To （2件）   	 ：  	multi_log@bml.co.jp ... （→宛先をすべて表示する）

下記、ディスク容量がしきい値を越えています。確認してください。
/apdata：100 (しきい値：80%)

-----
■対応①：7/6 20:50～ 21:50

20:50頃、リモート確認すると、/apdata　73％ であった。

発報された時間帯は、日次で「ファイルのバックアップ」処理が実行されていた。

100％の時間帯は、日次の表処理が終わり、依頼展開系の処理がされていたので
依頼、患者ともその１ファイ目の先頭、末尾のデータがDB登録されているか
念のため確認した。irai, kanjya のテーブルとも登録されていた。

また、両テーブルの本日受けの登録総レコード数をHulft生ファイルと比較。
ほぼ一致しており、問題なしと判断した。

hulft生ファイル：/apdata/today/online/host/Recv/sumi　依頼：*IRI*　  患者：*KAN*

--
select IRINO, kmkcd  from irai where UTKYMD='2021-07-06' and IRINO in( '00406920600', '00001540200' ) for read only with ur

IRINO       KMKCD
----------- -------
00406920600 0002490
00001540200 0002767
00001540200 0002768
00001540200 0002779
00001540200 0002780
00001540200 0002831
00001540200 0002832
00001540200 0002833
00001540200 0002834
00001540200 0002836
00001540200 0002918
00001540200 0003788
00001540200 0012984
00001540200 0012986
  14 レコードが選択されました。

select IRINO, KNJNMN  from kanjya where UTKYMD='2021-07-06' and IRINO in( '00406920600', '00001540200' ) for read only with ur

IRINO       KNJNMN
----------- ------------------------------------------------------------
00406920600 ｶｻｲ ﾋﾛﾐ
00001540200 ﾌｸｼﾏ ﾐｷﾛｳ

  2 レコードが選択されました。

select count(*) from irai where UTKYMD='2021-07-06'  for read only with ur
-----------
     298883

select count(*) from kanjya where UTKYMD='2021-07-06'  for read only with ur
-----------
      32867

■対応②：7/7 12:30頃

本日も同様のことが起こると大いに予想されるため、
同Dirの 日付毎のバックアップファイルを古いほうから１週間分ほど削除する。

この日付毎のバックアップファイルは、マウントしているkea00iaw02 にもあり
削除しても問題ないと判断した。
kea00sys@kea00apa://apdata/today/file/KEA00/KEA00IAW02/bak_daily

結果、
/apdate 67％　→ 49％　まで低減した。７GB強、未使用）

kea00sys@kea00apa:/apdata/oldday> date
2021年  7月  7日 水曜日 12:28:36 JST
kea00sys@kea00apa:/apdata/oldday> df
ファイルシス                                                      1K-ブロック     使用    使用可 使用% マウント位置
devtmpfs                                                               490692        0    490692    0% /dev
tmpfs                                                                  502696        0    502696    0% /dev/shm
tmpfs                                                                  502696     1804    500892    1% /run
tmpfs                                                                  502696        0    502696    0% /sys/fs/cgroup
/dev/mapper/kea00apa--os--vg-root--lv                                 7792080  4703312   2673232   64% /
/dev/dasdc1                                                            237556    50948    168408   24% /boot/zipl
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14126104  9435296   4674424   67% /apdata
/dev/mapper/kea00apa--os--vg-opt--lv                                  8191416  3540676   4214928   46% /opt
/dev/mapper/kea00apa--os--vg-home--lv                                 2514736   571136   1796144   25% /home
/dev/mapper/kea00apa--os--vg-var--lv                                  2514736   651456   1715824   28% /var
tmpfs                                                                  100540        0    100540    0% /run/user/1001
KEA00IAW08:/apdata/today/file/KEA00/KEA00IA                          10154048  8218848   1411072   86% /apdata/today/file/KEA00/KEA00IAW08
KEA00IAW21:/apdata/today/file/KEA00/KEA00IA                         470416384  8211456 438308864    2% /apdata/today/file/KEA00/KEA00IAW21
KEA00IAW22:/apdata/today/file/KEA00/KEA00IA                         470416384  7892992 438627328    2% /apdata/today/file/KEA00/KEA00IAW22
KEA00IAW23:/apdata/today/file/KEA00/KEA00IA                         460151808 12343296 424411136    3% /apdata/today/file/KEA00/KEA00IAW23
KEA00IAW24:/apdata/today/file/KEA00/KEA00IA                         460151808 11875328 424879104    3% /apdata/today/file/KEA00/KEA00IAW24
KEA00IAW02:/apdata/today/file/KEA00/KEA00IA                          74660160 61577560   9290056   87% /apdata/today/file/KEA00/KEA00IAW02
tmpfs                                                                  100540        0    100540    0% /run/user/0
kea00sys@kea00apa:/apdata/oldday>


kea00sys@kea00apa:/apdata/oldday> \rm -r ./2021-06-21/
kea00sys@kea00apa:/apdata/oldday> \rm -r ./2021-06-2?
kea00sys@kea00apa:/apdata/oldday> ll
合計 664
drwxr-xr-x 9 kea00sys users   4096  7月  7 12:30 ./
drwxr-xr-x 9 root     root    4096 10月 17  2019 ../
drwxr-xr-x 2 kea00sys users  16384  7月  1 21:10 2021-06-30/
drwxr-xr-x 2 kea00sys users  16384  7月  3 15:55 2021-07-01/
drwxr-xr-x 2 kea00sys users  16384  7月  3 21:45 2021-07-02/
drwxr-xr-x 2 kea00sys users  16384  7月  6 09:08 2021-07-03/
drwxr-xr-x 2 kea00sys users  16384  7月  6 23:13 2021-07-05/
drwxr-xr-x 2 kea00sys users   4096  7月  7 12:11 kekka_out/
drwxr-xr-x 2 kea00sys users 573440  7月  7 12:05 rack_out/
-rw-r--r-- 1 kea00sys users   4999  7月  5 05:42 rui_runstats.log
kea00sys@kea00apa:/apdata/oldday>

kea00sys@kea00apa:/apdata/oldday> df
ファイルシス                                                      1K-ブロック     使用    使用可 使用% マウント位置
devtmpfs                                                               490692        0    490692    0% /dev
tmpfs                                                                  502696        0    502696    0% /dev/shm
tmpfs                                                                  502696     1804    500892    1% /run
tmpfs                                                                  502696        0    502696    0% /sys/fs/cgroup
/dev/mapper/kea00apa--os--vg-root--lv                                 7792080  4703320   2673224   64% /
/dev/dasdc1                                                            237556    50948    168408   24% /boot/zipl
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14126104  6870860   7238860   49% /apdata
/dev/mapper/kea00apa--os--vg-opt--lv                                  8191416  3540684   4214920   46% /opt
/dev/mapper/kea00apa--os--vg-home--lv                                 2514736   571136   1796144   25% /home
/dev/mapper/kea00apa--os--vg-var--lv                                  2514736   651552   1715728   28% /var
tmpfs                                                                  100540        0    100540    0% /run/user/1001
KEA00IAW08:/apdata/today/file/KEA00/KEA00IA                          10154048  8219168   1410752   86% /apdata/today/file/KEA00/KEA00IAW08
KEA00IAW21:/apdata/today/file/KEA00/KEA00IA                         470416384  8212480 438307840    2% /apdata/today/file/KEA00/KEA00IAW21
KEA00IAW22:/apdata/today/file/KEA00/KEA00IA                         470416384  7892992 438627328    2% /apdata/today/file/KEA00/KEA00IAW22
KEA00IAW23:/apdata/today/file/KEA00/KEA00IA                         460151808 12343296 424411136    3% /apdata/today/file/KEA00/KEA00IAW23
KEA00IAW24:/apdata/today/file/KEA00/KEA00IA                         460151808 11876352 424878080    3% /apdata/today/file/KEA00/KEA00IAW24
KEA00IAW02:/apdata/today/file/KEA00/KEA00IA                          74660160 61577576   9290040   87% /apdata/today/file/KEA00/KEA00IAW02
tmpfs                                                                  100540        0    100540    0% /run/user/0
kea00sys@kea00apa:/apdata/oldday> 

--------------------------------------------------------------------
34：清水 竜也; 総研検査システム１課
2021年07月09日（金） 10:35

保全：

/apdata/oldday の日付毎のバックアップDirを、古いほうから2日分削除する。（週末に向けて）

１日分を削除すると、約300GB前後、使用率で2～３％ 削減できる。

kea00sys@kea00apa:/apdata/oldday> df
ファイルシス                                                      1K-ブロック     使用    使用可 使用% マウント位置
devtmpfs                                                               490692        0    490692    0% /dev
tmpfs                                                                  502696        0    502696    0% /dev/shm
tmpfs                                                                  502696     1748    500948    1% /run
tmpfs                                                                  502696        0    502696    0% /sys/fs/cgroup
/dev/mapper/kea00apa--os--vg-root--lv                                 7792080  4706140   2670404   64% /
/dev/dasdc1                                                            237556    50948    168408   24% /boot/zipl
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14126104  6221656   7888064   45% /apdata
･･･
KEA00IAW02:/apdata/today/file/KEA00/KEA00IA                          74660160 62386616   8481000   89% /apdata/today/file/KEA00/KEA00IAW02
tmpfs                                                                  100540        0    100540    0% /run/user/0
kea00sys@kea00apa:/apdata/oldday>


kea00sys@kea00apa:/apdata/oldday> \rm -r ./2021-06-30/
kea00sys@kea00apa:/apdata/oldday> df
･･･
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14126104  5944468   8165252   43% /apdata


kea00sys@kea00apa:/apdata/oldday> \rm -r ./2021-07-01/
kea00sys@kea00apa:/apdata/oldday> df
ファイルシス                                                      1K-ブロック     使用    使用可 使用% マウント位置
･･･
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14126104  5537736   8571984   40% /apdata

kea00sys@kea00apa:/apdata/oldday> date
2021年  7月  9日 金曜日 10:29:38 JST
kea00sys@kea00apa:/apdata/oldday

--------------------------------------------------------------------
35：横田 克夫; 総研検査システム２課
2021年07月09日（金） 11:01

@:清水 竜也; 総研検査システム１課

>>34
清水主任

ご対応ありがとうございます。念のため関家に問合せたところ下記回答がありました。
------------------------
自動でバックアップは取得しているのですが、削除を入れてません。
問題なければ消してください。
------------------------
何かの処理が止まっている訳では無い事が確認できました。ひとまず安ですね。
すみませんが、恒久対策が取られるまでは、持ち回り携帯の当番者が人手でのチェックとさせてください。

--------------------------------------------------------------------
36：清水 竜也; 総研検査システム１課
2021年07月12日（月） 11:24

保全：

先週同様、/apdata/oldday の日付毎のバックアップDirを、古いほうから2日分削除する。

また、/ルートが 64% で残が３GB無く気になる。
tmp下に MD102(ZS用常駐）のtmpファイルの残骸が、昔のものからかなりあり
～2021/02月分まで削除してみたがあまり変わらず。　63％

---
kea00sys@kea00apa:/apdata/oldday> date
2021年  7月 12日 月曜日 10:47:14 JST
kea00sys@kea00apa:/apdata/oldday> df
ファイルシス                                                      1K-ブロック     使用    使用可 使用% マウント位置
devtmpfs                                                               490692        0    490692    0% /dev
tmpfs                                                                  502696        0    502696    0% /dev/shm
tmpfs                                                                  502696     1804    500892    1% /run
tmpfs                                                                  502696        0    502696    0% /sys/fs/cgroup
/dev/mapper/kea00apa--os--vg-root--lv                                 7792080  4708276   2668268   64% /
/dev/dasdc1                                                            237556    50948    168408   24% /boot/zipl
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14126104  7013436   7096284   50% /apdata
/dev/mapper/kea00apa--os--vg-opt--lv                                  8191416  3561916   4193688   46% /opt
/dev/mapper/kea00apa--os--vg-home--lv                                 2514736   571812   1795468   25% /home
/dev/mapper/kea00apa--os--vg-var--lv                                  2514736   625640   1741640   27% /var
tmpfs                                                                  100540        0    100540    0% /run/user/1001
KEA00IAW08:/apdata/today/file/KEA00/KEA00IA                          10154048  8207200   1422720   86% /apdata/today/file/KEA00/KEA00IAW08
KEA00IAW21:/apdata/today/file/KEA00/KEA00IA                         470416384  8054784 438465536    2% /apdata/today/file/KEA00/KEA00IAW21
KEA00IAW22:/apdata/today/file/KEA00/KEA00IA                         470416384  7682048 438838272    2% /apdata/today/file/KEA00/KEA00IAW22
KEA00IAW23:/apdata/today/file/KEA00/KEA00IA                         460151808 12087296 424667136    3% /apdata/today/file/KEA00/KEA00IAW23
KEA00IAW24:/apdata/today/file/KEA00/KEA00IA                         460151808 11604992 425149440    3% /apdata/today/file/KEA00/KEA00IAW24
KEA00IAW02:/apdata/today/file/KEA00/KEA00IA                          74660160 63041464   7826152   89% /apdata/today/file/KEA00/KEA00IAW02
tmpfs                                                                  100540        0    100540    0% /run/user/0
kea00sys@kea00apa:/apdata/oldday> ll
合計 9212
drwxr-xr-x 11 kea00sys users    4096  7月 10 18:26 ./
drwxr-xr-x  9 root     root     4096 10月 17  2019 ../
drwxr-xr-x  2 kea00sys users   16384  7月  3 21:45 2021-07-02/
drwxr-xr-x  2 kea00sys users   16384  7月  6 09:08 2021-07-03/
drwxr-xr-x  2 kea00sys users   16384  7月  7 12:32 2021-07-05/
drwxr-xr-x  2 kea00sys users   16384  7月  7 22:39 2021-07-06/
drwxr-xr-x  2 kea00sys users   16384  7月  8 23:29 2021-07-07/
drwxr-xr-x  2 kea00sys users   16384  7月  9 23:22 2021-07-08/
drwxr-xr-x  2 kea00sys users   16384  7月 10 20:52 2021-07-09/
drwxr-xr-x  2 kea00sys users 8720384  7月 11 19:00 kekka_out/
drwxr-xr-x  2 kea00sys users  573440  7月 11 11:05 rack_out/
-rw-r--r--  1 kea00sys users    4999  7月 12 05:45 rui_runstats.log
kea00sys@kea00apa:/apdata/oldday> \rm -r ./2021-07-02/
kea00sys@kea00apa:/apdata/oldday> \rm -r ./2021-07-03/
kea00sys@kea00apa:/apdata/oldday> df
ファイルシス                                                      1K-ブロック     使用    使用可 使用% マウント位置
devtmpfs                                                               490692        0    490692    0% /dev
tmpfs                                                                  502696        0    502696    0% /dev/shm
tmpfs                                                                  502696     1804    500892    1% /run
tmpfs                                                                  502696        0    502696    0% /sys/fs/cgroup
/dev/mapper/kea00apa--os--vg-root--lv                                 7792080  4708344   2668200   64% /
/dev/dasdc1                                                            237556    50948    168408   24% /boot/zipl
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14126104  6484172   7625548   46% /apdata
/dev/mapper/kea00apa--os--vg-opt--lv                                  8191416  3561916   4193688   46% /opt
/dev/mapper/kea00apa--os--vg-home--lv                                 2514736   571812   1795468   25% /home
/dev/mapper/kea00apa--os--vg-var--lv                                  2514736   625640   1741640   27% /var
tmpfs                                                                  100540        0    100540    0% /run/user/1001
KEA00IAW08:/apdata/today/file/KEA00/KEA00IA                          10154048  8207264   1422656   86% /apdata/today/file/KEA00/KEA00IAW08
KEA00IAW21:/apdata/today/file/KEA00/KEA00IA                         470416384  8054784 438465536    2% /apdata/today/file/KEA00/KEA00IAW21
KEA00IAW22:/apdata/today/file/KEA00/KEA00IA                         470416384  7682048 438838272    2% /apdata/today/file/KEA00/KEA00IAW22
KEA00IAW23:/apdata/today/file/KEA00/KEA00IA                         460151808 12087296 424667136    3% /apdata/today/file/KEA00/KEA00IAW23
KEA00IAW24:/apdata/today/file/KEA00/KEA00IA                         460151808 11604992 425148416    3% /apdata/today/file/KEA00/KEA00IAW24
KEA00IAW02:/apdata/today/file/KEA00/KEA00IA                          74660160 63041464   7826152   89% /apdata/today/file/KEA00/KEA00IAW02
tmpfs                                                                  100540        0    100540    0% /run/user/0
kea00sys@kea00apa:/apdata/oldday>
kea00sys@kea00apa:/apdata/oldday> ll
合計 9180
drwxr-xr-x 9 kea00sys users    4096  7月 12 10:47 ./
drwxr-xr-x 9 root     root     4096 10月 17  2019 ../
drwxr-xr-x 2 kea00sys users   16384  7月  7 12:32 2021-07-05/
drwxr-xr-x 2 kea00sys users   16384  7月  7 22:39 2021-07-06/
drwxr-xr-x 2 kea00sys users   16384  7月  8 23:29 2021-07-07/
drwxr-xr-x 2 kea00sys users   16384  7月  9 23:22 2021-07-08/
drwxr-xr-x 2 kea00sys users   16384  7月 10 20:52 2021-07-09/
drwxr-xr-x 2 kea00sys users 8720384  7月 11 19:00 kekka_out/
drwxr-xr-x 2 kea00sys users  573440  7月 11 11:05 rack_out/
-rw-r--r-- 1 kea00sys users    4999  7月 12 05:45 rui_runstats.log
kea00sys@kea00apa:/apdata/oldday>

kea00sys@kea00apa:/tmp> lr MD*_2020* | head -3
-rw-r--r-- 1 kea00sys users  73 11月 17  2020 MD102_60198_20201117042557
-rw-r--r-- 1 kea00sys users  73 11月 17  2020 MD102_60198_20201117042702
-rw-r--r-- 1 kea00sys users  73 11月 17  2020 MD102_60198_20201117042724
kea00sys@kea00apa:/tmp> lr MD*_2020* | tail -3
-rw-r--r-- 1 kea00sys users  73 12月 30  2020 MD102_30081_20201230130831
-rw-r--r-- 1 kea00sys users 146 12月 30  2020 MD102_30081_20201230140545
-rw-r--r-- 1 kea00sys users 146 12月 30  2020 MD102_30081_20201230140551
kea00sys@kea00apa:/tmp>

 lr MD*_202101* | head -3
 lr MD*_202101* | tail -3
 \rm MD*_202101*
 lr MD*_202102* | head -3
 lr MD*_202102* | tail -3
 \rm MD*_202102*

--------------------------------------------------------------------
39：清水 竜也; 総研検査システム１課
2021年07月13日（火） 20:49

異常通知メール対応：

 [2021年 7月 13日 火曜日 20:20:01 JST]マルチ ＡＰサーバ ディスク容量 危険
差出人 	 ：  	kensys@bml.co.jp 
送信日時 	 ：  	2021年07月13日（火） 20:21
To （2件）   	 ：  	multi_log@bml.co.jp, multi_error@bml.co.jp （←宛先を隠す）

下記、ディスク容量がしきい値を越えています。確認してください。

/apdata：94 (しきい値：80%)

---
20:25頃　リモートで入った時点では、70%になっていました。

日次のファイルバックアップの一時的なものと思います。
更にolddayの古い日付を２日分削除。
64%になりました。

そうこうしているうちに、常駐処理が起動。
20:40頃には、46%まで下がりました。 
-----

kea00sys@kea00apa:/apdata/oldday> \rm -r ./2021-07-05/
kea00sys@kea00apa:/apdata/oldday>
kea00sys@kea00apa:/apdata/oldday> df
ファイルシス                                                      1K-ブロック     使用    使用可 使用% マウント位置
devtmpfs                                                               490692        0    490692    0% /dev
tmpfs                                                                  502696        0    502696    0% /dev/shm
tmpfs                                                                  502696     1776    500920    1% /run
tmpfs                                                                  502696        0    502696    0% /sys/fs/cgroup
/dev/mapper/kea00apa--os--vg-root--lv                                 7792080  4597756   2778788   63% /
/dev/dasdc1                                                            237556    50948    168408   24% /boot/zipl
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14126104  9431996   4677724   67% /apdata


kea00sys@kea00apa:/apdata/oldday> \rm -r ./2021-07-06/
kea00sys@kea00apa:/apdata/oldday>
kea00sys@kea00apa:/apdata/oldday> df
ファイルシス                                                      1K-ブロック     使用    使用可 使用% マウント位置
devtmpfs                                                               490692        0    490692    0% /dev
tmpfs                                                                  502696        0    502696    0% /dev/shm
tmpfs                                                                  502696     1776    500920    1% /run
tmpfs                                                                  502696        0    502696    0% /sys/fs/cgroup
/dev/mapper/kea00apa--os--vg-root--lv                                 7792080  4597756   2778788   63% /
/dev/dasdc1                                                            237556    50948    168408   24% /boot/zipl
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14126104  8984664   5125056   64% /apdata


kea00sys@kea00apa:/apdata/today/online/host/Recv/sumi> ll
合計 188904
drwxr-xr-x  2 kea00sys users     32768  7月 13 20:42 ./
drwxr-xr-x 11 kea00sys users      4096  7月 13 20:42 ../
-rwxrwxrwx  1 kea00sys users 150716416  7月 13 20:30 END.IRI.data.8115*
-rwxrwxrwx  1 kea00sys users  20444160  7月 13 20:39 END.IRI.data.8120*
-rwxrwxrwx  1 kea00sys users  20254720  7月 13 20:30 END.KAN.data.8116*
-rwxrwxrwx  1 kea00sys users   1955840  7月 13 20:39 END.KAN.data.8121*
-rwxrwxrwx  1 kea00sys users      2048  7月 13 20:30 HDTR.data.8114*
-rwxrwxrwx  1 kea00sys users      2048  7月 13 20:33 HDTR.data.8117*
-rwxrwxrwx  1 kea00sys users      2048  7月 13 20:36 HDTR.data.8118*
-rwxrwxrwx  1 kea00sys users      2048  7月 13 20:39 HDTR.data.8119*
-rwxrwxrwx  1 kea00sys users      2048  7月 13 20:42 HDTR.data.8122*
kea00sys@kea00apa:/apdata/today/online/host/Recv/sumi>

kea00sys@kea00apa:/apdata/today/online/host/Recv/sumi> df
ファイルシス                                                      1K-ブロック     使用    使用可 使用% マウント位置
devtmpfs                                                               490692        0    490692    0% /dev
tmpfs                                                                  502696        0    502696    0% /dev/shm
tmpfs                                                                  502696     1748    500948    1% /run
tmpfs                                                                  502696        0    502696    0% /sys/fs/cgroup
/dev/mapper/kea00apa--os--vg-root--lv                                 7792080  4597760   2778784   63% /
/dev/dasdc1                                                            237556    50948    168408   24% /boot/zipl
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14126104  6376052   7733668   46% /apdata

--------------------------------------------------------------------
40：横田 克夫; 総研検査システム２課
2021年07月13日（火） 21:25

問合者=自動分析課辻主任,対応時間(分)=清水主任と調査中
ケミストリに属性修正を10分間隔で自動取得し、再計算する仕組みがある。
今回、自動計算されない項目があったので原因を調査してもらいたい。
対象は、7/10受 041-1595 
属性世代は、0が07/10 14:27  66歳、1が07/10 16:10 65歳
本来、5276:シスタチンCの結果と年齢と性別を使って、12120:推算CYSを計算している。
営業からの問合せで計算結果が変わっていない事が判明した。

→調査中。
　当面、属性修正時、営業所から検査室へのFAX連絡の運用は残し、必ず再計算が行われているか確認をお願いした。

→調べたこと。
(1)属性修正の情報は、LD103で取得している。
(2)基幹LinuxのAPサーバログでは、ケミストリからファイルをFTP取得していた。
    2021-07-10T14:37:16.205357+09:00 kitga20a vsftpd[32779]: [kikan] OK DOWNLOAD: Client "::ffff:10.1.42.15", "/data/kikan/Data/6/File/A00/SIRAI002_26114153", 17408 bytes, 47222.22Kbyte/sec
    2021-07-10T16:20:01.096591+09:00 kitga20a vsftpd[52288]: [kikan] OK DOWNLOAD: Client "::ffff:10.1.42.15", "/data/kikan/Data/6/File/A00/SIRAI002_26115448", 1024 bytes, 3773.58Kbyte/sec
    SIRAI002_26114153:R120210710041001595008522800    1500                    099                                      39476                         ｸﾛｻﾜ ﾖｼｵ            　　　　　　　　　　          00  300710S 66Y                                                                  1  0                                                      20210710    0     020210710            001               2000000000142720210710                   41038前橋広瀬川クリニック　　　　　　　　 　　ﾏｴﾊﾞｼﾋﾛｾｶﾞﾜｸﾘﾆﾂｸ    前橋広瀬川クリニックﾏｴﾊﾞｼﾋﾛｾｶﾞ  0 002                                                                                                                                                                                                                                                                                                                                                                                                                             
    SIRAI002_26115448:R120210710041001595008522800    1500                    099                                      39476                         ｸﾛｻﾜ ﾖｼｵ            　　　　　　　　　　          0000300716S 65Y                                                                  1  0                                                      20210710    0     020210710            001                010000000161020210710                   41038前橋広瀬川クリニック　　　　　　　　 　　ﾏｴﾊﾞｼﾋﾛｾｶﾞﾜｸﾘﾆﾂｸ    前橋広瀬川クリニックﾏｴﾊﾞｼﾋﾛｾｶﾞ  0 002                                                                                                                                                                                                                                                                                                                                                                                                                             
(3)ログは以下にあるが、LD103で処理した痕跡がない。
    kea00apa:/apdata/oldday/2021-07-10/aplog/LD103_*
(4)下記の属性修正は取り込めているとの事。（辻主任に確認）
　7/1　016-9277　項目CD538　推算ＧＦＲ

--------------------------------------------------------------------
41：横田 克夫; 総研検査システム２課
2021年07月13日（火） 21:34

問合者=自動分析課辻主任,対応時間(分)=対応中

以下、メールで問合せ。打合せ調整中。
～～～ここから～～～
親）5880  遊離Ｌ鎖κ/λ比
子）5947  κ/λ比
子）5948  遊離Ｌ鎖κ
子）5949  遊離Ｌ鎖λ

上記項目のうち、子）5949  遊離Ｌ鎖λについて、直線性が劣る試薬ロットが納入される旨の連絡がありました。
該当ロットは今月末くらいから使用開始いたします。
そのタイミングで、希釈再検レンジを変更しなければなりません。（日程は調整可能です）

急なお話で申し訳ありませんが、検査現場も先日聞いたばかりでして、検討など切迫した状況です。
取り急ぎご報告と、近いうちにスケジュールを含めて一度お打合せをお願いしたいと思います。
～～～ここまで～～～
～～～続報（ここから）～～～
先日お話ししました　5949   遊離Ｌ鎖λ　の希釈レンジについて、
メーカー案内測定上限　110.0　で直線性が確認出来ましたのでお知らせいたします。
よって希釈レンジは　110.1以上を希釈と設定したいと思います。
～～～続報（ここまで）～～～


--------------------------------------------------------------------
42：清水 竜也; 総研検査システム１課
2021年07月14日（水） 09:16

保全：

 Re: [2021年 7月 13日 火曜日 20:20:01 JST]マルチ ＡＰサーバ ディスク容量 危険
差出人 	 ：  	"清水竜也" <smz.benkei@gmail.com> 
送信日時 	 ：  	2021年07月13日（火） 22:41
To   	 ：  	"multi_error@bml.co.jp" <multi_error@bml.co.jp>
Cc   	 ：  	multi_log@bml.co.jp

日次の裏ジョブも問題なく終わりました。

アラート出した /apdata も今は26%程度になってます。分母が小さい…

---
7/14 9:00 時点、40％台となっていた。

念のため、日付のバックアップをさらに１日分削除した。

kea00sys@kea00apa:/apdata/work> df
ファイルシス                                                      1K-ブロック     使用    使用可 使用% マウント位置
devtmpfs                                                               490692        0    490692    0% /dev
tmpfs                                                                  502696        0    502696    0% /dev/shm
tmpfs                                                                  502696     1748    500948    1% /run
tmpfs                                                                  502696        0    502696    0% /sys/fs/cgroup
/dev/mapper/kea00apa--os--vg-root--lv                                 7792080  4598228   2778316   63% /
/dev/dasdc1                                                            237556    50948    168408   24% /boot/zipl
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14126104  5633116   8476604   40% /apdata
/dev/mapper/kea00apa--os--vg-opt--lv                                  8191416  3571036   4184568   47% /opt
/dev/mapper/kea00apa--os--vg-home--lv                                 2514736   571148   1796132   25% /home


kea00sys@kea00apa:/apdata/oldday> \rm -r ./2021-07-07
kea00sys@kea00apa:/apdata/oldday> ll
合計 9172
drwxr-xr-x 8 kea00sys users    4096  7月 14 09:00 ./
drwxr-xr-x 9 root     root     4096 10月 17  2019 ../
drwxr-xr-x 2 kea00sys users   16384  7月  9 23:22 2021-07-08/
drwxr-xr-x 2 kea00sys users   16384  7月 10 20:52 2021-07-09/
drwxr-xr-x 2 kea00sys users   16384  7月 13 20:23 2021-07-10/
drwxr-xr-x 2 kea00sys users   16384  7月 13 22:33 2021-07-12/
drwxr-xr-x 2 kea00sys users 8728576  7月 13 21:54 kekka_out/
drwxr-xr-x 2 kea00sys users  573440  7月 13 20:30 rack_out/
-rw-r--r-- 1 kea00sys users    4999  7月 12 05:45 rui_runstats.log
kea00sys@kea00apa:/apdata/oldday> df
ファイルシス                                                      1K-ブロック     使用    使用可 使用% マウント位置
devtmpfs                                                               490692        0    490692    0% /dev
tmpfs                                                                  502696        0    502696    0% /dev/shm
tmpfs                                                                  502696     1832    500864    1% /run
tmpfs                                                                  502696        0    502696    0% /sys/fs/cgroup
/dev/mapper/kea00apa--os--vg-root--lv                                 7792080  4598228   2778316   63% /
/dev/dasdc1                                                            237556    50948    168408   24% /boot/zipl
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14126104  5298572   8811148   38% /apdata


--------------------------------------------------------------------
43：横田 克夫; 総研検査システム２課
2021年07月14日（水） 16:57

問合者=7/14 6時20分頃 エラーメール,対応時間(分)=120分

■仕組み
kea00apaサーバのクーロン
0-59/5 5-7 * * *          /home/kea00sys/shell/cron/chk_KNSFLG.sh
0   9-18/3 * * *          /home/kea00sys/shell/cron/chk_KNSFLG.sh

■エラーメール
[2021年 7月 14日 水曜日 06:20:05 JST]検査結果 フラグ異常 確認
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2021年07月14日（水） 06:21
To （2件）  	 ： 	multi_log@bml.co.jp, multi_error@bml.co.jp （←宛先を隠す）
20210713,"00032291300","0002535"
上記、測定結果のフラグがおかしい検体があります。
（ 検査フラグ M、結果状況コード 3 ）
→対応しないと、通知され続けるので、我慢する。

■暫定対応（その１）
締め間際の時間だったので、まずは該当検体でデータ不整合のエラーを検知した旨を連絡。
測定結果を確認して頂いた。（清水主任→ワクイ様）

■暫定対応（その２）
翌日の締め後に当該検体を確認。未報告だったため、ワクイ様に確認。
低値データため確認再検中ということの状況を確認。（横田←→ワクイ様）
藤本課長にも報告。（横田→藤本課長）

■暫定対応（その３）
・対象データ
　添付ファイル参照
・対応方法を調査
　(1)現場で対応方法を知っている人はいないか？
　　→いない。
　(2)強制的に報告できないか？
　　→結果入力画面でフラグを「報告可」に変えて報告実施。
　　→「報告済(重複指示)」で報告できない。
　(3)報告フラグリセット画面でリセットできないか？
　　→対象データ無しとなり、リセットできない。
　→お手上げなので、イントラを使った結果入力を藤本課長に依頼した。

■暫定対応（その４）
菅野主任から結果入力が完了した旨の連絡を貰う。
このままだとエラーメールが続いてしまうため、フラグを変更。（M:未報告完了→E:報告済 ）
select * from kekka where utkymd='2021-07-13' and irino ='00032291300' and kmkcd='0002535' and knsflg='M'
update kekka set knsflg='E' where utkymd='2021-07-13' and irino ='00032291300' and kmkcd='0002535' and knsflg='M'

■恒久対応
今後、本腰を入れて調査が必要

20210714_ケミストリ_測定結果フラグのおかしいデータ有りメール対応.xlsx
雑多な資料.pdf

--------------------------------------------------------------------
44：横田 克夫; 総研検査システム２課
2021年07月14日（水） 23:40

電算課よりパトライト点灯連絡(清水主任対応不可の連絡有り、代打)

エラーメール
[ /apdata/aplog/FATAL_DAILY_2021-07-13.log ]
-------------------------------------------------------------------
日次が正常に終わっていない可能性があります。
2021-07-13 ログを確認して下さい。
スキップされた行数      = 0
挿入された行数          = 217054
更新された行数          = 0
拒否された行数          = 0
コミットされた行数      = 217054

DB20000I  TERMINATE コマンドが正常に完了しました。

データベース接続情報

データベース・サーバー = DB2/LINUX 9.7.4
SQL 許可 ID            = DB2INST1
ローカル・データベース別名 = KEA00DBN

[2021年  7月 14日 水曜日 22:54:47 JST][SHU_KEKKA] import start ----->
-------------------------------------------------------------------

■調査
tail -f /apdata/oldday/2021-07-13/daily.log

  2021/07/14 23:23:53▼▼ 累積集計情報runstats --- 開始 ▼▼

   データベース接続情報

 データベース・サーバー = DB2/LINUXZ64 11.1.4.4
 SQL 許可 ID            = DB2INST1
 ローカル・データベース別名 = KEA00DB

[2021年  7月 14日 水曜日 23:23:54 JST][RIREKI] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
DB20000I  TERMINATE コマンドが正常に完了しました。

   データベース接続情報

 データベース・サーバー = DB2/LINUXZ64 11.1.4.4
 SQL 許可 ID            = DB2INST1
 ローカル・データベース別名 = KEA00DB

[2021年  7月 14日 水曜日 23:32:36 JST][RUI_CTRLKKA] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
[2021年  7月 14日 水曜日 23:35:57 JST][SHUSEI_KANJYA] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
DB20000I  TERMINATE コマンドが正常に完了しました。
  2021/07/14 23:35:57▲▲ 累積集計情報runstats --- 終了 ▲▲
2021/07/14 23:35:57▲▲ 日次処理 --- 終了 ▲▲

→無事に終了

■日次JOB終了確認
kea00sys@kea00apa:/apdata/oldday/2021-07-13> ps -ef | grep dai
kea00sys  3437  3229  0 23:28 pts/4    00:00:00 view daily.log
kea00sys  9149 61601  0 23:37 pts/2    00:00:00 grep --color=auto dai
kea00sys 13664 13564  0 21:31 pts/0    00:00:00 sh /home/kea00sys/shell/daily/daily.sh db2inst1 db2inst1

→特に裏Jobの累積DBへの追加「/imp_shu.sh」 が無いかどうか確認
→問題無しと判断。確認完了とした。


--------------------------------------------------------------------
45：横田 克夫; 総研検査システム２課
2021年07月15日（木） 20:18

問合者=7/15 19時00分頃 辻主任,対応時間(分)=60分

大至急、下記項目の再検率を調査してもらいたい。
　5948:遊離Ｌ鎖κ
　5949:遊離Ｌ鎖λ
期間は、2020年4月～2021年3月

→下記のSQLで集計、添付のEXCELを作成し、送付した。
　SQLは纏めて実行すると負荷がかかるため、月毎に１２回実行した。
　◆依頼数取得
    select KMKCD,count(*) from RUI_IRAI where 
    utkymd >= '2021-03-01' and utkymd < '2021-04-01' and
    KMKCD in ('0005948','0005949') group by KMKCD order by 1 for read only with ur
　◆再検数取得
    select KMKCD,count(*) from RUI_KEKKA where 
    utkymd >= '2021-03-01' and utkymd < '2021-04-01' and
    KMKCD in ('0005948','0005949') and knssu>1 group by KMKCD order by 1 for read only with ur

20210715_遊離Ｌ鎖再検率調査.xlsx

--------------------------------------------------------------------
46：清水 竜也; 総研検査システム１課
2021年07月16日（金） 00:38

異常通知メール対応：

２３時過ぎと、０時過ぎに異常通知メール、また電算化より都度連絡あり。
日次処理など状況を確認。日次は進んでおり、電算化には問題なしと返答した。

2021年 7月 15日 木曜日 23:05:01 JST]マルチ エラーログ 報告
差出人 	 ：  	kensys@bml.co.jp 
送信日時 	 ：  	2021年07月15日（木） 23:05
To （2件）   	 ：  	multi_log@bml.co.jp ... （→宛先をすべて表示する）

[ /apdata/aplog/FATAL_DAILY_2021-07-14.log ]
-------------------------------------------------------------------
日次が正常に終わっていない可能性があります。
2021-07-14 ログを確認して下さい。
挿入された行数          = 110578
更新された行数          = 272
拒否された行数          = 0
コミットされた行数      = 110850

[2021年  7月 15日 木曜日 22:48:26 JST][RUI_KEKKA] import start ----->

読み込まれた行数        = 590327
スキップされた行数      = 0
挿入された行数          = 590327
更新された行数          = 0
拒否された行数          = 0
コミットされた行数      = 590327

[2021年  7月 15日 木曜日 22:56:31 JST][RUI_KENORDER] import start ----->
-------------------------------------------------------------------


 [2021年 7月 16日 金曜日 00:10:02 JST]マルチ エラーログ 報告
差出人 	 ：  	kensys@bml.co.jp 
送信日時 	 ：  	2021年07月16日（金） 00:10
To （2件）   	 ：  	multi_log@bml.co.jp ... （→宛先をすべて表示する）


[ /apdata/aplog/WARNING_DAILY_20210716_0005012021-07-14.log ]
-------------------------------------------------------------------
<<<<<  テストメール  >>>>>
日次が正常に終わっていない可能性がありますが
過去１５分以内にログが出力されているので
多分大丈夫です。
データベース・サーバー = DB2/LINUXZ64 11.1.4.4
SQL 許可 ID            = DB2INST1
ローカル・データベース別名 = KEA00DB

[2021年  7月 16日 金曜日 00:00:56 JST][RIREKI] runstats start ----->
-------------------------------------------------------------------

上記、エラーログが存在しています。確認してください。
---

■日次のログ確認をする。
/apdata/oldday/2021-07-14/daily.log

エラーはなく、処理進み、ログも都度はかれているので問題なしと判断。

■Diskの使用率

/apdata も　２０～４０％台で推移しており、問題なし

■日次の裏Jobの状況

０時15分過ぎにみると、裏Jobはなく、daily.sh だけなので問題なし
kea00sys@kea00apa:/apdata/today/online/host/Recv/sumi> ps -ef | grep dai
kea00sys 15700 15605  0  7月15 pts/1   00:00:00 sh /home/kea00sys/shell/daily/daily.sh db2inst1 db2inst1
kea00sys 34003 26048  0 00:30 pts/0    00:00:00 grep --color=auto dai
kea00sys@kea00apa:/apdata/today/online/host/Recv/sumi>

■依頼展開系のファイル

処理済みフォルダーに移動しているので問題なし。

kea00sys@kea00apa:/apdata/today/online/host/Recv/sumi> wc *KA*
   35013   800959 35853312 END.KAN.data.8919
     857    19302   877568 END.KAN.data.8924
    1858    42278  1902592 END.KAN.data.8929
     548    11625   561152 END.KAN.data.8934
     161     3554   164864 END.KAN.data.8939
    1678    38732  1718272 END.KAN.data.8944
     887    20143   908288 END.KAN.data.8949
     262     5804   268288 END.KAN.data.8954
     385     8601   394240 END.KAN.data.8959
     878    19629   899072 END.KAN.data.8964
     657    13765   672768 END.KAN.data.8969
     352     8010   360448 END.KAN.data.8974
    1703    39892  1743872 END.KAN.data.8979
     357     8057   365568 END.KAN.data.8984
     453    10539   463872 END.KAN.data.8989
   46049  1050890 47154176 合計

以上

--------------------------------------------------------------------
47：清水 竜也; 総研検査システム１課
2021年07月16日（金） 10:55

>>45
問合者=7/16 10時30分頃 藤本課長  対応時間(分)=25分

昨日の再検率一覧に今年の4月～6月を追加して欲しい。
　5948:遊離Ｌ鎖κ
　5949:遊離Ｌ鎖λ
期間は、2021年4月～2021年6月

→下記のSQLで集計、昨日の一覧に追加し送付した。
　SQLは纏めて実行すると負荷がかかるため、月毎に実行。
　◆依頼数取得
    select KMKCD,count(*) from RUI_IRAI where 
    utkymd >= '2021-06-01' and utkymd < '2021-07-01' and
    KMKCD in ('0005948','0005949') group by KMKCD order by 1 for read only with ur
　◆再検数取得
    select KMKCD,count(*) from RUI_KEKKA where 
    utkymd >= '2021-06-01' and utkymd < '2021-07-01' and
    KMKCD in ('0005948','0005949') and knssu>1 group by KMKCD order by 1 for read only with ur

20210716_遊離Ｌ鎖再検率調査.xlsx

--------------------------------------------------------------------
48：清水 竜也; 総研検査システム１課
2021年07月16日（金） 23:47

日次アラートメール対応：

 [2021年 7月 16日 金曜日 23:05:01 JST]マルチ エラーログ 報告
差出人 	 ：  	kensys@bml.co.jp 
送信日時 	 ：  	2021年07月16日（金） 23:06
To （2件）   	 ：  	multi_log@bml.co.jp ... 


[ /apdata/aplog/FATAL_DAILY_2021-07-15.log ]
-------------------------------------------------------------------
日次が正常に終わっていない可能性があります。
2021-07-15 ログを確認して下さい。
> SELECT COUNT(KNSKISYMD) FROM SHU_KEKKA WHERE KNSKISYMD = '2019-07-16'

[2021年  7月 16日 金曜日 22:59:06 JST] SHU_KEKKA 削除前 566186 件 です。

[2021年  7月 16日 金曜日 22:59:06 JST] SELECT BEFORE END ------------------------------<


[2021年  7月 16日 金曜日 22:59:06 JST] DELETE SHU_KEKKA KNSKISYMD = '2019-07-16' START ------>

> DELETE FROM (SELECT KNSKISYMD, SRIYMD, KNTNO, KNSGRP, KMKCD, KNSSU, KNSSUEDA FROM SHU_KEKKA WHERE KNSKISYMD = '2019-07-16' FETCH FIRST 10000 ROWS ONLY)

[2021年  7月 16日 金曜日 22:59:25 JST] 10000 / 566186 件削除しました。
[2021年  7月 16日 金曜日 22:59:35 JST] 20000 / 566186 件削除しました。
[2021年  7月 16日 金曜日 22:59:46 JST] 30000 / 566186 件削除しました。
[2021年  7月 16日 金曜日 22:59:57 JST] 40000 / 566186 件削除しました。
-------------------------------------------------------------------

上記、エラーログが存在しています。確認してください。

----
以下を確認した。


■日次のログが進んでいること。
　最後に runstats終了、日次処理の終了のメーッセージが表示されたこと。

/apdata/oldday/2021-07-15/daily.log

[2021年  7月 16日 金曜日 23:17:18 JST][RUI_CTRLKKA] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
[2021年  7月 16日 金曜日 23:20:42 JST][SHUSEI_KANJYA] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
DB20000I  TERMINATE コマンドが正常に完了しました。
  2021/07/16 23:20:42▲▲ 累積集計情報runstats --- 終了 ▲▲
2021/07/16 23:20:42▲▲ 日次処理 --- 終了 ▲▲

■日次処理が終了した旨のログ出力後、日次関連の裏jobないこと。
ps -ef | grep dai
kea00sys 22591 22252  0 22:29 pts/1    00:00:00 tail -f daily.log
kea00sys 56382 56280  0 20:32 pts/0    00:00:00 sh /home/kea00sys/shell/daily/daily.sh db2inst1 db2inst1
kea00sys 61782 22692  0 23:25 pts/2    00:00:00 grep --color=auto dai
kea00sys@kea00apa:~>

■Diskスペース　特に /apdata が 20％台以下であること。

ea00sys@kea00apa:/apdata/oldday/2021-07-15> df
ファイルシス                                                      1K-ブロック     使用    使用可 使用% マウント位置
devtmpfs                                                               490692        0    490692    0% /dev
tmpfs                                                                  502696        0    502696    0% /dev/shm
tmpfs                                                                  502696     1748    500948    1% /run
tmpfs                                                                  502696        0    502696    0% /sys/fs/cgroup
/dev/mapper/kea00apa--os--vg-root--lv                                 7792080  4601460   2775084   63% /
/dev/dasdc1                                                            237556    50948    168408   24% /boot/zipl
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14126104  2610980  11498740   19% /apdata
/dev/mapper/kea00apa--os--vg-opt--lv                                  8191416  3581968   4173636   47% /opt
/dev/mapper/kea00apa--os--vg-home--lv                                 2514736   571608   1795672   25% /home
/dev/mapper/kea00apa--os--vg-var--lv                                  2514736   682736   1684544   29% /var
tmpfs                                                                  100540        0    100540    0% /run/user/1001
KEA00IAW08:/apdata/today/file/KEA00/KEA00IA                          10154048  8271264   1358656   86% /apdata/today/file/KEA00/KEA00IAW08
KEA00IAW21:/apdata/today/file/KEA00/KEA00IA                         470416384  7962624 438557696    2% /apdata/today/file/KEA00/KEA00IAW21
KEA00IAW22:/apdata/today/file/KEA00/KEA00IA                         470416384  7694336 438825984    2% /apdata/today/file/KEA00/KEA00IAW22
KEA00IAW23:/apdata/today/file/KEA00/KEA00IA                         460151808 12035072 424719360    3% /apdata/today/file/KEA00/KEA00IAW23
KEA00IAW24:/apdata/today/file/KEA00/KEA00IA                         460151808 11590656 425163776    3% /apdata/today/file/KEA00/KEA00IAW24
KEA00IAW02:/apdata/today/file/KEA00/KEA00IA                          74660160 64409552   6458064   91% /apdata/today/file/KEA00/KEA00IAW02
tmpfs                                                                  100540        0    100540    0% /run/user/0
kea00sys@kea00apa:/apdata/oldday/2021-07-15>


■依頼展開系のファイルが処理済みに移っていること。

kea00sys@kea00apa:/apdata/today/online/host/Recv/sumi> wc *KA*
   19276   441465 19738624 END.KAN.data.9269
    1874    45063  1918976 END.KAN.data.9274
    1249    29036  1278976 END.KAN.data.9279
     148     3399   151552 END.KAN.data.9284
    1041    24072  1065984 END.KAN.data.9289
    2120    48833  2170880 END.KAN.data.9294
    2127    48094  2178048 END.KAN.data.9299
     902    20370   923648 END.KAN.data.9304
    2251    50900  2305024 END.KAN.data.9309
     257     5478   263168 END.KAN.data.9314
     914    20307   935936 END.KAN.data.9319
    2835    66043  2903040 END.KAN.data.9324
    1014    23622  1038336 END.KAN.data.9329
     226     5013   231424 END.KAN.data.9334
     194     4470   198656 END.KAN.data.9339
    2837    64974  2905088 END.KAN.data.9344
     865    18993   885760 END.KAN.data.9349
   40130   920132 41093120 合計
kea00sys@kea00apa:/apdata/today/online/host/Recv/sumi>

以上、問題なしと判断。対応完了。


補足：　木曜受で比較的受付は少ないはずだが、
　　　　日次の開始～終了まで、３時間弱かかっている。

kea00sys@kea00apa:/apdata/oldday/2021-07-15> head -5 daily.log
2021/07/16 20:32:31▼▼ 日次処理 --- 開始 ▼▼
受付日は[2021-07-16]でよろしいですか(y/n)
  2021/07/16 20:34:51▼▼ 常駐プロセスの停止 --- 開始 ▼▼
…
kea00sys@kea00apa:/apdata/oldday/2021-07-15> tail -5 daily.log
[2021年  7月 16日 金曜日 23:20:42 JST][SHUSEI_KANJYA] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
DB20000I  TERMINATE コマンドが正常に完了しました。
  2021/07/16 23:20:42▲▲ 累積集計情報runstats --- 終了 ▲▲
2021/07/16 23:20:42▲▲ 日次処理 --- 終了 ▲▲

--------------------------------------------------------------------
49：清水 竜也; 総研検査システム１課
2021年07月19日（月） 23:49

日次アラートメール対応：

 [2021年 7月 19日 月曜日 23:05:01 JST]マルチ エラーログ 報告
差出人 	 ：  	kensys@bml.co.jp 
送信日時 	 ：  	2021年07月19日（月） 23:06
To （2件）   	 ：  	multi_log@bml.co.jp ... 


[ /apdata/aplog/FATAL_DAILY_2021-07-17.log ]
-------------------------------------------------------------------
日次が正常に終わっていない可能性があります。
2021-07-17 ログを確認して下さい。

[2021年  7月 19日 月曜日 22:58:18 JST] DELETE RUI_KEKKA KNSKISYMD = '2019-07-19' START ------>

> DELETE FROM (SELECT KNSKISYMD, SRIYMD, KNTNO, KNSGRP, KMKCD, KNSSU, KNSSUEDA FROM RUI_KEKKA WHERE KNSKISYMD = '2019-07-19' FETCH FIRST 10000 ROWS ONLY)

[2021年  7月 19日 月曜日 22:58:29 JST] 10000 / 482708 件削除しました。
[2021年  7月 19日 月曜日 22:58:40 JST] 20000 / 482708 件削除しました。
[2021年  7月 19日 月曜日 22:58:49 JST] 30000 / 482708 件削除しました。
[2021年  7月 19日 月曜日 22:58:58 JST] 40000 / 482708 件削除しました。
[2021年  7月 19日 月曜日 22:59:08 JST] 50000 / 482708 件削除しました。
[2021年  7月 19日 月曜日 22:59:19 JST] 60000 / 482708 件削除しました。
[2021年  7月 19日 月曜日 22:59:27 JST] 70000 / 482708 件削除しました。
[2021年  7月 19日 月曜日 22:59:39 JST] 80000 / 482708 件削除しました。
[2021年  7月 19日 月曜日 22:59:49 JST] 90000 / 482708 件削除しました。
[2021年  7月 19日 月曜日 22:59:57 JST] 100000 / 482708 件削除しました。
-------------------------------------------------------------------

上記、エラーログが存在しています。確認してください。

---
以下の内容を確認した。

■日次のログが進んでいること。
　最後に runstats終了、日次処理の終了のメーッセージが表示されたこと。

/apdata/oldday/2021-07-17/daily.log

[2021年  7月 19日 月曜日 23:25:22 JST][RIREKI] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
DB20000I  TERMINATE コマンドが正常に完了しました。
・・
[2021年  7月 19日 月曜日 23:34:03 JST][RUI_CTRLKKA] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
[2021年  7月 19日 月曜日 23:37:28 JST][SHUSEI_KANJYA] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
DB20000I  TERMINATE コマンドが正常に完了しました。
  2021/07/19 23:37:28▲▲ 累積集計情報runstats --- 終了 ▲▲
2021/07/19 23:37:28▲▲ 日次処理 --- 終了 ▲▲


■日次処理が終了した旨のログ出力後、日次関連の裏jobないこと。

ps -ef | grep dai
kea00sys 49185  1514  0 23:42 pts/2    00:00:00 grep --color=auto dai
kea00sys 55792 55548  0 20:42 pts/0    00:00:00 sh /home/kea00sys/shell/daily/daily.sh db2inst1 db2inst1
kea00sys@kea00apa:/apdata/today/online/host/Recv/sumi>


■Diskスペース　特に /apdata が 20％台以下であること。

kea00sys@kea00apa:/apdata/today/online/host/Recv/sumi> df
ファイルシス                                                      1K-ブロック     使用    使用可 使用% マウント位置
devtmpfs                                                               490692        0    490692    0% /dev
tmpfs                                                                  502696        0    502696    0% /dev/shm
tmpfs                                                                  502696     1748    500948    1% /run
tmpfs                                                                  502696        0    502696    0% /sys/fs/cgroup
/dev/mapper/kea00apa--os--vg-root--lv                                 7792080  4602964   2773580   63% /
/dev/dasdc1                                                            237556    50948    168408   24% /boot/zipl
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14126104  2930244  11179476   21% /apdata
/dev/mapper/kea00apa--os--vg-opt--lv                                  8191416  3591972   4163632   47% /opt
/dev/mapper/kea00apa--os--vg-home--lv                                 2514736   571744   1795536   25% /home
/dev/mapper/kea00apa--os--vg-var--lv                                  2514736   641308   1725972   28% /var
tmpfs                                                                  100540        0    100540    0% /run/user/1001
KEA00IAW08:/apdata/today/file/KEA00/KEA00IA                          10154048  8274464   1355456   86% /apdata/today/file/KEA00/KEA00IAW08
KEA00IAW21:/apdata/today/file/KEA00/KEA00IA                         470416384  7972864 438547456    2% /apdata/today/file/KEA00/KEA00IAW21
KEA00IAW22:/apdata/today/file/KEA00/KEA00IA                         470416384  7701504 438818816    2% /apdata/today/file/KEA00/KEA00IAW22
KEA00IAW23:/apdata/today/file/KEA00/KEA00IA                         460151808 12067840 424685568    3% /apdata/today/file/KEA00/KEA00IAW23
KEA00IAW24:/apdata/today/file/KEA00/KEA00IA                         460151808 11602944 425151488    3% /apdata/today/file/KEA00/KEA00IAW24
KEA00IAW02:/apdata/today/file/KEA00/KEA00IA                          74660160 65046208   5821408   92% /apdata/today/file/KEA00/KEA00IAW02
tmpfs                                                                  100540        0    100540    0% /run/user/0


■依頼展開系のファイルが処理済みに移っていること。

kea00sys@kea00apa:/apdata/today/online/host/Recv/sumi> wc *KA*
   22614   517977 23156736 END.KAN.data.0080
    3558    82464  3643392 END.KAN.data.0085
     164     3616   167936 END.KAN.data.0090
     387     8890   396288 END.KAN.data.0095
    1166    26104  1193984 END.KAN.data.0100
    1877    43458  1922048 END.KAN.data.0105
     866    19498   886784 END.KAN.data.0110
    1669    37904  1709056 END.KAN.data.0115
     561    12617   574464 END.KAN.data.0120
     984    21867  1007616 END.KAN.data.0125
    2514    56846  2574336 END.KAN.data.0130
     396     8820   405504 END.KAN.data.0135
    1393    31989  1426432 END.KAN.data.0140
    2579    60200  2640896 END.KAN.data.0145
     520    11982   532480 END.KAN.data.0150
     563    12570   576512 END.KAN.data.0155
    1511    35838  1547264 END.KAN.data.0160
     285     6552   291840 END.KAN.data.0165
     869    19927   889856 END.KAN.data.0170
   44476  1019119 45543424 合計
   
   kea00sys@kea00apa:/apdata/today/online/host/Recv/sumi> wc *IR*
   195957   2374095 200659968 END.IRI.data.0079
    31336    377842  32088064 END.IRI.data.0084
     1892     22341   1937408 END.IRI.data.0089
     2700     31938   2764800 END.IRI.data.0094
    12142    147960  12433408 END.IRI.data.0099
    19333    234599  19796992 END.IRI.data.0104
     6977     85920   7144448 END.IRI.data.0109
    15569    187650  15942656 END.IRI.data.0114
     5453     64932   5583872 END.IRI.data.0119
     8331    101777   8530944 END.IRI.data.0124
    26399    323283  27032576 END.IRI.data.0129
     3880     46736   3973120 END.IRI.data.0134
    15820    186934  16199680 END.IRI.data.0139
    27638    332703  28301312 END.IRI.data.0144
     4019     49171   4115456 END.IRI.data.0149
     5236     61958   5361664 END.IRI.data.0154
    17571    210975  17992704 END.IRI.data.0159
     1365     16456   1397760 END.IRI.data.0164
    10764    127445  11022336 END.IRI.data.0169
   412382   4984715 422279168 合計
   
以上、問題なしと判断。対応完了。


補足：休日明けでも、日次のスタートが遅いことに疑問を持ち、現場へ行ってそれがわかった。

      夜間に向け、各号機のコントロール、試薬を補充した後、コントロールのデータの値が
      良好かどうか確認・調整をし、それらが決着した後に、日次を開始するとのことで
      通常報告はないものの、出勤者も少なく、日次スタートは火曜日以降と同様に遅い。

--------------------------------------------------------------------
51：清水 竜也; 総研検査システム１課
2021年07月21日（水） 02:13

日次アラートメール対応:

今日は裏JobがRUI_KEKKAの import で止まっていた。NGなパターン。
日次Jobをキャンセル。累積DBを再起動し、リカバリーJobを起動する。

 [2021年 7月 20日 火曜日 23:05:02 JST]マルチ エラーログ 報告
差出人      ：      kensys@bml.co.jp 
送信日時      ：      2021年07月20日（火） 23:06
To （2件）        ：      multi_log@bml.co.jp ... （→宛先をすべて表示する）

[ /apdata/aplog/FATAL_DAILY_2021-07-19.log ]
-------------------------------------------------------------------
日次が正常に終わっていない可能性があります。
2021-07-19 ログを確認して下さい。
挿入された行数          = 981816
更新された行数          = 0
拒否された行数          = 0
コミットされた行数      = 981816

[2021年  7月 20日 火曜日 22:08:47 JST][RUI_KANJYA] import start ----->

読み込まれた行数        = 115228
スキップされた行数      = 0
挿入された行数          = 115228
更新された行数          = 0
拒否された行数          = 0
コミットされた行数      = 115228

[2021年  7月 20日 火曜日 22:21:51 JST][RUI_KEKKA] import start ----->
-------------------------------------------------------------------

上記、エラーログが存在しています。確認してください。

----
■ログ確認　　現在23時過ぎだが、RUI_KEKKA の importがおよそ１時間前に始まっているのに
　　　　　　　終わっていない。これはNGのパターン。

[2021年  7月 20日 火曜日 22:08:47 JST][RUI_KANJYA] import start ----->

読み込まれた行数        = 115228
スキップされた行数      = 0
挿入された行数          = 115228
更新された行数          = 0
拒否された行数          = 0
コミットされた行数      = 115228

[2021年  7月 20日 火曜日 22:21:51 JST][RUI_KEKKA] import start ----->

■日次Job、および裏Jobのプロセスを確認。２つ同時に kill する。

kea00sys@kea00apa:/apdata/oldday/2021-07-19> ps -ef | grep dai
kea00sys  5236 59139  0 20:36 pts/1    00:00:00 sh /home/kea00sys/shell/daily/imp_rui.sh kea00db db2inst1 db2inst1
kea00sys 52188 30335  0 23:28 pts/0    00:00:00 grep --color=auto dai
kea00sys 59139 59045  0 20:13 pts/1    00:00:00 sh /home/kea00sys/shell/daily/daily.sh db2inst1 db2inst1
kea00sys@kea00apa:/apdata/oldday/2021-07-19> kill -9 59139 5236
kea00sys@kea00apa:/apdata/oldday/2021-07-19> !ps
ps -ef | grep dai
kea00sys 53576 30335  0 23:30 pts/0    00:00:00 grep --color=auto dai
kea00sys@kea00apa:/apdata/oldday/2021-07-19> 


■累積DBのW08側で、DB状態を確認。

[db2inst1@KEA00IAW08 ~]$ db2 list application

Auth Id  Application    Appl.      Application Id                                                 DB       # of
         Name           Handle                                                                    Name    Agents
-------- -------------- ---------- -------------------------------------------------------------- -------- -----
DB2INST1 db2bp          51378      10.1.42.15.48646.210720113654                                  KEA00DBN 1

[db2inst1@KEA00IAW08 ~]$

■累積DBの停止と再起動（KEA00IAW08上で実施）
[db2inst1@KEA00IAW08 shell]$ sh ./dbn_force.sh
DB20000I  The FORCE APPLICATION command completed successfully.
DB21024I  This command is asynchronous and may not be effective immediately.

[db2inst1@KEA00IAW08 shell]$ db2 list application
SQL1611W  No data was returned by Database System Monitor.
[db2inst1@KEA00IAW08 shell]$ sh ./dbn_reboot.sh
DB20000I  The FORCE APPLICATION command completed successfully.
DB21024I  This command is asynchronous and may not be effective immediately.

SQL1064N  DB2STOP processing was successful.
SQL1063N  DB2START processing was successful.
[db2inst1@KEA00IAW08 shell]$

■APサーバで、累積DBをアクセスできるか確認

db2 connect to kea00db user db2inst1 using db2inst1

   データベース接続情報

 データベース・サーバー = DB2/LINUXZ64 11.1.4.4
 SQL 許可 ID            = DB2INST1
 ローカル・データベース別名 = KEA00DB

kea00sys@kea00apa:/apdata/oldday/2021-07-19> db2 "select * from RUI_KEKKA fetch first 1 rows only for read only "

KNSKISYMD  SRIYMD     KNTNO         KNTKETFLG KNSGRP           KMKCD   KNSSU  KNSSUEDA IRIHSMKBN IRIKBN KSKTKBN UTKYMD     IRINO       IRIKETFLG ZSSDINO
SSTCD   TRID       TRPOS  ASYRCKID   ASYRCKPOS OYAKMKCD SECCD BKFKKBN SMPCD   BSKKBN BSKLNE BSKGOK BSKSEQ      BSKERRSTS SKTDH                      NBKMK
CD TSTRFLG ZRCD YSNLBL KJNO FKHKKNOHJKBN TBKJNO TBKJFLG HTKFKHMS                 SKFLG TSKFLG TKTFLG JISKSBR         KKFLG KKIRIFLG KKIRILOTNO HSYKFLG HS
KFLG HHKKFLG RAWDATA              KNSKKA1      KNSKKA2                  KNSKKA2KBN KKAHSKCD HJKKA                    SDI KKACMT1 KKACMT2 KKAJKCD PNCRGFLG

---------- ---------- ------------- --------- ---------------- ------- ------ -------- --------- ------ ------- ---------- ----------- --------- -------
2020-09-18 2020-09-18 00155411100             0719             0000864      1        0 0         A      A       2020-09-18 00155411100                 0
4713400 2RAT0382       89 55573              4 0000864  A     0       0719    BIOM   24     240600         479           2020-09-19-04.12.05.000000 052
   R       023  00     005                              　　　　　　　　　　　　                     1                                       0
                 22.9                     22.9                                              22.9                                         3       0
 0           0        1        5      5      5                                 0               0               0                       3       38289
 0           4           8          2020-09-19-04.14.38.000000 1000-01-01-00.00.00.000001 2020-09-19-17.44.20.032317 04:17:05 1000-01-01           0
   0       1      1                  1      E      1         1         0         0         1         0         0         1         0         0         1
        0         0         0         0         1         0         1         1         1                                 2020-09-19-17.44.20.032317 2020
-09-19-04.17.05.269310         22.9

  1 レコードが選択されました。

■リカバリーJobの起動

kea00sys@kea00apa:~/shell/daily> ll dai*
-rwxr-xr-x 1 kea00sys users 16963  3月 30 19:54 daily.sh*
-rwxr-xr-x 1 kea00sys users  4937  6月  3 11:11 daily_recover_rui.sh*
-rwxr-xr-x 1 kea00sys users  8497  1月 27 12:47 daily_upsysdate.sh*
-rwxr-xr-x 1 kea00sys users 15245  3月 17 17:08 daily_work.sh*

kea00sys@kea00apa:~/shell/daily> ./daily_recover_rui.sh  db2inst1 db2inst1

○imp_rui_work.sh を用いて累積ＤＢへのインポートをやり直します。

よろしいですか？(y/n)==>
y
やり直しを行う元処理日を入力してください(20210719) :
20210719
処理日[2021-07-19]分の累積インポートをやり直します。よろしいですか(y/n)
y
  2021/07/20 23:44:17▼▼ 累積インポートリカバリー処理 --- 開始 ▼▼
  2021/07/20 23:44:17▼▼ 累積に追加＆累積から未報告分削除 --- 開始 ▼▼


--------------------------------------------------------------------
52：清水 竜也; 総研検査システム１課
2021年07月21日（水） 06:25

日次アラートメール対応:

今日は裏JobがRUI_KEKKAの import で止まっていた。NGなパターン。
日次Jobをキャンセル。累積DBを再起動し、リカバリーJobを起動する。

 [2021年 7月 20日 火曜日 23:05:02 JST]マルチ エラーログ 報告
差出人      ：      kensys@bml.co.jp 
送信日時      ：      2021年07月20日（火） 23:06
To （2件）        ：      multi_log@bml.co.jp ... （→宛先をすべて表示する）

[ /apdata/aplog/FATAL_DAILY_2021-07-19.log ]
-------------------------------------------------------------------
日次が正常に終わっていない可能性があります。
2021-07-19 ログを確認して下さい。
挿入された行数          = 981816
更新された行数          = 0
拒否された行数          = 0
コミットされた行数      = 981816

[2021年  7月 20日 火曜日 22:08:47 JST][RUI_KANJYA] import start ----->

読み込まれた行数        = 115228
スキップされた行数      = 0
挿入された行数          = 115228
更新された行数          = 0
拒否された行数          = 0
コミットされた行数      = 115228

[2021年  7月 20日 火曜日 22:21:51 JST][RUI_KEKKA] import start ----->
-------------------------------------------------------------------

上記、エラーログが存在しています。確認してください。

----
■ログ確認　　現在23時過ぎだが、RUI_KEKKA の importがおよそ１時間前に始まっているのに
　　　　　　　終わっていない。これはNGのパターン。

[2021年  7月 20日 火曜日 22:08:47 JST][RUI_KANJYA] import start ----->

読み込まれた行数        = 115228
スキップされた行数      = 0
挿入された行数          = 115228
更新された行数          = 0
拒否された行数          = 0
コミットされた行数      = 115228

[2021年  7月 20日 火曜日 22:21:51 JST][RUI_KEKKA] import start ----->

■日次Job、および裏Jobのプロセスを確認。２つ同時に kill する。

kea00sys@kea00apa:/apdata/oldday/2021-07-19> ps -ef | grep dai
kea00sys  5236 59139  0 20:36 pts/1    00:00:00 sh /home/kea00sys/shell/daily/imp_rui.sh kea00db db2inst1 db2inst1
kea00sys 52188 30335  0 23:28 pts/0    00:00:00 grep --color=auto dai
kea00sys 59139 59045  0 20:13 pts/1    00:00:00 sh /home/kea00sys/shell/daily/daily.sh db2inst1 db2inst1
kea00sys@kea00apa:/apdata/oldday/2021-07-19> kill -9 59139 5236
kea00sys@kea00apa:/apdata/oldday/2021-07-19> !ps
ps -ef | grep dai
kea00sys 53576 30335  0 23:30 pts/0    00:00:00 grep --color=auto dai
kea00sys@kea00apa:/apdata/oldday/2021-07-19> 


■累積DBのW08側で、DB状態を確認。

[db2inst1@KEA00IAW08 ~]$ db2 list application

Auth Id  Application    Appl.      Application Id                                                 DB       # of
         Name           Handle                                                                    Name    Agents
-------- -------------- ---------- -------------------------------------------------------------- -------- -----
DB2INST1 db2bp          51378      10.1.42.15.48646.210720113654                                  KEA00DBN 1

[db2inst1@KEA00IAW08 ~]$

■累積DBの停止と再起動（KEA00IAW08上で実施）
[db2inst1@KEA00IAW08 shell]$ sh ./dbn_force.sh
DB20000I  The FORCE APPLICATION command completed successfully.
DB21024I  This command is asynchronous and may not be effective immediately.

[db2inst1@KEA00IAW08 shell]$ db2 list application
SQL1611W  No data was returned by Database System Monitor.
[db2inst1@KEA00IAW08 shell]$ sh ./dbn_reboot.sh
DB20000I  The FORCE APPLICATION command completed successfully.
DB21024I  This command is asynchronous and may not be effective immediately.

SQL1064N  DB2STOP processing was successful.
SQL1063N  DB2START processing was successful.
[db2inst1@KEA00IAW08 shell]$

■APサーバで、累積DBをアクセスできるか確認

db2 connect to kea00db user db2inst1 using db2inst1

   データベース接続情報

 データベース・サーバー = DB2/LINUXZ64 11.1.4.4
 SQL 許可 ID            = DB2INST1
 ローカル・データベース別名 = KEA00DB

kea00sys@kea00apa:/apdata/oldday/2021-07-19> db2 "select * from RUI_KEKKA fetch first 1 rows only for read only "

KNSKISYMD  SRIYMD     KNTNO         KNTKETFLG KNSGRP           KMKCD   KNSSU  KNSSUEDA IRIHSMKBN IRIKBN KSKTKBN UTKYMD     IRINO       IRIKETFLG ZSSDINO
SSTCD   TRID       TRPOS  ASYRCKID   ASYRCKPOS OYAKMKCD SECCD BKFKKBN SMPCD   BSKKBN BSKLNE BSKGOK BSKSEQ      BSKERRSTS SKTDH                      NBKMK
CD TSTRFLG ZRCD YSNLBL KJNO FKHKKNOHJKBN TBKJNO TBKJFLG HTKFKHMS                 SKFLG TSKFLG TKTFLG JISKSBR         KKFLG KKIRIFLG KKIRILOTNO HSYKFLG HS
KFLG HHKKFLG RAWDATA              KNSKKA1      KNSKKA2                  KNSKKA2KBN KKAHSKCD HJKKA                    SDI KKACMT1 KKACMT2 KKAJKCD PNCRGFLG

---------- ---------- ------------- --------- ---------------- ------- ------ -------- --------- ------ ------- ---------- ----------- --------- -------
2020-09-18 2020-09-18 00155411100             0719             0000864      1        0 0         A      A       2020-09-18 00155411100                 0
4713400 2RAT0382       89 55573              4 0000864  A     0       0719    BIOM   24     240600         479           2020-09-19-04.12.05.000000 052
   R       023  00     005                              　　　　　　　　　　　　                     1                                       0
                 22.9                     22.9                                              22.9                                         3       0
 0           0        1        5      5      5                                 0               0               0                       3       38289
 0           4           8          2020-09-19-04.14.38.000000 1000-01-01-00.00.00.000001 2020-09-19-17.44.20.032317 04:17:05 1000-01-01           0
   0       1      1                  1      E      1         1         0         0         1         0         0         1         0         0         1
        0         0         0         0         1         0         1         1         1                                 2020-09-19-17.44.20.032317 2020
-09-19-04.17.05.269310         22.9

  1 レコードが選択されました。

■リカバリーJobの起動

kea00sys@kea00apa:~/shell/daily> ll dai*
-rwxr-xr-x 1 kea00sys users 16963  3月 30 19:54 daily.sh*
-rwxr-xr-x 1 kea00sys users  4937  6月  3 11:11 daily_recover_rui.sh*
-rwxr-xr-x 1 kea00sys users  8497  1月 27 12:47 daily_upsysdate.sh*
-rwxr-xr-x 1 kea00sys users 15245  3月 17 17:08 daily_work.sh*

kea00sys@kea00apa:~/shell/daily> ./daily_recover_rui.sh  db2inst1 db2inst1

○imp_rui_work.sh を用いて累積ＤＢへのインポートをやり直します。

よろしいですか？(y/n)==>
y
やり直しを行う元処理日を入力してください(20210719) :
20210719
処理日[2021-07-19]分の累積インポートをやり直します。よろしいですか(y/n)
y
  2021/07/20 23:44:17▼▼ 累積インポートリカバリー処理 --- 開始 ▼▼
  2021/07/20 23:44:17▼▼ 累積に追加＆累積から未報告分削除 --- 開始 ▼▼
  2021/07/21 03:11:39▲▲ 累積に追加＆累積から未報告分削除 --- 終了 ▲▲
  2021/07/21 03:11:39▼▼ EXPORTファイル(ixf, msg)圧縮＆結果out圧縮・削除 --- 開始 ▼▼
[2021年  7月 21日 水曜日 03:11:39 JST][*.ixf] gzip start ----->
[2021年  7月 21日 水曜日 03:12:29 JST][*.msg] gzip start ----->
[2021年  7月 21日 水曜日 03:12:29 JST][*.dat] gzip start ----->
[2021年  7月 21日 水曜日 03:12:30 JST][*.trg] gzip start ----->
[2021年  7月 21日 水曜日 03:12:30 JST][*.del] gzip start ----->
[2021年  7月 21日 水曜日 03:12:30 JST][kekka_out] tar cvfz start ----->
  2021/07/21 03:19:41▲▲ EXPORTファイル(ixf, msg)圧縮＆結果out圧縮・削除 --- 終了 ▲▲
2021/07/21 03:19:41▲▲ 日次処理 --- 終了 ▲▲

--------------------------------------------------------------------
53：羽生 達哉; 総研検査システム２課
2021年07月26日（月） 16:47

IA のＤＢサーバーテスト機(KEA00IAW20)にftpコマンドが入っていなかったので
KEA00IAW08からコピーしてきました。

KEA00IAW08:/usr/bin/ftp -> KEA00IAW20:/usr/bin へコピー
KEA00IAW08:/usr/lib/libreadline.so.5 -> KEA00IAW20:/usr/lib へコピー
KEA00IAW08:/usr/lib/libncurses.so.5 -> KEA00IAW20:/usr/lib へコピー

KEA00IAW20はftpサーバーは何故か動いているので、KEA00IAW08側からftpのbinaryモードでput
その後、chmod a+x で実行権限をつけています。

OSのバージョンが RHEL5.4 -> RHEL7.3とだいぶ違いますがとりあえず動いているので大丈夫かと。

--------------------------------------------------------------------
54：横田 克夫; 総研検査システム２課
2021年07月26日（月） 18:43

問合者=自動分析課 菅野主任,対応時間(分)=90
7/20受255-5827 の 0013094:食塩摂取量 について、EXCELの「食塩摂取量計算ツール」で結果送信しても下記のメッセージが表示される。
　以下の結果の登録はスキップされました。
　　受付日:2021-07-20 依頼書ＮＯ:2555827 項目コード:0013094
このままだとホストに結果送信ができないので対応してもらいたい。

→過去の対応履歴を確認
　https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=28#follow
　保留依頼情報(HKHRIRAI)の報告保留区分(HKKHRKBN)を、3:再計算待ちから0:報告保留解除済みに変更
　select * from HKHRIRAI where utkymd='2021-07-20' and irino='00255582700' and kmkcd='0013094'
　update HKHRIRAI set hkkhrkbn='0' where utkymd='2021-07-20' and irino='00255582700' and kmkcd='0013094' and hkkhrkbn='3'
　→変わらず、「食塩摂取量計算ツール」のメッセージが出る。

→「食塩摂取量計算ツール」のVBAソースを調査。
→→同ファイルの「設定情報」シートの「起動アプリ」を起動している。
→→→スキップのメッセージは、「C:\Program Files\BML\NxtGene01\DS349.exe」で出している。

→「DS349」のソース(DS349.vb)を調査。
→→\\10.1.103.226\NAS_Backup\総研システム部\総研システム３課\01_ケミストリ\99_資料\ソース\Source\Solution\NxtGene01\DS349
                If dsKekka.Tables.Item(0).Rows.Count = 0 Then
                    skipRecord.Append(vbCrLf)
                    skipRecord.Append(" 受付日：" & parts(0).ToString & " 依頼書NO：" & parts(1).ToString & " 項目コード：" & parts(2).ToString)
                    ' ケミストリーにオーダーが存在しない場合 or 結果がすでに存在する場合（スキップ）
                    gclsLogger.gs_PutNml(gclsLogger.ModeLog.OPT, _
                                         "DS349", _
                                         gclsSysConfig.LoginID, _
                                         "mf_FileProcess", _
                                         "", _
                                         "登録処理スキップ ・・ 受付日：" & parts(0).ToString & " 依頼書NO：" & parts(1).ToString & " 項目コード：" & parts(2).ToString)

→ログファイルにSQLを出力している模様
→→C:\Program Files\BML\NxtGene01\Log\Bml.log
    2021/07/26  17:13:01    OPT DS349       Main                        Main Start
    2021/07/26  17:13:01    OPT DS349   system  ZD101                       gf_GetSysBaseDate START
    2021/07/26  17:13:01    OPT DS349   system  ZD101                       SQL： SELECT  KJNSRIYMD  FROM SYSKNRMST FOR READ ONLY
    2021/07/26  17:13:01    OPT DS349   system  mf_CreateSearchKijunMstSQL                      SELECT  ・・・　FOR READ ONLY
    2021/07/26  17:13:02    OPT DS349   system  mf_FileProcess                      登録処理スキップ ・・ 受付日：2021/07/20 依頼書NO：2555827 項目コード：0013094
    2021/07/26  17:13:02    OPT DS349   system  mf_FileProcess                      ファイル処理完了：C:\Program Files\BML\NxtGene01\send_file\2021072617152627.dat
    2021/07/26  17:13:23    OPT DS349   system  Main                        Main End
→→→KEKKAテーブルにレコードがあるとスキップしてる事が判明
→→→別の依頼の同一項目を菅野主任に確認したところ、KEKKAテーブルにレコードがない。
　　　select * from kekka where utkymd='2021-07-24' and irino='00255402100' order by kmkcd
→→→何かのタイミングでKEKKAテーブルにレコードが出来てしまった。原因不明。

→一旦、KEKKAテーブルの検査開始日を変更。
　　select * from kekka where utkymd='2021-07-20' and irino='00255582700' and kmkcd='0013094'
　　update kekka set KNSKISYMD='2000-01-01' where utkymd='2021-07-20' and irino='00255582700' and kmkcd='0013094'
→「食塩摂取量計算ツール」で再実行したところ、スキップのメッセージが消えた。
→依頼書№単位結果入力画面で、結果が張り付いた事を確認していただく。
→不要となったレコードをバックアップ取得の上、削除
　　select * from kekka where KNSKISYMD='2000-01-01' and irino='00255582700' and kmkcd='0013094'
　　delete from kekka where KNSKISYMD='2000-01-01' and irino='00255582700' and kmkcd='0013094'



Bml.log.1
Bml.log
20210726_バックアップ.xlsx
20210726_HC.pdf
食塩摂取量計算ツール.xlsm
DELデータ.csv

--------------------------------------------------------------------
55：横田 克夫; 総研検査システム２課
2021年07月26日（月） 18:49

問合者=自動分析課 藤本課長,対応時間(分)=30
履歴チェック対象になっているか確認してもらいたい。
　0007707:バンコマイシン　←　有る不明
　0000680:エラスターゼ１　←　間違いなく有る

→下記の結果を報告。
　select * from RRKCHKMST where kmkcd='0007707' fetch first 5 rows only 
　　→無し
　select * from RRKCHKMST where kmkcd='0000680' fetch first 5 rows only 
　　→有り

→他の項目についても問合せを受けそうだったので、マスタの全件を抽出し送付。
　select * from RRKCHKMST order by 1,2,3

履歴チェックマスタ.xlsx

--------------------------------------------------------------------
56：羽生 達哉; 総研検査システム２課
2021年07月28日（水） 12:35

日次処理終了チェックを変更しました。
以前からテストで動かしていたログファイルのタイムスタンプを確認するバージョンに変えています。

合わせてcronでのチェック間隔も変更しています。
23,0,1時の３回 -> 23:00 ～ 01:45 まで１５分間間隔

#0  23,0,1 * * *               /home/kea00sys/shell/cron/chk_daily_end.sh    <- 今までの処理
*/15  23,0,1 * * *             /home/kea00sys/shell/cron/chk_daily_end.sh   <- 新しい処理


--------------------------------------------------------------------
58：羽生 達哉; 総研検査システム２課
2021年07月28日（水） 14:08

APサーバーの /tmp に MD102_*のファイルが大量に残っているので、
７日以上前のものは削除しました。

実行コマンド
/usr/bin/find /tmp -mtime +7 -name 'MD102*' -exec /usr/bin/rm {} \; > /dev/null 2>&1


そのうちcronに仕込みます。

--------------------------------------------------------------------
59：横田 克夫; 総研検査システム２課
2021年07月29日（木） 10:53

問合者=高倉課長,対応時間(分)=30
3:40分頃からＢＭの測定結果がＤＢに反映されない。

→IAサーバのプロセスを確認したところ、「ZD888.sh」がいなかったので、起動。
　cd /home/kea00sys/bin/
　/bin/bash - /home/kea00sys/bin/ZD888.sh &

→測定結果がDBに取り込まれた事を確認。

★本来、IAサーバで動作するプロセスは以下の３つ。
[kea00sys@KEA00IAW21 ~]$ ps -ef | grep ZD
kea00sys  9646     1  0 02:09 ?        00:00:48 /bin/bash - /home/kea00sys/bin/ZD777.sh
kea00sys  9827     1  3 02:10 ?        00:17:38 /home/kea00sys/bin/ZD999IA /home/kea00sys/bin/ZD999IA.ini
kea00sys 11340     1  0 02:17 ?        00:00:39 /bin/bash - /home/kea00sys/bin/ZD888.sh
kea00sys 14009 13961  0 10:54 pts/1    00:00:00 grep ZD


--------------------------------------------------------------------
60：横田 克夫; 総研検査システム２課
2021年07月29日（木） 15:36

問合者=マルチ／たかなし様,対応時間(分)=15

■内容
　再検のワークシートを切ろうとしても
　「しばらくお待ちください」と出るので
　ワークシートを切れるようにしてほしい

■対応
　PCフリーズは無いが、下記の事象と同じ。
　https://bmlgrp.cybozu.com/g/message/view.csp?cid=22503&rid=134886&mid=657153&follow_id=6#follow
　
　下記の対応を実施。
　select * from KNSSEQKNRI where KNSKISYMD='2021-07-28' fetch first 5000 rows only for read only with ur
　select * from KNSSEQKNRI where knsgrp='KEA00SYS'
　delete from KNSSEQKNRI where knsgrp='KEA00SYS'

　実施後、ワークシートが印刷できる事をご確認いただいた。

20210729_バックアップデータ.csv

--------------------------------------------------------------------
61：横田 克夫; 総研検査システム２課
2021年07月29日（木） 15:54

問合者=マルチ／クラモチさま,対応時間(分)=30

分注ＥＮＤ受信時、サンプリングリストが自動出力されるハズが印刷されていない。
再印刷を実施しても、データ無しとなる。
データ無しは、おかしいので、調べてもらいたい。

■調査
　(1)TeraTermマクロで「/apdata/work/gyoumu/sh/lst_menu.sh」を起動
　(2)「隔日検査用サンプリングリスト再出力」は「23」。
　　　「/home/kea00sys/shell/cron/SmpLst/repri_smplst.sh」を起動。
　(3)上記シェルは「/apdata/today/online/host/ok_Recv」配下のファイルを使って再印刷。
　(4)「smplst.sumi」があれば再印刷可能。
　(5)ログ「/apdata/aplog/SmpLst.log」を見ると、なぜか「7月 29日 木曜日 00:58:03」に動作。
　　　データが揃っていない状態でリスト情報を作成してしまい、対象データ無しとなっていた。

■リカバリ
　(1)ファイルリネーム
　　/apdata/today/online/host/ok_Recv
	　7月 29 00:58 xxx.lst_smplst.txt_202107290058
	　7月 29 01:03 xxx.lst_smplst.txt_202107290103
	　7月 29 01:03 xxx.smplst.sumi
	※ファイル名の先頭に「xxx.」を付与。
　(2)cronの実行コマンドをコピペして実行
　　「/home/kea00sys/shell/cron/SmpLst/pri_smplst.sh >> /apdata/aplog/SmpLst.log」
　(3)実行ログを確認
		*****    サンプリングリスト    START [2021年  7月 29日 木曜日 15:17:22 JST]  *****
		リクエスト ID は prt01-613 です (0 個のファイル)
		*****    サンプリングリスト    END [2021年  7月 29日 木曜日 15:17:27 JST]  *****
		分注END後にリスト出力済みです。[2021年  7月 29日 木曜日 15:18:01 JST]
　(4)ファイルが作成される事を確認
　　/apdata/today/online/host/ok_Recv
	　7月 29 15:17 lst_smplst.txt_202107291517
	　7月 29 15:17 smplst.sumi
　(5)現場に連絡を取ってリストを確認して頂く。問題無しのため、対応完了とした。



20210729_サンプリングリスト.pdf

--------------------------------------------------------------------
62：清水 竜也; 総研検査システム１課
2021年08月02日（月） 13:26

８月の保守携帯の転送先を 横田課長の会社携帯に設定しました。

横田課長：携帯本体は今週出社した際、お渡しします。

--------------------------------------------------------------------
63：羽生 達哉; 総研検査システム２課
2021年08月02日（月） 13:30

IAサーバーのDB2再起動処理を本日の14:30に実施します。

問題ないようであれば、自動実行の時間を月曜早朝へ変更します。


--------------------------------------------------------------------
64：羽生 達哉; 総研検査システム２課
2021年08月02日（月） 15:44

IAサーバーのDB2再起動処理を毎週月曜の4:01に実施します。

正常に再起動した場合はmulti_log@bml.co.jpへメールを送ります。
エラーが発生した場合はmulti_error@bml.co.jpへメールを送ります。


--------------------------------------------------------------------
65：清水 竜也; 総研検査システム１課
2021年08月02日（月） 15:57

IAの W02 に置いている日付毎のバックアップフォルダーが 98％とFULLに近いため
IAの W21に同様のDirを作成し、ひとまず 3/1～3/9分を mv しました。
10日で2GB程。　w02  98％ --> 94％へ。

このIA 下とは別に、NAS など更にどこか別の所へバックアップをとってるかどうか等
どなたかご存じですか？

---
KEA00IAW08:/apdata/today/file/KEA00/KEA00IA                         9.7G  7.9G  1.4G   86% /apdata/today/file/KEA00/KEA00IAW08
KEA00IAW21:/apdata/today/file/KEA00/KEA00IA                         449G  7.9G  418G    2% /apdata/today/file/KEA00/KEA00IAW21
KEA00IAW22:/apdata/today/file/KEA00/KEA00IA                         449G  7.5G  419G    2% /apdata/today/file/KEA00/KEA00IAW22
KEA00IAW23:/apdata/today/file/KEA00/KEA00IA                         439G   12G  406G    3% /apdata/today/file/KEA00/KEA00IAW23
KEA00IAW24:/apdata/today/file/KEA00/KEA00IA                         439G   12G  406G    3% /apdata/today/file/KEA00/KEA00IAW24
KEA00IAW02:/apdata/today/file/KEA00/KEA00IA                          72G   66G  1.9G   98% /apdata/today/file/KEA00/KEA00IAW02

drwxr-xr-x   2 kea00sys users 16384  3月  2 22:21 2021-03-01/
drwxr-xr-x+  2 kea00sys users 12288  3月  3 23:51 2021-03-02/
drwxr-xr-x+  2 kea00sys users 16384  3月  5 08:33 2021-03-03/
drwxr-xr-x+  2 kea00sys users 16384  3月  5 22:14 2021-03-04/
drwxr-xr-x+  2 kea00sys users 12288  3月  6 20:34 2021-03-05/
drwxr-xr-x+  2 kea00sys users 12288  3月  8 20:40 2021-03-06/
drwxr-xr-x+  2 kea00sys users 12288  3月 10 00:14 2021-03-08/
drwxr-xr-x+  2 kea00sys users 12288  3月 10 22:15 2021-03-09/
kea00sys@kea00apa://apdata/today/file/KEA00/KEA00IAW21/bak_daily>

KEA00IAW21:/apdata/today/file/KEA00/KEA00IA                         449G   10G  416G    3% /apdata/today/file/KEA00/KEA00IAW21
KEA00IAW22:/apdata/today/file/KEA00/KEA00IA                         449G  7.5G  419G    2% /apdata/today/file/KEA00/KEA00IAW22
KEA00IAW23:/apdata/today/file/KEA00/KEA00IA                         439G   12G  406G    3% /apdata/today/file/KEA00/KEA00IAW23
KEA00IAW24:/apdata/today/file/KEA00/KEA00IA                         439G   12G  406G    3% /apdata/today/file/KEA00/KEA00IAW24
KEA00IAW02:/apdata/today/file/KEA00/KEA00IA                          72G   64G  4.2G   94% /apdata/today/file/KEA00/KEA00IAW02

kea00sys@kea00apa:/apdata/today/file/KEA00/KEA00IAW02/bak_daily> ls
2021-03-10  2021-03-23  2021-04-03  2021-04-15  2021-04-27  2021-05-13  2021-05-25  2021-06-05  2021-06-17  2021-06-29  2021-07-10  2021-07-24
2021-03-11  2021-03-24  2021-04-05  2021-04-16  2021-04-28  2021-05-14  2021-05-26  2021-06-07  2021-06-18  2021-06-30  2021-07-12  2021-07-26
2021-03-12  2021-03-25  2021-04-06  2021-04-17  2021-04-30  2021-05-15  2021-05-27  2021-06-08  2021-06-19  2021-07-01  2021-07-13  2021-07-27
2021-03-13  2021-03-26  2021-04-07  2021-04-19  2021-05-01  2021-05-17  2021-05-28  2021-06-09  2021-06-21  2021-07-02  2021-07-14  2021-07-28
2021-03-15  2021-03-27  2021-04-08  2021-04-20  2021-05-06  2021-05-18  2021-05-29  2021-06-10  2021-06-22  2021-07-03  2021-07-15  2021-07-29
2021-03-16  2021-03-29  2021-04-09  2021-04-21  2021-05-07  2021-05-19  2021-05-31  2021-06-11  2021-06-23  2021-07-05  2021-07-16  2021-07-30
2021-03-17  2021-03-30  2021-04-10  2021-04-22  2021-05-08  2021-05-20  2021-06-01  2021-06-12  2021-06-24  2021-07-06  2021-07-17
2021-03-18  2021-03-31  2021-04-12  2021-04-23  2021-05-10  2021-05-21  2021-06-02  2021-06-14  2021-06-25  2021-07-07  2021-07-19
2021-03-19  2021-04-01  2021-04-13  2021-04-24  2021-05-11  2021-05-22  2021-06-03  2021-06-15  2021-06-26  2021-07-08  2021-07-20
2021-03-22  2021-04-02  2021-04-14  2021-04-26  2021-05-12  2021-05-24  2021-06-04  2021-06-16  2021-06-28  2021-07-09  2021-07-21
---

--------------------------------------------------------------------
66：横田 克夫; 総研検査システム２課
2021年08月03日（火） 12:59

問合者=エラーメール,対応時間(分)=30

[2021年 8月 3日 火曜日 07:05:04 JST]検査結果 フラグ異常 確認
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2021年08月03日（火） 07:06
To （2件）  	 ： 	multi_log@bml.co.jp, multi_error@bml.co.jp （←宛先を隠す）
20210802,"00304470500","0000538"
上記、測定結果のフラグがおかしい検体があります。
（ 検査フラグ M、結果状況コード 3 ）

→清水主任から現場に連絡していただく。
　藤本課長と連絡が取れ、当該依頼は、計算元項目が報告されていないため”確認中”として頂く。
→藤本課長に連絡し、イントラから手入力して頂いた。
→エラーメールが送られてくるので、下記のSQLを清水主任にご確認いただいた後、実行。
select * from kekka where utkymd='2021-08-02' and irino ='00304470500' and kmkcd='0000538' and knsflg='M'
update kekka set knsflg='E' where utkymd='2021-08-02' and irino ='00304470500' and kmkcd='0000538' and knsflg='M'


--------------------------------------------------------------------
67：小林 洋一; 総研検査システム２課
2021年08月03日（火） 16:12

問合者=自動分析課金山,対応時間(分)=20
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=54#follow
受日:20210730
依頼書NO:0373474
食塩摂取量が3:再計算待ちから変わらないので対応してもらいたい。
下記SQLを実行し対応。

select * from HKHRIRAI where utkymd='2021-07-30' and irino='00037347400' and kmkcd='0013094'
update HKHRIRAI set hkkhrkbn='0' where utkymd='2021-07-30' and irino='00037347400' and kmkcd='0013094' and hkkhrkbn='3'
select * from kekka where utkymd='2021-07-30' and irino='00037347400' and kmkcd='0013094'
update kekka set KNSKISYMD='2000-01-01' where utkymd='2021-07-30' and irino='00037347400' and kmkcd='0013094'

CSEでバックアップしレコード削除
select * from kekka where KNSKISYMD='2000-01-01' and irino='00037347400' and kmkcd='0013094'
delete from kekka where KNSKISYMD='2000-01-01' and irino='00037347400' and kmkcd='0013094'

--------------------------------------------------------------------
68：小林 洋一; 総研検査システム２課
2021年08月03日（火） 16:41

>>67
現場に確認しましたが関家さんが気が付いて対応したら現場へ連絡していたそうです。

--------------------------------------------------------------------
69：横田 克夫; 総研検査システム２課
2021年08月05日（木） 07:45

問合者=エラーメール,対応時間(分)=30

日次処理チェックのエラーメールを受信。
メールを確認し、日次裏処理が動作中である事を確認。
→正常終了ログが出る事を確認した。
　kea00apa:/apdata/oldday/2021-08-03/daily.log
　　DB20000I  TERMINATE コマンドが正常に完了しました。
　　2021/08/05 00:23:45▲▲ 累積集計情報runstats --- 終了 ▲▲
　　2021/08/05 00:23:45▲▲ 日次処理 --- 終了 ▲▲

[2021年 8月 4日 水曜日 230502 JST]マルチ エラーログ 報告.txt
[2021年 8月 4日 水曜日 232001 JST]マルチ エラーログ 報告.txt
[2021年 8月 4日 水曜日 233501 JST]マルチ エラーログ 報告.txt
[2021年 8月 4日 水曜日 235001 JST]マルチ エラーログ 報告.txt
[2021年 8月 5日 木曜日 000501 JST]マルチ エラーログ 報告.txt
[2021年 8月 5日 木曜日 002001 JST]マルチ エラーログ 報告.txt

--------------------------------------------------------------------
70：横田 克夫; 総研検査システム２課
2021年08月05日（木） 08:10

問合者=エラーメール,対応時間(分)=30

[2021年 8月 5日 木曜日 06:30:05 JST]検査結果 フラグ異常 確認
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2021年08月05日（木） 06:30
To （2件）  	 ： 	multi_log@bml.co.jp, multi_error@bml.co.jp （←宛先を隠す）
20210804,"00304455400","0000538"
上記、測定結果のフラグがおかしい検体があります。
（ 検査フラグ M、結果状況コード 3 ）

→現場に連絡。ワクイ氏にデータ確認を要請。
→「データに問題無いため、当該依頼のケミストリ項目はすべて報告した」事を確認
→フラグが正しい状態になり、エラー通知メールが止まった。

→その後のヒアリング状況によると...
　・538:ｽｲｻﾝGFRは計算項目。
　・計算元項目が低値のため、「検査グループ単位結果入力画面」で再検とした。
　・その後、再検測定を行った。
　→ここで、意図せず、検査項目の538:ｽｲｻﾝGFRが報告可の状態になり、報告された可能性があるとの事。
　　→継続して調査予定。（羽生主事ヘルプです！）

→メールに気が付かず現場連絡が遅くなるリスクがあるため、下記の仕組みを検討する。
　・定期的に、おかしいフラグのデータを見つけるシェルのなかで、
　　APPLOGテーブルへのデータ書き込みと、パトランプ点灯を実装。
　　パトランプが付いたら確認して頂くよう、藤本課長と相談し実装。
　　（横田から藤本課長に説明します。他、環境準備は適宜担当を割り振らせて頂きます）

--------------------------------------------------------------------
71：羽生 達哉; 総研検査システム２課
2021年08月05日（木） 13:00

\\10.1.103.226\NAS_Backup\総研システム部\総研システム３課\01_ケミストリ\01_受託案件\02_分析機追加_ZS050
は
02_機能設計～05_単体テストまで空

とりあえず一番詳しいドキュメントは
\\10.1.103.226\NAS_Backup\総研システム部\総研システム３課\01_ケミストリ\99_資料\01_各種設計_定義書\オンライン関連_ZS050\資料
の
ZS050オンライン_再検処理_仕様概要.docx
ZS050状態遷移図.xlsx
です。

--------------------------------------------------------------------
72：羽生 達哉; 総研検査システム２課
2021年08月05日（木） 15:18

@:横田 克夫; 総研検査システム２課

>>70
>→その後のヒアリング状況によると...
>　・538:ｽｲｻﾝGFRは計算項目。
>　・計算元項目が低値のため、「検査グループ単位結果入力画面」で再検とした。
                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^
                                               このタイミングで、計算項目が報告可にならないだろうか？  
>　・その後、再検測定を行った。
>　→ここで、意図せず、検査項目の538:ｽｲｻﾝGFRが報告可の状態になり、報告された可能>性があるとの事。


--------------------------------------------------------------------
73：清水 竜也; 総研検査システム１課
2021年08月05日（木） 15:50

横田課長より連絡あり、下記のメール対応を行う。対応時間(分)=50
----
 ラック情報の削除依頼
差出人 	 ：  	"竹澤 富雄" <tomio_takezawa@bml.co.jp> 
送信日時 	 ：  	2021年08月05日（木） 12:26
To （2件）   	 ：  	"横田 克夫" <k-yokota@bml.co.jp>, "清水 竜也" <shimizu@bml.co.jp>
Cc   	 ：  	"辻 祐輝" <yuki_tsuji@bml.co.jp> （←宛先を隠す）

横田課長

お疲れ様です。
ZS側で誤って登録したラック情報の削除をお願いいたします。
トレーID：1SIN0235
SEQ：23536～23600

対応よろしくお願い致します。

竹澤
---

検査：倉持さんに確認する、分注OKとの事で、
該当データのバックアップ後、以下のSQLを手動で実行した。

●トレー登録前に戻す場合(分注ＯＫ分)
①KENORDERの更新
---update KENORDER   SET TRID = '____0000',  TRPOS = 0, KNSJKFLG = ' ' \
select kntno, trid,trpos,knsjkflg  from KENORDER \
WHERE   KNSKISYMD = '2021-08-04' \
AND    TRID = '1SIN0235' \
AND     KNSJKFLG <> ' ' \
AND  KNSSEQ >=23536 \
AND  KNSSEQ <=23600 \

②KENPOSの削除
--delete  from KENPOS \
select count(*) from KENPOS \
WHERE  KNSKISYMD = '2021-08-04' \
AND    TRID = '1SIN0235' \
and    RAKITJHO = 'A' \

③WSSEQKNRIの更新(指定したトレーの情報を全て削除する場合)
--UPDATE  WSSEQKNRI  SET  WSSBT = '',  WSNO = 0
select *  from WSSEQKNRI \
WHERE  KNSKISYMD = '2021-08-04' \
AND  WSSBT = '1SIN'  \
AND  WSNO = 235

--------------------------------------------------------------------
74：横田 克夫; 総研検査システム２課
2021年08月05日（木） 20:26

問合者=竹澤さん、辻主任,対応時間(分)=120

ZS 第2レーンに接続の4号機～6号機の結果が8:17のコントロール結果を最後に、システムに取り込めなくなった。
ZSの再立ち上げを実施しコントロールを流したが、やはり取り込めない。

■調査
(1)一次ファイル
　kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl/new
　→大量に残っている。(3285ファイル)
(2)ログ
　kea00apa:/apdata/aplog/MD102_2_20210805.log
　→下記の通り
　　[2000]件の結果一時ファイルを読込み...
　　測定項目(チャネル)の結果が揃っていません。Rack[55044] Pos[3]
　　　～上記と同じメッセージでRack・POS違いの行が500行近く出力～
　　ラックの検体結果が揃っていません。RackID[81920] POS[001]
　　　～上記と同じメッセージでRackID・POS違いの行が100行近く出力～
(3)ヒアリング
　－ZSの再起動を実施した
　－再測定(同じラックを再度測定する操作)を実施した
　－搬送システムの方で「コンポーネントエラー」が出ていた

■原因(想定)
(1)一次ファイルが2000を超えて滞留。
　　→2000を超えると処理しないロジック
(2)ファイルが増えてしまったのは、おそらく、登録装置のエラーで
　　送られてくるはずのファイル(*1)が送られてなかったので、
　　処理が進まなかったから。
　　*1:/apdata/today/file/KEA00/kea00ap/ZS050/lane/result/end/のファイル

■対処
(1)現場に確認したところ、通報した時点で測定済にも関わらず
　　結果が取り込まれていないラックは無いとの事だったので、
　　取り込み待ち結果ファイルを退避。
　　/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl/new
　　　↓
　　/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl/new_20210805
(2)プロセス再起動を実施したかったが、第1レーンに接続の1～3号機が稼働中だったため、そのまま再起動せず。
　　※やるとしたら、/home/kea00sys/shell/daily/prcZS_onoff.shだが、号機指定が出来ない！注意！
(3)この状態でコントロールを流してもらったところ結果が取り込まれた。
　　検体も確認して頂き、問題無さそうなので、測定終了後に下記のお願いした上で使用を再開。
　　　・未入力となっている項目が無い
　　　・分析器の結果と、サテライト内の結果が一致している（抜粋で）

■今後の対応
日設に登録装置のエラー調査と対応を依頼するように、辻主任に要請した。

--------------------------------------------------------------------
75：横田 克夫; 総研検査システム２課
2021年08月07日（土） 08:45

問合者=エラーメール,対応時間(分)=30

日次処理チェックのエラーメールを受信。
メールを確認し、日次裏処理が動作中である事を確認。
→正常終了ログが出る事を確認した。
　kea00apa:/apdata/oldday/2021-08-05/daily.log
　　DB20000I  TERMINATE コマンドが正常に完了しました。
　　2021/08/06 23:31:48▲▲ 累積集計情報runstats --- 終了 ▲▲
　　2021/08/06 23:31:48▲▲ 日次処理 --- 終了 ▲▲

[2021年 8月 6日 金曜日 230501 JST]マルチ エラーログ 報告.txt
[2021年 8月 6日 金曜日 232001 JST]マルチ エラーログ 報告.txt

--------------------------------------------------------------------
76：横田 克夫; 総研検査システム２課
2021年08月07日（土） 09:50

日次バックアップファイルの移動作業を実施しました。

・移動元フォルダ
　kea00apa:/apdata/today/file/KEA00/KEA00IAW02/bak_daily/
　　2021-03-10　～　2021-03-31
・移動先フォルダ
　kea00apa:/apdata/today/file/KEA00/KEA00IAW21/bak_daily/
・Disk使用率
　作業前
　　KEA00IAW21:/apdata/today/file/KEA00/KEA00IA 449G   11G  416G    3% /apdata/today/file/KEA00/KEA00IAW21
　　KEA00IAW02:/apdata/today/file/KEA00/KEA00IA  72G   65G  2.7G   97% /apdata/today/file/KEA00/KEA00IAW02
　作業後
　　KEA00IAW21:/apdata/today/file/KEA00/KEA00IA 449G   15G  412G    4% /apdata/today/file/KEA00/KEA00IAW21
　　KEA00IAW02:/apdata/today/file/KEA00/KEA00IA  72G   61G  7.1G   90% /apdata/today/file/KEA00/KEA00IAW02

> このIA 下とは別に、NAS など更にどこか別の所へバックアップをとってるかどうか等
> どなたかご存じですか？
引き継ぎ当初、バックアップ用ＮＡＳが無かったようなので、藤本課長に説明しＮＡＳの購入申請を要請しました。
ＮＡＳが納品されましたので、小林殿にセットアップを指示。現在作業中です。
小林殿へ＞忙しいところ悪いけど、対応をお願いします。

※作業ログ（抜粋）
kea00sys@kea00apa:/apdata/today/file/KEA00/KEA00IAW02/bak_daily> date ; mv 2021-03-30 /apdata/today/file/KEA00/KEA00IAW21/bak_daily/ ; date
2021年  8月  7日 土曜日 09:34:39 JST
2021年  8月  7日 土曜日 09:35:42 JST
kea00sys@kea00apa:/apdata/today/file/KEA00/KEA00IAW02/bak_daily> date ; mv 2021-03-31 /apdata/today/file/KEA00/KEA00IAW21/bak_daily/ ; date
2021年  8月  7日 土曜日 09:35:42 JST
2021年  8月  7日 土曜日 09:36:44 JST

--------------------------------------------------------------------
77：小林 洋一; 総研検査システム２課
2021年08月10日（火） 14:10

KEA00IAW12のDISKmount対応
7/28の停電後にUSBのハードディスクがマウントされていなかった様です。
下記のコマンドを実行し対応。
[root@KEA00IAW12 usb]# fdisk -l

Disk /dev/sda: 79.9 GB, 79999009280 bytes
255 heads, 63 sectors/track, 9725 cylinders
Units = シリンダ数 of 16065 * 512 = 8225280 bytes

 デバイス ブート   始点      終点  ブロック   ID  システム
/dev/sda1             1         7     56196   12  Compaq 診断
/dev/sda2   *         8        20    104422+  83  Linux
/dev/sda3            21      9463  75850897+  83  Linux
/dev/sda4          9464      9725   2104515    f  Win95 拡張領域 (LBA)
/dev/sda5          9464      9724   2096451   82  Linux スワップ

Disk /dev/sdb: 2000.3 GB, 2000398934016 bytes
255 heads, 63 sectors/track, 243201 cylinders
Units = シリンダ数 of 16065 * 512 = 8225280 bytes

 デバイス ブート   始点      終点  ブロック   ID  システム
/dev/sdb1             1    243201 1953512001   83  Linux
[root@KEA00IAW12 usb]# mount -t ext3 /dev/sdb1 /mnt/usb
[root@KEA00IAW12 usb]# df -h
Filesystem          サイズ  使用  残り 使用% マウント位置
/dev/sda3              72G   31G   37G  46% /
/dev/sda2              99M   26M   69M  28% /boot
none                  501M     0  501M   0% /dev/shm
/dev/sdb1             1.8T  1.2T  604G  66% /mnt/usb
[root@KEA00IAW12 usb]#


--------------------------------------------------------------------
78：清水 竜也; 総研検査システム１課
2021年08月10日（火） 18:40

問合者=自動分析課：高梨さん

属性修正がされていないデータがある。8/7受 307-5182  年齢44 → 35になるはず。
エラーチェックリストというものがあり、通常それに記載されるはずだが、記載されない、との問合せ。

調べたこと：
①過去の保守作業の対応履歴
　"属性"で検索すると No.40,  30, 28 
　hkhrirai の カラム hkkhrkbn='0'を更新する対応が載っていたが
　今回のデータは hkhriraiには無かった。　irai , kanjya にデータあり。

②ログを確認
  /apdata/aplog下で、属性修正がらみと思われる LD* のログ中に 該当No. があるか確認するも、無かった。
  連休であり(カレンダー上は8/7から３日経っているが）、処理日としては、現在処理している日付のデータなので
  LD* で そもそも処理されるのだろうか。１日以上古い受日のデータのみ救済するのではないか？ その辺りが
  まだ理解不足であり、システム側で手動のリカバリーは危険と判断し、以下、検査側の操作のみで対応頂くこととした。
  
高梨さんへ連絡：
・8/7受で、報告を急ぐものが今現在３件あるそうで
　これについては、画面で属性修正をした上で、報告して頂く。
・それ以外については、今晩受を処理した以降、明日、エラーリストに掲載されるか確認頂く。
　なお、通常の週末の場合、土曜受の中で属性修正されたデータが、週明け月曜の午後には
　エラーリストに大体記載されのだが...とも言われていた。

--------------------------------------------------------------------
79：羽生 達哉; 総研検査システム２課
2021年08月16日（月） 17:49

問合者=羽生
KEA00IAW12にログインできない
対応者＝小林

KEA00IAW12にsshでログインできない＆pingも通らない

IAサーバーを確認したところ電源は入っていたが、ログイン画面でハングアップしており、
マウスもキーバードもきかない状態だった。
電源SWのON/OFFで再起動。
再起動後、No.77の手順でUSBディスクを手動マウントした。


--------------------------------------------------------------------
80：小林 洋一; 総研検査システム２課
2021年08月17日（火） 16:23

問合者=自動分析課金山,対応時間(分)=20
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=54#follow
受日:20210807
依頼書NO:0373618
食塩摂取量が3:再計算待ちから変わらないので対応してもらいたい。
下記SQLを実行し対応。
select * from HKHRIRAI where utkymd='2021-08-07' and irino='00037361800' and kmkcd='0013094'
update HKHRIRAI set hkkhrkbn='0' where utkymd='2021-08-07' and irino='00037361800' and kmkcd='0013094' and hkkhrkbn='3'

結果値を確認し9.3で問題ないか現場へ確認したところ問題ないと回答があったため結果値を確認して終了。
select * from kekka where utkymd='2021-08-07' and irino='00037361800' and kmkcd='0013094'


--------------------------------------------------------------------
81：羽生 達哉; 総研検査システム２課
2021年08月18日（水） 15:49

毎日のＤＢチェックメールにエラーが出力されている

--- db2diag.log ---
view での確認も必要です (/var/log/db2/db2inst1/db2dump/db2diag.log)
2021-08-16-12.44.24.959343+540 I29160A661           LEVEL: Error
2021-08-16-12.44.24.978831+540 I29822A1010          LEVEL: Error
2021-08-16-12.44.24.978900+540 I30833A706           LEVEL: Error
2021-08-16-12.44.24.983396+540 I31540A662           LEVEL: Error
2021-08-16-12.44.24.983437+540 I32203A812           LEVEL: Error
2021-08-16-12.44.24.983488+540 I33016A707           LEVEL: Error
2021-08-16-12.44.25.047740+540 I33724A619           LEVEL: Error
2021-08-16-12.44.25.060329+540 I34344A630           LEVEL: Error
2021-08-16-12.44.25.106380+540 I36455A494           LEVEL: Error
2021-08-16-12.44.25.106607+540 I36950A591           LEVEL: Error
2021-08-16-12.44.25.120524+540 I37542A590           LEVEL: Error
2021-08-16-12.44.25.120562+540 I38133A579           LEVEL: Error
2021-08-16-12.44.25.120606+540 I38713A652           LEVEL: Error
2021-08-16-12.44.25.120667+540 I39366A1000          LEVEL: Severe
2021-08-16-12.44.25.120702+540 I40367A870           LEVEL: Severe
2021-08-16-12.44.25.120739+540 I41238A996           LEVEL: Severe
2021-08-16-12.44.25.120780+540 I42235A571           LEVEL: Severe
2021-08-16-12.44.25.120812+540 I42807A1015          LEVEL: Severe
2021-08-16-18.11.40.710700+540 I53907A613           LEVEL: Error
2021-08-16-18.11.40.755651+540 I54521A595           LEVEL: Error
2021-08-16-18.11.40.755725+540 I55117A586           LEVEL: Error
2021-08-17-07.57.21.205890+540 I219465A613          LEVEL: Error
2021-08-17-07.57.21.234971+540 I220079A595          LEVEL: Error
2021-08-17-07.57.21.235028+540 I220675A586          LEVEL: Error

ログファイルの場所は、
kea00dba:/var/log/db2/db2inst1/db2dump
-----------------------------------------------------------------------------------
2021-08-16-12.44.24.959343+540 I29160A661           LEVEL: Error
2021-08-16-12.44.24.978831+540 I29822A1010          LEVEL: Error
2021-08-16-12.44.24.978900+540 I30833A706           LEVEL: Error
2021-08-16-12.44.24.983396+540 I31540A662           LEVEL: Error
2021-08-16-12.44.24.983437+540 I32203A812           LEVEL: Error
2021-08-16-12.44.24.983488+540 I33016A707           LEVEL: Error
2021-08-16-12.44.25.047740+540 I33724A619           LEVEL: Error
2021-08-16-12.44.25.060329+540 I34344A630           LEVEL: Error
2021-08-16-12.44.25.106380+540 I36455A494           LEVEL: Error
2021-08-16-12.44.25.106607+540 I36950A591           LEVEL: Error
2021-08-16-12.44.25.120524+540 I37542A590           LEVEL: Error
2021-08-16-12.44.25.120562+540 I38133A579           LEVEL: Error
2021-08-16-12.44.25.120606+540 I38713A652           LEVEL: Error
2021-08-16-12.44.25.120667+540 I39366A1000          LEVEL: Severe
2021-08-16-12.44.25.120702+540 I40367A870           LEVEL: Severe
2021-08-16-12.44.25.120739+540 I41238A996           LEVEL: Severe
2021-08-16-12.44.25.120780+540 I42235A571           LEVEL: Severe
2021-08-16-12.44.25.120812+540 I42807A1015          LEVEL: Severe
------------------------------------------------------------------------------------
この部分のメッセージ超約
フェデレーション先のＤＢと通信ができなくなった
ログ内容は添付ファイル参照。

------------------------------------------------------------------------------------
2021-08-16-18.11.40.710700+540 I53907A613           LEVEL: Error
2021-08-16-18.11.40.755651+540 I54521A595           LEVEL: Error
2021-08-16-18.11.40.755725+540 I55117A586           LEVEL: Error
2021-08-17-07.57.21.205890+540 I219465A613          LEVEL: Error
2021-08-17-07.57.21.234971+540 I220079A595          LEVEL: Error
2021-08-17-07.57.21.235028+540 I220675A586          LEVEL: Error
--------------------------------------------------------------------------------
この部分のメッセージ詳細

2021-08-17-07.57.21.205890+540 I219465A613          LEVEL: Error
PID     : 9654                 TID : 2203372742928  PROC : db2sysc 0
INSTANCE: db2inst1             NODE : 000           DB   : KEA00DB
APPHDL  : 0-20999              APPID: GA01B548.PA12.225286165009
UOWID   : 247                  ACTID: 1
AUTHID  : DB2INST1             HOSTNAME: kea00dba
EDUID   : 1274                 EDUNAME: db2agent (KEA00DB) 0
FUNCTION: DB2 UDB, common communication, sqlcctcptest, probe:11
MESSAGE : Detected client termination
DATA #1 : Hexdump, 2 bytes
0x00000201033FA660 : 0036                                       .6

2021-08-17-07.57.21.234971+540 I220079A595          LEVEL: Error
PID     : 9654                 TID : 2203372742928  PROC : db2sysc 0
INSTANCE: db2inst1             NODE : 000           DB   : KEA00DB
APPHDL  : 0-20999              APPID: GA01B548.PA12.225286165009
UOWID   : 247                  ACTID: 1
AUTHID  : DB2INST1             HOSTNAME: kea00dba
EDUID   : 1274                 EDUNAME: db2agent (KEA00DB) 0
FUNCTION: DB2 UDB, common communication, sqlcctest, probe:50
MESSAGE : sqlcctest RC
DATA #1 : Hexdump, 2 bytes
0x00000201033FC758 : 0036                                       .6

2021-08-17-07.57.21.235028+540 I220675A586          LEVEL: Error
PID     : 9654                 TID : 2203372742928  PROC : db2sysc 0
INSTANCE: db2inst1             NODE : 000           DB   : KEA00DB
APPHDL  : 0-20999              APPID: GA01B548.PA12.225286165009
UOWID   : 247                  ACTID: 1
AUTHID  : DB2INST1             HOSTNAME: kea00dba
EDUID   : 1274                 EDUNAME: db2agent (KEA00DB) 0
FUNCTION: DB2 UDB, base sys utilities, sqeAgent::AgentBreathingPoint, probe:10
CALLED  : DB2 UDB, common communication, sqlcctest
RETCODE : ZRC=0x00000036=54

このメッセージは、エージェント (db2agent) が UOW 実行中に、リモート・アプリケーションの終了を検出したことを示すインフォメーション・メッセージです。
SQL 実行中にデータベース接続を切断せずにアプリケーションを終了した場合や、ネットワークが切断された場合などに記録されます。

サーバーによる検出の頻度は DB2CHECKCLIENTINTERVAL レジストリー変数で制御できます。
V8.1 フィックスパック 4 以降のデフォルト値は 50 ですが、単位は内部的なカウンター (AgentBreathingPoint の回数) を示し、秒数や分数ではありません。低い値ほどチェックが頻繁になります。

どのリモート・クライアントと切断されたかは、db2diag.log に記録されている APPID から判断できます。Db2 9.1 以降の DB2 クライアントは、APPID の一部に自分の IP アドレスを使用します。

運用上の考慮点
DB2CHECKCLIENTINTERVAL を変更する場合は、Knowledge Center に記載されている注意事項をご参照ください。
DB2CHECKCLIENTINTERVAL を 0 にするとリモート・クライアント切断の検出が遅れ、Db2 サーバーが無駄な作業を中止する機会を失います。
[抜粋]
DB2 のワークロードが重い (内部要求が多い) 場合、DB2CHECKCLIENTINTERVAL に低い値を設定すると、ワークロードが軽い状況よりも、パフォーマンスに重大な影響があります。

＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊
ざっくり理解すると、コミットせずにアプリケーションが終了したみたい。
考えられるケースとして、
①アプリケーションが異常終了
②アプリケーションがCOMMIT or TERMINATE せずに終了
③アプリケーションを外部から強制終了

APPIDからリモートのIPアドレスを求める。
APPID=GA01B548.0313.*********
 GA.01.B5.48 (hex) G->0....P->9に置き換える
 ↓
 0A.01.B5.48
 ↓　HEX->DEC
10.1.181.72
(KEA00CLP02)









DB2diag.log

--------------------------------------------------------------------
82：羽生 達哉; 総研検査システム２課
2021年08月19日（木） 10:43

ＤＢチェックメールにエラーが出力されている
昨日出力分に以下が追加された。

-------------------------------------------------------------------------
2021-08-18-12.07.15.757390+540 I417800A617          LEVEL: Error
2021-08-18-12.07.15.770407+540 I418418A599          LEVEL: Error
2021-08-18-12.07.15.770446+540 I419018A590          LEVEL: Error
2021-08-18-12.08.26.402823+540 I422666A617          LEVEL: Error
2021-08-18-12.08.26.403179+540 I423284A599          LEVEL: Error
2021-08-18-12.08.26.403214+540 I423884A590          LEVEL: Error
-------------------------------------------------------------------------

メッセージ詳細
-------------------------------------------------------------------------
2021-08-18-12.07.15.757390+540 I417800A617          LEVEL: Error
PID     : 9654                 TID : 2203360160016  PROC : db2sysc 0
INSTANCE: db2inst1             NODE : 000           DB   : KEA00DB
APPHDL  : 0-26690              APPID: 10.1.181.71.33774.210818030056
UOWID   : 9                    ACTID: 1
AUTHID  : DB2INST1             HOSTNAME: kea00dba
EDUID   : 949                  EDUNAME: db2agent (KEA00DB) 0
FUNCTION: DB2 UDB, common communication, sqlcctcptest, probe:11
MESSAGE : Detected client termination
DATA #1 : Hexdump, 2 bytes
0x00000201027FA660 : 0036                                       .6

2021-08-18-12.07.15.770407+540 I418418A599          LEVEL: Error
PID     : 9654                 TID : 2203360160016  PROC : db2sysc 0
INSTANCE: db2inst1             NODE : 000           DB   : KEA00DB
APPHDL  : 0-26690              APPID: 10.1.181.71.33774.210818030056
UOWID   : 9                    ACTID: 1
AUTHID  : DB2INST1             HOSTNAME: kea00dba
EDUID   : 949                  EDUNAME: db2agent (KEA00DB) 0
FUNCTION: DB2 UDB, common communication, sqlcctest, probe:50
MESSAGE : sqlcctest RC
DATA #1 : Hexdump, 2 bytes
0x00000201027FC758 : 0036                                       .6

2021-08-18-12.07.15.770446+540 I419018A590          LEVEL: Error
PID     : 9654                 TID : 2203360160016  PROC : db2sysc 0
INSTANCE: db2inst1             NODE : 000           DB   : KEA00DB
APPHDL  : 0-26690              APPID: 10.1.181.71.33774.210818030056
UOWID   : 9                    ACTID: 1
AUTHID  : DB2INST1             HOSTNAME: kea00dba
EDUID   : 949                  EDUNAME: db2agent (KEA00DB) 0
FUNCTION: DB2 UDB, base sys utilities, sqeAgent::AgentBreathingPoint, probe:10
CALLED  : DB2 UDB, common communication, sqlcctest
RETCODE : ZRC=0x00000036=54

2021-08-18-12.07.15.864666+540 I419609A1936         LEVEL: Warning
PID     : 9654                 TID : 2203360160016  PROC : db2sysc 0
INSTANCE: db2inst1             NODE : 000           DB   : KEA00DB
APPHDL  : 0-26690              APPID: 10.1.181.71.33774.210818030056
UOWID   : 9                    ACTID: 1
AUTHID  : DB2INST1             HOSTNAME: kea00dba
EDUID   : 949                  EDUNAME: db2agent (KEA00DB) 0
FUNCTION: DB2 UDB, base sys utilities, sqeAgent::AgentBreathingPoint, probe:16
CALLSTCK: (Static functions may not be resolved correctly, as they are resolved to the nearest symbol)
  [0] 0x0000020015114166 _ZN8sqeAgent19AgentBreathingPointEi + 0x54A
  [1] 0x0000020017CF55B4 _Z10sqlqgFetchP12sqlri_rquery + 0x3A0
  [2] 0x000002001857D0D8 _Z13sqlri_djx_rtaP8sqlrr_cb + 0x4EC
  [3] 0x00000200185B734E _Z15sqlriSectInvokeP8sqlrr_cbP12sqlri_opparm + 0x6C6
  [4] 0x0000020017EC3418 _Z27sqlrr_process_fetch_requestP14db2UCinterface + 0x8EC
  [5] 0x0000020017EBB05E _Z10sqlrr_openP14db2UCinterfaceP15db2UCCursorInfo + 0xF26
  [6] 0x000002001570D33E _Z16sqljs_ddm_opnqryP14db2UCinterfaceP13sqljDDMObject + 0x1B2
  [7] 0x00000200156EC086 _Z21sqljsParseRdbAccessedP13sqljsDrdaAsCbP13sqljDDMObjectP14db2UCinterface + 0x23A
  [8] 0x00000200156EDA48 _Z10sqljsParseP13sqljsDrdaAsCbP14db2UCinterfaceP8sqeAgentb + 0xF5C
  [9] 0x00000200156D1F62 /db2dbf/data/db2inst1/sqllib/lib64/libdb2e.so.1 + 0x9A51F62
  [10] 0x00000200156D108C /db2dbf/data/db2inst1/sqllib/lib64/libdb2e.so.1 + 0x9A5108C
  [11] 0x00000200156D0BE6 /db2dbf/data/db2inst1/sqllib/lib64/libdb2e.so.1 + 0x9A50BE6
  [12] 0x00000200156CF8D8 _Z17sqljsDrdaAsDriverP18SQLCC_INITSTRUCT_T + 0x1C8
  [13] 0x00000200150F9450 _ZN8sqeAgent6RunEDUEv + 0x434
  [14] 0x0000020019A00DAA _ZN9sqzEDUObj9EDUDriverEv + 0x49E
  [15] 0x000002001766AA18 sqloEDUEntry + 0x724
  [16] 0x000002000BC08B5E /lib64/libpthread.so.0 + 0x8B5E
  [17] 0x00000200201F8812 /lib64/libc.so.6 + 0xF8812
-----------------------------------------------------------------------------------------------------
メッセージ内容は昨筒と同じ。
IPアドレス10.1.181.72は　KEA00CLP01


--------------------------------------------------------------------
83：羽生 達哉; 総研検査システム２課
2021年08月25日（水） 09:36

ＩＡサーバーのＤＢ２(KEA00IAW08)でエラーログがで続けている。


起動直後
--------------------------------------------------------------
2021-08-23-10.00.04.944608+540 I13698G666         LEVEL: Error
PID     : 18264                TID  : 2944396176  PROC : db2sysc
INSTANCE: db2inst1             NODE : 000         DB   : KEA00DBN
APPHDL  : 0-21                 APPID: *LOCAL.db2inst1.210823010004
AUTHID  : DB2INST1
EDUID   : 21                   EDUNAME: db2agent (KEA00DBN)
FUNCTION: DB2 UDB, buffer pool services, sqlbCreateAndLockParent, probe:917
MESSAGE : ZRC=0x8002003C=-2147352516=SQLB_BAD_CONTAINER_PATH
          "Bad container path"
DATA #1 : <preformatted>
The container /mnt/rui/tmp/db2inst1/NODE0000/KEA00DBN/T0000001/C0000000.TMP cannot be created below another container (/mnt/rui/tmp)

2021-08-23-10.00.04.944837+540 I14365G629         LEVEL: Warning
PID     : 18264                TID  : 2944396176  PROC : db2sysc
INSTANCE: db2inst1             NODE : 000         DB   : KEA00DBN
APPHDL  : 0-21                 APPID: *LOCAL.db2inst1.210823010004
AUTHID  : DB2INST1
EDUID   : 21                   EDUNAME: db2agent (KEA00DBN)
FUNCTION: DB2 UDB, buffer pool services, sqlbSMSAcquireContainer, probe:805
MESSAGE : ZRC=0x8002003C=-2147352516=SQLB_BAD_CONTAINER_PATH
          "Bad container path"
DATA #1 : <preformatted>
User error: bad container path: /mnt/rui/tmp/db2inst1/NODE0000/KEA00DBN/T0000001/C0000000.TMP

2021-08-23-10.00.04.945028+540 I14995G1031        LEVEL: Severe
PID     : 18264                TID  : 2944396176  PROC : db2sysc
INSTANCE: db2inst1             NODE : 000         DB   : KEA00DBN
APPHDL  : 0-21                 APPID: *LOCAL.db2inst1.210823010004
AUTHID  : DB2INST1
EDUID   : 21                   EDUNAME: db2agent (KEA00DBN)
FUNCTION: DB2 UDB, buffer pool services, sqlbASSetPoolContsForSMS, probe:50
MESSAGE : ZRC=0x8002003C=-2147352516=SQLB_BAD_CONTAINER_PATH
          "Bad container path"
ARG  #1 : String, 10 bytes
TEMPSPACE1
ARG  #2 : Pool ID, PD_TYPE_SQLB_POOL_ID, 2 bytes
1
ARG  #3 : unsigned integer, 4 bytes
1
ARG  #4 : Hex integer, 4 bytes
0x00000000
ARG  #5 : Pool container specifications, PD_TYPE_SQLB_CONTAINER_SPEC, 280 bytes

  Container #:               0
  name:             /mnt/rui/tmp/db2inst1/NODE0000/KEA00DBN/T0000001/C0000000.TMP
  type:             SQLB_CONT_PATH
  size:                      0
  alterOperation:            0
  stripeSetToAlter:          0
  nodeNum:                   0

2021-08-23-10.00.04.945368+540 I16027G710         LEVEL: Error
PID     : 18264                TID  : 2944396176  PROC : db2sysc
INSTANCE: db2inst1             NODE : 000         DB   : KEA00DBN
APPHDL  : 0-21                 APPID: *LOCAL.db2inst1.210823010004
AUTHID  : DB2INST1
EDUID   : 21                   EDUNAME: db2agent (KEA00DBN)
FUNCTION: DB2 UDB, buffer pool services, sqlbASDefineContainersForSMS, probe:60
MESSAGE : ZRC=0x8002003C=-2147352516=SQLB_BAD_CONTAINER_PATH
          "Bad container path"
DATA #1 : String, 10 bytes
TEMPSPACE1
DATA #2 : Pool ID, PD_TYPE_SQLB_POOL_ID, 2 bytes
1
DATA #3 : unsigned integer, 4 bytes
2
DATA #4 : unsigned integer, 4 bytes
1
DATA #5 : Boolean, 1 bytes
false

2021-08-23-10.00.04.945677+540 E16738G674         LEVEL: Severe
PID     : 18264                TID  : 2944396176  PROC : db2sysc
INSTANCE: db2inst1             NODE : 000         DB   : KEA00DBN
APPHDL  : 0-21                 APPID: *LOCAL.db2inst1.210823010004
AUTHID  : DB2INST1
EDUID   : 21                   EDUNAME: db2agent (KEA00DBN)
FUNCTION: DB2 UDB, buffer pool services, sqlbSMSStartPool, probe:107
MESSAGE : ZRC=0x8002003C=-2147352516=SQLB_BAD_CONTAINER_PATH
          "Bad container path"
DATA #1 : String, 143 bytes
Unable to redefine containers for temporary automatic storage table space "TEMPSPACE1" (ID = "1").  Placing table space into the OFFLINE state.

--------------------------------------------------------------
超約
「TEMPSPACE1の領域が確保できないのでOFFLINEにします」

KEA00IAW08のDISK領域が96%使用済みで足りない模様。

[db2inst1@KEA00IAW08 ~]$ df -k
Filesystem           1K-ブロック    使用   使用可 使用% マウント位置
/dev/sda2             10154020   7794324   1835576  81% /
/dev/sda1               202219     19602    172177  11% /boot
tmpfs                  4082768        12   4082756   1% /dev/shm
/dev/sda6            1904302212 1719319176  88250052  96% /mnt/rui

TABLESPACEの状態
[db2inst1@KEA00IAW08 hanyu]$ db2 list tablespaces

           Tablespaces for Current Database

 Tablespace ID                        = 0
 Name                                 = SYSCATSPACE
 Type                                 = Database managed space
 Contents                             = All permanent data. Regular table space.
 State                                = 0x0000
   Detailed explanation:
     Normal

 Tablespace ID                        = 1
 Name                                 = TEMPSPACE1
 Type                                 = System managed space
 Contents                             = System Temporary data
 State                                = 0x4000
   Detailed explanation:
     Offline                                                                         ←OFFLINE

 Tablespace ID                        = 2
 Name                                 = USERSPACE1
 Type                                 = Database managed space
 Contents                             = All permanent data. Large table space.
 State                                = 0x0000
   Detailed explanation:
     Normal
・
・
・
以下略


--------------------------------------------------------------------
84：羽生 達哉; 総研検査システム２課
2021年08月25日（水） 09:47

ＩＡサーバーのＤＢ２(KEA00IAW08)でエラーログがで続けている。
その２

---------------------------------------------------------------------------------------
2021-08-25-03.00.21.553706+540 I1248012G529       LEVEL: Error
PID     : 18264                TID  : 2940201872  PROC : db2sysc
INSTANCE: db2inst1             NODE : 000         DB   : KEA00DBN
APPHDL  : 0-5268               APPID: *LOCAL.db2inst1.210824180021
AUTHID  : DB2INST1
EDUID   : 2246                 EDUNAME: db2agent (KEA00DBN)
FUNCTION: DB2 UDB, buffer pool services, sqlbGetPoolStats, probe:1022
MESSAGE : ZRC=0x80020035=-2147352523=SQLB_NOT_ALLOWED_RECOVERY_P
          "Access not allowed. Tblspc Recovery Pend."
--------------------------------------------------------------------------------------
上記エラーが継続して出力されている。
TEMPSPACE1のOFFLINEが解消されないのが多分原因。
15分間核で出力され続けているので結構なボリュームが出ている。

--------------------------------------------------------------------
85：羽生 達哉; 総研検査システム２課
2021年08月25日（水） 09:52

ＩＡサーバーのＤＢ２(KEA00IAW08)でエラーログがで続けている。
その３

こんなのも出ている。
-----------------------------------------------------------------------------------------------
2021-08-25-02.24.18.985187+540 E1237410G663       LEVEL: Error
PID     : 18280                TID  : 2933619600  PROC : db2acd
INSTANCE: db2inst1             NODE : 000
FUNCTION: DB2 UDB, Health Monitor, HealthIndicator::update, probe:500
MESSAGE : ADM10500E  Health indicator "Database Automatic Storage Utilization" 
          ("db.auto_storage_util") breached the "upper" alarm threshold of "90 
          %" with value "95 %" on "database" "db2inst1.KEA00DBN".  Calculation: 
          "((db.auto_storage_used/db.auto_storage_total)*100);" = 
          "((1868239183872 / 1960403181568) * 100)" = "95 %".  History 
          (Timestamp, Value, Formula): "()"

2021-08-25-02.24.18.990309+540 E1238074G424       LEVEL: Warning
PID     : 18280                TID  : 2933619600  PROC : db2acd
INSTANCE: db2inst1             NODE : 000
FUNCTION: DB2 UDB, Health Monitor, HealthIndicator::update, probe:500
MESSAGE : ADM10502W  Health indicator "Table Space Operational State" 
          ("ts.ts_op_status") is in state "Offline" on "table space" 
          "db2inst1.KEA00DBN.TEMPSPACE1".

2021-08-25-02.24.19.002688+540 E1238499G702       LEVEL: Warning
PID     : 18280                TID  : 2933619600  PROC : db2acd
INSTANCE: db2inst1             NODE : 000
FUNCTION: DB2 UDB, Health Monitor, HealthIndicator::update, probe:500
MESSAGE : ADM10501W  Health indicator "Table Space Container Utilization" 
          ("tsc.tscont_util") breached the "upper" warning threshold of "80 %" 
          with value "83 %" on "table space container" 
          "db2inst1.KEA00DBN.DBTEMP./home/db2inst1/db2dbf/data/kea00dbn/log". 
          Calculation: "((os.fs_used/os.fs_total)*100);" = "((8602165248 / 
          10397716480) * 100)" = "83 %".  History (Timestamp, Value, Formula): 
          "()"

2021-08-25-02.24.19.005047+540 E1239202G752       LEVEL: Warning
PID     : 18280                TID  : 2933619600  PROC : db2acd
INSTANCE: db2inst1             NODE : 000
FUNCTION: DB2 UDB, Health Monitor, HealthIndicator::update, probe:500
MESSAGE : ADM10501W  Health indicator "Table Space Container Utilization" 
          ("tsc.tscont_util") breached the "upper" warning threshold of "80 %" 
          with value "83 %" on "table space container" 
          "db2inst1.KEA00DBN.SYSTOOLSTMPSPACE./home/db2inst1/db2dbf/data/kea00d
          bn/db2inst1/NODE0000/SQL00001/SYSTOOLSTMPSPACE". Calculation: 
          "((os.fs_used/os.fs_total)*100);" = "((8602165248 / 10397716480) * 
          100)" = "83 %".  History (Timestamp, Value, Formula): "()"

2021-08-25-02.24.19.007480+540 E1239955G668       LEVEL: Error
PID     : 18280                TID  : 2933619600  PROC : db2acd
INSTANCE: db2inst1             NODE : 000
FUNCTION: DB2 UDB, Health Monitor, HealthIndicator::update, probe:500
MESSAGE : ADM10500E  Health indicator "Table Space Container Utilization" 
          ("tsc.tscont_util") breached the "upper" alarm threshold of "90 %" 
          with value "95 %" on "table space container" 
          "db2inst1.KEA00DBN.TMP_TBSP./mnt/rui/tmp".  Calculation: 
          "((os.fs_used/os.fs_total)*100);" = "((1859637411840 / 1950005465088) 
          * 100)" = "95 %".  History (Timestamp, Value, Formula): "()"

2021-08-25-02.24.19.008753+540 E1240624G612       LEVEL: Warning
PID     : 18280                TID  : 2933619600  PROC : db2acd
INSTANCE: db2inst1             NODE : 000
FUNCTION: DB2 UDB, Health Monitor, HealthIndicator::update, probe:500
MESSAGE : ADM10501W  Health indicator "Log Filesystem Utilization" 
          ("db.log_fs_util") breached the "upper" warning threshold of "75 %" 
          with value "83 %" on "database" "db2inst1.KEA00DBN". Calculation: 
          "((os.fs_used/os.fs_total)*100);" = "((8602177536 / 10397716480) * 
          100)" = "83 %".  History (Timestamp, Value, Formula): "()"
------------------------------------------------------------------------------
超約
「何かいろいろいっぱいいっぱいです」

累積ＤＢの保存期間を見直した方が良いと思う。

--------------------------------------------------------------------
86：小林 洋一; 総研検査システム２課
2021年08月27日（金） 16:06

問合者=自動分析課田口,対応時間(分)=10
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=54#follow
受日:20210821
依頼書NO:3037879
食塩摂取量が3:再計算待ちから変わらないので対応してもらいたい。
下記SQLを実行し対応。
select * from HKHRIRAI where utkymd='2021-08-21' and irino='00303787900' and kmkcd='0013094'
update HKHRIRAI set hkkhrkbn='0' where utkymd='2021-08-21' and irino='00303787900' and kmkcd='0013094' and hkkhrkbn='3'

select * from kekka where utkymd='2021-08-21' and irino='00303787900' and kmkcd='0013094'

--------------------------------------------------------------------
87：横田 克夫; 総研検査システム２課
2021年08月31日（火） 07:50

問合者=エラーメール,対応時間(分)=30

日次処理チェックのエラーメールを受信。
メールを確認し、日次裏処理が動作中である事を確認。
→正常終了ログが出る事を確認した。
　[2021年  8月 30日 月曜日 23:46:07 JST][RUI_CTRLKKA] runstats start ----->
　DB20000I  RUNSTATS コマンドが正常に完了しました。
　[2021年  8月 30日 月曜日 23:49:35 JST][SHUSEI_KANJYA] runstats start ----->
　DB20000I  RUNSTATS コマンドが正常に完了しました。
　DB20000I  TERMINATE コマンドが正常に完了しました。
　  2021/08/30 23:49:35▲▲ 累積集計情報runstats --- 終了 ▲▲
　2021/08/30 23:49:35▲▲ 日次処理 --- 終了 ▲▲

--------------------------------------------------------------------
88：羽生 達哉; 総研検査システム２課
2021年08月31日（火） 09:10

日次処理の警告メールを出した場合、日次処理の終了を確認するようにしました。

----------------------------------------------------------
<<<<<  日次処理チェック警告メール  >>>>>
日次が正常に終わっていない可能性がありますが
過去１５分以内にログが出力されているので
処理は進行中です。
----------------------------------------------------------
上記のメールが送信されていた場合、
23:00 - 2:00の間、日次処理のログをチェックして終了メッセージを確認します。

終了メッセージが出力されたら
----------------------------------------------------------
<<< 日次処理チェック >>>
日次処理終了が終了しました
2021年 8月 30日 月曜日 23:51:02 JST
----------------------------------------------------------
上記の終了確認メールを送信します。

2:00過ぎても終了メッセージが確認できない場合は、
エラーメッセージのメールを送信します。
----------------------------------------------------------
<<< 日次処理エラー >>>
日次処理終了が終了していません
2021年 8月 30日 月曜日 23:51:02 JST
ログを確認して下さい
----------------------------------------------------------
こんな感じです。



--------------------------------------------------------------------
89：横田 克夫; 総研検査システム２課
2021年08月31日（火） 11:28

@:羽生 達哉; 総研検査システム２課

>>88
羽生主事

パソコンを起動して確認する必要が無くなるので、とても助かります！

お忙しい中の対応、ありがとうございます。

--------------------------------------------------------------------
90：横田 克夫; 総研検査システム２課
2021年09月01日（水） 16:13

問合者=自動分析課　高梨さま,対応時間(分)=10
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=54#follow
受日:20210828
依頼書NO:039-2482、278-4410
食塩摂取量が3:再計算待ちから変わらないので対応してもらいたい。
下記SQLを実行し対応。
select * from HKHRIRAI where utkymd='2021-08-28' and irino='00039248200' and kmkcd='0013094'
update HKHRIRAI set hkkhrkbn='0' where utkymd='2021-08-28' and irino='00039248200' and kmkcd='0013094' and hkkhrkbn='3'

select * from HKHRIRAI where utkymd='2021-08-28' and irino='00278441000' and kmkcd='0013094'
update HKHRIRAI set hkkhrkbn='0' where utkymd='2021-08-28' and irino='00278441000' and kmkcd='0013094' and hkkhrkbn='3'


--------------------------------------------------------------------
91：横田 克夫; 総研検査システム２課
2021年09月04日（土） 19:25

問合者=エラーメール,対応時間(分)=10

	[2021年 9月 4日 土曜日 19:20:01 JST]マルチ ＡＰサーバ ディスク容量 危険
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2021年09月04日（土） 19:20
To （2件）  	 ： 	multi_log@bml.co.jp, multi_error@bml.co.jp （←宛先を隠す）

下記、ディスク容量がしきい値を越えています。確認してください。

/apdata：87 (しきい値：80%)

→以下を実施
cd /apdata/oldday
rm -fr 2021-08-21 2021-08-23 2021-08-24 2021-08-25 2021-08-26 2021-08-27 2021-08-28

→67%になったことを確認。

羽生主事へ
　今月は、羽生主事が保守当番なので、次回以降は対応をお願いします。

--------------------------------------------------------------------
92：横田 克夫; 総研検査システム２課
2021年09月07日（火） 18:51

問合者=藤本課長,対応時間(分)=60
ZSの稼働率が低い為、号機・時間別で集計してもらいたい。

→8/2受、8/5受でデータ抽出
select knskisymd,BSKKBN,BSKLNE,substr(TRKDH,1,15)||'0',count(*) from rui_kekka where knskisymd='2021-08-02' and BSKKBN='Z050' group by knskisymd,BSKKBN,BSKLNE,substr(TRKDH,1,15) order by 1 for read only with ur
select knskisymd,BSKKBN,BSKLNE,substr(TRKDH,1,15)||'0',count(*) from rui_kekka where knskisymd='2021-08-05' and BSKKBN='Z050' group by knskisymd,BSKKBN,BSKLNE,substr(TRKDH,1,15) order by 1 for read only with ur

→添付のグラフを作成

20210907_ZS稼働率分析.xlsx

--------------------------------------------------------------------
93：横田 克夫; 総研検査システム２課
2021年09月07日（火） 20:34

問合者=エラーメール,対応時間(分)=5

[2021年 9月 7日 火曜日 20:30:02 JST]マルチ ＡＰサーバ ディスク容量 危険
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2021年09月07日（火） 20:30
To （2件）  	 ： 	multi_log@bml.co.jp ... （→宛先をすべて表示する）

下記、ディスク容量がしきい値を越えています。確認してください。

/apdata：91 (しきい値：80%)

→過去ファイル削除
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14G   13G  1.4G   91% /apdata
kea00sys@kea00apa:/apdata/oldday> rm -fr 2021-08-30 2021-08-31
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    14G   12G  1.9G   87% /apdata


--------------------------------------------------------------------
94：羽生 達哉; 総研検査システム２課
2021年09月08日（水） 10:01

kea00sysの
/apdata/bkupと
/apdata/workの下の日付ディレクトリをgzipで圧縮しておきました。


--------------------------------------------------------------------
95：小林 洋一; 総研検査システム２課
2021年09月08日（水） 16:10

問合者=自動分析課　金山さま,対応時間(分)=10
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=54#follow
受日:20210904
依頼書NO:0350173
食塩摂取量が3:再計算待ちから変わらないので対応してもらいたい。
下記SQLを実行し対応。
select * from HKHRIRAI where utkymd='2021-09-04' and irino='00035017300' and kmkcd='0013094'
update HKHRIRAI set hkkhrkbn='0' where utkymd='2021-09-04' and irino='00035017300' and kmkcd='0013094' and hkkhrkbn='3'


--------------------------------------------------------------------
96：羽生 達哉; 総研検査システム２課
2021年09月08日（水） 17:48

kea00sysの
/apdata/olddayの下の日次処理バックアップディレクトリの自動削除を実施予定です。
~/shell/cron/enddel.sh
新しいものを４つ残して他は削除します。

数日間手動で確認したらcronへ登録します。

--------------------------------------------------------------------
97：清水 竜也; 総研検査システム１課
2021年09月09日（木） 16:32

問合者=高梨さん　15：00頃 対応時間(分)=10

電解質のオンラインでデータがなかなか取り込まれない...旨の伝言あり、調査。

proc.sh で状況確認する。　IAサーバー「 LABO- 9号機 尿    W24」で稼働中の表示であった。

続いて、IAの w24に入り、ログ等を確認 。
[kea00sys@KEA00IAW24 Log]$ ps -elf | grep DD
F S UID        PID  PPID  C PRI  NI ADDR SZ WCHAN  STIME TTY          TIME CMD
1 S kea00sys  3953     1  2  80   0 -  8326 poll_s  9月08 ?       00:31:12 DD203 06
1 S kea00sys  3956     1  2  80   0 -  6643 poll_s  9月08 ?       00:31:33 DD203 07
1 S kea00sys  3960     1  2  80   0 -  7031 poll_s  9月08 ?       00:31:33 DD203 08
0 S kea00sys 13849  8612  0  80   0 - 29220 pipe_w 15:10 pts/1    00:00:00 grep --color=auto DD
1 S kea00sys 26781     1  2  80   0 -  4851 poll_s 11:54 ?        00:05:46 DD204 09

オンライン通信ログ：
[kea00sys@KEA00IAW24 Log]$ pwd
/home/kea00sys/appl/src/kns/DD204/dat/Log
[kea00sys@KEA00IAW24 Log]$
[kea00sys@KEA00IAW24 Log]$ ll
合計 2228
合計 1716
-rw-r--r-- 1 kea00sys users  615654  9月  9 14:51 com_09.log
-rw-r--r-- 1 kea00sys users       6  9月  9 12:24 ctrlseq_09.dat
-rw-r--r-- 1 kea00sys users 1128960  9月  9 13:53 xbarinf_09.dat

分析機の通信は、行われているようであった。
と、ここで、再度、高梨さんよりTELが取次者より自携帯に入り、直接話をする。

聞くと、再度測定をしたく、結果クリアをしたが画面が戻ってこないので電話したとのこと。
ただその電話を切ったあと、カーソルが戻り、処理が終わったとのことであった。

どのくらい画面が戻ってこなかったか聞くと、４～５分だそうで
いつもはどれくらいかさらに聞くと、普段は電解質を再測定することはまずないとのこと。

未報告確認でデータが全てクリアできているとのことで、再測定進めてくださいと話し
対応終了。

--------------------------------------------------------------------
98：清水 竜也; 総研検査システム１課
2021年09月10日（金） 15:16

作業依頼：不確かさ推定用コントロールデータの抽出

■背景
> > > ケミストリーではISOの要求で全号機・特定項目のコントロール結果を元に
> > > 不確かさの推定を毎年実施しています。
> > > 
･･･
> > > 抽出期間
> > > 6/1～6/31
> > > コントロールNo
> > > 3・4
> > > 号機
> > > LABO1-9、BM10-21
> > > 
> > > 自動分析課
> > > 藤本


■抽出作業
①実機上で該当データを分析機区分、コントロールNoで大まかにexport
　ちなみに bskkbnは、現在、'BIOM'、'LABO'、'Z050'の３種


export to ctl_bm of del select *  from rui_ctrlkka   \
where CTRLNO in (3,4) \
and  KNSKISYMD>='2021-06-01' \
and  KNSKISYMD< '2021-07-01' \
and  bskkbn='BIOM' \
for read only with ur

export to ctl_labo of del select *  from rui_ctrlkka   \
where CTRLNO in (3,4) \
and  KNSKISYMD>='2021-06-01' \
and  KNSKISYMD< '2021-07-01' \
and  bskkbn='LABO' \
for read only with ur

それぞれ３～４万行ほど。


②テスト機側で①をロード。マスターとjoinし、項目名、コントロール名をあわせ、一覧用のcsvを作成。
　各号機とも複数モジュールで構成されており、全項目が先方、後方のモジュールに対(二重）で設定されている。
　このため抽出は全部モジュールが必要ではなく、半分の先方だけが必要。
　LABOは1～4モジュール、BMは1～6モジュール。
　またこれとは別に電解質のユニットのモジュールも２つあり、これも先方のみ抽出する。
　bskgokの like指定は、このため。


export to bm_distinct of del \
select  distinct ri.bsklne, ri.bskgok, me.chnm, substr(ri.ctrlsbt,1,2) as sbt , ct.ctrlnm, \
       ri.knskisymd,  ri.ctrlno, substr(ri.sktti,1,8) as kekka, substr(ri.syklotno,1, 10) as lot  \
from rui_ctrlkka ri, mechmst me , ctrlmst ct \
where   ri.bskkbn=me.bskkbn  \
and     ri.bskkbn='BIOM'     \
and     me.bskkbn='BIOM'     \
and     ct.bskkbn='BIOM'     \
and ( bskgok like '___100'  or bskgok like '___200' or bskgok like '___300' or bskgok like '___001') \
and   ri.kmkcd=me.kmkcd    \
and   ri.bskkbn=ct.bskkbn  \
and   ri.nbkmkcd=ct.nbkmkcd   \
and   ri.ctrlsbt=ct.ctrlsbt    \
and   ri.bskgok < '240000' \
order by  ri.bsklne, me.chnm, sbt, ri.knskisymd,  ri.ctrlno  for read only with ur


export to labo_no_dist of del \
select  ri.bsklne, ri.bskgok, me.chnm, ri.kmkcd, substr(ri.ctrlsbt,1,2) as sbt , ct.ctrlnm, \
       ri.knskisymd,  ri.ctrlno, substr(ri.sktti,1,8) as kekka, substr(ri.syklotno,1, 10) as lot  \
from rui_ctrlkka ri, mechmst me , ctrlmst ct \
where   ri.bskkbn=me.bskkbn  \
and     ri.bskkbn='LABO'     \
and     me.bskkbn='LABO'     \
and     ct.bskkbn='LABO'     \
and  ( bskgok like '___001'  or bskgok like '__01__' or bskgok like '__02__' ) \
and   ri.kmkcd=me.kmkcd    \
and   ri.bskkbn=ct.bskkbn  \
and   ri.nbkmkcd=ct.nbkmkcd   \
and   ri.ctrlsbt=ct.ctrlsbt    \
order by  ri.bsklne, me.chnm, ri.kmkcd, sbt, ri.knskisymd,  ri.ctrlno  for read only with ur


③添付のExcelを作成。検査へ以下のメール。
　ただ、一覧を渡したところ、現場でさらに、不確かさを確認する別のExcelシートに
　データをコピペするとのことで、全体的にもっと作業を簡単にできないか別途検討中。
----
藤本課長

お疲れ様です。

コントロール・データ一覧を送付します。

抽出内容が妥当か否かご確認をお願いします。

また、表の使い勝手、不明点などありましたら、ご連絡ください。


以下、詳細：
---
以前の別件の打ち合わせの際に、このデータ抽出の話題が出
その時、全項目のデータを全て縦に列記することで良しとのことでしたので
BM、Labo、それぞれ一表で作成しています。

ですので、号機、項目、コントロール種別など
１行目のフィルターで適宜絞り込みしながら使用してみてください。

１行目の右方に、絞り込んだ際の「n数」「Ave」「Min」「Max」を表示するようにしました。
なお「n数」は、行数が 60 より大きい時、絞り込みが足りないという意で赤色表示させてます。
初期表示も絞り込み無しで全行表示のため、赤色となります。


補足①フィルターの一括解除はメニュー「データ」の真ん中あたり「フィルター」の大きいアイコンの
　　　右隣、赤のXマーク付きの小さいじょうろのアイコン「クリア」で、一括解除できます。

　　②BMのデータで、マイナス値が20行ほどありましたが、そのまま載せています。
　　　初期表示で「Min」-191となるのは、そのためです。
       「結果」をマイナス値だけピックアップしてみると、特定の日付＆号機 となりました。
--
清水

----- Original Message -----
Subject: Re: 不確かさ推定用コントロールデータ抽出のお願い
Date: Fri, 09 Jul 2021 18:05:16 +0900
From: "藤本 丈志"<takeshi-f@bml.co.jp>
> 清水主任
> 
> お疲れ様です。
> 
> BMもLABOと同様で問題ありません。
> LABOは1～4ブロック、BMは1～6ブロックあります。
> 
> また、Na・K・Clの3項目も先の部分だけの
> 抽出をお願いします。
> 
> > 09      090001    24 抽出
> > 21      210001    24
> 
> ご不明な点がございましたら、
> 再度ご連絡ください。
> 
> よろしくお願いいたします。
> 
> 藤本
> 
> ----- Original Message -----
> > 藤本課長
> > 
> > お疲れ様です。
> > もう１点確認させてください。
> > 
> > さらにデータを見たところ
> > LABOSPECTの表現 xx01xx
> > 　　　　　　　　　 ･･･
> > 　　　　　　　　　 xx04xx の４モジュールと違い
> > 
> > ＢＭ側の表現が  　xx01xx
> > 　　　　　　　　　･･･
> > 　　　　　　　　  xx06xx と6種類ありました。
> > 
> > 　同じ論法で、6種のうちの半分、
> > 　例えば xx01xx ～xx03xx を対象にすれば良いですか？
> > 
> > BSKLNE  BSKGOK    
> > -----------------
> > 09      090001    24 抽出
> > 09      090002    24  ↓
> > 09      090101    136 ●
> > 09      090102    156 ●
> > 09      090201    104 ●
> > 09      090202    108 ●
> > 09      090301    136
> > 09      090302    156
> > 09      090401    104
> > 09      090402    108
> > --------------------
> > 21      210001    24
> > 21      210002    24
> > 21      210100    188 ●
> > 21      210200    176 ●
> > 21      210300    140 <-- ？
> > 21      210400    188 <-- ？
> > 21      210500    176 <-- ？
> > 21      210600    140 <-- ？
> >

CTL_BM_202106.xlsx
CTL_labo_202106.xlsx

--------------------------------------------------------------------
99：横田 克夫; 総研検査システム２課
2021年09月11日（土） 16:03

１行目：問合者=エラーメール＆高梨さん,対応時間(分)=15

■[2021年 9月 11日 土曜日 15:00:08 JST]検査結果 フラグ異常 確認
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2021年09月11日（土） 15:00
To （2件）  	 ： 	multi_log@bml.co.jp, multi_error@bml.co.jp （←宛先を隠す）
20210909,"00967863900","0000435"
20210909,"00967863900","0000437"
上記、測定結果のフラグがおかしい検体があります。
（ 検査フラグ M、結果状況コード 3 ）
■未報告リストを出力しようとしたところ「システムに連絡してください」のエラーが表示される

→上記の項目について報告結果を確認いただき、問題無いとの回答。
→ケミストリ内のみのデータ不整合なので、過去の対応履歴を参照し対応

select * from kekka where utkymd='2021-09-09' and irino ='00967863900' and kmkcd='0000435' and knsflg='M'
select * from kekka where utkymd='2021-09-09' and irino ='00967863900' and kmkcd='0000437' and knsflg='M'

update kekka set knsflg='E' where utkymd='2021-09-09' and irino ='00967863900' and kmkcd='0000435' and knsflg='M'
update kekka set knsflg='E' where utkymd='2021-09-09' and irino ='00967863900' and kmkcd='0000437' and knsflg='M'


20210911_パッチ実施前バックアップ.xlsx

--------------------------------------------------------------------
100：羽生 達哉; 総研検査システム２課
2021年09月15日（水） 12:44

>>96
>kea00sysの
>/apdata/olddayの下の日次処理バックアップディレクトリの自動削除を実施予定です。
>~/shell/cron/enddel.sh
>新しいものを４つ残して他は削除します。
>
>数日間手動で確認したらcronへ登録します。

cronへ登録しました。
毎日11:23に実行します。
時間が半端なのは他のcron実行と重ならないためです。



--------------------------------------------------------------------
101：小林 洋一; 総研検査システム２課
2021年09月15日（水） 16:26

問合者=自動分析課　高梨様,対応時間(分)=10
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=54#follow
受日:20210911
依頼書NO:4103409

食塩摂取量が3:再計算待ちから変わらないので対応してもらいたい。
下記SQLを実行し対応。
select * from HKHRIRAI where utkymd='2021-09-11' and irino='00410340900' and kmkcd='0013094'
update HKHRIRAI set hkkhrkbn='0' where utkymd='2021-09-11' and irino='00410340900' and kmkcd='0013094' and hkkhrkbn='3'


--------------------------------------------------------------------
102：横田 克夫; 総研検査システム２課
2021年09月15日（水） 18:23

問合者=自動分析課　辻主任,対応時間(分)=10
ZS稼働率分析のため、9/14受の情報を抽出してもらいたい。

→下記のSQLの結果を送付
select knskisymd,BSKKBN,BSKLNE,kmkcd,substr(TRKDH,1,15)||'0',count(*) from kekka where knskisymd='2021-09-14' and BSKKBN='Z050' group by knskisymd,BSKKBN,BSKLNE,kmkcd,substr(TRKDH,1,15) order by 1 for read only with ur



20210914受_ZS稼働率分析_項目CD付加.xlsx

--------------------------------------------------------------------
103：清水 竜也; 総研検査システム１課
2021年09月18日（土） 08:29

9/18(土)ITS統合サーバートラブル対応　　　9/17受

この日、7：30締めで、ケミストリーは全部入ったが、データ抽出したので、以下、記載します。

フォルダー：\\10.1.103.226\NAS_Backup\総研システム部\総研システム３課\01_ケミストリ\WORK\未報告リスト_データ抽出

ツール：未報告確認リスト出力.xlsm

抽出データ：20210918-0733_A00.csv　

なお、６時台（未報告がまだたくさんある状態）に抽出すると、オーバーフローのエラーとなった。




--------------------------------------------------------------------
104：上原 洋樹; 総研検査システム２課
2021年09月24日（金） 16:35

各位
起動手順について、停電対応時の手順を追記しました。

\\10.1.103.226\NAS_Backup\総研システム部\共用\★停電対応\システム起動停止マニュアル\A00_ケミストリー\新棟システム起動手順_2021版.txt

--------------------------------------------------------------------
105：横田 克夫; 総研検査システム２課
2021年09月25日（土） 09:47

@:上原 洋樹; 総研検査システム２課

>>104
上原副主任

手順書の改訂、ありがとう。いくつか気になった事があるので、確認ください。

・先頭部分に、履歴がわかるよう「2021年9月ｘ日の全館停電対応結果を反映」と追記
・１１行目の手順は、IAサーバを起動する前に実施した方が安全では。
・１７行目に文字コードの確認も入れませんか。（３８行目と同様に）
・１０６行目の「？？？？」は「KEA00DB」です。
・１７８行目の「→当日、累積DB★？」って何だっけ？口頭で良いので教えてください。


--------------------------------------------------------------------
106：清水 竜也; 総研検査システム１課
2021年09月27日（月） 18:00

KEA00IAW12にsshでログインできない＆pingも通らない

IAサーバーを確認したところ電源は入っていたが、ログイン画面でハングアップしており、
マウスもキーバードもきかない状態だった。

①電源SWのON/OFFで再起動。対応者＝上原

②再起動後、No.77の手順でUSBディスクを手動マウントした。対応者＝清水

[root@KEA00IAW12 dev]# df -h
Filesystem          サイズ  使用  残り 使用% マウント位置
/dev/sda3              72G   31G   37G  46% /
/dev/sda2              99M   26M   69M  28% /boot
none                  501M     0  501M   0% /dev/shm

[root@KEA00IAW12 dev]# mount -t ext3 /dev/sdb1 /mnt/usb

[root@KEA00IAW12 dev]# df -h
Filesystem          サイズ  使用  残り 使用% マウント位置
/dev/sda3              72G   31G   37G  46% /
/dev/sda2              99M   26M   69M  28% /boot
none                  501M     0  501M   0% /dev/shm
/dev/sdb1             1.8T  1.2T  592G  66% /mnt/usb


--------------------------------------------------------------------
107：小林 洋一; 総研検査システム２課
2021年09月29日（水） 17:03

問合者=自動分析課　高梨様,対応時間(分)=10
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=54#follow

食塩摂取量が3:再計算待ちから変わらないので対応してもらいたい。
下記SQLを実行し対応。
select * from HKHRIRAI where kmkcd='0013094' and hkkhrkbn='3'
update HKHRIRAI set hkkhrkbn='0' where kmkcd='0013094' and hkkhrkbn='3'


--------------------------------------------------------------------
108：小林 洋一; 総研検査システム２課
2021年09月29日（水） 17:03

問合者=自動分析課　高梨様,対応時間(分)=10
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=54#follow

食塩摂取量が3:再計算待ちから変わらないので対応してもらいたい。
下記SQLを実行し対応。
select * from HKHRIRAI where kmkcd='0013094' and hkkhrkbn='3'
update HKHRIRAI set hkkhrkbn='0' where kmkcd='0013094' and hkkhrkbn='3'


--------------------------------------------------------------------
109：羽生 達哉; 総研検査システム２課
2021年09月30日（木） 09:20

日次処理のチェックメールで
<<<<<  日次処理チェック警告メール  >>>>>
と
<<< 日次処理チェック >>>
の受信順番が逆転する現象が発生。

以下説明です。
----------------------------------------------------------------------------------------
----- Original Message -----
Subject: [2021年 9月 29日 水曜日 23:35:01 JST]マルチ エラーログ 報告
Date: Wed, 29 Sep 2021 23:35:38 +0900
From: kensys@bml.co.jp
To: multi_log@bml.co.jp, multi_error@bml.co.jp
kensys@bml.co.jp wrote:
> 
> [ /apdata/aplog/WARNING_DAILY_20210929_2330012021-09-28.log ]
> -------------------------------------------------------------------
> <<<<<  日次処理チェック警告メール  >>>>>
> 日次が正常に終わっていない可能性がありますが
> 過去１５分以内にログが出力されているので
> 処理は進行中です。
> データベース・サーバー = DB2/LINUXZ64 11.1.4.4
> SQL 許可 ID            = DB2INST1
> ローカル・データベース別名 = KEA00DB
> 
> [2021年  9月 29日 水曜日 23:21:49 JST][RIREKI] runstats start ----->
> -------------------------------------------------------------------
> 
> 上記、エラーログが存在しています。確認してください。
> 

このメールの前にケミストリー日次処理チェックのメールが来ていて順番がおかしいように見えますが、
これはメール送信の方法が違うため、メール送信までのタイムラグが発生して送信順番が逆転したためです。

----- Original Message -----
Subject: ケミストリー日次処理チェック
Date: Wed, 29 Sep 2021 23:35:28 +0900
From: kensys@bml.co.jp
To: multi_log@bml.co.jp, multi_error@bml.co.jp
kensys@bml.co.jp wrote:
> 
> <<< 日次処理チェック >>>
> 日次処理が終了しました
> 2021年 9月 29日 水曜日 23:35:02 JST
> 


Subject: [2021年 9月 29日 水曜日 23:35:01 JST]マルチ エラーログ 報告
のメールは
cronにより１５分に１回日次処理の終了チェックを行い終了していない場合警告メッセージのファイルを作成する。
↓
cronにより５分に１回警告メッセージのファイルが存在していた場合、メール送信する。
このため、メール送信まで最大５分ほどの遅延が発生します。

Subject: ケミストリー日次処理チェック
のメールは
上の警告メッセージのファイルが存在していた場合、２分おきに日次処理のログファイルをチェックして終了メッセージを見つけたら直接メール送信。
このため、メール送信までの遅延はありません。

以上の理由でメール送信の逆転が発生しています。

----- Original Message -----
Subject: ケミストリー日次処理チェック
Date: Wed, 29 Sep 2021 23:35:28 +0900
From: kensys@bml.co.jp
To: multi_log@bml.co.jp, multi_error@bml.co.jp
kensys@bml.co.jp wrote:
> 
> <<< 日次処理チェック >>>
> 日次処理が終了しました
> 2021年 9月 29日 水曜日 23:35:02 JST
> 
----------------------------------------------------------------------------------------


--------------------------------------------------------------------
111：羽生 達哉; 総研検査システム２課
2021年10月01日（金） 10:02

各位

ここ数日、ケミストリーの日次処理開始時間が遅く、
終了チェックのエラーメールが来る頻度が上がっています。
清水主任が開始時間を確認してくれていますが、何度も警告メールが来てしまいます。
そこで日次処理の終了チェックを次のように変えようと思うのすが、どうでしょう。

変更前（現状）
23:05～01:55まで15分間隔でcronによりチェックを起動、日次処理のログファイル中に終了メッセージが存在しているかチェックする。
終了メッセージが存在していれば、日次処理データのディレクトリをバックアップ先へコピーする。
終了メッセージが存在していない場合、ログファイルのタイムスタンプが15分以内なら警告メール、
15分を超えていたらエラーメールを送信。
02:00 を超えても日次処理が終了しないようであれば、別途エラーメールを送信。

変更後
23:00～01:45まで15分間隔でcronによりチェックを起動、日次処理のログファイル中に終了メッセージが存在しているかチェックする。
終了メッセージが存在していれば、日次処理データのディレクトリをバックアップ先へコピーする。
終了メッセージが存在していない場合、
--------- ここを追加 -------------------------------------------------------------
ログファイルの先頭行の出力日時から3時間以内ならば何もしない。
3時間を超えていて、
-----------------------------------------------------------------------------------
ログファイルのタイムスタンプが15分以内なら警告メール、
15分を超えていたらエラーメールを送信。
02:00 を超えても日次処理が終了しないようであれば、別途エラーメールを送信。

以上です。

--------------------------------------------------------------------
113：清水 竜也; 総研検査システム１課
2021年10月01日（金） 11:47

@:羽生 達哉; 総研検査システム２課

>>111
羽生主事、ありがとうございます。

追加ロジック、良いと思います。

あと、2:00のチェックを、時刻を1：00とかに出来るものでしょうか。

2:00にメールが来ても寝入っていて気づかないかもしれず、
また累積DBの週一再起動を入れてもらってから、
日次に３時間を超えることはほぼ無くなってきてますから
22時スタートしたとしても、1時には終わるだろうと見込んで...の話です。

よろしくお願いします。

--------------------------------------------------------------------
114：横田 克夫; 総研検査システム２課
2021年10月01日（金） 11:57

@:羽生 達哉; 総研検査システム２課

>>111
羽生主事

賛成です。
エラー通知の頻度が低くなるようであれば、電算課パトランプを点灯させるよう、実装をお願いいたします。

--------------------------------------------------------------------
115：島村 健汰; 総研検査システム１課
2021年10月01日（金） 12:04

各位
停止手順について、停電対応時の手順を改めて作成しました。

\\10.1.103.226\NAS_Backup\総研システム部\共用\★停電対応\システム起動停止マニュアル\A00_ケミストリー\ケミストリーサテライト システム停止手順書（※島村作成）.xlsx

--------------------------------------------------------------------
116：羽生 達哉; 総研検査システム２課
2021年10月01日（金） 12:06

>> 113
>> 114

分かりました。
来週テストして実装したいと思います。
>> あと、2:00のチェックを、時刻を1：00とかに出来るものでしょうか。
時間の調整もしてみます。

確認取れましたらまた連絡します。
パトライトは少し運用してみてから考えます。


--------------------------------------------------------------------
117：横田 克夫; 総研検査システム２課
2021年10月01日（金） 12:13

@:島村 健汰; 総研検査システム１課

>>115
島村殿

おおぉぉっ！分かりやすい！！ありがとう！！

１つだけお願いがあります。

ケミストリは正月にZサーバだけ停止する作業があります。

先頭にシートを追加し、目次を書いて、Zサーバだけ停止する時は、
どの手順だけを実施すれば良いのか、記載してもらえないですか。

急がないので、対応を検討してもらえると幸いです。


--------------------------------------------------------------------
118：島村 健汰; 総研検査システム１課
2021年10月01日（金） 13:20

@:横田 克夫; 総研検査システム２課

>>117
分かりました。
タイミングを見て対応します。

完成しましたら内容の確認の程、よろしくお願いします。

--------------------------------------------------------------------
119：清水 竜也; 総研検査システム１課
2021年10月01日（金） 16:48

9/27の週に、FEUAという計算項目のマスターを追加しましたので、以下記載します。

■ＦＥＵＡについて　　名称：尿中尿酸排泄率  

　・従来コードで小数点１桁設定の項目コード(13111)があり、
　  今回、小数点２桁を新設。項目コード＝ 13549　
　  
　  計算元の項目が血清と尿で、それぞれの 尿酸(UA)とクレアチニン(Cre)
　  サテライト跨ぎの計算となる。
　  
　            　   尿中UA ｘ 血清Cre                    尿中UA =124
　  ＦＥＵＡ＝ --------------------- ｘ 100％      尿中Cre=126
　                  血清UA ｘ 尿中Cre                     血清UA =407
　                                                                 血清Cre=413
　       
　  尿項目は尿一般、血清はケミストリーだが、ラボでも良しとし、ＦＥＵＡは総研でのみ受付。
 
　  2020年頃に追加した以下の機能により再計算され、今回は５個のうち下３つ。
　  proc.shで表示される常駐系のLDシリーズ
　  
　      LD101      属性エラーチェック 
         LD103      属性修正展開       
         LD104      結果要求カード作成・・・分注END後から発動
         LD105      他結果情報登録     
         LD106      再計算処理

●登録したマスター
     ・基本的なもの     KJNMST、
                               HST_KJNMST
                               KMKGMST
                               KMKMST
                       
     ・サテライト跨ぎ  GETSYSKKAMST・・・ ホストへの結果照会要求カード(LD104)用
                               CALCSYSMST    ・・・サテライト跨ぎ専用の計算式マスタ
                               CALCZAIMST
      
     作業用フォルダー：
     \\10.1.103.226\NAS_Backup\総研システム部\総研システム３課\01_ケミストリ\03_マスタ管理\03_マスターリリース作業\20210910_尿中尿酸排泄FEUA_小数2桁新規

     
      ※ 計算元が依頼に無い場合、よくサテライト内部で自動発生させるが
         サテライト跨ぎはホスト上の結果を照会をするため、リアルな依頼が必要。
         
      ※ 計算に身長、体重、年齢など使う場合は CHKZOKMST も登録が必要と思われる。LD101関連 
      
      ホスト結果照会要求カード   分注END後から、10分間隔で送出。
      送信済み後の格納dir  /apdata/today/online/host/ok_Send下     ネーミング は  *.kka 
 
●PC上の計算ツール
   
     自動計算機能を追加する以前から、サテライト跨ぎで計算が必要な項目が多数あり
     それら、EXCELのツールでkikanDBよりデータ取得させ、計算を行っている。
     計算後、「送信」にてケミストリへ送信、取込を行っている。
      PC:\Program Files\BML\EXECL 下
    
     従来の項目コード(13111)が「FEUA計算ツール」であり、コピーし、今回の小数点２桁用を作成。
     内部のマクロで、FEUAのセル 小数桁設定あり  "#####0.0" → "#####0.00" に変更。
 

--------------------------------------------------------------------
120：小林 洋一; 総研検査システム２課
2021年10月04日（月） 13:20

問合者=自動分析課海老島,対応時間(分)=120
問い合わせ内容
10/1(土)に試薬ロットが229109に更新されたのでコントロールマスタを入力をしたつもりになっていた。
XbarRの画面で10/1,2のコントロールデータが旧ロット(223012)で表示されてしまっているので対応してほしい。

調査結果
X-R管理図(HS101.exe)のログ、ソースを確認。
テスト機にコントロールデータ(CTRLKKA,RUI_CTRLKKA)をコピー

テスト機での対応内容
コントロールデータの更新。
update RUI_CTRLKKA set SYKLOTNO='229109' where KNSKISYMD between '2021-10-01' and '2021-10-02' and SYKLOTNO in('223012')
update CTRLKKA set SYKLOTNO='229109' where KNSKISYMD between '2021-10-01' and '2021-10-02' and SYKLOTNO in('223012')

コントロールマスタを前のデータでコピー。
insert into QCCTRLMST select BSKKBN,NBKMKCD,CTRLSBT,CTRLNM,CTRLRS,'229109',CTRLLBL,CTRLX,CTRLSD,CTRLCV,VALUER,MAXR,SSTNKSU,TANKJ,FACTERJD1,FACTERJD2,FACTERSD1,FACTERSD2,BASEJD1,BASEJD2,BASESD1,BASESD2,KSIKJNSPSU,SHRNGLWHF,SHRNGHIHF,SHRNGLWHB,SHRNGHIHB,HSTKJNTN,HSTKZMHB,HSTKAIKYU,FILENUM,YKKIGEN,GKTKS,CTRLHYJN,KAIYMD,HAIYMD,HNKTNTID,KSNDH from QCCTRLMST where syklotno='223012'

試薬の変更は本日行うので対応は不要と連絡をいただきました。

20211004131900.pdf

--------------------------------------------------------------------
121：小林 洋一; 総研検査システム２課
2021年10月05日（火） 17:43

問合者=自動分析課金山,対応時間(分)=30
下記の属性が修正されたがケミストリの属性が更新されない。
select * from kanjya where utkymd='2021-10-02' and irino='00303293800'limit 10
2021-10-02
3032938

身長体重を入力していただき、食塩摂取量の再計算を行っていただきました。
報告できない状況であったため下記SQLで更新。
select * from HKHRIRAI where utkymd='2021-10-02' and irino='00303293800'
update HKHRIRAI set hkkhrkbn='0'  where utkymd='2021-10-02' and irino='00303293800'


--------------------------------------------------------------------
122：横田 克夫; 総研検査システム２課
2021年10月05日（火） 22:39

問合者=自動分析課　辻主任,対応時間(分)=10
ZS稼働率分析のため、10/4受の情報を抽出してもらいたい。

→下記のSQLの結果を送付
select knskisymd,BSKKBN,BSKLNE,kmkcd,substr(TRKDH,1,15)||'0',count(*) from rui_kekka where knskisymd='2021-10-04' and BSKKBN='Z050' group by knskisymd,BSKKBN,BSKLNE,kmkcd,substr(TRKDH,1,15) order by 1 for read only with ur


20211004受_ZS稼働率分析_項目CD付加.xlsx

--------------------------------------------------------------------
123：羽生 達哉; 総研検査システム２課
2021年10月07日（木） 12:31

各位

ケミストリーのＤＢで、
bunchu
chikenzok
hkhrirai
irai
kanjya
kekka
kenorder
kenzok
ninsiki
realchk
のテーブルは未報告分が繰り越されているようですが、過去分のデータが大量に残っています。（53000患者くらい）
一番古い日付が2006-10-06なので稼働当初から残っているようです。

この繰り越し分を毎日日次処理で
exportでファイル作成→テーブルクリア→ファイルからimport
という超無駄なことをしています。

半年以上過ぎた未報告データをサテライトで入力することは無いと思うので
検査に確認して削除するようにしませんか。


--------------------------------------------------------------------
124：清水 竜也; 総研検査システム１課
2021年10月07日（木） 12:42

@:羽生 達哉; 総研検査システム２課

>>123
ありがとうございます。
とっても良いと思います。

--------------------------------------------------------------------
125：横田 克夫; 総研検査システム２課
2021年10月07日（木） 13:20

@:羽生 達哉; 総研検査システム２課

>>123
大賛成です！

--------------------------------------------------------------------
126：松津 健; 総研検査システム２課
2021年10月07日（木） 14:37

他のサテライトも同様な状況でないか総点検を実施したらどうですか？

--------------------------------------------------------------------
127：横田 克夫; 総研検査システム２課
2021年10月07日（木） 15:46

@:松津 健; 総研検査システム２課

>>126
松津さま

ご意見ありがとうございます。
他のサテライトの点検を実施します。

--------------------------------------------------------------------
128：羽生 達哉; 総研検査システム２課
2021年10月07日（木） 17:39

>>123
ケミストリーＤＢの過去分患者数です。

ケミストリー過去分データ数.xlsx

--------------------------------------------------------------------
129：横田 克夫; 総研検査システム２課
2021年10月07日（木） 18:35

@:羽生 達哉; 総研検査システム２課

>>128
羽生主事

頂いた件数を使って、藤本課長への説明は横田から行います。
作業予定日を決めたいのですが、１０月１４日（木）で宜しいでしょうか。

--------------------------------------------------------------------
130：羽生 達哉; 総研検査システム２課
2021年10月08日（金） 09:02

@:横田 克夫; 総研検査システム２課

>>129
作業内容を皆で確認しておきたいので、
その前に清水主任が出社している日に
事前打ち合わせをしておきたいです。

--------------------------------------------------------------------
131：清水 竜也; 総研検査システム１課
2021年10月08日（金） 09:24

@:羽生 達哉; 総研検査システム２課

>>130
来週月曜10/11、出社予定です。
あと今日夕方、ケミストリーの打合せあり、15時半頃、出社します。

--------------------------------------------------------------------
132：横田 克夫; 総研検査システム２課
2021年10月08日（金） 17:42

問合者=自動分析課　辻主任,対応時間(分)=10
ZS稼働率分析のため、血清測定情報を抽出してもらいたい。

下記SQLを実行し、結果を送付。
SELECT
    trim(knsgrp) as 検査Ｇ,
    kmkcd as 項目ＣＤ,
    trim(REPLACE(kmknmj,'　','')) as 項目名,
    ksjhflg as 測定Ｆ,
    case ksjhflg
        when '1' then '測定する'
        else '測定しない'
    end as 血清測定,
    nyuyouflg as コメントＦ,
    case nyuyouflg
        when '1' then '乳びのみ'
        when '2' then '溶血のみ'
        when '3' then '乳び優先'
        when '4' then '溶血優先'
        else 'コメントなし'
    end as コメント
FROM
    kmkmst
ORDER BY
    knsgrp,kmkcd
for read only with ur


20211008_血清測定情報.xlsx

--------------------------------------------------------------------
133：横田 克夫; 総研検査システム２課
2021年10月12日（火） 08:19

@:羽生 達哉; 総研検査システム２課

>>130
羽生主事

過去分データが大量に残っている件、藤本課長に説明しました。

データ保持期間は３ヶ月で良いとの事です。
また、リリース日程を決定したいため週のどこが良いか確認したところ、平日であれば木曜受が少ないとの事でした。

が、ケミストリーで何かあると一大事になるので、稼働日を悩み始めています。
リカバリ手順を含めた作業手順と確認項目の明確化した上で３人で打合せを行いませんか。

データ保持期間が無制限となっているのを、１年ずつ短くするなどの段階的なリリースも検討したいです。

--------------------------------------------------------------------
134：小林 洋一; 総研検査システム２課
2021年10月12日（火） 17:28

問合者=自動分析課　高梨様,対応時間(分)=10
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=54#follow

食塩摂取量が3:再計算待ちから変わらないので対応してもらいたい。
下記SQLを実行し対応。
select * from HKHRIRAI where kmkcd='0013094' and hkkhrkbn='3' and utkymd='2021-10-09'
update HKHRIRAI set hkkhrkbn='0' where kmkcd='0013094' and hkkhrkbn='3'and utkymd='2021-10-09'


--------------------------------------------------------------------
135：上原 洋樹; 総研検査システム２課
2021年10月13日（水） 09:24

各位
ＩＡサーバーにZabbixを導入する準備を進めています
本日(10/13)、使用ポートの調査の為に以下サーバーのクーロンにポート取得の設定を入れてあります。
もし何かありましたら止めるか消すかしてください。

KEA00IAW21	10.1.181.41

[kea00sys@KEA00IAW21 work]$ crontab -l
MAILTO=""
#                                           Kansi FTP
*/5 * * * *               /home/kea00sys/shell/chk_proc_IA.sh
*/5 * * * *               /home/kea00sys/shell/chk_CS2232.sh
15 * * * * /usr/sbin/lsof -i -P >> /home/kea00sys/work/20211013_port.log　←★
[kea00sys@KEA00IAW21 work]$ ls

特に影響無ければ、明日(10/14)の朝残り３台(KEA00IAW22～24)に同様のクーロンを設定（10/15金に停止）
Zabbixのポートを使用していない事が確認できたら、来週中に１台にZabbix導入して様子見。
問題無ければ残り３台に導入予定です。

--------------------------------------------------------------------
136：羽生 達哉; 総研検査システム２課
2021年10月13日（水） 14:53

問合者=自動分析課　和泉様,対応時間(分)=15
特定施設・患者リストが文字化けしているので見て欲しい。

検査員がローカルのＯＣから登録する特定施設作業定義ファイル(tokutei.txt)に
改行のみの空行が入っていた。
空行を削除して再実行。


--------------------------------------------------------------------
137：羽生 達哉; 総研検査システム２課
2021年10月13日（水） 15:57

>>136
この処理は今となってはいろいろと問題があります。

①ローカルで定義ファイルにメモ帳で登録→サーバーへftpで送信
となっているので、不注意で定義ファイルを壊してしまう恐れがあります。
（今回はこれでした）
②定義ファイルはftpでサーバーへ上書きなので、壊れたファイルで上書きすると
復旧できなくなる可能性があります。バックアップも取っていないみたいです。ケミストリーの
③リスト印刷時の出力先が、ライン側検査室プリンタに固定されている。
操作しているのはBMZ側の検査室なので、
④定義ファイル・スクリプトの置き場がとても遠い。
/apdata/work/gyoumu/sh/
の下。
workという名前がうっかり消してしまいしまいそうになる。

--------------------------------------------------------------------
138：羽生 達哉; 総研検査システム２課
2021年10月13日（水） 17:59

問合者=自動分析課　和泉様,対応時間(分)=20
特定施設・患者リストで定義ファイルに追加登録したらまた文字化けした。

定義ファイルからSQL問い合わせ分を作成してDB２での実行結果をリストへ編集しているが、
問い合わせ結果に警告メッセージが含まれてしまった。
リスト編集時には警告メッセージなどは想定していないため、編集結果のレイアウトが崩れた。

警告メッセージが出力された理由は、定義ファイル中の施設コードを入力ミスして７桁以外の
施設コードで登録していた。
DBのカラムと桁数が合わないので警告が出た。
今まで出なかった警告が今回出たのは、定義ファイルの件数が増えたためではないかと思う。


--------------------------------------------------------------------
139：上原 洋樹; 総研検査システム２課
2021年10月14日（木） 09:50

>>135
Zabbix導入前の使用ポート調査

以下３サーバーのクーロンにポート調査のコマンド実行を設定しております。
KEA00IAW22	"10.1.181.42
KEA00IAW23	"10.1.181.43
KEA00IAW24	"10.1.181.44

[kea00sys@KEA00IAW24 ~]$ crontab -l
MAILTO=""
#                                           Kansi FTP
*/5 * * * *               /home/kea00sys/shell/chk_proc_IA.sh
*/5 * * * *               /home/kea00sys/shell/chk_CS2232.sh
15 * * * * /usr/sbin/lsof -i -P >> /home/kea00sys/work/20211014_port.log　★
[kea00sys@KEA00IAW24 ~]$

10/15(金)の朝停止予定です。
もし何かありましたら停止をお願いします。




--------------------------------------------------------------------
140：上原 洋樹; 総研検査システム２課
2021年10月15日（金） 09:52

>>139
ポート取得のクーロン停止しました。
KEA00IAW21    10.1.181.41
KEA00IAW22    10.1.181.42
KEA00IAW23    10.1.181.43
KEA00IAW24    10.1.181.44

--------------------------------------------------------------------
141：小林 洋一; 総研検査システム２課
2021年10月19日（火） 15:53

問合者=自動分析課　金山様,対応時間(分)=10
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=54#follow

食塩摂取量が3:再計算待ちから変わらないので対応してもらいたい。
下記SQLを実行し対応。
select * from HKHRIRAI where kmkcd='0013094' and hkkhrkbn='3' and utkymd<=(SELECT current date-2 FROM sysibm.sysdummy1)
update HKHRIRAI set hkkhrkbn='0' where kmkcd='0013094' and hkkhrkbn='3' and utkymd<=(SELECT current date-2 FROM sysibm.sysdummy1)


--------------------------------------------------------------------
142：横田 克夫; 総研検査システム２課
2021年10月20日（水） 15:08

■開発・検証用のクライアント環境
IPアドレス:10.1.103.78
ユーザー:bml
パスワード:System01
→リモートデスクトップでログイン後、デスクトップの「ケミストリ」アイコンをクリック
→必要画面には「1004」／「1004」でアクセス可能。

--------------------------------------------------------------------
143：小林 洋一; 総研検査システム２課
2021年10月20日（水） 17:18

問合者=自動分析課　海老島様,対応時間(分)=10
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=54#follow

コッククロフトが3:再計算待ちから変わらないので対応してもらいたい。
受日:2021-10-13
依頼書NO:0939705

下記SQLを実行し対応。
select * from HKHRIRAI where hkkhrkbn='3' and utkymd='2021-10-13'
update HKHRIRAI set hkkhrkbn='0' where hkkhrkbn='3' and utkymd='2021-10-13'


--------------------------------------------------------------------
144：清水 竜也; 総研検査システム１課
2021年10月21日（木） 13:55

備忘録：
DBにインポートする際、compoud指定 を入れると、圧倒的に早くなる。

テスト環境で１日分のデータが、18分から3分程度へ。

DB内部でのレコードチェックが１件毎から、n件ごとになるらしい。 n=Max100
※だたし、 INSERT_UPDATEとの併用は不可のよう（やってはいないけれど）

例）
import from  KENORDER    of del   commitcount 20000  replace into  KENORDER
　　　　　　　　　　　　　　　　　　↓
import from  KENORDER    of del  modified by compound=100  commitcount 20000  replace into  KENORDER

--------------------------------------------------------------------
145：横田 克夫; 総研検査システム２課
2021年10月23日（土） 09:41

１行目：問合者=エラーメール＆竹澤さん,対応時間(分)=15

■[2021年 10月 23日 土曜日 07:55:03 JST]検査結果 フラグ異常 確認
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2021年10月23日（土） 07:55

20211022,"00136469900","0012976"
20211022,"00136470700","0012976"

上記、測定結果のフラグがおかしい検体があります。
（ 検査フラグ M、結果状況コード 3 ）

■未報告リストを出力しようとしたところ「システムに連絡してください」のエラーが表示される

→上記の項目について報告結果を確認いただき、問題無いとの回答。
→ケミストリ内のみのデータ不整合なので、過去の対応履歴を参照し対応

select * from kekka where utkymd='2021-10-22' and irino ='00136469900' and kmkcd='0012976' and knsflg='M'
select * from kekka where utkymd='2021-10-22' and irino ='00136470700' and kmkcd='0012976' and knsflg='M'

update kekka set knsflg='E' where utkymd='2021-10-22' and irino ='00136469900' and kmkcd='0012976' and knsflg='M'
update kekka set knsflg='E' where utkymd='2021-10-22' and irino ='00136470700' and kmkcd='0012976' and knsflg='M'


--------------------------------------------------------------------
146：横田 克夫; 総研検査システム２課
2021年10月27日（水） 18:15

問合者=自動分析課　藤本課長・海老島様,対応時間(分)=60
属性修正の情報が反映される時と、反映されない時があるので、調査してもらいたい。

→現状を確認したいので、下記の依頼でダミーを発生させ、検証をお願いしたい。
0031776　テスト1：パターン①　属性に問題なく正常に報告⇒日曜日（夕方）にホスト属性修正
0031777　テスト2：パターン②　属性に問題なく正常に報告⇒月曜日（昼）にホスト属性修正
0031778　テスト3：パターン③　属性不足で未入力⇒日曜日（夕方）にホスト属性修正
0031779　テスト4：パターン④　属性不足で未入力⇒月曜日（昼）にホスト属性修正

→添付の結果を確認。
　結果、ホストで日曜に属性修正すると、基幹Linuxに情報が配信されずケミストリにも配信されない事が判明。
　側主任に対応方法案の検討と工数・工期の調査を依頼した。
　案１：月曜の業務開始処理前に、溜まっている属性修正情報を配信する。
　案２：日曜の２２時に、溜まっている属性修正情報を配信する。
　など

属性修正_ケミストリでの取込状況の確認.pdf

--------------------------------------------------------------------
147：古河 ゆり; 総研検査システム２課
2021年10月28日（木） 13:19

【備忘録】
「ABC検診_エラーリスト_ケミストリー新版.xls 」のエラーコード判別条件
(A-202110-07312　Excelシートの設定抽出対応履歴)
詳細は添付ファイルをご確認ください。

ABC検診_エラーリスト_ケミストリー新版.xls
ABC検診エラーコード一覧.xlsx

--------------------------------------------------------------------
148：上原 洋樹; 総研検査システム２課
2021年10月28日（木） 17:32

各位
Zabbix導入の連絡
本日（10/28）以下ＩＡサーバーにZabbixを導入しています。
ポートかぶり等が無い事は事前に確認済みですが、
何かありましたらZabbixエージェントの停止をお願い致します。

・対象サーバー
KEA00IAW24    "10.1.181.44

・対象分析機
ＬＡＢＯ 6～9号機

[kea00sys@KEA00IAW24 ~]$ ps -ef | grep DD
kea00sys  4325     1  2 10月27 ?       00:39:12 DD203 07
kea00sys  4328     1  2 10月27 ?       00:39:09 DD203 08
kea00sys  4333     1  2 10月27 ?       00:39:18 DD203 06
kea00sys  6176     1  2 15:29 ?        00:03:20 DD203 09
kea00sys 21359 11497  0 17:24 pts/3    00:00:00 grep --color=auto DD
[kea00sys@KEA00IAW24 ~]$

・停止方法
# systemctl stop zabbix-agent

問題無ければ、１１月に週に１台づつ程度入れていく予定です。
宜しくお願い致します。

--------------------------------------------------------------------
149：古河 ゆり; 総研検査システム２課
2021年11月02日（火） 00:09

問合者=自動分析課　藤本課長　対応時間(分)=15
PrtScreenで印刷ができない

Mini Hardcopy Utilityをスタートアップに設定。
また、クライアントPC設定手順書を改定しました。

＜手順書の場所＞
\\10.1.103.226\nas_backup\総研システム部\総研システム３課\01_ケミストリ\99_資料\02_手順書\Win10用クライアントSetup
→手順.txt
※旧手順書はbakフォルダに移動

＜追加文＞
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー
7，以下のディレクトリを「C:bml\Tools」にコピーし、ディレクトリ内の「MiniCopy.exe」プログラムをスタートアップに設定する。
　・PrintScreenキーでコピーした画面を印刷するツール。
　　\\10.1.103.226\nas_backup\総研システム部\総研システム３課\01_ケミストリ\99_資料\02_手順書\Win10用クライアントSetup\Tools\MiniCopy
ーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーーー

--------------------------------------------------------------------
150：横田 克夫; 総研検査システム２課
2021年11月02日（火） 17:15

各位

藤本課長と定例会を行うようにするため、ケミストリー関連の作業について棚卸しを行います。
抱えている作業について、添付ファイルに漏れが無いか確認してください。
記載内容に認識違いがある場合は、１１／４（木）中に教えてください。

なお、添付ファイルは以下に保管しています。
\\10.1.103.225\検査本部\総研検査システム２課\定例会\31001-自動分析課(ケミストリー)

67期_システム案件一覧（ケミストリー）.xlsx

--------------------------------------------------------------------
151：清水 竜也; 総研検査システム１課
2021年11月02日（火） 19:08

@:横田 克夫; 総研検査システム２課

>>150
２件追加。FEUAなど 追記しました。
また状況の欄、全く作業着手できていない箇所は、未着手にしました。

67期_システム案件一覧（ケミストリー）smz追記.xlsx

--------------------------------------------------------------------
152：横田 克夫; 総研検査システム２課
2021年11月02日（火） 19:52

@:清水 竜也; 総研検査システム１課

>>151
ありがとうございます。
食塩摂取量についての相談事項を書き洩らしていたので追加しました。
サーバのファイルを更新済です。（№24食塩摂取量について）

--------------------------------------------------------------------
153：上原 洋樹; 総研検査システム２課
2021年11月04日（木） 09:43

各位
Zabbix導入の連絡
本日（11/4）以下ＩＡサーバーにZabbixを導入しています。
ポートかぶり等が無い事は事前に確認済みですが、
何かありましたらZabbixエージェントの停止をお願い致します。

・対象サーバー
KEA00IAW23    "10.1.181.43

・対象分析機
ＬＡＢＯ 1～5号機

[kea00sys@KEA00IAW23 ~]$ ps -ef | grep DD
kea00sys  1839     1  2 11月02 ?       01:07:49 DD203 01
kea00sys  1842     1  2 11月02 ?       01:07:31 DD203 02
kea00sys  1845     1  2 11月02 ?       01:07:23 DD203 03
kea00sys  1849     1  2 11月02 ?       01:07:18 DD203 04
kea00sys  8895     1  2 02:50 ?        00:11:53 DD203 05
kea00sys 15499 15243  0 09:38 pts/1    00:00:00 grep --color=auto DD
[kea00sys@KEA00IAW23 ~]$

・停止方法
# systemctl stop zabbix-agent

10/28にZabbixを入れたIAサーバー(KEA00IAW24)と同じ型のサーバーかと思いますので、
問題無いと思いますが宜しくお願いします。

--------------------------------------------------------------------
154：清水 竜也; 総研検査システム１課
2021年11月05日（金） 20:00

各位

定期的に検査結果データをチェックし、フラグ異常（不整合データ）を検知した場合に
エラーメールを発報する機能が従来からあります。　shell/cron/chk_KNSFLG.sh

エラーメールはシステム担当者宛に配信され、システム担当者から検査担当者に電話で連絡して
いますが、翌日〆間際など電話が繋がらない事があるため、検査室にエラー発生を通知する機能を
11/5より追加しました。

具体的には、検査室にパトランプを設置、　
同フラグ異常があった場合、エラー内容をDBのAPLLOGに登録し、パトランプの赤色を点滅します。

パトランプが赤色点灯した場合は、既存機能のログ照会で詳細を確認してもらうように話しました。
（ただし、エラーメールがあった場合の電話連絡は今まで通り欲しいとのことです。）

ケミストリー_パトライト設置お知らせ.xlsx

--------------------------------------------------------------------
155：横田 克夫; 総研検査システム２課
2021年11月07日（日） 09:41

@:清水 竜也; 総研検査システム１課

>>154
清水主任

ご対応ありがとうございます。

システム担当者が認識しておくことを一覧に纏めませんか？
メールだと忘れますので...

なお、清水主任から藤本課長に配信して頂いたメール・資料は以下にも保管しておきました。ご連絡しておきます。
\\10.1.103.225\検査本部\総研検査システム２課\定例会\31001-自動分析課(ケミストリー)\運用願い\20211105_ケミストリー：パトランプ設置について


--------------------------------------------------------------------
156：横田 克夫; 総研検査システム２課
2021年11月08日（月） 18:00

>>146
ホストの対応内容について回答を貰えたので、下記のメールを藤本課長に配信しました。
-------------------------------
	属性修正 情報配信の機能実装について
差出人	 ： 	"横田 克夫" <k-yokota@bml.co.jp> 
送信日時	 ： 	2021年11月08日（月） 17:58
To  	 ： 	"藤本 丈志" <takeshi-f@bml.co.jp>
Cc  	 ： 	"側 展嘉" <gawa-n@bml.co.jp>
藤本課長
cc:側主任

お疲れ様です。

先日、お問合せ頂いていた件について回答します。

□問合せ内容
　日曜に属性修正をした時に、ホストの修正情報が
　ケミストリシステムに反映されていない。
　対応に必要な工数を調査してもらいたい。

□回答
　対応は、ホストシステムへの機能追加になります。
　その為、基幹システム課の側主任に調査してもらいました。
　以下、回答です。
　　・日曜に実施した属性修正の情報を配信させる事は可能です。
　　・配信タイミングは日曜日の通常報告処理です。
　　・作業依頼書で対応可能です。

上記の対応を行えば、日曜の属性修正の情報は月曜の午前中には
ケミストリシステムで確認が可能となります。

作業依頼書は、基幹システム課に提出をお願いします。

横田


--------------------------------------------------------------------
157：羽生 達哉; 総研検査システム２課
2021年11月09日（火） 13:29

問合者=自動分析課　和泉様,対応時間(分)=20
特定施設・患者リストで定義ファイルに追加登録したらまた文字化けした。

136,138と同じ現象。
対象とする患者が多くなりすぎてSQLの最適化が働かなくなっている。
そのため当初想定していないメッセージがSQLの出力に含まれ、出力結果をうまく整形できなくなっている。


UTKYMD     IRINO       KNJNMN               SSTCD   USERNAME             SEX
---------- ----------- -------------------- ------- -------------------- ----
SQL0437W  この複合照会のパフォーマンスが最適ではない可能性があります。　　　　　　※
理由コード: "1"。  SQLSTATE=01602　　　　　　　　　　　　　　　　　　　　　　　　　※

2021-11-08 00000304500 ﾔﾏｻﾞｷ ﾐﾁｺ            3834200 東大泉病院　　　　　 女　
2021-11-08 00070304600 ﾀﾆﾓﾄ ﾀﾂﾔ             7517300 津山慈風会　津山中央 男　
2021-11-08 00756215800 ｵｸﾞﾘ ﾐﾂｵ             2761201 浜松赤十字病院　　　 男　

  選択された 3 レコード (1 警告メッセージ) が表示されました。　　　　　　　　　　　　　※

※をつけた行がエラーメッセージの行

tokutei_kanja.sh を修正してキーワード"SQL","警告"を含む行を除外するように変更。
患者名とか施設名にキーワードを含む患者が来なければ大丈夫。


--------------------------------------------------------------------
158：横田 克夫; 総研検査システム２課
2021年11月09日（火） 20:22

日次バックアップファイルの移動作業を実施しました。

・移動元フォルダ
　kea00apa:/apdata/today/file/KEA00/KEA00IAW02/bak_daily/
　　2021-07-01　～　2021-07-31
・移動先フォルダ
　kea00apa:/apdata/today/file/KEA00/KEA00IAW21/bak_daily/
・Disk使用率
　作業前
　　KEA00IAW21:/apdata/today/file/KEA00/KEA00IA　449G   36G  391G    9% /apdata/today/file/KEA00/KEA00IAW21
　　KEA00IAW02:/apdata/today/file/KEA00/KEA00IA　72G   62G  5.7G   92% /apdata/today/file/KEA00/KEA00IAW02
　作業後
　　KEA00IAW21:/apdata/today/file/KEA00/KEA00IA　449G   44G  382G   11% /apdata/today/file/KEA00/KEA00IAW21
　　KEA00IAW02:/apdata/today/file/KEA00/KEA00IA　72G   54G   15G   80% /apdata/today/file/KEA00/KEA00IAW02


--------------------------------------------------------------------
159：羽生 達哉; 総研検査システム２課
2021年11月15日（月） 11:53

>>111
少し古い話ですが、この機能を実施します。

今週は現行のチェック処理も残しているので、新旧のメールが来ます。
また、確認用に
-----------------------------------------------------------
<<<<<  日次処理チェック警告メール  >>>>>
日次がまだ終わっていませんが
処理開始より１８０分以内なのでチェックしません。
-----------------------------------------------------------
こんなメールが来ます。
今週実施して問題ないようなら、原稿のチェックを停止して
新しいチェックのみにします。
確認用のメールも停止します。

これで日次処理のメールはほとんど出なくなるはずです。



--------------------------------------------------------------------
160：横田 克夫; 総研検査システム２課
2021年11月15日（月） 12:57

@:羽生 達哉; 総研検査システム２課

>>159
ご対応ありがとうございます。
夜中のメールが来なくなるので、とても助かります。

--------------------------------------------------------------------
161：小林 洋一; 総研検査システム２課
2021年11月24日（水） 10:55

問合者=自動分析課金山様,対応時間(分)=20
計算項目患者属性NGリストというものが営業所にFAXされた。
どこからFAXされているかは不明。
11/23が休日なので誤って送信されたものかもしれないと回答。
調査はしてみると回答。


FAX内容.pdf

--------------------------------------------------------------------
162：小林 洋一; 総研検査システム２課
2021年11月25日（木） 09:26

問合者=自動分析課田口様,対応時間(分)=10
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=54#follow

推算GFRが3:再計算待ちから変わらないので対応してもらいたい。
受日:2021-11-20
依頼書NO:7108432

下記SQLを実行し対応。
select * from HKHRIRAI where hkkhrkbn='3' and irino='00710843200'
update HKHRIRAI set hkkhrkbn='0' where hkkhrkbn='3' and irino='00710843200'


--------------------------------------------------------------------
163：小林 洋一; 総研検査システム２課
2021年11月25日（木） 16:15

問合者=自動分析課高梨様,対応時間(分)=60
ホストで属性修正を行ったがケミストリに反映されていない。
下記の検体の状態を調べてほしい。
受日:2021-11-19,依頼書:3075906
受日:2021-11-20,依頼書:0063273
受日:2021-11-20,依頼書:0064076
受日:2021-11-20,依頼書:0064280
受日:2021-11-20,依頼書:0343594
受日:2021-11-20,依頼書:0871491

基幹イントラネットで属性修正の時刻を確認。
11/22(月) 10:09に修正されていることを確認。

teratermで10.1.181.22 kea00sys kea00sysでログイン。
ケミストリテスト機へログファイルとオンラインファイルをコピー
cd /mnt/usb/bak_daily/2021-11-20
scp -p Backup_apdata_0.tgz 10.1.42.147:/home/kea00sys/work/kobayashi/20211124/
scp -p Backup_apdata_1.tgz 10.1.42.147:/home/kea00sys/work/kobayashi/20211124/

teratermでkea00apk kea00sys kea00sysでログイン。
cd /home/kea00sys/work/kobayashi/20211124/
tar -zxf Backup_apdata_0.tgz
tar -zxf Backup_apdata_1.tgz
cd today/online/host/Recv/shusei/OK
grep -l 307005906 *
grep -l 006003273 *
grep -l 006004076 *
grep -l 006004280 *
grep -l 034003594 *
grep -l 087001491 *

ファイルが存在することを確認。
kea00sys@kea00apk:~/work/kobayashi/20211124/today/online/host/Recv/shusei/OK> grep -l 006004076 *
SHU.data.211122124701

ログを確認
cd /home/kea00sys/work/kobayashi/20211124/aplog
view LD103_20211122.log
2021/11/22  12:47:07    T   kea00apa    16837   kea00sys    LD103   LD103.c     384     00000000    属性修正情報ファイルの処理を開始します。[/apdata/today/online/host/Recv/shusei/SHU.data.211122124701]
2021/11/22  12:47:07    T   kea00apa    16837   kea00sys    LD103   LD103.c     494     00000000    ファイル読込。[utkymd:2021-11-02 irino:00087095100]
2021/11/22  12:47:08    E   kea00apa    16837   kea00sys    LD103   LD103_db.sqc    sFncRuiChkZok   411 S   00000000    SQLCODE:-1476 SQLSTATE:40506 WHERE[UTKYMD='2021-11-02'][IRINO='00087095100']

SQLCODE:-1476 SQLSTATE:40506(タイムアウト)でエラーになっていることを確認。
1行目からエラーになっていた。
横田課長と相談した結果、対象行のみのファイルを作成して取り込みをすることに決定。
下記のコマンドを実行してファイルを作成
cd today/online/host/Recv/shusei/OK
grep -h 307005906 SHU* > test.txt
grep -h 006003273 SHU* >> test.txt
grep -h 006004076 SHU* >> test.txt
grep -h 006004280 SHU* >> test.txt
grep -h 034003594 SHU* >> test.txt
grep -h 087001491 SHU* >> test.txt

scp -p test.txt 10.1.42.15:/apdata/today/online/host/Recv/shusei

teratermでkea00apa kea00sys kea00sysでログイン。
cd /apdata/today/online/host/Recv/shusei
mv test.txt SHU.data.211125041511
cd /aplog
tail -f LD103_20211125.log

処理されたことを確認。
LD103で属性を更新。
LD106で結果を更新していた。

問い合わせ者に連絡し報告できるようになったことを確認。


--------------------------------------------------------------------
164：小林 洋一; 総研検査システム２課
2021年11月25日（木） 18:16

ケミストリのログをチェックしてエラー通知するシェルを作成しました。
/home/kea00sys/shell/cron/chk_log.sh

まずは本番機で1日稼働して確認を行います。
送信先は横田課長、小林です。

11月26日に問題なければパトランプを鳴らすようにします。

送信サンプルは下記の通りです。
[2021年 11月 25日 木曜日 17:50:02 JST] ログチェック
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2021年11月25日（木） 17:50
To  	 ： 	you-kb@bml.co.jp

< /apdata/aplog/LD103_20211122.log:2021/11/22 12:47:08 E kea00apa 16837 kea00sys LD103 LD103_db.sqc sFncRuiChkZok 411 S 00000000 SQLCODE:-1476 SQLSTATE:40506 WHERE[UTKYMD='2021-11-02'][IRINO='00087095100']

DB2のエラーが発生しています。
ログを確認しファイルを再処理してください。





--------------------------------------------------------------------
165：小林 洋一; 総研検査システム２課
2021年12月03日（金） 14:21

各位
お疲れ様です。小林です。

ケミストリのログチェックシェルを修正しました。
・チェック対象を全てのログからLD103に変更
・送信先をmulti_error@bml.co.jpに変更

kea00sys@kea00apa:~/shell/cron> diff chk_log.sh chk_log.sh_20211203
22c22
< /usr/bin/grep SQLCODE /apdata/aplog/LD103*.log | grep SQLSTATE > $TMP_FILE_NAME
---
> /usr/bin/grep SQLCODE /apdata/aplog/*.log | grep SQLSTATE > $TMP_FILE_NAME
27,28c27
<       #echo "TO: you-kb@bml.co.jp,k-yokota@bml.co.jp" >> ${DIR_LOCAL}/${SEND_FILE_NAME}
<       echo "TO: multi_error@bml.co.jp" >> ${DIR_LOCAL}/${SEND_FILE_NAME}
---
>       echo "TO: you-kb@bml.co.jp,k-yokota@bml.co.jp" >> ${DIR_LOCAL}/${SEND_FILE_NAME}
kea00sys@kea00apa:~/shell/cron>

以上

--------------------------------------------------------------------
166：上原 洋樹; 総研検査システム２課
2021年12月03日（金） 17:20

お疲れ様です。上原です。

ケミストリーとNonRIAのサーバールームのエアコンが１台壊れました
現在は、冷風機を２台使用して対応しています（15度くらいになっています）

12/6(月) 9時から住産サービスが来て交換を実施します。
ケミのサーバーの後ろに脚立を置く必要があります。
新井さんに対応して貰いますが、上原は休みの為いる方でフォローをお願いします。

宜しくお願い致します

--------------------------------------------------------------------
168：清水 竜也; 総研検査システム１課
2021年12月03日（金） 18:22

①問合者=藤本課長　時刻＝9時過ぎ。対応時間(分)=60, 対応者：島村、清水

ケミストリーのPCや、緊急SUNなどが接続エラーで
端末が使えなくなってしまったのでみて欲しいと連絡あり。

ケミストリーの事務室のテーブルの島にHUB：24ポートが２台あり
かるく10年以上は使用されている古い機材であり、２台とも新品に交換した。
（Loop検知機能付きで、Loopは無し）

１台のほうのポート状態のLEDが尋常じゃないほど早く点滅。
１本ずつ抜いて確認すると、黄色のLAN線(１番ポート)を抜くと、
点滅が穏やかになっることがわかったが、何がつながっているか
その時点では特定できず、また状況的には、それぞれの端末が回復したので
様子見とした(10時ころ)。

②問合者=藤本課長  時刻＝16時過ぎ。対応時間(分)=60, 対応者：島村、清水、横田課長

午前中と同様の接続エラーが再発し始めたと連絡あり。

１番ポートの黄色のLAN線の接続先を調べると
10連ラベラー(旧分画)まで延ばしたLAN線とわかる。

10連ラベラーで、さらに分岐用の８ポートHUBあり。
Centrecom のものでこれもかなり古いので、新品に交換。
（Loop検知機能付きで、Loopは無し）

交換後のHUBのポート状態のLED点滅がやはり早い。
１本が別室にさらに伸びており、横田課長と１本ずつ調べると
監視カメラに使用している線だとわかる。
別室の担当者が同LAN線を抜くことで点滅穏やかになり、決着。

--------------------------------------------------------------------
169：横田 克夫; 総研検査システム２課
2021年12月03日（金） 19:36

@:清水 竜也; 総研検査システム１課

>>168
本件、下記の対策を分注の佐藤主任にお願いしました。
(1)監視カメラ用PCの交換する。
　→セコムに連絡してもらう。
(2)専用LANをL3スイッチから配線する。
　→総務に連絡してもらう。

--------------------------------------------------------------------
170：小林 洋一; 総研検査システム２課
2021年12月06日（月） 13:40

問合者=エラー通知,対応時間(分)=30
kea00sys@kea00apa:/apdata/aplog> cat chk_log_mail20211206-124501
CODE: SJIS
TO: multi_error@bml.co.jp
SUBJECT: [2021年 12月  6日 月曜日 12:45:02 JST] ケミストリーログチェック
BODY:
< /apdata/aplog/LD103_20211206.log:2021/12/06 12:42:58 E kea00apa 47080 kea00sys LD103 LD103_db.sqc sFncRuiChkZok 411 S 00000000 SQLCODE:-1476 SQLSTATE:40506 WHERE[UTKYMD='2021-11-10'][IRINO='00255546200']

DB2のエラーが発生しています。
ログを確認しファイルを再処理してください。

kea00sys@kea00apa:/apdata/aplog>view /apdata/aplog/LD103_20211206.log
2021/12/06      12:42:58        T       kea00apa        47080   kea00sys        LD103   LD103.c         384             00000000        属性修正情報ファイルの処理を開始します。[/apdata/today/online/host/Recv/shusei/SHU.data.211206124252]
2021/12/06      12:42:58        T       kea00apa        47080   kea00sys        LD103   LD103.c         494             00000000        ファイル読込。[utkymd:2021-11-06 irino:00082410000]
2021/12/06      12:42:58        T       kea00apa        47080   kea00sys        LD103   LD103.c         494             00000000        ファイル読込。[utkymd:2021-11-10 irino:00255546200]
2021/12/06      12:42:58        E       kea00apa        47080   kea00sys        LD103   LD103_db.sqc    sFncRuiChkZok   411     S       00000000        SQLCODE:-1476 SQLSTATE:40506 WHERE[UTKYMD='2021-11-10'][IRINO='00255546200']
2021/12/06      12:42:58        E       kea00apa        47080   kea00sys        LD103   LD103.c mainProc        506             00000000        sFncRuiChkZok

下記のコマンドを実行して取り込まれたことをLD103のログを確認。
cd /apdata/today/online/host/Recv/shusei/OK
mv SHU.data.211206124252 ./../

cd /apdata/aplog
tail -f LD103_20211206.log

27件の属性が更新され、再計算済みになったことを確認しました。

2021/12/06      13:24:17        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-03, irino:00003100000, hkkhrKbn:3]
2021/12/06      13:24:17        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-03, irino:00003100200, hkkhrKbn:3]
2021/12/06      13:24:39        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00197133900, hkkhrKbn:3]
2021/12/06      13:24:39        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-03, irino:00002758700, hkkhrKbn:3]
2021/12/06      13:24:39        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-03, irino:00002763900, hkkhrKbn:3]
2021/12/06      13:24:40        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-03, irino:00740083000, hkkhrKbn:3]
2021/12/06      13:24:40        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00002831300, hkkhrKbn:3]
2021/12/06      13:24:40        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00002847100, hkkhrKbn:3]
2021/12/06      13:24:40        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00002896000, hkkhrKbn:3]
2021/12/06      13:24:40        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00007495900, hkkhrKbn:3]
2021/12/06      13:24:40        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00034105800, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00006097700, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00087091100, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00087091200, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00087091300, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00087091400, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00087091500, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00087091600, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00087091700, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00087091800, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00087091900, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00087092000, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00087092100, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-03, irino:00003100100, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-03, irino:00003100300, hkkhrKbn:3]
2021/12/06      13:24:41        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-03, irino:00006467500, hkkhrKbn:3]
2021/12/06      13:24:42        T       kea00apa        47080   kea00sys        LD103   LD103.c         588             00000000        報告保留フラグを更新します。[utkymd:2021-12-04, irino:00098439100, hkkhrKbn:3]
27 個が検索されました。

select * from HKHRIRAI where utkymd='2021-12-03' and irino='00003100000' union all
select * from HKHRIRAI where utkymd='2021-12-03' and irino='00003100200' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00197133900' union all
select * from HKHRIRAI where utkymd='2021-12-03' and irino='00002758700' union all
select * from HKHRIRAI where utkymd='2021-12-03' and irino='00002763900' union all
select * from HKHRIRAI where utkymd='2021-12-03' and irino='00740083000' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00002831300' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00002847100' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00002896000' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00007495900' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00034105800' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00006097700' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00087091100' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00087091200' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00087091300' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00087091400' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00087091500' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00087091600' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00087091700' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00087091800' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00087091900' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00087092000' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00087092100' union all
select * from HKHRIRAI where utkymd='2021-12-03' and irino='00003100100' union all
select * from HKHRIRAI where utkymd='2021-12-03' and irino='00003100300' union all
select * from HKHRIRAI where utkymd='2021-12-03' and irino='00006467500' union all
select * from HKHRIRAI where utkymd='2021-12-04' and irino='00098439100' for read only with ur

UTKYMD	IRINO	KNSGRP	KMKCD	HKKHRKBN	HKKHRCMT	KSNDH	TRKDH
2021-12-03	00006467500	0054    	0000538	0	                                                                	2021-12-06 13:25:47.988112	2021-12-04 04:16:04.639838
2021-12-03	00003100300	0054    	0000538	0	                                                                	2021-12-06 13:25:48.031149	2021-12-04 04:16:04.658973
2021-12-03	00003100100	0054    	0000538	0	                                                                	2021-12-06 13:25:48.605099	2021-12-06 13:24:41.462266
2021-12-04	00087092100	0054    	0013185	0	                                                                	2021-12-06 13:25:48.465093	2021-12-05 03:55:19.712132
2021-12-04	00087092000	0054    	0013185	0	                                                                	2021-12-06 13:25:48.418216	2021-12-05 03:55:19.712056
2021-12-04	00087091900	0054    	0013185	0	                                                                	2021-12-06 13:25:48.320569	2021-12-05 03:55:19.711972
2021-12-04	00087091800	0054    	0013185	0	                                                                	2021-12-06 13:25:48.292742	2021-12-05 03:55:19.711895
2021-12-04	00087091700	0054    	0013185	0	                                                                	2021-12-06 13:25:48.270447	2021-12-05 03:55:19.711815
2021-12-04	00087091600	0054    	0013185	0	                                                                	2021-12-06 13:25:48.264243	2021-12-05 03:55:19.711731
2021-12-04	00087091500	0054    	0013185	0	                                                                	2021-12-06 13:25:48.251952	2021-12-05 03:55:19.711646
2021-12-04	00087091400	0054    	0013185	0	                                                                	2021-12-06 13:25:48.242576	2021-12-05 03:55:19.711568
2021-12-04	00087091300	0054    	0013185	0	                                                                	2021-12-06 13:25:48.230755	2021-12-05 03:55:19.711483
2021-12-04	00087091200	0054    	0013185	0	                                                                	2021-12-06 13:25:48.216723	2021-12-05 03:55:19.711372
2021-12-04	00087091100	0054    	0013185	0	                                                                	2021-12-06 13:25:48.207059	2021-12-05 03:55:19.711270
2021-12-04	00006097700	0054    	0000538	0	                                                                	2021-12-06 13:25:48.157975	2021-12-05 03:55:19.707793
2021-12-04	00034105800	0054    	0000538	0	                                                                	2021-12-06 13:25:48.516157	2021-12-05 03:55:19.721566
2021-12-04	00007495900	0054    	0000538	0	                                                                	2021-12-06 13:25:48.143285	2021-12-05 03:55:19.706854
2021-12-04	00002896000	0054    	0000538	0	                                                                	2021-12-06 13:25:48.052831	2021-12-05 03:55:19.633184
2021-12-04	00002847100	0054    	0000538	0	                                                                	2021-12-06 13:25:48.130554	2021-12-05 03:55:19.675208
2021-12-04	00002831300	0006    	0000737	0	                                                                	2021-12-06 13:25:48.079671	2021-12-05 03:55:19.675064
2021-12-03	00740083000	0054    	0000538	0	                                                                	2021-12-06 13:25:48.036439	2021-12-04 04:16:04.671063
2021-12-03	00002763900	0054    	0002696	0	                                                                	2021-12-06 13:25:48.023706	2021-12-04 04:16:04.656697
2021-12-03	00002758700	0054    	0002696	0	                                                                	2021-12-06 13:25:48.012741	2021-12-04 04:16:04.643283
2021-12-04	00197133900	0003    	0013094	0	                                                                	2021-12-06 13:25:48.598476	2021-12-05 03:55:19.729416
2021-12-03	00003100200	0054    	0000538	0	                                                                	2021-12-06 13:25:48.028370	2021-12-04 04:16:04.658861
2021-12-03	00003100000	0054    	0000538	0	                                                                	2021-12-06 13:25:48.601706	2021-12-06 13:24:17.804231
2021-12-04	00098439100	0054    	0000538	0	                                                                	2021-12-06 13:25:48.482285	2021-12-05 03:55:19.715465






--------------------------------------------------------------------
171：羽生 達哉; 総研検査システム２課
2021年12月06日（月） 13:48

ケミストリー属性修正のエラーメールを受信
リトライ処理を実行。

-----------------------------------------------------------------------------------------------------
SUBJECT: [2021年 12月  6日 月曜日 12:45:02 JST] ケミストリーログチェック
BODY:
< /apdata/aplog/LD103_20211206.log:2021/12/06 12:42:58 E kea00apa 47080 kea00sys LD103 LD103_db.sqc sFncRuiChkZok 411 S
00000000 SQLCODE:-1476 SQLSTATE:40506 WHERE[UTKYMD='2021-11-10'][IRINO='00255546200']

DB2のエラーが発生しています。
ログを確認しファイルを再処理してください。
---------------------------------------------------------------------------------------------------------

手順

1.属性修正ファイルから対象のNo.を含むファイルを検索
% cd /apdata/today/online/host/Recv/shusei/OK
% grep -l 255005462 *              <- 依頼書No.をサテライトの内部表現からHULFTインターフェイスの 表現に編集して検索する
SHU.data.211206124252
2.対象ファイルを１つ上のディレクトリへ移動
% mv SHU.data.211206124252 ../
3.取り込み処理が行われるまで少し待つ。移動したファイルが無くなればＯＫ。
4.LD103のログを確認する。
% cd /apdata/aplog
% view LD103_20211206.log    ← 処理した日付（休み明けは３日分あるので注意）
取り込み時のメッセージにSQLCODEが新たに出力されていなければＯＫ


--------------------------------------------------------------------
172：横田 克夫; 総研検査システム２課
2021年12月06日（月） 20:42

情報共有までに。
エビデンスは以下のフォルダに保管しました。
\\10.1.103.226\NAS_Backup\総研システム部\総研システム３課\01_ケミストリ\70_調査\20211206_属性修正
～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～～
Re: 推算ＧＦＲについて
差出人	 ： 	"海老島 和雄" <kazuo_ebishima@bml.co.jp> 
送信日時	 ： 	2021年12月06日（月） 16:58
To  	 ： 	"横田 克夫" <k-yokota@bml.co.jp>
Cc （7件）    	 ： 	"城田 正則" <Masanori_Shirota@bml.co.jp> ...  （→宛先をすべて表示する）
横田課長

お疲れ様です。

以前ご連絡させていただきましたテスト検体の結果についてです。

0031000　テスト1：パターン①　属性に問題なく正常に報告⇒日曜日（夕方）にホスト属性修正
0031001　テスト2：パターン②　属性に問題なく正常に報告⇒月曜日（昼）にホスト属性修正
0031002　テスト3：パターン③　属性不足で未入力⇒日曜日（夕方）にホスト属性修正
0031003　テスト4：パターン④　属性不足で未入力⇒月曜日（昼）にホスト属性修正

以下の確認を本日いたしました。

【確認事項】

・上記のテスト４パターン全て問題なく自動で計算が走り、値が変わること。

・対象検体(テスト1とテスト２）
ホスト属性修正後に属性エラーチェック画面にて『再計算待ち』と表示されていること。
14時過ぎに属性エラーチェック画面にて『再計算済み』に表示が変わっていること。
ケミストリーシステム内で依頼復活、フラグリセット、再計算が実行されている事を確認して報告。
報告後にホスト画面に修正後の数値が反映されていること。

・対象検体(テスト3とテスト4)
ホスト属性修正前(属性不足：年齢)は、属性エラーチェック画面にて『未入力』が表示されていること。
ホスト属性修正後(年齢を入力)に属性エラーチェック画面にて『再計算待ち』と表示されていること。
14時過ぎに属性エラーチェック画面にて『再計算済み』に表示が変わっていること。
報告後にホスト画面に数値が反映がされること。

結果は、テスト４パターン全て問題なく正しい動きをしていました。
属性修正前、属性修正後などの画面ハードコピー等を行っておりますので、
もし必要であればお手すきの際にケミストリーまでお越しいただければと思います。

ご不明な点がございましたらご連絡いただければと思います。
よろしくお願いいたします。

ケミストリー
海老島


メール.txt

--------------------------------------------------------------------
173：羽生 達哉; 総研検査システム２課
2021年12月07日（火） 18:46

問い合わせ者　ケミストリー高梨さん　対応時間　６０分

■未報告リストを出力しようとしたところ「システムに連絡してください」のエラーが表示される

検査フラグのチェックがかかっていない時間帯だったので手動でcornの処理を実行

実行した結果、以下のメールを受信
------------------------------------------------------------
20211206,"00028039600","0000411"

上記、測定結果のフラグがおかしい検体があります。
（ 検査フラグ M、結果状況コード 3 ）
------------------------------------------------------------

→上記の項目について報告結果を確認したところ、ケミストリーでは0.3となるのにホストは0.1で入力されていた。
→結果が２件あり、表示結果は0.3だが検査結果１が0.1のままの状態だった。

select * from kekka where utkymd='2021-12-06' and irino ='00028039600' and kmkcd='0000411' and knsflg='M'

00028039600 0000411      1 3       E               0.1                                              0.3
00028039600 0000411      4 3       M               0.1                                              0.3

検査フラグ'M'のレコードの検査結果状況コードを１に更新
update kekka set kkajkcd='1' where utkymd='2021-10-22' and irino ='00136469900' and kmkcd='0012976' and knsflg='M'

項目コード411は計算項目だったので、計算元項目も合わせてフラグリセット→再計算→ホスト報告の操作をしてもらった。
ホスト結果が0.3に修正されたことを確認した。


--------------------------------------------------------------------
174：横田 克夫; 総研検査システム２課
2021年12月07日（火） 21:12

エラーメール
	[2021年 12月 7日 火曜日 20:40:01 JST]マルチ ＡＰサーバ ディスク容量 危険
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2021年12月07日（火） 20:41
To （2件）  	 ： 	multi_log@bml.co.jp, multi_error@bml.co.jp （←宛先を隠す）

下記、ディスク容量がしきい値を越えています。確認してください。

/apdata：96 (しきい値：80%)

→容量の大きいフォルダを移動しました。
kea00sys@kea00apa:/apdata/work> mv 20200526 /apdata/today/file/KEA00/KEA00IAW24/bak_daily/work/

--------------------------------------------------------------------
175：羽生 達哉; 総研検査システム２課
2021年12月08日（水） 17:47

問い合わせ者　シングル青木さん　対応時間　４５分
再検ＮＧになった検体が確定にならず、未検査のままになっている。

2021/12/07 542-1873 ヒアルロン酸
初回 4.7 低値再検
再検 13.7 照合ＮＧ
再々々検 13.5 (検査回数４)

「再々々検を選択して確定した」と言っている。

再度検索するとデータが４つ表示された。
初回 4.7 低値再検
再検 13.7 照合ＮＧ
再々々検 13.5 (検査回数４)
手入力 13.5 (検査回数０)
ＮＧ確定画面より手入力結果にチェックをつけ、状態を確定にして更新した。
→問題なく更新された。
未検査からも消えたことを確認してもらった。

ＤＢ２のログを確認したが、取り立てておかしなメッセージはないように見える。

--------------------------------------------------------------------
176：横田 克夫; 総研検査システム２課
2021年12月08日（水） 17:51

問合者=海老島氏　対応時間(分)=30

受付日2021-12-07,依頼書NO:0140536の推算GFRの依頼が消えた。

→小林殿　一次調査結果
irai,kekkaを確認しましたが推算GFR(0000538)の依頼、結果は残っていました。
検査グループ単位結果入力画面に表示されないかは不明です。
折り返し3202へ電話をお願いします。

→海老島氏に状況を確認。画面の動作が遅く、おかしな状況になったとのこと。
　データを確認。検査回数２のレコードがあるためかと思い、一次的に検体№を別№に変更したが状況変わらず。
→検査結果は”99”である事を確認できるので、イントラからの手入力をお願いした。

20211208_ケミ問合せ.xlsx

--------------------------------------------------------------------
177：清水 竜也; 総研検査システム１課
2021年12月20日（月） 11:49

①問合者=藤本課長　12/16(木) 対応時間(分)=45分

尿酸(UA) の再検レンジと希釈設定の抽出依頼。

フィブリンなどの影響で分析機で検体が正しくサンプリングされず
測定結果が正しくでなかった(低値が高値、もしくは高値が低値に化けた)ようで
マスター設定が知りたいのこと。

項目コード：407(一般）、2478（透析前）、2778（透析後）

レンジマスタは、上下限でレコードが分かれているが
区分(SSA)は上限が1、下限が２なのでSELECT時、descにてsortする。
施設コード(sstcd)は、特定施設コードは除き、全施設向けの"0000000"のみに限定。

希釈マスターは、BM／Labospect の機種別に１コードについて、多段階設定できる。 
なお希釈下限順に並べたいが、ケミストリーは数値関連のカラムを殆どcharでもっており
SELECT時のsortでは 意図通り並ばないため、Excel上で数値と見なしてsort。

②問合者=藤本課長　12/17(金) 対応時間(分)=45分

マスター設定を確認したところ、2478（透析前）で、
再検レンジの高値が15.0～ で設定されているが、希釈設定が 13.1～ となっている。
この〓み合っていない状態が気になるとのことことで、業務データを12/7受けを抽出。

低値側は、検査回数２回目、自動再検が結構あるものの
高値側はマスター間の乖離の影響か、13.1～15.0の間の初回値に対して
検査回数２回目はなく、いきなり３回目以降となっている。

藤本課長より透析前のマスターについて、見直したいとさらに連絡があった。
　


407UA_renji_kisyaku_mst.sql
407_尿酸_レンジ.xlsx
1207_UA_zen_only.sql
1207_UA_zen_only.xlsx

--------------------------------------------------------------------
178：羽生 達哉; 総研検査システム２課
2021年12月20日（月） 14:07

ケミストリー属性修正のエラーメールを受信
リトライ処理を実行。
----------------------------------------------------------------------------------
< /apdata/aplog/LD103_20211220.log:2021/12/20 12:41:17 E kea00apa 43676 kea00sys LD103 LD103_db.sqc sFncRuiChkZok 411 S 00000000 SQLCODE:-1476 SQLSTATE:40506 WHERE[UTKYMD='2021-10-30'][IRINO='00406136000']

DB2のエラーが発生しています。
ログを確認しファイルを再処理してください。
-----------------------------------------------------------------------------------
No171と同じ手順を実行。


--------------------------------------------------------------------
179：小林 洋一; 総研検査システム２課
2021年12月20日（月） 16:12

ケミストリで前読み装置のテストを行いました。
手順を添付します。

ケミストリ前読み装置テスト20211220.txt

--------------------------------------------------------------------
180：羽生 達哉; 総研検査システム２課
2021年12月21日（火） 05:46

ZSの６号機でコントロール結果が取り込まれない。

確認内容
①プロセスの起動を確認
kea00sys@kea00apa:/apdata/aplog> ps -ef | grep MD
UID        PID  PPID  C STIME TTY          TIME CMD
kea00sys  4831 23174  0 05:31 pts/0    00:00:00 grep --color=auto MD
kea00sys 30563     1  0 12月20 ?       00:00:04 MD101 /home/kea00sys/bin/MD101_L1.ini
kea00sys 30565     1  0 12月20 ?       00:00:01 MD101 /home/kea00sys/bin/MD101_L2.ini
kea00sys 30567     1  0 12月20 ?       00:00:39 MD102 /home/kea00sys/bin/MD102_L1.ini 1
kea00sys 30569     1  0 12月20 ?       00:00:37 MD102 /home/kea00sys/bin/MD102_L2.ini 1
kea00sys 30577     1  0 12月20 ?       00:00:01 /home/kea00sys/bin/MD103 /home/kea00sys/bin/MD103.ini
kea00sys 30583     1  0 12月20 ?       00:00:01 /home/kea00sys/bin/MD104 /home/kea00sys/bin/MD104.ini
kea00sys 30587     1  0 12月20 ?       00:00:01 /home/kea00sys/bin/MD105 /home/kea00sys/bin/MD105.ini
kea00sys@kea00apa:/apdata/aplog>

②未処理の結果ファイル確認
kea00sys@kea00apa:/apdata/aplog> cd /apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl> ls
end  err  new
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl> cd new
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl/new> ls
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl/new> cd ../
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl> cd err
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl/err> ls
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl/err> cd ../
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl> cd end
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl/end> ls
1_KEK55006___01_063.end     1_KEK76430___01_121.end     1_KEK80413___03_121.end     1_KEK88669___02_124.end
1_KEK55006___02_121.end     1_KEK76430___02_121.end     1_KEK80413___04_121.end     1_KEK88669___03_121.end
1_KEK55006___03_121.end     1_KEK76430___03_121.end     1_KEK80413___05_053.end     1_KEK88669___04_063.end
1_KEK55006___04_058.end     1_KEK76430___04_121.end     1_KEK80413___05_054.end     1_KEK88669___05_121.end
～～～　略　～～～～～
1_KEK76355___03_121.end     1_KEK80389___05_063.end     1_KEK88663___04_121.end     2_QCKQC041_0001_138_35.end
1_KEK76355___04_120.end     1_KEK80413___01_063.end     1_KEK88663___05_121.end
1_KEK76355___05_120.end     1_KEK80413___02_121.end     1_KEK88669___01_124.end
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl/end>

未処理分は特になし。
③オンラインプロセスのログ確認
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl/end> cd /apdata
kea00sys@kea00apa:/apdata> cd aplog
kea00sys@kea00apa:/apdata/aplog> ls MD*
MD101_1_20211220.log  MD101_2_20211221.log  MD102_2_20211220.log  MD103_20211221.log  MD105.log
MD101_1_20211221.log  MD102_1_20211220.log  MD102_2_20211221.log  MD104_20211220.log  MD105_BMLRNS20211220.log
MD101_2_20211220.log  MD102_1_20211221.log  MD103_20211220.log    MD104_20211221.log
kea00sys@kea00apa:/apdata/aplog> cat MD101_2_20211220.log
2021/12/20      19:30:31        T       kea00apa        30565   kea00sys        MD101   MD101.c         181
00000000        プログラム起動
2021/12/20      19:30:31        T       kea00apa        30565   kea00sys        MD101   MD101.c         355
00000000        処理日 [2021/12/20]
2021/12/20      19:30:31        T       kea00apa        30565   kea00sys        MD101   MD101.c         715
00000000        メモリ退避ファイルが見つかりません。File[/apdata/today/file/KEA00/kea00ap/ZS050/2_MD101.sav]
2021/12/20      19:30:31        T       kea00apa        30565   kea00sys        MD101   MD101.c         863
00000000        SOCKET接続しました。Server[10.1.3.171] ME[4]
2021/12/20      19:30:31        T       kea00apa        30565   kea00sys        MD101   MD101.c         863
00000000        SOCKET接続しました。Server[10.1.3.171] ME[5]
2021/12/20      19:30:31        T       kea00apa        30565   kea00sys        MD101   MD101.c         863
00000000        SOCKET接続しました。Server[10.1.3.171] ME[6]
kea00sys@kea00apa:/apdata/aplog> cat MD101_2_20211221.log
2021/12/21      02:03:55        T       kea00apa        30565   kea00sys        MD101   MD101.c         1751
00000000        コントロール結果受信: KenID[QC006_0001^N] CH[108] ME[5] No[1]
2021/12/21      02:03:55        T       kea00apa        30565   kea00sys        MD101   MD101.c         1751
00000000        コントロール結果受信: KenID[QC006_0001^N] CH[109] ME[5] No[2]
2021/12/21      02:03:55        T       kea00apa        30565   kea00sys        MD101   MD101.c         1751
00000000        コントロール結果受信: KenID[QC006_0001^N] CH[143] ME[5] No[3]
2021/12/21      02:04:01        T       kea00apa        30565   kea00sys        MD101   MD101.c         1751
00000000        コントロール結果受信: KenID[QC038_0001^N] CH[108] ME[5] No[4]
2021/12/21      02:04:01        T       kea00apa        30565   kea00sys        MD101   MD101.c         1751
00000000        コントロール結果受信: KenID[QC002_0001^N] CH[072] ME[4] No[1]
2021/12/21      02:04:57        T       kea00apa        30565   kea00sys        MD101   MD101.c         1751
00000000        コントロール結果受信: KenID[QC002_0001^N] CH[073] ME[4] No[2]
2021/12/21      02:04:57        T       kea00apa        30565   kea00sys        MD101   MD101.c         1751
00000000        コントロール結果受信: KenID[QC002_0001^N] CH[091] ME[4] No[3]
2021/12/21      02:04:57        T       kea00apa        30565   kea00sys        MD101   MD101.c         1751
00000000        コントロール結果受信: KenID[QC002_0001^N] CH[128] ME[4] No[4]
～～～　略　～～～～～
2021/12/21      02:29:27        T       kea00apa        30565   kea00sys        MD101   MD101.c         1751
00000000        コントロール結果受信: KenID[QC037_0005^N] CH[091] ME[4] No[46]
2021/12/21      02:29:27        T       kea00apa        30565   kea00sys        MD101   MD101.c         1751
00000000        コントロール結果受信: KenID[QC037_0005^N] CH[128] ME[4] No[47]
kea00sys@kea00apa:/apdata/aplog>
６号機に対する接続メッセージは出ているが、コントロール受信のメッセージは出ていない。

特に異常は見られなかった。

↓↓↓でテストをしているのと、６号機のログには前日から接続エラーが出ているので、
日本電子に設定変更していないか確認を依頼してもらった。


--------------------------------------------------------------------
181：羽生 達哉; 総研検査システム２課
2021年12月21日（火） 09:00

>>180
追記

６号機のＣＳ接続用ＬＡＮケーブルが抜けていた。
ＬＡＮケーブルを接続後、コントロールを測定してもらい、
データ受信を確認した。

--------------------------------------------------------------------
182：島村 健汰; 総研検査システム１課
2021年12月23日（木） 16:04

各位

年末のZサーバ停止に伴う、作業手順書を作成しました。
IAサーバ側はシャットダウンは行わず、常駐系のプロセスの停止のみ行う手順です。

内容に不備などがありましたら、ご連絡ください。

年末対応版_ケミストリーサテライト システム停止手順書.xlsx

--------------------------------------------------------------------
184：島村 健汰; 総研検査システム１課
2021年12月27日（月） 15:30

各位

12/31（金）のZサーバ停止対応の作業工程を記載します。

①Hinemosの停止（※ケミストリー関連のみ）
②Zサーバの停止
③IAサーバの停止
④UPS本体交換（1台）
⑤UPSバッテリー交換（2台）
⑥サーバラック内の8ポートHUBの交換（1台）
⑦ラック内配線整理
⑧IAサーバの再起動（※起動のみ）

UPS関連の作業の際にIAサーバも停止して行う事しました。
なので、停電対応の時と同様の手順で作業を行います。

\\10.1.103.226\NAS_Backup\総研システム部\共用\★停電対応\システム起動停止マニュアル\A00_ケミストリー

⇒ケミストリーサテライト システム停止手順書.xlsx

--------------------------------------------------------------------
186：島村 健汰; 総研検査システム１課
2021年12月27日（月） 15:46

9月の停電対応の時にHinemosの対象から外していた監視項目を教えてください。
ログインして確認してみましたが、mon_ping_scope_CHEMISTRY等ですかね...

\\10.1.103.226\NAS_Backup\総研システム部\共用\★停電対応\システム起動停止マニュアル\A00_ケミストリー

⇒ケミストリーサテライト_Hinemos停止対応.xlsx

--------------------------------------------------------------------
187：横田 克夫; 総研検査システム２課
2021年12月28日（火） 22:44

@:島村 健汰; 総研検査システム１課

>>186
９月の時は、全て一括して停止しました。
\\10.1.103.226\NAS_Backup\総研システム部\総研システム２課\30_システム仕様管理\ZZZ_基幹システム系資料\引継資料\検査サーバ資料\8.システム管理\ｻｰﾊﾞｰ停止・起動\Hinemosの起動と停止

先に停止するとなると、ケミストリーだけを選んで止めるしかないと思います。
または、エラーメールを我慢するか。。。

--------------------------------------------------------------------
188：上原 洋樹; 総研検査システム２課
2021年12月29日（水） 15:17

小林さん

ケミストリー起動手順、9月の対応内容を反映させた手順書は以下になります。
\\10.1.103.226\NAS_Backup\総研システム部\共用\★停電対応\システム起動停止マニュアル\A00_ケミストリー\新棟システム起動手順_2021版.txt

--------------------------------------------------------------------
191：島村 健汰; 総研検査システム１課
2021年12月31日（金） 14:14

各位

Zサーバ停止対応を完了しました。（対応時間(分)=120分）

シャットダウンした以下のIAサーバについては再起動を行い
導通確認を行っています。

・KEA00IAW08
・KEA00IAW20
・KEA00IAW21
・KEA00IAW22
・KEA00IAW23
・KEA00IAW24

UPSのバッテリ交換については、問題無く完了しましたが
本体交換については、電源ケーブルを外す事が困難だった為
サーバラックに未使用の状態で設置されていたUPSに接続を移しました。

なお、交換の対象だったUPS本体はバッテリーを外し、電源を停止した状態にしてあります。

--------------------------------------------------------------------
192：清水 竜也; 総研検査システム１課
2021年12月31日（金） 14:31

@:島村 健汰; 総研検査システム１課

>>191
UPSのバッテリー交換の画像添付します。

20211231_UPS作業.xlsx

--------------------------------------------------------------------
193：横田 克夫; 総研検査システム２課
2022年01月01日（土） 22:41

@:島村 健汰; 総研検査システム１課

>>182
島村殿

手順書作成ありがとう。
起動時に下記のエラーメールが発報されました。
～～～～～～
ZD777 ファイル移動シェル
ZD888 オンライン起動プロセス
ZD999

IA21 号機にて、上記プロセスが起動していません。確認してください。
～～～～～～

IAサーバのプロセス監視クーロンを停止する手順が無いように思いますので、追加して、ファイルサーバに保管をお願いします。
（次回の停電までに対応をお願いしたいです）

--------------------------------------------------------------------
194：羽生 達哉; 総研検査システム２課
2022年01月11日（火） 14:48

ケミストリー属性修正のエラーメールを受信
リトライ処理を実行。
----------------------------------------------------------------------------------
< /apdata/aplog/LD103_20220111.log:2022/01/11 12:45:41 E kea00apa 2421 kea00sys LD103 LD103_db.sqc sFncRuiChkZok 411 S 00000000 SQLCODE:-1476 SQLSTATE:40506 WHERE[UTKYMD='2021-11-08'][IRINO='00058303800']

DB2のエラーが発生しています。
ログを確認しファイルを再処理してください。
-----------------------------------------------------------------------------------
No171と同じ手順を実行。

--------------------------------------------------------------------
195：清水 竜也; 総研検査システム１課
2022年01月12日（水） 14:14

お疲れ様です。

どなたかアイデアいただけますか（助けてください）。

1/7受(現象は1/8 AM3時頃)の ZSの５号機で通信エラーが出、調べたところ
依頼返答レコードをZS側が受け取った際、
チェックサムが正しくない、ということで NAK 返答していました。

ZSは稼働が2020年の春からで、おおよそ１年半程経っていますが
ケミストリーで自分がこの現象を見聞きしたのは、今回初めてです。

1年半で初めてだとすると、今更、チェックサムのロジックが
おかしいということも、無いような気がするのですが...

また、システム内に送信電文のログなど残るようになっていない、
と認識していますが、これ以上調べる箇所、手立て等あれば、教えてください。


数年前、こんなことがありました。
尿一般のBMオンラインで、BMのコンソールPCの真上に空調の吹き出しがあり
暖房が入る時期になると、電文中の１バイトが稀に欠落する現象ありました。
コンソールPCが温まったことで起きたのかなと、うそのような本当の話です。
その時は、天井の吹き出し口を一部塞ぎました。

清水

ZS_#05_20211107_log.pdf
03_06_27.pdf

--------------------------------------------------------------------
196：横田 克夫; 総研検査システム２課
2022年01月12日（水） 15:19

@:清水 竜也; 総研検査システム１課

>>195
難解な調査対応ありがとうございます。
ZSの仕様書に、NAK応答を受信したときの動作について規定されていないでしょうか。
そもそも通信上のエラーは発生し得るので、リトライ処理があるべきかと考えます。
一旦、メーカーに調査を依頼しませんか。

ちなみに、タイミングを見てログを残すように変更しませんか。
来年度が始まったくらいに、手が空いた人で対応を検討したいと思ってます。

--------------------------------------------------------------------
197：羽生 達哉; 総研検査システム２課
2022年01月13日（木） 13:16

@:清水 竜也; 総研検査システム１課

>>195
私の方でＣＲＣを計算したところ、ＮＧだったメッセージのＣＲＣが違っているみたいです。

gyoko91:/export/home/gyoko/work/hanyu/crc%*.exe
[<STX>1H|\^&|LIS||||||||O|P|1<CR>P|1<CR>O|1|7503402^N||^^^501^M\^^^502^M\^^^503^M\^^^746^M\^^^091^M|||||||A||^^
^^7||S|||000072^00228507300^|||||||O<CR>L|1|N<CR><ETX>]
CRC[70]
[<STX>1H|\^&|LIS||||||||O|P|1<CR>P|1<CR>O|1|7507403^N||^^^501^M\^^^502^M\^^^503^M\^^^746^M\^^^143^M|||||||A||^^
^^7||S|||000073^00228506300^|||||||O<CR>L|1|N<CR><ETX>]
CRC[73]
[<STX>1H|\^&|LIS||||||||O|P|1<CR>P|1<CR>O|1|7503404^N||^^^501^M\^^^502^M\^^^503^M\^^^746^M\^^^091^M|||||||A||^^
^^7||S|||000074^00228507500^|||||||O<CR>L|1|N<CR><ETX>]
CRC[76]
gyoko91:/export/home/gyoko/work/hanyu/crc%

CRC=73はBMが期待しているCRCです。
特定条件でCRCの計算がエラーになるのでは無いでしょうか。

--------------------------------------------------------------------
198：羽生 達哉; 総研検査システム２課
2022年01月13日（木） 15:28

>>194
この件ですが、休み明けの１発目に発生しているため
累積ＤＢの再起動が怪しい気がします。

試しに再起動後にZから累積ＤＢへＳＱＬを発行するように
cronに仕込んでみました。

しばらくこれで様子を見てください。

--------------------------------------------------------------------
199：清水 竜也; 総研検査システム１課
2022年01月13日（木） 17:25

@:羽生 達哉; 総研検査システム２課

>>197
羽生さん　
　CRC確認ありがとうございます！　流石です。

　ついでにもう一つ聞いて良いですか。

  <NAK>で拒否した時、相手側(ケミストリー）の再送を待つのが普通のような気がするのですが
　今回、ZS側が <ENQ>要求を出し、次のポジション「...04」の依頼問合せを送信してきています。その点、どう思います？

--------------------------------------------------------------------
200：羽生 達哉; 総研検査システム２課
2022年01月13日（木） 18:00

@:清水 竜也; 総研検査システム１課

>>199
NAK送信後すぐにエラーメッセージが表示されているので
リトライしない設定になっているのかもしれません。

もしくは単純にENQが衝突してZS側が優先されているだけかも。



--------------------------------------------------------------------
201：清水 竜也; 総研検査システム１課
2022年01月13日（木） 18:17

@:羽生 達哉; 総研検査システム２課

>>200
なるほど。どうもありがとうございます！

--------------------------------------------------------------------
202：横田 克夫; 総研検査システム２課
2022年01月13日（木） 20:46

リソースチェックでDisk容量閾値超えを検知。

■作業前
/apdata/today/file/KEA00/KEA00IAW02　80%

■10月分を移動
mv /apdata/today/file/KEA00/KEA00IAW02/bak_daily/2021-10* /apdata/today/file/KEA00/KEA00IAW21/bak_daily/

■作業後
/apdata/today/file/KEA00/KEA00IAW02　68%

--------------------------------------------------------------------
203：羽生 達哉; 総研検査システム２課
2022年01月14日（金） 14:44

12/30 AM05:50 エラーメールを受信
-------------------------------------------------------------
ND101 フロンティアラック登録

上記プロセスが起動していません。確認してください。
-------------------------------------------------------------

１．ログを確認。
/apdata/aplog/ND101_20211230.log
2021/12/30      05:40:48        T       kea00apa        9948    kea00sys        ND101   ND101.c mainFunction    266
        00000000        ファイル処理開始[/apdata/today/file/rack/A00_20211230054041.dat]
2021/12/30      05:40:48        T       kea00apa        9948    kea00sys        ND101   ND101.c sFncGetFileRecord
462             00000000        ＥＮＤ情報を受信しました。

上記メッセージを出力が最後

２．ND101を再起動
~/bin/proc.shよりND101を再起動
下記のメッセージを出して異常終了する。

-------------------------------------------------------------------------------------------------------------------------
kea00sys@kea00apk:~> /home/kea00sys/bin/ND101 /home/kea00sys/bin/ND101.ini
kea00sys@kea00apk:~> *** Error in `/home/kea00sys/bin/ND101': free(): invalid pointer: 0x000003ffa6523f68 ***
======= Backtrace: =========
/lib64/libc.so.6(+0x845a4)[0x3ffa37045a4]
/lib64/libc.so.6(+0x8a368)[0x3ffa370a368]
/lib64/libc.so.6(+0x8b338)[0x3ffa370b338]
/home/kea00sys/bin/ND101[0x10047ba]
/home/kea00sys/bin/ND101[0x1002fea]
/home/kea00sys/bin/ND101[0x100298e]
/home/kea00sys/bin/ND101[0x1003c5e]
/lib64/libc.so.6(__libc_start_main+0x112)[0x3ffa36a3052]
/home/kea00sys/bin/ND101[0x1001d7e]
======= Memory map: ========
01000000-01009000 r-xp 00000000 fe:02 12574                              /home/kea00sys/bin/ND101
01009000-0100a000 r--p 00008000 fe:02 12574                              /home/kea00sys/bin/ND101
0100a000-0100b000 rw-p 00009000 fe:02 12574                              /home/kea00sys/bin/ND101
0100b000-0100d000 rw-p 00000000 00:00 0
2d281000-2d2b3000 rw-p 00000000 00:00 0                                  [heap]
2d2b3000-2d2f7000 rw-p 00000000 00:00 0                                  [heap]
3ffa0680000-3ffa0697000 r-xp 00000000 fe:00 19045                        /usr/lib64/gconv/SJIS.so
3ffa0697000-3ffa0698000 r--p 00016000 fe:00 19045                        /usr/lib64/gconv/SJIS.so
3ffa0698000-3ffa0699000 rw-p 00017000 fe:00 19045                        /usr/lib64/gconv/SJIS.so
3ffa0700000-3ffa0906000 r-xp 00000000 fe:00 306597                       /usr/local/ibm/gsk8_64/lib64/C/icc/icclib/libic
clib084.so
3ffa0906000-3ffa0933000 rw-p 00206000 fe:00 306597                       /usr/local/ibm/gsk8_64/lib64/C/icc/icclib/libic
clib084.so
3ffa0933000-3ffa0940000 rw-p 00000000 00:00 0
3ffa0980000-3ffa09f2000 r-xp 00000000 fe:00 57697                        /usr/local/ibm/gsk8_64/lib64/libgsk8iccs_64.so
3ffa09f2000-3ffa0a02000 rw-p 00072000 fe:00 57697                        /usr/local/ibm/gsk8_64/lib64/libgsk8iccs_64.so
3ffa0a02000-3ffa0a05000 rw-p 00000000 00:00 0
3ffa0a80000-3ffa0e94000 r-xp 00000000 fe:00 57711                        /usr/local/ibm/gsk8_64/lib64/libgsk8ssl_64.so
3ffa0e94000-3ffa0eb2000 rw-p 00413000 fe:00 57711                        /usr/local/ibm/gsk8_64/lib64/libgsk8ssl_64.so
3ffa0eb2000-3ffa0eb5000 rw-p 00000000 00:00 0
3ffa0f00000-3ffa12f5000 r-xp 00000000 fe:00 57704                        /usr/local/ibm/gsk8_64/lib64/libgsk8cms_64.so
3ffa12f5000-3ffa1321000 rw-p 003f5000 fe:00 57704                        /usr/local/ibm/gsk8_64/lib64/libgsk8cms_64.so
3ffa1380000-3ffa1381000 r-xp 00000000 fe:00 57712                        /usr/local/ibm/gsk8_64/lib64/libgsk8sys_64.so
3ffa1381000-3ffa1382000 rw-p 00001000 fe:00 57712                        /usr/local/ibm/gsk8_64/lib64/libgsk8sys_64.so
3ffa1400000-3ffa1426000 r--p 00000000 fe:00 19075                        /usr/share/locale/ja/LC_MESSAGES/libc.mo
3ffa1480000-3ffa1483000 r-xp 00000000 fe:03 263124                       /opt/ibm/db2/V11.1/security64/plugin/IBM/client
/IBMOSauthclient.so
3ffa1483000-3ffa1484000 r--p 00002000 fe:03 263124                       /opt/ibm/db2/V11.1/security64/plugin/IBM/client
/IBMOSauthclient.so
3ffa1484000-3ffa1485000 rw-p 00003000 fe:03 263124                       /opt/ibm/db2/V11.1/security64/plugin/IBM/client
/IBMOSauthclient.so
3ffa1500000-3ffa1584000 r--p 00000000 fe:00 269212                       /usr/lib/locale/ja_JP.sjis/LC_CTYPE
3ffa1600000-3ffa1601000 r--p 00000000 fe:00 269219                       /usr/lib/locale/ja_JP.sjis/LC_NUMERIC
3ffa1680000-3ffa1682000 r--p 00000000 fe:00 269222                       /usr/lib/locale/ja_JP.sjis/LC_TIME
3ffa1700000-3ffa174a000 r--p 00000000 fe:00 269211                       /usr/lib/locale/ja_JP.sjis/LC_COLLATE
3ffa1780000-3ffa1781000 r--p 00000000 fe:00 269217                       /usr/lib/locale/ja_JP.sjis/LC_MONETARY
3ffa1800000-3ffa1801000 r--p 00000000 fe:00 269216                       /usr/lib/locale/ja_JP.sjis/LC_MESSAGES/SYS_LC_M
ESSAGES
3ffa1880000-3ffa1881000 r--p 00000000 fe:00 269220                       /usr/lib/locale/ja_JP.sjis/LC_PAPER
3ffa1900000-3ffa1901000 r--p 00000000 fe:00 269218                       /usr/lib/locale/ja_JP.sjis/LC_NAME
3ffa1980000-3ffa1981000 r--p 00000000 fe:00 269210                       /usr/lib/locale/ja_JP.sjis/LC_ADDRESS
3ffa1a00000-3ffa1a01000 r--p 00000000 fe:00 269221                       /usr/lib/locale/ja_JP.sjis/LC_TELEPHONE
3ffa1a80000-3ffa1a81000 r--p 00000000 fe:00 269214                       /usr/lib/locale/ja_JP.sjis/LC_MEASUREMENT
3ffa1b00000-3ffa1b07000 r--s 00000000 fe:00 19085                        /usr/lib64/gconv/gconv-modules.cache
3ffa1b80000-3ffa1b81000 r--p 00000000 fe:00 269213                       /usr/lib/locale/ja_JP.sjis/LC_IDENTIFICATION
3ffa1c00000-3ffa1c35000 r--s 00000000 00:15 17244                        /run/nscd/dbPwg08V (deleted)
3ffa1c80000-3ffa1c88000 r-xp 00000000 fe:00 143343                       /lib64/librt-2.22.so
3ffa1c88000-3ffa1c89000 r--p 00007000 fe:00 143343                       /lib64/librt-2.22.so
3ffa1c89000-3ffa1c8a000 rw-p 00008000 fe:00 143343                       /lib64/librt-2.22.so
3ffa1d00000-3ffa1d19000 r-xp 00000000 fe:00 9768                         /usr/lib64/libaudit.so.1.0.0
3ffa1d19000-3ffa1d1a000 r--p 00018000 fe:00 9768                         /usr/lib64/libaudit.so.1.0.0
3ffa1d1a000-3ffa1d1b000 rw-p 00019000 fe:00 9768                         /usr/lib64/libaudit.so.1.0.0
3ffa1d1b000-3ffa1d25000 rw-p 00000000 00:00 0
3ffa1d80000-3ffa1d90000 r-xp 00000000 fe:00 143677                       /lib64/libgcc_s.so.1
3ffa1d90000-3ffa1d91000 ---p 00010000 fe:00 143677                       /lib64/libgcc_s.so.1
3ffa1d91000-3ffa1d92000 r--p 00010000 fe:00 143677                       /lib64/libgcc_s.so.1
3ffa1d92000-3ffa1d93000 rw-p 00011000 fe:00 143677                       /lib64/libgcc_s.so.1
3ffa1e00000-3ffa1fbb000 r-xp 00000000 fe:00 10033                        /usr/lib64/libstdc++.so.6.0.25
3ffa1fbb000-3ffa1fbc000 ---p 001bb000 fe:00 10033                        /usr/lib64/libstdc++.so.6.0.25
3ffa1fbc000-3ffa1fc5000 r--p 001bb000 fe:00 10033                        /usr/lib64/libstdc++.so.6.0.25
3ffa1fc5000-3ffa1fc9000 rw-p 001c4000 fe:00 10033                        /usr/lib64/libstdc++.so.6.0.25
3ffa1fc9000-3ffa1fcc000 rw-p 00000000 00:00 0
3ffa2000000-3ffa2002000 r-xp 00000000 fe:03 262807                       /opt/ibm/db2/V11.1/lib64/libibmc++.so.1
3ffa2002000-3ffa2003000 r--p 00001000 fe:03 262807                       /opt/ibm/db2/V11.1/lib64/libibmc++.so.1
3ffa2003000-3ffa2004000 rw-p 00002000 fe:03 262807                       /opt/ibm/db2/V11.1/lib64/libibmc++.so.1
3ffa2080000-3ffa2091000 r-xp 00000000 fe:03 262811                       /opt/ibm/db2/V11.1/lib64/libdb2trcapi.so.1
3ffa2091000-3ffa2092000 ---p 00011000 fe:03 262811                       /opt/ibm/db2/V11.1/lib64/libdb2trcapi.so.1
3ffa2092000-3ffa2093000 r--p 00011000 fe:03 262811                       /opt/ibm/db2/V11.1/lib64/libdb2trcapi.so.1
3ffa2093000-3ffa2094000 rw-p 00012000 fe:03 262811                       /opt/ibm/db2/V11.1/lib64/libdb2trcapi.so.1
3ffa2100000-3ffa2179000 r-xp 00000000 fe:03 262870                       /opt/ibm/db2/V11.1/lib64/libdb2sdbin.so.1
3ffa2179000-3ffa217a000 r--p 00078000 fe:03 262870                       /opt/ibm/db2/V11.1/lib64/libdb2sdbin.so.1
3ffa217a000-3ffa2190000 rw-p 00079000 fe:03 262870                       /opt/ibm/db2/V11.1/lib64/libdb2sdbin.so.1
3ffa2200000-3ffa2279000 r-xp 00000000 fe:03 262817                       /opt/ibm/db2/V11.1/lib64/libdb2osse_db2.so.1
3ffa2279000-3ffa227a000 r--p 00078000 fe:03 262817                       /opt/ibm/db2/V11.1/lib64/libdb2osse_db2.so.1
3ffa227a000-3ffa227c000 rw-p 00079000 fe:03 262817                       /opt/ibm/db2/V11.1/lib64/libdb2osse_db2.so.1
3ffa2280000-3ffa27c3000 r-xp 00000000 fe:03 262860                       /opt/ibm/db2/V11.1/lib64/libdb2osse.so.1
3ffa27c3000-3ffa27c4000 r--p 00542000 fe:03 262860                       /opt/ibm/db2/V11.1/lib64/libdb2osse.so.1
3ffa27c4000-3ffa2882000 rw-p 00543000 fe:03 262860                       /opt/ibm/db2/V11.1/lib64/libdb2osse.so.1
3ffa2882000-3ffa2884000 rw-p 00000000 00:00 0
3ffa2900000-3ffa291d000 r-xp 00000000 fe:03 262859                       /opt/ibm/db2/V11.1/lib64/libdb2locale.so.1
3ffa291d000-3ffa291e000 r--p 0001c000 fe:03 262859                       /opt/ibm/db2/V11.1/lib64/libdb2locale.so.1
3ffa291e000-3ffa2929000 rw-p 0001d000 fe:03 262859                       /opt/ibm/db2/V11.1/lib64/libdb2locale.so.1
3ffa2980000-3ffa2985000 r-xp 00000000 fe:03 262841                       /opt/ibm/db2/V11.1/lib64/libdb2install.so.1
3ffa2985000-3ffa2986000 ---p 00005000 fe:03 262841                       /opt/ibm/db2/V11.1/lib64/libdb2install.so.1
3ffa2986000-3ffa2987000 r--p 00005000 fe:03 262841                       /opt/ibm/db2/V11.1/lib64/libdb2install.so.1
3ffa2987000-3ffa2988000 rw-p 00006000 fe:03 262841                       /opt/ibm/db2/V11.1/lib64/libdb2install.so.1
3ffa2988000-3ffa298a000 rw-p 00000000 00:00 0
3ffa2a00000-3ffa2a3c000 r-xp 00000000 fe:03 262868                       /opt/ibm/db2/V11.1/lib64/libdb2genreg.so.1
3ffa2a3c000-3ffa2a3d000 ---p 0003c000 fe:03 262868                       /opt/ibm/db2/V11.1/lib64/libdb2genreg.so.1
3ffa2a3d000-3ffa2a3e000 r--p 0003c000 fe:03 262868                       /opt/ibm/db2/V11.1/lib64/libdb2genreg.so.1
3ffa2a3e000-3ffa2a3f000 rw-p 0003d000 fe:03 262868                       /opt/ibm/db2/V11.1/lib64/libdb2genreg.so.1
3ffa2a80000-3ffa328e000 r-xp 00000000 fe:03 262853                       /opt/ibm/db2/V11.1/lib64/libdb2g11n.so.1
3ffa328e000-3ffa328f000 r--p 0080d000 fe:03 262853                       /opt/ibm/db2/V11.1/lib64/libdb2g11n.so.1
3ffa328f000-3ffa32b5000 rw-p 0080e000 fe:03 262853                       /opt/ibm/db2/V11.1/lib64/libdb2g11n.so.1
3ffa32b5000-3ffa32b6000 rw-p 00000000 00:00 0
3ffa3300000-3ffa3324000 r-xp 00000000 fe:03 262810                       /opt/ibm/db2/V11.1/lib64/libdb2dascmn.so.1
3ffa3324000-3ffa3325000 r--p 00023000 fe:03 262810                       /opt/ibm/db2/V11.1/lib64/libdb2dascmn.so.1
3ffa3325000-3ffa3327000 rw-p 00024000 fe:03 262810                       /opt/ibm/db2/V11.1/lib64/libdb2dascmn.so.1
3ffa3327000-3ffa3329000 rw-p 00000000 00:00 0
3ffa3380000-3ffa341d000 r-xp 00000000 fe:00 143319                       /lib64/libm-2.22.so
3ffa341d000-3ffa341e000 r--p 0009c000 fe:00 143319                       /lib64/libm-2.22.so
3ffa341e000-3ffa341f000 rw-p 0009d000 fe:00 143319                       /lib64/libm-2.22.so
3ffa3480000-3ffa348e000 r-xp 00000000 fe:00 157384                       /lib64/libpam.so.0.83.1
3ffa348e000-3ffa348f000 ---p 0000e000 fe:00 157384                       /lib64/libpam.so.0.83.1
3ffa348f000-3ffa3490000 r--p 0000e000 fe:00 157384                       /lib64/libpam.so.0.83.1
3ffa3490000-3ffa3491000 rw-p 0000f000 fe:00 157384                       /lib64/libpam.so.0.83.1
3ffa3500000-3ffa351a000 r-xp 00000000 fe:00 143339                       /lib64/libpthread-2.22.so
3ffa351a000-3ffa351b000 r--p 00019000 fe:00 143339                       /lib64/libpthread-2.22.so
3ffa351b000-3ffa351c000 rw-p 0001a000 fe:00 143339                       /lib64/libpthread-2.22.so
3ffa351c000-3ffa3520000 rw-p 00000000 00:00 0
3ffa3580000-3ffa3583000 r-xp 00000000 fe:00 143317                       /lib64/libdl-2.22.so
3ffa3583000-3ffa3584000 r--p 00002000 fe:00 143317                       /lib64/libdl-2.22.so
3ffa3584000-3ffa3585000 rw-p 00003000 fe:00 143317                       /lib64/libdl-2.22.so
3ffa35c0000-3ffa3600000 rw-p 00000000 00:00 0
3ffa3600000-3ffa360c000 r-xp 00000000 fe:00 143315                       /lib64/libcrypt-2.22.so
3ffa360c000-3ffa360d000 r--p 0000b000 fe:00 143315                       /lib64/libcrypt-2.22.so
3ffa360d000-3ffa360e000 rw-p 0000c000 fe:00 143315                       /lib64/libcrypt-2.22.so
3ffa360e000-3ffa363c000 rw-p 00000000 00:00 0
3ffa3640000-3ffa3680000 rw-p 00000000 00:00 0
3ffa3680000-3ffa380d000 r-xp 00000000 fe:00 143311                       /lib64/libc-2.22.so
3ffa380d000-3ffa3811000 r--p 0018c000 fe:00 143311                       /lib64/libc-2.22.so
3ffa3811000-3ffa3813000 rw-p 00190000 fe:00 143311                       /lib64/libc-2.22.so
3ffa3813000-3ffa3817000 rw-p 00000000 00:00 0
3ffa3830000-3ffa3880000 rw-p 00000000 00:00 0
3ffa3880000-3ffa38b5000 r--s 00000000 00:15 17242                        /run/nscd/passwd
3ffa38c0000-3ffa3900000 rw-p 00000000 00:00 0
3ffa3900000-3ffa5daa000 r-xp 00000000 fe:03 262847                       /opt/ibm/db2/V11.1/lib64/libdb2.so.1
3ffa5daa000-3ffa5dab000 r--p 024a9000 fe:03 262847                       /opt/ibm/db2/V11.1/lib64/libdb2.so.1
3ffa5dab000-3ffa61e9000 rw-p 024aa000 fe:03 262847                       /opt/ibm/db2/V11.1/lib64/libdb2.so.1
3ffa61e9000-3ffa64dc000 rw-p 00000000 00:00 0
3ffa6500000-3ffa6523000 r-xp 00000000 fe:00 143303                       /lib64/ld-2.22.so
3ffa6523000-3ffa6524000 r--p 00022000 fe:00 143303                       /lib64/ld-2.22.so
3ffa6524000-3ffa6525000 rw-p 00023000 fe:00 143303                       /lib64/ld-2.22.so
3ffa6525000-3ffa6526000 rw-p 00000000 00:00 0
3ffa652b000-3ffa656d000 rw-p 00000000 00:00 0
3ffa656d000-3ffa657e000 rw-p 00000000 00:00 0
3ffa657e000-3ffa6580000 r-xp 00000000 00:00 0                            [vdso]
3ffed6df000-3ffed6ff000 rwxp 00000000 00:00 0                            [stack]
3ffed6ff000-3ffed700000 rw-p 00000000 00:00 0

kea00sys@kea00apk:~>
---------------------------------------------------------------------------------------------------------------

３．ファイルを確認
ログより
/apdata/today/file/rack/A00_20211230054041.dat
と
/apdata/today/file/rack/A00_20211230054041.trg
を確認。

/apdata/today/file/rack/A00_20211230054041.dat
の内容は
---------------------
20211229,END,22
---------------------
の１行のみ。

/apdata/today/file/rack/A00_20211230054041.trg
の内容は
---------------------
0
---------------------
の１行のみ。

４．ファイル待避
対象のファイルは２回目のＥＮＤ情報のみのファイルと判断し、検査内容へ影響なさそうなので
ファイル名を変更し待避する。

/apdata/today/file/rack/A00_20211230054041.dat
↓
/apdata/today/file/rack/A00_20211230054041.dat.aaa

/apdata/today/file/rack/A00_20211230054041.trg
↓
/apdata/today/file/rack/A00_20211230054041.trg.aaa

へリネーム。

５．ND101を再起動
~/bin/proc.shよりND101を再起動
リネームしたファイル以外が処理されることを確認。


--------------------------------------------------------------------
204：羽生 達哉; 総研検査システム２課
2022年01月17日（月） 13:43

ケミストリー属性修正のエラーメールを受信
リトライ処理を実行。
----------------------------------------------------------------------------------
< /apdata/aplog/LD103_20220117.log:2022/01/17 12:46:41 E kea00apa 37593 kea00sys LD103 LD103_db.sqc sFncRuiChkZok 411 S 00000000 SQLCODE:-1476 SQLSTATE:40506 WHERE[UTKYMD='2022-01-08'][IRINO='00035037100']

DB2のエラーが発生しています。
ログを確認しファイルを再処理してください。
-----------------------------------------------------------------------------------
No171と同じ手順を実行。

--------------------------------------------------------------------
206：清水 竜也; 総研検査システム１課
2022年01月18日（火） 08:48

横田課長、羽生主事、小林さん

1/18 AM2時半頃　ＺＳのオンラインについて　竹澤さんより問い合わせ　

業務開始時のコントロール取込みが、正常に行われないのでみて欲しい。

8時現在、解決していません。
昨晩は尿一般の翌日報告対象のOC装置のトラブルありそちらの対応を優先しました。
９時で上がらせていただきます。本件について、対応をお願いいたします。

詳細：

１ライン目の１～３号機  各項目のコントロール、大体２濃度設定しているのが
一方の項目しか概ね取り込まれていない。
２ライン目の４～６号機　６号機が１ライン目と同様。なお再送したところ取り込んだとも。

ＺＳのログを見ると 
ls -l /apdata/aplog/MD*  

-rw-r--r-- 1 kea00sys users      719  1月 17 20:25 MD101_1_20220117.log
-rw-r--r-- 1 kea00sys users    12794  1月 18 05:07 MD101_1_20220118.log
-rw-r--r-- 1 kea00sys users      719  1月 17 20:25 MD101_2_20220117.log
-rw-r--r-- 1 kea00sys users    18668  1月 18 05:07 MD101_2_20220118.log
-rw-r--r-- 1 kea00sys users 46603870  1月 17 23:59 MD102_1_20220117.log
-rw-r--r-- 1 kea00sys users 98770243  1月 18 07:37 MD102_1_20220118.log
-rw-r--r-- 1 kea00sys users     1289  1月 17 20:25 MD102_2_20220117.log
-rw-r--r-- 1 kea00sys users    32576  1月 18 05:07 MD102_2_20220118.log
-rw-r--r-- 1 kea00sys users       91  1月 17 20:25 MD103_20220117.log
-rw-r--r-- 1 kea00sys users   659707  1月 18 07:27 MD103_20220118.log
-rw-r--r-- 1 kea00sys users       91  1月 17 20:25 MD104_20220117.log
-rw-r--r-- 1 kea00sys users      182  1月 18 05:07 MD104_20220118.log
-rw-r--r-- 1 kea00sys users    12819  1月 18 03:45 MD105.log
-rw-r--r-- 1 kea00sys users      114  1月 17 20:25 MD105_BMLRNS20220117.log
-rw-r--r-- 1 kea00sys users      226  1月 18 05:07 MD105_BMLRNS20220118.log

MD102_1_20220118.log から、
・MD102   MD102.c sFncMkLineKekka 3065            00000000        Line用依頼ファイルのオープンに失敗しました。
    File[/apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86497.end] ERR[2]

のメーッセージが頻繁に出力されていた。


  PID TTY          TIME CMD
42524 ?        00:00:00 MD101
42526 ?        00:00:00 MD101
42528 ?        00:00:29 MD102
42531 ?        00:00:28 MD102
42535 ?        00:00:01 MD103
42539 ?        00:00:01 MD104
42544 ?        00:00:00 MD105
51754 ?        00:00:58 MD102


AM５時過ぎにプログラムの再起動を行った。
cd shell/daily
sh /home/kea00sys/shell/daily/prcZS_onoff.sh -STOP

（数分後、ND102のオーダーラック登録　プロセスが起動していません。のアラートメールが入り
  proc.sh より、ND102の起動を行った。 
  prcZS_onoff.sh -STOP で止めると、ND102を停止してしまうことを思い出した ）

sh /home/kea00sys/shell/daily/prcZS_onoff.sh -START

  PID TTY          TIME CMD
43994 ?        00:00:00 MD101
43996 ?        00:00:00 MD101
43999 ?        00:00:01 MD102
44001 ?        00:00:00 MD102
44003 ?        00:00:00 MD103
44005 ?        00:00:00 MD104
44007 ?        00:00:00 MD105
kea00sys@kea00apa:/apdata/aplog> date
2022年  1月 18日 火曜日 05:19:10 JST
kea00sys@kea00apa:/apdata/aplog>

ただし状況は改善せず、MD102_1_20220118.log から
・MD102   MD102.c sFncMkLineKekka 3065            00000000        Line用依頼ファイルのオープンに失敗しました。
    File[/apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86497.end] ERR[2]

のメーッセージが頻繁に出力される。

ＺＳの通信電文のフォルダーを見つけるが、解決せず。
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/socdata

清水



--------------------------------------------------------------------
208：小林 洋一; 総研検査システム２課
2022年01月18日（火） 10:45

@:清水 竜也; 総研検査システム１課

>>206
ZS050のコントロールの結果が取り込まれない。

エラーになっていた空ファイルを手動作成。
kea00sys@kea00apa:/apdata/aplog> tail MD102_1_20220118.log
2022/01/18      10:00:41        E       kea00apa        43999   kea00sys        MD102   MD102.c sFncMkLineKekka 3065            00000000 Line用依頼ファイルのオープンに失敗しました。File[/apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86103.end] ERR[2]
2022/01/18      10:00:41        E       kea00apa        43999   kea00sys        MD102   MD102.c sFncMkLineKekka 3065            00000000 Line用依頼ファイルのオープンに失敗しました。File[/apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86103.end] ERR[2]
2022/01/18      10:00:41        E       kea00apa        43999   kea00sys        MD102   MD102.c sFncMkLineKekka 3065            00000000 Line用依頼ファイルのオープンに失敗しました。File[/apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86103.end] ERR[2]
2022/01/18      10:00:41        E       kea00apa        43999   kea00sys        MD102   MD102.c sFncMkLineKekka 3065            00000000 Line用依頼ファイルのオープンに失敗しました。File[/apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86103.end] ERR[2]
2022/01/18      10:00:41        E       kea00apa        43999   kea00sys        MD102   MD102.c sFncMkLineKekka 3065            00000000 Line用依頼ファイルのオープンに失敗しました。File[/apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86103.end] ERR[2]
2022/01/18      10:00:43        E       kea00apa        43999   kea00sys        MD102   MD102.c sFncMkLineKekka 3065            00000000 Line用依頼ファイルのオープンに失敗しました。File[/apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86103.end] ERR[2]
2022/01/18      10:00:43        E       kea00apa        43999   kea00sys        MD102   MD102.c sFncMkLineKekka 3065            00000000 Line用依頼ファイルのオープンに失敗しました。File[/apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86103.end] ERR[2]
2022/01/18      10:00:43        E       kea00apa        43999   kea00sys        MD102   MD102.c sFncMkLineKekka 3065            00000000 Line用依頼ファイルのオープンに失敗しました。File[/apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86103.end] ERR[2]
2022/01/18      10:00:43        E       kea00apa        43999   kea00sys        MD102   MD102.c sFncMkLineKekka 3065            00000000 Line用依頼ファイルのオープンに失敗しました。File[/apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86103.end] ERR[2]
2022/01/18      10:00:43        E       kea00apa        43999   kea00sys        MD102   MD102.c sFncMkLineKekka 3065            00000000 Line用依頼ファイルのオープンに失敗しました。File[/apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86103.end] ERR[2]

kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050> touch /apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86497.end
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050> touch /apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/85492.end
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050> touch /apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86009.end
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050> touch /apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/85321.end
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050> touch /apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86251.end
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050> touch /apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/85818.end
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050> touch /apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end/86103.end

エラーログが止まったことを確認。
再度コントロールを測定、結果は取り込まれず。

プログラム停止
kea00sys@kea00apa:~/shell/daily> prcZS_onoff.sh -STOP

kea00sys@kea00apa:/apdata/aplog> ps -ax | grep MD
20960 ?        Ss     0:00 MD102 /home/kea00sys/bin/MD102_L1.ini 1
kea00sys@kea00apa:/apdata/aplog>

kea00sys@kea00apa:/apdata/aplog> view MD102_1_20220118.log
共有メモリの取得に失敗しました ERR[2]
2022/01/18      10:33:50        E       kea00apa        43999   kea00sys        MD102   MD102.c shmget  3727            00000000        >共有メモリの取得に失敗しました ERR[2]

延々と共有メモリの取得に失敗のログが出力されたためkill -USR1でプロセスを停止。

共有メモリファイルを退避、作成
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050> mv 1_MD102.sav 1_MD102.sav_bk
kea00sys@kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050> touch 1_MD102.sav

プログラム起動
kea00sys@kea00apa:~/shell/daily> prcZS_onoff.sh -START
kea00sys@kea00apa:/apdata/aplog> ps -ax | grep MD
20956 ?        Ss     0:00 MD101 /home/kea00sys/bin/MD101_L1.ini
20958 ?        Ss     0:00 MD101 /home/kea00sys/bin/MD101_L2.ini
20960 ?        Ss     0:00 MD102 /home/kea00sys/bin/MD102_L1.ini 1
20963 ?        Ss     0:00 MD102 /home/kea00sys/bin/MD102_L2.ini 1
20967 ?        Ss     0:00 /home/kea00sys/bin/MD103 /home/kea00sys/bin/MD103.ini
20969 ?        Ss     0:00 /home/kea00sys/bin/MD104 /home/kea00sys/bin/MD104.ini
20971 ?        Ss     0:00 /home/kea00sys/bin/MD105 /home/kea00sys/bin/MD105.ini
kea00sys@kea00apa:/apdata/aplog>

kea00sys@kea00apa:/apdata/aplog>proc.sh
ND102を起動。



--------------------------------------------------------------------
209：羽生 達哉; 総研検査システム２課
2022年01月19日（水） 12:17

MD102_L1 と ND102 の共有メモリのキーが14002で重複しています。
このため、prcZS_onoff.sh -STOPでND102が一緒に終了しています。

ND101の共有メモリキーは15001なのでND102のキーは15002が正しいのではないかと思います。

--------------------------------------------------------------------
210：横田 克夫; 総研検査システム２課
2022年01月19日（水） 12:46

@:羽生 達哉; 総研検査システム２課

>>209
羽生主事

調査ありがとうございます。
テスト実施の上、本番への適用をご検討いただけますと幸いです。

--------------------------------------------------------------------
212：清水 竜也; 総研検査システム１課
2022年01月21日（金） 20:08

問い合わせ者　ケミストリー松岡さん　　対応時間　60分

問い合わせ内容：
1/20受、164-4192　の依頼が、結果入力画面、未報告確認リストに２行表示されるのでみて欲しい。
SEQが２行(SとVなど）で異なることはしばしばあるが、今回はSEQが同一値で、これは初めて見る、とのことであった。


確認すると、検査回数４回目まであったが、４回目の内容はどう見ても３回目と同じ内容。
ただし、検査数１回目と４回目の２つが　KKAJKCD＝３の最終報告の扱いとなっていて
また、４回目の KNSFLG, SYOUGOFLG　の値は、他のレコードと足並みが揃っていない、という状態である。
（詳細は添付ファイル参照）

KNSKISYMD    KNTNO    KNSGRP    KMKCD    KNSSU    BSKSEQ    SKTDH    HJKKA    KKACMT1    KKAJKCD    SIYFLG    KNSFLG    SYOUGOFLG    KSNDH
2022/1/20    264419201    3414    546    1    308    2022/1/21 3:44 AM    0.7    101    3    1    X    1    2022/1/21 4:24 AM
2022/1/20    264419201    3414    546    2    328    2022/1/21 4:08 AM    0.7    101    1         X    1    2022/1/21 4:08 AM
2022/1/20    264419201    3414    546    3    583    2022/1/21 4:24 AM    0.8    101    1         X    1    2022/1/21 4:24 AM
2022/1/20    264419201    3414    546    4    583    2022/1/21 4:24 AM    0.8        3    1    A    0    2022/1/21 4:24 AM


４回目は本来不要なため、手動でフラグ更新した。

update kekka 
set KKAJKCD='1', KNSFLG='X', SYOUGOFLG='1'
where  utkymd   ='2022-01-20' 
and irino = '00264419200' 
and kmkcd = '0000546'
and knssu=4 

更新後、未報告リストが１行になったことを確認した。

その後、報告をかけてもらい
ホストにて問題なく取り込まれていることを確認した。


kekka_2644192.xlsx

--------------------------------------------------------------------
213：横田 克夫; 総研検査システム２課
2022年01月21日（金） 20:21

@:小林 洋一; 総研検査システム２課

>>208
ZS050のACE_Cコントロールの結果が取り込まれない。
追加調査を実施し、藤本課長に報告。
再度、夜間業務を確認して頂くこととした。

20220121_ACEコントロールデータ無し調査結果.txt

--------------------------------------------------------------------
214：羽生 達哉; 総研検査システム２課
2022年01月24日（月） 13:08

ケミストリー属性修正のエラーメールを受信
リトライ処理を実行。
----------------------------------------------------------------------------------
< /apdata/aplog/LD103_20220124.log:2022/01/24 12:51:22 E kea00apa 61190 kea00sys LD103 LD103_db.sqc sFncRuiChkZok 411 S 00000000 SQLCODE:-1476 SQLSTATE:40506 WHERE[UTKYMD='2021-11-29'][IRINO='00058324600']

DB2のエラーが発生しています。
ログを確認しファイルを再処理してください。
-----------------------------------------------------------------------------------
No171と同じ手順を実行。

累積のDB2再起動後にZ側からアクセスをしているが改善せず。
継続して対応を検討。

--------------------------------------------------------------------
215：清水 竜也; 総研検査システム１課
2022年01月24日（月） 14:59

問い合わせ者　ケミストリー海老島さん　　対応時間　150分

問合せ内容：
ヒストグラムを2021年の11月でWS=054を全項目、出力しているが
Na, CLの２項目がエラーになるので見て欲しい。

調査・対応：
PC側のヒストグラムのログ：HS104.logを調べると、
抽出時の以下のようなSQLがあり、そこでエラーを出していた。

（数値変換の失敗は画面のエラーで何となくわかっていたが
　ヒストグラムの階級付けを項目マスターとjoinしながらSQLで直接やっているのには驚いた）

テーブルはrui_kekka でなく、集計用の SHU_KEKKA (IA上）を参照。

2022/01/24	12:40:29	OPT	HS104	1004    	frmHS104	
SQL：
SELECT KMKCD,'' AS BSKKBN,'' AS BSKLNE,SBTKBN,RANK,COUNT(RANK) AS CNT 
FROM (SELECT SHU_KEKKA.KMKCD,SHU_KEKKA.SBTKBN,DECIMAL(SHU_KEKKA.KNSKKA1,24,5) AS KNSKKA1,
CASE 
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 0) THEN 1
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 1) THEN 2
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 2) THEN 3
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 3) THEN 4
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 4) THEN 5
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 5) THEN 6
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 6) THEN 7
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 7) THEN 8
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 8) THEN 9
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 9) THEN 10
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 10) THEN 11
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 11) THEN 12
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 12) THEN 13
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 13) THEN 14
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 14) THEN 15
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 15) THEN 16
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 16) THEN 17
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 17) THEN 18
WHEN DOUBLE(SHU_KEKKA.KNSKKA1) <= (DOUBLE(KMKMST.GMIN) + DOUBLE(KMKMST.GHABA) * 18) THEN 19
ELSE 20  END AS RANK 
FROM SHU_KEKKA,KMKMST WHERE SHU_KEKKA.KNSKISYMD >= '2021-11-05' 
AND SHU_KEKKA.KNSKISYMD <= '2021-11-05' 
AND SHU_KEKKA.KNSGRP = '0054' 
AND SHU_KEKKA.BSKKBN <> '' 
AND SHU_KEKKA.BSKLNE <> '' 
AND SHU_KEKKA.BSKGOK <> '' 
AND SHU_KEKKA.KNSFLG = 'E' 
AND SHU_KEKKA.TSTRFLG <> 'S' 
AND SHU_KEKKA.KNSKKA2KBN <> '0' 
AND SHU_KEKKA.KMKCD = '0000421' 
AND KMKMST.KNSGRP = '0054' 
AND KMKMST.KMKCD = '0000421' 
AND KMKMST.KAIYMD <= '2021-11-05' 
AND KMKMST.HAIYMD >= '2021-11-05' 
AND SHU_KEKKA.KNSGRP = KMKMST.KNSGRP 
AND SHU_KEKKA.KMKCD = KMKMST.KMKCD ) KKA 
GROUP BY KMKCD,SBTKBN,RANK ORDER BY KMKCD,SBTKBN,RANK FOR READ ONLY

2022/01/24	12:40:31	ERR	HS104	1004    	HS104	frmHS104	mf_ExecSQL				
データ取得失敗：0ERROR [22018] [IBM][DB2/LINUXZ64] SQL0420N  無効文字が、関数 "DOUBLE" の文字ストリング引数で見つかりました。

KNSKKA1　にどのような値が入っているか distinct  でみてみる。
なお、ヒスト画面の実行で抽出期間を狭めていき、11/5受にエラーデータがあることはわかっていた。

SELECT distinct KNSKKA1   FROM SHU_KEKKA 
WHERE SHU_KEKKA.KNSKISYMD = '2021-11-05' 
AND SHU_KEKKA.KNSGRP = '0054' 
AND SHU_KEKKA.BSKKBN <> '' 
AND SHU_KEKKA.BSKLNE <> '' 
AND SHU_KEKKA.BSKGOK <> '' 
AND SHU_KEKKA.KNSFLG = 'E' 
AND SHU_KEKKA.TSTRFLG <> 'S' 
AND SHU_KEKKA.KNSKKA2KBN <> '0' 

で KNSKKA1 に数字が入っておらず、未入力（空白）のものがあることがわかった。
その DOUBLE変換が失敗するのが原因。


SELECT *   FROM SHU_KEKKA 
WHERE SHU_KEKKA.KNSKISYMD = '2021-11-05' 
AND SHU_KEKKA.KNSGRP = '0054' 
AND SHU_KEKKA.BSKKBN <> '' 
AND SHU_KEKKA.BSKLNE <> '' 
AND SHU_KEKKA.BSKGOK <> '' 
AND SHU_KEKKA.KNSFLG = 'E' 
AND SHU_KEKKA.TSTRFLG <> 'S' 
AND SHU_KEKKA.KNSKKA2KBN <> '0' 
AND SHU_KEKKA.KMKCD = '0000421' 
AND KNSKKA1 ='' 


irino が '00006945200'、'00006945300'　の２つに
Na(0000421)と CL(0000425)で　KNTNO（枝番）違いのレコードがあり
２本を実測後、何らかの理由で画面で結果を手入力したのか
knssuが=0回の３番目のレコードで最終的に報告されたことがうかがえる。

KNTNO	KNSGRP	KMKCD	KNSSU	BSKKBN	BSKLNE	BSKSEQ	KNSKKA1	KNSKKA2	KNSKKA2KBN	KNSFLG
00006945204 	54	425	1	LABO	8	2076	            	                        	  	M
00006945204 	54	425	0	    	    	0	105	                        	  	E
00006945205	54	425	1	BIOM	12	1188	            	                        	X 	E


KNSFLG='E', KNSKKA2KBN='X'で KNSKKA1が入っていないレコードの KNSFLGを 'M'未報告完了にupdateし、ヒストに抽出されないようにした。

UPDATE  SHU_KEKKA  SET  KNSFLG='M'
WHERE KNSKISYMD = '2021-11-05' 
and irino ='00006945200'
and kmkcd in('0000421','0000425')
and KNSKKA2KBN='X'
and KNSKKA1=''

リモートにて現場のPC上で、同ヒストを実行。
エラーが出ず、正常処理されることを確認した。

以上

hist_err.jpg

--------------------------------------------------------------------
216：羽生 達哉; 総研検査システム２課
2022年01月24日（月） 17:36

問い合わせ者　ケミストリー高梨さん　　対応時間　30分

問合せ内容：
食塩摂取量のExcelマクロを実行して、データを送信（サテライトへの取り込み）を
するとエラーになって送信ができない

調査・対応：
作業したKEA00CLP08にはExcelマクロファイルは配置してあったが、サテライトへの更新プログラム(DS349.exe)や作業フォルダが存在していなかった。
マクロファイルはコピーしたが、実行環境は整備していなかった模様。
普段作業しているＰＣがたまたま使用中だったため、KEA00CLP08でやってみたところエラーが出た。

普段作業しているＰＣで再実行してもらい、サテライトへ取り込まれることを確認した。


--------------------------------------------------------------------
217：清水 竜也; 総研検査システム１課
2022年01月24日（月） 18:23

保全関連：

1/22、日次後のhulft送受信関連を確認したく
utllist -r や -s ログ表示コマンドを打ったところ
ログが2019年の10月頃から削除されていないことを知りました。

HOST NAME FILEID    START DAY   START TIME END TIME   RECORDS  STATUS   CONNECT
kea00apa  LOOPTEST  2019/06/19  18:09:52   18:09:52          1 0000-0000   LAN
kitga20a  SA00SY00  2019/10/23  10:37:36   10:37:37      78293 0000-0000   LAN
kitga20a  SA00SY00  2019/10/23  10:37:47   10:37:54     556004 0000-0000   LAN

理想は、日次の中で削除でしょうが、今週～来週辺りに
マスターを追加する予定なので、その時に手動で削除しようと思います。

/opt　４G使用と表示されますが、huftの rcv, sndログが、それぞれ１G以上とかなり大きいです。
　
/dev/mapper/kea00apa--os--vg-opt--lv                                7.9G  4.1G  3.4G   56% /opt
/dev/mapper/kea00apa--os--vg-home--lv                               2.4G  1.2G  1.2G   50% /home
/dev/mapper/kea00apa--os--vg-var--lv                                2.4G  612M  1.7G   27% /var
tmpfs                                                                99M     0   99M    0% /run/user/1001
KEA00IAW08:/apdata/today/file/KEA00/KEA00IA                         9.7G  7.6G  1.7G   83% /apdata/today/file/KEA00/KEA00IAW08
KEA00IAW21:/apdata/today/file/KEA00/KEA00IA                         449G   66G  360G   16% /apdata/today/file/KEA00/KEA00IAW21
KEA00IAW22:/apdata/today/file/KEA00/KEA00IA                         449G  7.4G  419G    2% /apdata/today/file/KEA00/KEA00IAW22
KEA00IAW23:/apdata/today/file/KEA00/KEA00IA                         439G   12G  406G    3% /apdata/today/file/KEA00/KEA00IAW23
KEA00IAW24:/apdata/today/file/KEA00/KEA00IA                         439G   12G  406G    3% /apdata/today/file/KEA00/KEA00IAW24
KEA00IAW02:/apdata/today/file/KEA00/KEA00IA                          72G   49G   20G   72% /apdata/today/file/KEA00/KEA00IAW02


-rw-rw-rw- 1 root root  155722320  1月 24 17:30 hulexeclogr.dat
-rw-rw-rw- 1 root root  215741565  1月 24 18:01 hulexeclogs.dat
-rw-rw-rw- 1 root root          0  1月  1 20:45 hulrcvd_cmd
-rw-rw-rw- 1 root root 1015792488  1月 24 17:30 hulrcvlog.dat
-rw-rw-rw- 1 root root          0  1月  1 20:45 hulsndd_cmd
-rw-rw-rw- 1 root root 1430909080  1月 24 18:01 hulsndlog.dat


--------------------------------------------------------------------
218：清水 竜也; 総研検査システム１課
2022年01月27日（木） 19:24

>>217
保全関連：

コマンド  utllog -a　　にて削除。　
　サイズ大きく、１～２分かかった。実行中、cpu負荷は50％前後で推移していた。
 
実行前：
/dev/mapper/kea00apa--os--vg-opt--lv                                7.9G  4.1G  3.3G   56% /opt

実行後：
/dev/mapper/kea00apa--os--vg-opt--lv                                7.9G  1.5G  6.0G   20% /opt


--------------------------------------------------------------------
219：横田 克夫; 総研検査システム２課
2022年01月27日（木） 22:47

>>213
ACEのコントロールが取り込まれない件、藤本課長より連絡あり。
---------------------------------------------------
	Re: Fwd: Re: ACEコントロールについて
差出人	 ： 	"藤本 丈志" <takeshi-f@bml.co.jp> 
送信日時	 ： 	2022年01月27日（木） 19:14
To  	 ： 	"横田 克夫" <k-yokota@bml.co.jp>
Cc （4件）    	 ： 	"辻　祐輝" <yuki_tsuji@bml.co.jp>, "竹澤 富雄" <tomio_takezawa@bml.co.jp>, "清水 竜也" <shimizu@bml.co.jp>, "小林 洋一" <you-kb@bml.co.jp> （←宛先を隠す）

横田課長

お疲れ様です。

関家さんへの確認ありがとうございます。
関家さんも未対応ってことはなかったということですね。

お騒がせしてすみませんでした。

藤本

----- Original Message -----
Subject: Re: Fwd: Re: ACEコントロールについて
Date: Wed, 26 Jan 2022 12:14:33 +0900
From: "横田 克夫"<k-yokota@bml.co.jp>
To: "藤本 丈志"<takeshi-f@bml.co.jp>
Cc: "辻　祐輝"<yuki_tsuji@bml.co.jp>, "竹澤 富雄"<tomio_takezawa@bml.co.jp>, "清水 竜也"<shimizu@bml.co.jp>, "小林 洋一"<you-kb@bml.co.jp>
横田 克夫 wrote:
> 藤本課長
> 
> お疲れ様です。
> 
> 本件、前任者の関家に連絡が取れ、内容を確認しましたが、
> 「日次処理より前にコントロール情報を確認する方法は無いハズ」
> とのことでした。
> 
> 夜間業務をご確認いただけますようお願いいたします。
> 
> 横田



--------------------------------------------------------------------
220：羽生 達哉; 総研検査システム２課
2022年01月31日（月） 14:16

ケミストリー属性修正のエラーメールを受信
リトライ処理を実行。
----------------------------------------------------------------------------------
< /apdata/aplog/LD103_20220131.log:2022/01/31 12:45:12 E kea00apa 1097 kea00sys LD103 LD103_db.sqc sFncRuiChkZok 411 S 00000000 SQLCODE:-1476 SQLSTATE:40506 WHERE[UTKYMD='2021-11-26'][IRINO='00552336200']

DB2のエラーが発生しています。
ログを確認しファイルを再処理してください。
-----------------------------------------------------------------------------------
No171と同じ手順を実行。

累積のDB2再起動後にZ側からアクセスをしているが改善せず。
継続して対応を検討。

--------------------------------------------------------------------
221：小林 洋一; 総研検査システム２課
2022年02月01日（火） 16:11

問い合わせ者　ケミストリー高梨さん　　対応時間　30分
受日:2022/01/31
依頼書NO:0066439
推算GFR検出不可が入らないので対応してほしい。
結果照会画面で確認したところ検査回数1,3の検査状況が終になっていた。
1,2回(検査SEQ93156)は通常測定、3回目(検査SEQ500904)は非分注の検体から測定した様です。
下記SQLをCSEで実行しバックアップ
select * from kekka where utkymd='2022-01-31' and irino='00006643900'
select * from kekka where utkymd='2022-01-31' and irino='00006643900' and knsseq=500904

3回目(検査SEQ500904)の受日を受付日のない日付(2022/01/30)に更新
update kekka set utkymd='2022-01-30' where utkymd='2022-01-31' and irino='00006643900' and knsseq=500904

依頼書NO単位入力画面から入力していただきました。




--------------------------------------------------------------------
222：横田 克夫; 総研検査システム２課
2022年02月01日（火） 18:26

問い合わせ者　ケミストリー高梨さん　　対応時間　15分

■未報告リストを出力しようとしたところ「測定結果のフラグがおかしい検体があります。システムに連絡してください」のエラーが表示される

→データ確認
	SELECT  DISTINCT UTKYMD, IRINO, KMKCD
	FROM    KEKKA
	WHERE   SRIYMD IN (SELECT DISTINCT KJNSRIYMD FROM SYSKNRMST)
	AND             KNSFLG = 'M'
	AND             KKAJKCD = '3'
	ORDER BY UTKYMD, IRINO, KMKCD
	for read only with ur
→受日=2022-01-30,依頼書№=00006643900,項目CD=0002696がヒット。
→ホストに報告済だったので、下記のパッチを実施。
	update KEKKA set KNSFLG = 'E' where UTKYMD='2022-01-30' and irino='00006643900' and kmkcd='0002696' and KNSFLG = 'M'
	KNSFLG を M:未報告完了 から E:報告済 に変更
→解消を確認して頂いた。

--------------------------------------------------------------------
223：羽生 達哉; 総研検査システム２課
2022年02月07日（月） 14:19

ケミストリー属性修正のエラーメールを受信
リトライ処理を実行。
----------------------------------------------------------------------------------
< /apdata/aplog/LD103_20220207.log:2022/02/07 12:42:28 E kea00apa 1451 kea00sys LD103 LD103_db.sqc sFncRuiChkZok 411 S 00000000 SQLCODE:-1476 SQLSTATE:40506 WHERE[UTKYMD='2021-12-18'][IRINO='00006430200']

DB2のエラーが発生しています。
ログを確認しファイルを再処理してください。
-----------------------------------------------------------------------------------
No171と同じ手順を実行。

累積のDB2再起動後にZ側からアクセスは効果がない模様。
継続して対応を検討。

--------------------------------------------------------------------
224：清水 竜也; 総研検査システム１課
2022年02月08日（火） 17:27

問合せ者　ケミストリー倉持さん　　対応時間 30分

ケミストリー上のID登録：
マスターDB定義表に、ユーザーマスタ(USERMST)に、登録用のshがあるとのことだが
どれとは記載されておらず、USERMST テーブルにレコードを登録したが、ログインできないとのこと。

→ サーバーのディレクトリを再確認すると、/home/kea00sys/shell　下に add_user.sh というのがあり、それとわかる。
　ユーザーマスタ(USERMST)と、機能権限マスタ(KNOKGNMST) をペアで入れないといけないようだ。
   ユーザーマスタ(USERMST)に入れた１行を削除し、 add_user.sh　にて登録。ログインOKとなる。

　また、マスターDB定義表の備考欄に「登録用sh  /home/kea00sys/shell/add_user.sh」を追記した。


--------------------------------------------------------------------
225：清水 竜也; 総研検査システム１課
2022年02月11日（金） 15:22

横田課長が外出中に以下連絡を受けたと連絡あり、対応

問合者=ケミストリー くらもち様(内3223) 　対応時間=15分

■内容
　再検のワークシートを切ろうとしても
　他の端末で...しばらくお待ちくださいのようなメッセージが出て、ワークシートが切れない。

■対応

>>60 と同様の処置を実施。
  
select * from KNSSEQKNRI where knsgrp='KEA00SYS'　　でデータが１行表示された。

ロック的なものでこれがあるとワークシート出力が待ち合わせになるらしく、削除する。

delete from KNSSEQKNRI where knsgrp='KEA00SYS'

実施後、くらもち様に連絡を入れ、ワークシート出力をしてもらい、印刷できることを確認。


--------------------------------------------------------------------
226：小林 洋一; 総研検査システム２課
2022年02月13日（日） 09:24

認識フロンティアの遅着情報送信テストを行っていた時に誤って本番機に送信。
下記受日の遅着情報がケミストリに入ってきたので確認。
20211110
20211111
20211112

cd /apdata/today/online/host/Recv/bun
CHKXXXXXXXXXXXXXXX.tmpファイルが大量に溜まっていることを確認。
退避フォルダを作成
mkdir x
grep で対象になったファイルを全てxフォルダに移動。
grep -l 20211110 *tmp
grep -l 20211111 *tmp
grep -l 20211112 *tmp
同階層フォルダにあったBUN.data.XXXXが展開されなかったため
分注展開プログラムを再起動。
proc.sh
3
1
3
proc.sh
2
1
3
同階層フォルダにあったBUN.data.XXXXが展開されたことを確認。
移動したファイルの内容を確認し送信されたレコード数、内容であると一致することを確認。
cd x cat *tmp > test.txt



--------------------------------------------------------------------
227：小林 洋一; 総研検査システム２課
2022年02月14日（月） 11:09

2022年02月13日（日） 10:57
問合せ者　ケミストリー和泉 対応時間 10分
ワークシート出力時にエラーが発生するので対応してほしい。
「SEQデータ取得失敗」と表示される。
ワークシート出力画面のログ
SEQデータ取得失敗：Cast from type 'DBNull' to type 'Integer' is not valid. SQL：SELECT MAX(KNSSEQMAX) AS KNSSEQMAX, MAX(SYTRYMAX) AS SYTRYMAX, MAX(WSNO) AS WSNO FROM KNSSEQKNRI WHERE KNSKISYMD = '2022-02-12' AND WSSBT = '2MAH' 

KNSSEQKNRIにプログラムリリース時に2MAH,2MAIを入れたが消えていた。

日次処理で当日日付以外のKNSSEQKNRIを削除する処理があったので本日の日次後に確認します。
本日からは発生しない予定です。

--------------------------------------------------------------------
228：小林 洋一; 総研検査システム２課
2022年02月15日（火） 05:18

問合せ者横田課長 対応時間 20分
新しい前読み装置を使用していたら検体バーコードを読み取ってしまった。
トレーID:2RRR0002を初期化して対応したい。

元ファイルをバックアップ、取込フォルダにリネームしてコピー
前読み装置で再度読めるか確認を依頼。
cd /apdata/today/file/NSWS/Recv/TrRk/Ok
mv SP09_220215034006_2RRR0002.dat SP09_220215034006_2RRR0002.dat_back
cp -p SP09_220215034006_2RRR0002.dat_back ./../SP09_220215034006_2RRR0002.tmp_test
cd /apdata/today/file/NSWS/Recv/TrRk/
vi SP09_220215034006_2RRR0002.tmp_test
0から始まるアッセイラックIDを削除してアッセイラックを前詰め。

select文をCSEでCtrl+Shift+Enterでバックアップ
UPDATE,DELETEを実行。

select * from kenorder
WHERE
        KNSKISYMD = '2022-02-14' AND
        TRID = '2RRR0002' AND
        KNSJKFLG <> ' '

UPDATE
        KENORDER 
SET 
        ASYRCKID = '____0000',
        ASYRCKPOS = 0,
        KNSJKFLG = ' '
WHERE
        KNSKISYMD = '2022-02-14' AND
        TRID = '2RRR0002' AND
        KNSJKFLG <> ' '

select * from kenpos
WHERE
        KNSKISYMD = '2022-02-14' AND
        TRID = '2RRR0002' AND
        RAKITJHO = 'A'

DELETE FROM
        KENPOS 
WHERE
        KNSKISYMD = '2022-02-14' AND
        TRID = '2RRR0002' AND
        RAKITJHO = 'A'

前読み装置で再度登録するよう現場に伝えるよう依頼。
前読み装置で読めない場合は上記で修正したファイルを.tmp_test箇所を.datにすれば
取込できると伝えました。

--------------------------------------------------------------------
229：横田 克夫; 総研検査システム２課
2022年02月15日（火） 05:29

問合者=竹澤さん,対応時間(分)=56
BMの前読み装置で2RRRR0002のトレーを読ませたところ、本来５桁のラックIDで登録されるが、サンプリングチューブに貼られたバーコードで登録された。
クリアをお願いしたい。

小林氏と協力し下記の対応を行った。
参考手順：\\10.1.103.226\NAS_Backup\総研システム部\総研システム３課\01_ケミストリ\99_資料\02_手順書\トレー登録リセット処理.txt - ショートカット

(1)誤読したトレー情報を確認
　kea00sys@kea00apa:/apdata/today/file/NSWS/Recv/TrRk/Ok> cat SP09_220215034006_2RRR0002.dat
　2RRR0002,20220214,85365,00110,00115,00120,85956,,,,,,,,,,,,,,,,2022/02/15 03:40:06
　→中の３ラックが誤っている。
(2)DB確認
　select * from KENORDER where TRID = '2RRR0002' for read only with ur
　select * from KENPOS where TRID = '2RRR0002'  for read only with ur
　→誤った情報で更新されている。
(3)前読み装置の情報クリア
　→竹澤さんに説明。2RRRR0002で読ませた情報を前読み装置のアプリから消してもらう
(4)DBクリア
	UPDATE
	        KENORDER 
	SET 
	        ASYRCKID = '____0000',
	        ASYRCKPOS = 0,
	        KNSJKFLG = ' '
	WHERE
	        KNSKISYMD = '2022-02-14' AND
	        TRID = '2RRR0002' AND
	        KNSJKFLG <> ' '


	SQLを実行中です...

	SQL応答時間 : 0.172000秒

	23行が処理されました。

	SQL>
	DELETE FROM
	        KENPOS 
	WHERE
	        KNSKISYMD = '2022-02-14' AND
	        TRID = '2RRR0002' AND
	        RAKITJHO = 'A'


	SQLを実行中です...

	SQL応答時間 : 0.156000秒

	22行が処理されました。
(5)竹澤さんに連絡し、再度読ませてもらう。
(6)ファイル＆DB確認
　kea00sys@kea00apa:/apdata/today/file/NSWS/Recv/TrRk/Ok> cat SP09_220215051507_2RRR0002.dat
　2RRR0002,20220214,85365,86840,85696,85525,85956,,,,,,,,,,,,,,,,2022/02/15 05:15:07
(7)竹澤さんに連絡し、ワークシートを確認してもらう。
　→OK
(8)測定結果がホストに登録されることまで確認してもらうことを依頼し、対応完了とした。
(9)恒久対策は藤本課長と相談予定。

--------------------------------------------------------------------
230：横田 克夫; 総研検査システム２課
2022年02月15日（火） 09:21

>>229
> (9)恒久対策は藤本課長と相談予定。
下記、対応を実施するとのこと。
-1.チューブバーコードを読まないようにリーダの向きを調整する
-2.「-1」が完了するまでは、チューブのバーコードを読まないように向きを変える

--------------------------------------------------------------------
231：小林 洋一; 総研検査システム２課
2022年02月17日（木） 16:05

問合せ者辻主任 対応時間 60分
受日:2022-02-16
依頼書NO:4645426
のグリコアルブミン量を照合NGで2回確定してしまった様だ。
依頼書NO単位結果入力画面に表示されないので対応してほしい。

依頼書NO単位結果入力画面を確認。
グリコアルブミン比とアルブミンが表示された。

実行されたSQLを確認。
SELECT
    INSFLG ,
    KNSKISYMD ,
    UTKYMD ,
    KNSSEQ ,
    IRINO ,
    IRIKETFLG ,
    SRIYMD ,
    KNTNO ,
    KNTKETFLG ,
    KNSGRP ,
    KMKCD ,
    IRIHSMKBN ,
    ZRCD ,
    KJNO ,
    KNSKKA ,
    KKACMT1 ,
    KKACMT2 ,
    SKKKA ,
    RAWDATA ,
    NBKMKCD ,
    KKIRILOTNO ,
    KNSFLG ,
    RENJICFLG ,
    SOUKN1FLG ,
    KANRENFLG ,
    BUNKKUFLG ,
    KESSEIFLG ,
    RIREKIFLG ,
    SYOUGOFLG ,
    KEISANFLG ,
    PER100FLG ,
    TOUSEKFLG ,
    KISYAKFLG ,
    KOUSEIFLG ,
    SYOUNGFLG ,
    SOUKN2FLG ,
    FUKAPTFLG ,
    NBDOLBL ,
    YKDOLBL ,
    ETCLBL ,
    PNCRGFLG ,
    KNSPNCRGFLG ,
    JISKSBR ,
    KKFLG ,
    KKIRIFLG ,
    KKAHSKCD ,
    SC ,
    TJ ,
    SBTKBN ,
    TNTME ,
    TNRYO ,
    TRID ,
    ASYRCKID ,
    TRPOS ,
    ASYRCKPOS ,
    OYAKMKCD ,
    KNSSU ,
    KNSSUEDA ,
    KNSGRPRS ,
    KMKRSJ ,
    KMKRS ,
    HYJIJN ,
    SSTCD ,
    KNSKKA1 ,
    KNSKKA2 ,
    KNSKKA2KBN ,
    IRIKBN ,
    KSKTKBN ,
    SECCD ,
    BKFKKBN ,
    SMPCD ,
    YSNLBL ,
    SKFLG ,
    TSKFLG ,
    TKTFLG ,
    FKHKKNOHJKBN ,
    TBKJNO ,
    TBKJFLG ,
    BTHNO ,
    TSTRFLG ,
    IJKBNM ,
    IJKBNF ,
    IJKBNN ,
    ZSSDINO ,
    TNYRKFLG ,
    YTIKSBR ,
    '' AS YTIKSBR2
FROM
    VDS30201
WHERE
    UTKYMD = '2022-02-16' AND
    IRINO = '00464542600' AND
    KNSGRP = '0719'
ORDER BY
    KNSGRP,
    HYJIJN FOR READ ONLY

Viewを確認
select TEXT from syscat.views where VIEWNAME='VDS30201'

SELECT UNI.INSFLG ,
 UNI.KNSKISYMD ,
 UNI.UTKYMD ,
 UNI.IRINO ,
 UNI.IRIKETFLG ,
 UNI.SRIYMD ,
 UNI.KNTNO ,
 UNI.KNTKETFLG ,
 UNI.KNSGRP ,
 UNI.KMKCD ,
 UNI.KNSSU ,
 UNI.KNSSUEDA ,
 UNI.IRIHSMKBN ,
 UNI.ZRCD ,
 UNI.KJNO ,
 UNI.KNSSEQ ,
 UNI.KNSKKA ,
 UNI.KKACMT1 ,
 UNI.KKACMT2 ,
 UNI.SKKKA ,
 UNI.RAWDATA ,
 UNI.NBKMKCD ,
 UNI.KKIRILOTNO ,
 UNI.KNSFLG ,
 UNI.RENJICFLG ,
 UNI.SOUKN1FLG ,
 UNI.KANRENFLG ,
 UNI.BUNKKUFLG ,
 UNI.KESSEIFLG ,
 UNI.RIREKIFLG ,
 UNI.SYOUGOFLG ,
 UNI.KEISANFLG ,
 UNI.PER100FLG ,
 UNI.TOUSEKFLG ,
 UNI.KISYAKFLG ,
 UNI.KOUSEIFLG ,
 UNI.SYOUNGFLG ,
 UNI.SOUKN2FLG ,
 UNI.FUKAPTFLG ,
 UNI.NBDOLBL ,
 UNI.YKDOLBL ,
 UNI.ETCLBL ,
 UNI.PNCRGFLG ,
 UNI.KNSPNCRGFLG ,
 UNI.JISKSBR ,
 UNI.KKFLG ,
 UNI.KKIRIFLG ,
 UNI.KKAHSKCD ,
 KNJ.SC ,
 KNJ.TJ ,
 KNJ.SBTKBN ,
 KZK.TNTME ,
 KZK.TNRYO ,
 KNJ.SSTCD ,
 UNI.TRID ,
 UNI.TRPOS ,
 UNI.ASYRCKID ,
 UNI.ASYRCKPOS ,
 UNI.OYAKMKCD ,
 UNI.IRIKBN ,
 UNI.KSKTKBN ,
 UNI.SECCD ,
 UNI.BKFKKBN ,
 UNI.SMPCD ,
 UNI.YSNLBL ,
 UNI.SKFLG ,
 UNI.TSKFLG ,
 UNI.TKTFLG ,
 UNI.KNSKKA1 ,
 UNI.KNSKKA2 ,
 UNI.KNSKKA2KBN ,
 UNI.FKHKKNOHJKBN ,
 UNI.TBKJNO ,
 UNI.TBKJFLG ,
 UNI.BTHNO ,
 UNI.IJKBNM ,
 UNI.IJKBNF ,
 UNI.IJKBNN ,
 UNI.ZSSDINO ,
 UNI.TNYRKFLG ,
 KGM.KNSGRPRS ,
 KMM.KMKRSJ ,
 KMM.KMKRS ,
 KMM.HYJIJN ,
 KMM.TSTRFLG ,
 UNI.YTIKSBR FROM ( ( SELECT  (CASE KKA.KNSFLG WHEN 'E' THEN '2' Else '0' END) AS INSFLG ,
 KKA.KNSKISYMD ,
 KKA.UTKYMD ,
 KKA.IRINO ,
 KKA.IRIKETFLG ,
 KKA.SRIYMD ,
 KKA.KNTNO ,
 KKA.KNTKETFLG ,
 KKA.KNSGRP ,
 KKA.KMKCD ,
 KKA.KNSSU ,
 KKA.KNSSUEDA ,
 KKA.IRIHSMKBN ,
 COALESCE(IRI.STSRCD,'') AS ZRCD ,
 KKA.KJNO ,
 KKA.KNSSEQ ,
 KKA.HJKKA AS KNSKKA ,
 KKA.KKACMT1 AS KKACMT1 ,
 KKA.KKACMT2 AS KKACMT2 ,
 KKA.SKKKA AS SKKKA ,
 KKA.RAWDATA AS RAWDATA ,
 KKA.NBKMKCD AS NBKMKCD ,
 KKA.KKIRILOTNO ,
 KKA.KNSFLG ,
 KKA.RENJICFLG ,
 KKA.SOUKN1FLG ,
 KKA.KANRENFLG ,
 KKA.BUNKKUFLG ,
 KKA.KESSEIFLG ,
 KKA.RIREKIFLG ,
 KKA.SYOUGOFLG ,
 KKA.KEISANFLG ,
 KKA.PER100FLG ,
 KKA.TOUSEKFLG ,
 KKA.KISYAKFLG ,
 KKA.KOUSEIFLG ,
 KKA.SYOUNGFLG ,
 KKA.SOUKN2FLG ,
 KKA.FUKAPTFLG ,
 KKA.NBDOLBL ,
 KKA.YKDOLBL ,
 KKA.ETCLBL ,
 KKA.PNCRGFLG ,
 KKA.KNSPNCRGFLG ,
 KKA.JISKSBR ,
 KKA.KKFLG ,
 KKA.KKIRIFLG ,
 KKA.TRID ,
 KKA.TRPOS ,
 KKA.ASYRCKID ,
 KKA.ASYRCKPOS ,
 KKA.OYAKMKCD ,
 COALESCE(HSK.KKAHSKCD, '') AS KKAHSKCD ,
 KKA.IRIKBN ,
 KKA.KSKTKBN ,
 KKA.SECCD ,
 KKA.BKFKKBN ,
 KKA.SMPCD ,
 KKA.YSNLBL ,
 KKA.SKFLG ,
 KKA.TSKFLG ,
 KKA.TKTFLG ,
 KKA.KNSKKA1 ,
 KKA.KNSKKA2 ,
 KKA.KNSKKA2KBN ,
 KKA.FKHKKNOHJKBN ,
 KKA.TBKJNO ,
 KKA.TBKJFLG ,
 KKA.BTHNO ,
 KKA.IJKBNM ,
 KKA.IJKBNF ,
 KKA.IJKBNN ,
 KKA.ZSSDINO ,
 KKA.TNYRKFLG ,
 IRI.YTIKSBR FROM KEKKA AS KKA 
LEFT OUTER JOIN IRAI AS IRI ON KKA.UTKYMD = IRI.UTKYMD AND
 KKA.IRINO = IRI.IRINO AND
 KKA.ZSSDINO = IRI.ZSSDINO AND
 KKA.KNSGRP = IRI.KNSGRP AND
 KKA.KMKCD = IRI.KMKCD 
LEFT OUTER JOIN KKAHSKMST AS HSK ON HSK.KKAHSKCD = KKA.KKAHSKCD AND
 CURRENT DATE BETWEEN KAIYMD AND
 HAIYMD WHERE KKA.KNSFLG != 'M' AND
 KKA.KKAYSNFLG = '1' AND
 KKA.SIYFLG = '1' AND
 KKA.KKAJKCD <> ' ' AND
 KKA.KNSSUEDA < 9000 ) 
 UNION ALL ( SELECT '1' AS INSFLG ,
 ODR.KNSKISYMD AS KNSKISYMD ,
 IRI.UTKYMD ,
 IRI.IRINO ,
 IRI.IRIKETFLG ,
 IRI.SRIYMD ,
 COALESCE(ODR.KNTNO, '') AS KNTNO ,
 COALESCE(ODR.KNTKETFLG, '') AS KNTKETFLG ,
 IRI.KNSGRP ,
 IRI.KMKCD ,
 0 AS KNSSU ,
 COALESCE(ODR.KNSSUEDA, 0) AS KNSSUEDA ,
 IRI.IRIHSMKBN ,
 COALESCE(IRI.STSRCD, '') AS ZRCD ,
 IRI.KJNO ,
 COALESCE(ODR.KNSSEQ, 0) AS KNSSEQ ,
 '' AS KNSKKA ,
 '' AS KKACMT1 ,
 '' AS KKACMT2 ,
 '' AS SKKKA ,
 '' AS RAWDATA ,
 '' AS NBKMKCD ,
 IRI.KKIRILOTNO ,
 '' AS KNSFLG ,
 '0' AS RENJICFLG ,
 '0' AS SOUKN1FLG ,
 '0' AS KANRENFLG ,
 '0' AS BUNKKUFLG ,
 '0' AS KESSEIFLG ,
 '0' AS RIREKIFLG ,
 '0' AS SYOUGOFLG ,
 '0' AS KEISANFLG ,
 '0' AS PER100FLG ,
 '0' AS TOUSEKFLG ,
 '0' AS KISYAKFLG ,
 '0' AS KOUSEIFLG ,
 '0' AS SYOUNGFLG ,
 '0' AS SOUKN2FLG ,
 '0' AS FUKAPTFLG ,
 '0' AS NBDOLBL ,
 '0' AS YKDOLBL ,
 '0' AS ETCLBL ,
 '0' AS PNCRGFLG ,
 '0' AS KNSPNCRGFLG ,
 IRI.JISKSBR AS JISKSBR ,
 COALESCE(ODR.KKFLG, '') AS KKFLG ,
 IRI.KKIRIFLG ,
 COALESCE(ODR.TRID, '') AS TRID ,
 COALESCE(ODR.TRPOS, 0) AS TRPOS ,
 COALESCE(ODR.ASYRCKID, '') AS ASYRCKID ,
 COALESCE(ODR.ASYRCKPOS, 0) AS ASYRCKPOS ,
 IRI.OYAKMKCD ,
 '' AS KKAHSKCD ,
 IRI.IRIKBN ,
 IRI.KSKTKBN ,
 IRI.SECCD ,
 IRI.BKFKKBN ,
 IRI.SMPCD ,
 IRI.YSNLBL ,
 IRI.SKFLG ,
 IRI.TSKFLG ,
 IRI.TKTFLG ,
 '' AS KNSKKA1 ,
 '' AS KNSKKA2 ,
 '' AS KNSKKA2KBN ,
 COALESCE(ODR.FKHKKNOHJKBN, '') AS FKHKKNOHJKBN ,
 COALESCE(ODR.TBKJNO, '') AS TBKJNO ,
 COALESCE(ODR.TBKJFLG, '') AS TBKJFLG ,
 COALESCE(ODR.BTHNO, 0) AS BTHNO ,
 '' AS IJKBNM ,
 '' AS IJKBNF ,
 '' AS IJKBNN ,
 IRI.ZSSDINO ,
 '' AS TNYRKFLG ,
 IRI.YTIKSBR FROM ( SELECT IRI.UTKYMD ,
 IRI.IRINO ,
 IRI.IRIKETFLG ,
 IRI.SRIYMD ,
 IRI.KNTNO ,
 IRI.KNTKETFLG ,
 IRI.KNSGRP ,
 IRI.KMKCD ,
 IRI.KNSSU ,
 IRI.IRIHSMKBN ,
 IRI.STSRCD ,
 IRI.KJNO ,
 IRI.KKIRILOTNO ,
 IRI.YTIKSBR AS JISKSBR ,
 IRI.KKIRIFLG ,
 IRI.ZSSDINO ,
 IRI.OYAKMKCD ,
 IRI.IRIKBN ,
 IRI.KSKTKBN ,
 IRI.SECCD ,
 IRI.BKFKKBN ,
 IRI.SMPCD ,
 IRI.YSNLBL ,
 IRI.SKFLG ,
 IRI.TSKFLG ,
 IRI.TKTFLG ,
 IRI.YTIKSBR FROM IRAI IRI ) AS IRI 
LEFT OUTER JOIN KENORDER ODR ON ODR.UTKYMD = IRI.UTKYMD AND
 ODR.IRINO = IRI.IRINO AND
 ODR.ZSSDINO = IRI.ZSSDINO AND
 ODR.KNSGRP = IRI.KNSGRP AND
 ODR.KMKCD = IRI.KMKCD AND
 ODR.KNSSUEDA < 9000 AND
 ODR.KNSSU = 1 WHERE NOT EXISTS ( SELECT * FROM KEKKA WHERE ODR.KNSKISYMD = KEKKA.KNSKISYMD AND
 IRI.SRIYMD = KEKKA.SRIYMD AND
 ODR.KNTNO = KEKKA.KNTNO AND
 IRI.KNSGRP = KEKKA.KNSGRP AND
 IRI.KMKCD = KEKKA.KMKCD AND
 KEKKA.KNSFLG != 'M' ) )) AS UNI ,
 KNSGMST		KGM ,
 KMKMST		KMM ,
 VCMNKANJYA	KNJ ,
 VCMNKENZOK	KZK WHERE KGM.KNSGRP = UNI.KNSGRP AND
 KGM.KAIYMD <= UNI.KNSKISYMD AND
 KGM.HAIYMD >= UNI.KNSKISYMD AND
 UNI.KNSGRP = KMM.KNSGRP AND
 UNI.KMKCD = KMM.KMKCD AND
 KMM.KAIYMD <= UNI.KNSKISYMD AND
 KMM.HAIYMD >= UNI.KNSKISYMD AND
 KNJ.UTKYMD = UNI.UTKYMD AND
 KNJ.IRINO = UNI.IRINO AND
 KZK.UTKYMD = UNI.UTKYMD AND
 KZK.IRINO = UNI.IRINO AND
 KZK.KNTNO = UNI.KNTNO AND
 KZK.SRIYMD = UNI.SRIYMD and
 UNI.UTKYMD = '2022-02-16' AND
 UNI.IRINO = '00464542600' AND
 UNI.KNSGRP = '0719'

CSEでバックアップ
select *  from kekka where  UTKYMD = '2022-02-16' AND IRINO = '00464542600' AND KNSGRP = '0719'
定義書を確認。羽生主事に相談した結果、下記の内容で更新。
select irino,knssu,KNSFLG,kmkcd,KKAYSNFLG,SIYFLG,KKAJKCD,KNSSUEDA  from kekka where  UTKYMD = '2022-02-16' AND IRINO = '00464542600' AND KNSGRP = '0719' and kmkcd='0900001' and knssu='0'
update kekka set knsflg='S',KKAYSNFLG = '1',SIYFLG = '1' where  UTKYMD = '2022-02-16' AND IRINO = '00464542600' AND KNSGRP = '0719' and kmkcd='0900001' and knssu='0'

依頼書NO単位結果入力画面に表示されたことを確認し現場へ連絡。


--------------------------------------------------------------------
232：小林 洋一; 総研検査システム２課
2022年02月20日（日） 06:57

問い合わせ者　横田課長　対応時間　10分

------------------------------------------------------------
20220219,"00055231100","0006720"

上記、測定結果のフラグがおかしい検体があります。
（ 検査フラグ M、結果状況コード 3 ）
------------------------------------------------------------

■未報告リストを出力しようとしたところ「システムに連絡してください」のエラーが表示される

過去の対応履歴より下記を実施。
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=173#follow

下記をCSEでCtrl+Shift+Enterでバックアップ
select * from kekka where utkymd='2022-02-19' and irino='00055231100' and kmkcd='0006720' and knsflg='M'
検査フラグ'M'のレコードの検査結果状況コードを１に更新
update kekka  set kkajkcd='1'  where utkymd='2022-02-19' and irino='00055231100' and kmkcd='0006720' and knsflg='M'

フラグリセット→再計算→ホスト報告の操作を依頼。


--------------------------------------------------------------------
233：清水 竜也; 総研検査システム１課
2022年02月21日（月） 18:51

アラートメールあり、対応　 対応時間　15分。なお、海老島さんからもTEL連絡あり
---
20220219,"00171276000","0000437"

上記、測定結果のフラグがおかしい検体があります。
（ 検査フラグ M、結果状況コード 3 ）
---

→上記の依頼についてホスト確認したところ、検出不可(*339)が「修」マーク付きで入っていた。
→ケミには結果が３件あり。

海老島さん曰く、ケミから送信したら数値側のデータがホストにいってしまったので
ホスト上で修正入力したとのこと。ケミストリー内を報告済みで決着したいとのこと。

select kmkcd, hjkka, knssu, knsflg, kkajkcd 
from kekka where utkymd='2022-02-19'  and irino='00171276000' and kmkcd='0000437'   
for read only with ur

KMKCD	HJKKA	KNSSU	KNSFLG	KKAJKCD
0000437	*339                    	1	S	3
0000437	514                     	2	M	1
0000437	*339                    	4	M	3

kekka を念のため、全件バックアップ。

検査回数４回目を中間結果(kkajkcd='1')に、
　　　　１回目を報告済み(knsflg='E')に、以下のsqlでそれぞれupdateした。

update  kekka  set kkajkcd='1'
where utkymd='2022-02-19'  and irino='00171276000' and kmkcd='0000437'  and knssu=4 

update  kekka  set knsflg='E'
where utkymd='2022-02-19'  and irino='00171276000' and kmkcd='0000437'  and knssu=1 

更新後：
KMKCD	HJKKA	KNSSU	KNSFLG	KKAJKCD
0000437	*339                    	1	E	3
0000437	514                     	2	M	1
0000437	*339                    	4	M	1

--------------------------------------------------------------------
234：小林 洋一; 総研検査システム２課
2022年03月02日（水） 09:52

問合者=自動分析課菅野様,対応時間(分)=10
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=54#follow

食塩摂取量3:再計算待ちから変わらないので対応してもらいたい。
受日:2022-02-24
依頼書NO:0373683

下記SQLを実行し対応。
select * from HKHRIRAI where hkkhrkbn='3'

select * from HKHRIRAI where hkkhrkbn='3' and irino='00037368300'
UTKYMD	IRINO	KNSGRP	KMKCD	HKKHRKBN	HKKHRCMT	KSNDH	TRKDH
2022-02-24	00037368300	0003    	0013094	3	                                                                	2022-02-28 13:19:09.048754	2022-02-25 04:36:26.444481

update HKHRIRAI set hkkhrkbn='0' where hkkhrkbn='3' and irino='00037368300'




--------------------------------------------------------------------
235：羽生 達哉; 総研検査システム２課
2022年03月10日（木） 13:07

問い合わせ者　ケミストリーイズミさん　　対応時間　30分

問合せ内容：
FABPの抜き取りリストが、プリンターエラーのため出力できなかった。
再出力して欲しい。

調査・対応：
/apdata/today/online/host/ok_Recv/lst_smplst.txt_20220300851を
ftpでファイルを取得しＰＣで印刷。
横位置が多少ずれるが気にしないように伝えた。

プリンタの修理依頼をしているそうなので明日以降は大丈夫だと思うが、
また、プリンターエラーで出力できなかったら連絡してもらうように伝えた。

リスト自体はCronで３分おきに作成チェックをしている。
/home/kea00sys/shell/cron/SmpLst/pri_smplst.sh

処理済みファイル
/apdata/today/online/host/ok_Recv/smplst.sumi
を消せば再作成されると思う。


--------------------------------------------------------------------
236：小林 洋一; 総研検査システム２課
2022年03月14日（月） 16:07

問合者=自動分析課金山様,対応時間(分)=10
https://bmlgrp.cybozu.com/g/message/view.csp?cid=5218&rid=116873&mid=657153&follow_id=54#follow

コッククロフト3:再計算待ちから変わらないので対応してもらいたい。
受日:2022-03-10
依頼:15件
下記SQLを実行し対応。
select * from HKHRIRAI where hkkhrkbn='3'
update HKHRIRAI set hkkhrkbn='0' where hkkhrkbn='3'



--------------------------------------------------------------------
237：上原 洋樹; 総研検査システム２課
2022年03月15日（火） 20:55

問い合わせ者　ケミストリー 青木さん
問合せ内容：
FABPの抜き取りリストが、プリンターエラーのため出力できなかった。再出力して欲しい。
3/10以降リストが出力されていないとの事。
↓
3/10(木)羽生主事の対応を参考に対応
https://bmlgrp.cybozu.com/g/message/view.csp?cid=23427&rid=98632&mid=657153&follow_id=235#follow

調査・対応：
/apdata/today/online/host/ok_Recv/lst_smplst.txt_20220300851を
ftpでファイルを取得しＰＣで印刷してお渡しした。

・プリンタジョブの確認→ジョブが滞留している
kea00sys@kea00apa:~> lpstat -t
スケジューラーは動作中です
システムのデフォルトの宛先がありません
prt01 のデバイス: lpd://KEA00PRT01/lpd
prt01 は 2022年03月10日 10時13分42秒 からリクエストを受け付けています
プリンター prt01 は 2022年03月10日 10時13分42秒 から無効です -
        プリンターが応答しません。
prt01-818               kea00sys          2048   2022年03月10日 09時06分35秒
prt01-819               kea00sys          2048   2022年03月10日 09時24分26秒
prt01-820               kea00sys          2048   2022年03月10日 09時25分41秒
prt01-821               kea00sys          2048   2022年03月10日 09時27分23秒
prt01-822               kea00sys          2048   2022年03月11日 08時12分06秒
prt01-823               kea00sys          2048   2022年03月12日 08時15分12秒
prt01-824               kea00sys          2048   2022年03月12日 09時00分31秒
prt01-825               kea00sys          2048   2022年03月12日 09時01分20秒
prt01-826               kea00sys          2048   2022年03月12日 09時01分54秒
prt01-827               kea00sys          2048   2022年03月13日 07時48分07秒
prt01-828               kea00sys          2048   2022年03月15日 08時45分14秒

・プリンタのネットワーク応答は有り
kea00sys@kea00apa:~> ping 10.1.181.111
PING 10.1.181.111 (10.1.181.111) 56(84) bytes of data.
64 bytes from 10.1.181.111: icmp_seq=1 ttl=254 time=2.52 ms

・他のWindows端末からは印刷可能との事だった。


対策：
血清フロンティアでも同事象が発生しており、参考に以下手順により復旧と対策を実施。

①プリンタの有効化とジョブの再実行
kea00sys@kea00apa:~> su
pX?[h:
kea00apa:/home/kea00sys # lpadmin -p prt01 -E
kea00apa:/home/kea00sys # lp^C
kea00apa:/home/kea00sys # lpstat -t
スケジューラーは動作中です
システムのデフォルトの宛先がありません
prt01 のデバイス: lpd://KEA00PRT01/lpd
prt01 は 2022年03月15日 20時36分18秒 からリクエストを受け付けています
プリンター prt01 は待機中です。2022年03月15日 20時36分18秒 以来有効です
⇒プリンタが待機中に変移。ジョブが無くなった事を確認

②プリンタ無効化の無効化
・/etc/cups/printers.conf 内のプリンター設定にて
　「ErrorPolicy stop-printer」を「ErrorPolicy retry-job」に変更
・プリンタサービスの再起動
　systemctl restart cups.service

＜参考＞以下フロンティアの対応を参考
・プリンタ有効化
https://bmlgrp.cybozu.com/g/message/view.csp?cid=4918&rid=48294&mid=231795&follow_id=199#follow
・プリンタ無効化の無効化
https://bmlgrp.cybozu.com/g/message/view.csp?cid=4918&rid=48294&mid=231795&follow_id=178#follow

--------------------------------------------------------------------
239：羽生 達哉; 総研検査システム２課
2022年03月17日（木） 14:01

>202と同様
リソースチェックでDisk容量閾値超えを検知。

■作業前
/apdata/today/file/KEA00/KEA00IAW02　90%
/apdata/today/file/KEA00/KEA00IAW21　16%

■2021年分を移動
mv /apdata/today/file/KEA00/KEA00IAW02/bak_daily/2021-* ../../KEA00IAW21/bak_daily/
mv /apdata/today/file/KEA00/KEA00IAW02/bak_daily/2022-* ../../KEA00IAW21/bak_daily/

■作業後
/apdata/today/file/KEA00/KEA00IAW02　45%
/apdata/today/file/KEA00/KEA00IAW21　23%


日次終了チェックのスクリプト(~/shell/cron/chk_daily_end.sh)で日次データのコピー先を
KEA00IAW02からKEA00IAW21へ変更

---------------------- chk_daily_end.sh --------------------------------------------
# バックアップ先設定追加(nfs で mount しているディレクトリ）
BKUP_PATH2="/apdata/today/file/KEA00/KEA00IAW02/bak_daily/"
↓
BKUP_PATH2="/apdata/today/file/KEA00/KEA00IAW21/bak_daily/"
---------------------------------------------------------------------------------------

※KEA00IAW21のDisk使用量は１ヶ月分で2%程度増加する。
　古いデータの削除は特にしていないので、空き容量が不足してきたら２年前の日付を目安に削除を推奨。

--------------------------------------------------------------------
240：羽生 達哉; 総研検査システム２課
2022年03月18日（金） 17:52

>>239
3/16分のバックアップファイルがKEA00IAW21へコピーできていることが
確認できたので、とりあえずこれで様子見。

--------------------------------------------------------------------
241：清水 竜也; 総研検査システム１課
2022年03月24日（木） 17:53

アラートメール対応　対応時間　20分

2022年3月24日(木) 7:11 <kensys@bml.co.jp>:

    20220323,"00252408800","0000421"
    20220323,"00252408800","0000423"
    20220323,"00252408800","0000425"

    上記、測定結果のフラグがおかしい検体があります。
    （ 検査フラグ M、結果状況コード 3 ）


夜間管理で入っていた藤本課長と連絡取れ、データ問題なしとのことで
検査フラグを完了の E に更新しました。　項目は、電解質の3項目。
--
select * from kekka 
where utkymd='2022-03-23' and irino='00252408800' and kmkcd in('0000421','0000423','0000425') and KKAJKCD='3'  

--update kekka set  knsflg='E'
--where utkymd='2022-03-23' and irino='00252408800' and kmkcd in('0000421','0000423','0000425') and KKAJKCD='3' and knsflg='M' 

清水


20220323uke.xlsx

--------------------------------------------------------------------
242：清水 竜也; 総研検査システム１課
2022年03月25日（金） 17:54

メール問い合せ　ケミストリー 海老島さん

--
調査依頼
差出人 	 ："海老島 和雄" <kazuo_ebishima@bml.co.jp> 
送信日時 	 ：2022年03月25日（金） 12:25
To   	 ：  	"清水 竜也" <shimizu@bml.co.jp>

    試料１.pdf 試料2.pdf 

清水主任

お疲れ様です。

夜勤者より再検になった理由の調査依頼を頼まれました。

初回はLABOSPECT008K 1号機で測定(患者マスキングのため測定されず)。
そのため、BM23号機にて測定を実施したら、TP、ALBが再検になったとのことです。
(添付した試料１、２を参照してください)
マスタ更新等で何かやってませんか。とのことです。

よろしくお願いいたします。

ケミストリー
海老島

--
 Re: 調査依頼
差出人 	 ："清水竜也" <shimizu@bml.co.jp> 
送信日時 	 ：2022年03月25日（金） 17:40
To   	 ：  	"海老島 和雄" <kazuo_ebishima@bml.co.jp>
Cc （5件） ："横田 克夫" <k-yokota@bml.co.jp>, "上原 洋樹" <hiro-ue@bml.co.jp>, "藤本 丈志" <takeshi-f@bml.co.jp>, "辻 祐輝" <yuki_tsuji@bml.co.jp>, "菅野 隆" <takashi-s@bml.co.jp> 

    TP_ALB_相関エラー1ran.xlsx 

海老島様

お疲れ様です。清水です。

確認したいことあり何度か電話したのですが話中だったため、メールにてご報告します。

頂いた資料とデータを突合せ確認しました。

マスキングと言われる場合、測定結果が恐らく空白で入って来るのだろうと思います。
その場合に、従来からあるTP、ALBの逆転チェック（システム上は相関マスター）にて
結果が空白のため、TP、ALBともにゼロ扱いで(TP=ALB)となり、
TP>ALB の関係から外れたことで相関エラーに。

W/S=054で、相関エラーとなったデータを抽出し一覧を添付しておりますが
頂いた照合NGリストをほぼ一致しますので、これで間違いないかと思います。

これに関係するマスター更新としては、社内メール側の
「【ケミストリー：マスター】TP、ALB(BCP改良) の相関について」で
3/15に、TP(401)と BCP改良型のALB(417)についても TP> ALB の設定を入れています。
https://bmlgrp.cybozu.com/g/message/view.csp?cid=2130&rid=147432&mid=745780

ですので、こちらのコード(401,417)についても、今後同様の動きをとります。

以上となりますが、この内容で海老島さんの認識と符合する場合は
夜勤の方々へご周知くださるようよろしくお願いいたします。
異なる場合は、お手数ですが再度ご一報ください。

清水


試料１L.pdf
試料2.pdf
TP_ALB_相関エラー1ran.xlsx

--------------------------------------------------------------------
243：小林 洋一; 総研検査システム２課
2022年04月05日（火） 14:48

問い合わせ者:自動分析課藤本課長 30分
受付日:2022-04-04
依頼書NO:4148391
のALB前、A/G比前がラボで測定しているが
ケミストリーサテライトにも依頼が入ってきている。
→基幹のデータを確認。
select * from v_keka where utkymd='2022-04-04' and irino='00414839100'
検査実施ラボコード031
ラボ検査マスタを確認
select * from m_lbkns where lbcd='031' order by kmkcd
1780,1797が無いことを確認。
→ラボ検査システム課井戸端さんへ連絡→営業へ連絡
本日登録を実施し明日反映予定。
明日もケミストリにはラボ検査分の依頼が入ってきますが無視してくださいと連絡しました。
　

--------------------------------------------------------------------
244：羽生 達哉; 総研検査システム２課
2022年04月11日（月） 10:45

問い合わせ者:自動分析課竹澤さん 対応時間:120分

問合せ内容：1SIN0111のトレーを前読み装置にかけたが、オーダーが送信されず検査ができない。
ラックＩＤ55003が既に登録済みとなってしまっている。

対応内容：
ログ確認：MD103_20220410.log
2022/04/10   06:44:24        E       kea00apa        30065   kea00sys        MD103   MD103.c
641             00000000        該当のアッセイラックはすでに登録済みです。[55003]

ＤＢ確認
select * from BUNCHU where ASYRCKID = '55003' for read only 

UTKYMD	IRINO	IRIKETFLG	ZSSDINO	SRIYMD	KNTNO	KNTKETFLG	SMPCD	KMKCD	SMPCDITNO	CHKMJ	TRID	TRPOS	ASYRCKID	ASYRCKPOS	ID2	ID2POS	SBTKBN	AGE	AGEKBN	TNTME	TNTNI	TNRYO	TNRYOTNI	SSTCD	ECD	BCKID	JTFLG	KNSSYR	TKNFLG	TTKKFLG	BNCKKA	SRTKEY	KSNDH	TRKDH
2022-04-09	00458099600	 	0	2022-04-09	00458099601  	 	0006   	0013585	0	ｶﾜ  	____0000  	0	55003     	1	SSSS3207  	45	0	 92	Y	    	0	     	0	7863200	580	A20	 	1	 	 	0	40	2022-04-10 06:30:01.127647	2022-04-10 06:25:12.975187
2022-04-09	00458001800	 	0	2022-04-09	00458001801  	 	0006   	0005276	0	ｱﾐ  	____0000  	0	55003     	2	SSSS3207  	42	0	 80	Y	    	0	     	0	7863200	580	A20	 	1	 	 	0	40	2022-04-10 06:30:01.126945	2022-04-10 06:25:12.989892
2022-04-09	00303601100	 	0	2022-04-09	00303601111  	 	0006   	0005276	0	ﾌｴ  	____0000  	0	55003     	3	SSSS3210  	5	1	 77	Y	    	0	     	0	3629001	140	A20	 	1	 	 	0	40	2022-04-10 06:30:01.189912	2022-04-10 06:25:12.994455
2022-04-09	00303601100	 	0	2022-04-09	00303601111  	 	0006   	0012120	0	ﾌｴ  	____0000  	0	55003     	3	SSSS3210  	5	1	 77	Y	    	0	     	0	3629001	140	A20	 	1	 	 	0	40	2022-04-10 06:30:01.189912	2022-04-10 06:25:12.997256
2022-04-09	00303657300	 	0	2022-04-09	00303657311  	 	0006   	0000802	0	ｴｷ  	____0000  	0	55003     	4	SSSS3210  	36	1	 52	Y	    	0	     	0	4186000	160	A20	 	1	 	 	0	40	2022-04-10 06:30:01.198504	2022-04-10 06:25:13.002546
2022-04-09	00303661100	 	0	2022-04-09	00303661111  	 	0006   	0003511	0	ｷﾇ  	____0000  	0	55003     	5	SSSS3226  	41	0	 57	Y	    	0	     	0	7496600	140	A20	 	1	 	 	0	40	2022-04-10 06:35:00.401176	2022-04-10 06:25:13.007804

select * from KENORDER where ASYRCKID = '55003' for read only 

KNSKISYMD	SRIYMD	KNTNO	KNTKETFLG	KNSGRP	KMKCD	KNSSU	KNSSUEDA	IRIHSMKBN	IRIKBN	KSKTKBN	UTKYMD	IRINO	IRIKETFLG	ZSSDINO	SSTCD	TRID	TRPOS	ASYRCKID	ASYRCKPOS	OYAKMKCD	SECCD	BKFKKBN	SMPCD	BSKKBN	NBKMKCD	ZRCD	YSNLBL	KJNO	FKHKKNOHJKBN	TBKJNO	TBKJFLG	HTKFKHMS	SKFLG	TSKFLG	TKTFLG	YTIKSBR	KKFLG	KKIRIFLG	KKIRILOTNO	SC	TJ	TJTNI	SBTKBN	BIRTHDAY	BIRTHDAYKBN	AGE	AGEKBN	SSTME	SSYMD	TNTME	TNTNI	TNRYO	TNRYOTNI	KNSSEQ	BTHNO	KNSJKFLG	KSNDH
2022-04-09	2022-04-09	00006575003  	 	0054            	0000421	2	0	0	A	K	2022-04-09	00006575000	 	0	4420600	2MLT0023  	1	55003     	1	0000421	A 	0	0054   	    	       	023 	00	001	 	   	 	　　　　　　　　　　　　	0	  	  	1              	0	0	0	     	     	0	0	  151215	S	 81	Y	00:00:01	1000-01-01	    	0	     	0	501001	0	1	2022-04-10 06:16:13.066947
2022-04-09	2022-04-09	00006575003  	 	0054            	0000423	2	0	0	A	K	2022-04-09	00006575000	 	0	4420600	2MLT0023  	1	55003     	1	0000423	A 	0	0054   	    	       	023 	00	001	 	   	 	　　　　　　　　　　　　	0	  	  	1              	0	0	0	     	     	0	0	  151215	S	 81	Y	00:00:01	1000-01-01	    	0	     	0	501001	0	1	2022-04-10 06:16:13.066947
2022-04-09	2022-04-09	00006575003  	 	0054            	0000425	2	0	0	A	K	2022-04-09	00006575000	 	0	4420600	2MLT0023  	1	55003     	1	0000425	A 	0	0054   	    	       	023 	00	001	 	   	 	　　　　　　　　　　　　	0	  	  	1              	0	0	0	     	     	0	0	  151215	S	 81	Y	00:00:01	1000-01-01	    	0	     	0	501001	0	1	2022-04-10 06:16:13.066947
2022-04-09	2022-04-09	00458099601  	 	0006            	0013585	1	0	0	A	A	2022-04-09	00458099600	 	0	7863200	____0000  	0	55003     	1	0013585	A 	0	0006   	    	       	023 	00	001	 	   	 	　　　　　　　　　　　　	 	  	ｶ 	1              	 	 	0	     	     	0	0	        	 	 92	Y	00:00:01	1000-01-01	    	0	     	0	0	0	 	2022-04-10 06:25:12.980270
2022-04-09	2022-04-09	00458001801  	 	0006            	0005276	1	0	0	A	A	2022-04-09	00458001800	 	0	7863200	____0000  	0	55003     	2	0005276	A 	0	0006   	    	       	023 	00	004	 	   	 	　　　　　　　　　　　　	 	  	ｶ 	1              	 	 	0	     	     	0	0	        	 	 80	Y	00:00:01	1000-01-01	    	0	     	0	0	0	 	2022-04-10 06:25:12.990310
2022-04-09	2022-04-09	00303601111  	 	0006            	0005276	1	0	0	A	A	2022-04-09	00303601100	 	0	3629001	____0000  	0	55003     	3	0005276	A 	0	0006   	    	       	023 	00	004	 	   	 	　　　　　　　　　　　　	 	  	  	1              	 	 	0	     	     	0	1	  190909	S	 77	Y	00:00:01	2022-04-09	    	0	     	0	0	0	 	2022-04-10 06:25:12.994822
2022-04-09	2022-04-09	00303601111  	 	0006            	0012120	1	0	0	A	A	2022-04-09	00303601100	 	0	3629001	____0000  	0	55003     	3	0012120	A 	0	0006   	    	       	023 	00	001	 	   	 	　　　　　　　　　　　　	 	  	  	1              	 	 	0	     	     	0	1	  190909	S	 77	Y	00:00:01	2022-04-09	    	0	     	0	0	0	 	2022-04-10 06:25:12.997612
2022-04-09	2022-04-09	00303657311  	 	0006            	0000802	1	0	0	A	A	2022-04-09	00303657300	 	0	4186000	____0000  	0	55003     	4	0000802	A 	0	0006   	    	       	023 	00	009	 	   	 	　　　　　　　　　　　　	 	  	  	1              	 	 	0	     	     	0	1	  450402	S	 52	Y	00:00:01	2022-04-09	    	0	     	0	0	0	 	2022-04-10 06:25:13.002905
2022-04-09	2022-04-09	00303661111  	 	0006            	0003511	1	0	0	A	A	2022-04-09	00303661100	 	0	7496600	____0000  	0	55003     	5	0003511	A 	0	0006   	    	       	023 	00	004	 	   	 	　　　　　　　　　　　　	 	  	  	1              	 	 	0	     	     	0	0	        	 	 57	Y	00:00:01	2022-04-09	    	0	     	0	0	0	 	2022-04-10 06:25:13.008161

2MLT0023のポジション１でラックＩＤ55003が既に使用されていた。

当日の対応：
前読み装置で1SIN0111の登録をリセット。
1SIN0111から55003のラックを取り除いて再度前読み装置で登録。
55003のラックの検体は再検にして別ラックで測定してもらった。

検査終了後、55003ラックの検体と1SIN0111の検体数件をホスト画面の結果と
サテライト画面で違いが無いか確認してもらった。

翌日の対応：
検査の方に確認してもらったところ、2MLT0023は再検用に作成したワークシートだった。
検査室に保管してあるラックを使用しているとのことなので、ラックＩＤが重複していると思われる。
再建用ラックを使用する際に注意してもらって、55003のラックがあったら取り除いてもらうようにお願いをした。



--------------------------------------------------------------------
245：羽生 達哉; 総研検査システム２課
2022年04月27日（水） 11:57

問い合わせ者:  対応時間:120分

問合せ内容：WS作成時にエラーが発生し、10連ラベル情報とPOT情報が作られなかった。
復旧して欲しい。

対応内容：検査グループ810のPOT情報と検査グループ3195の10連ラベル情報が作成されていなかった。（検査側で確認）

APサーバー(10.1.42.15)でkea00sysでログイン

kea00sys@kea00apa:~> cd shell
kea00sys@kea00apa:~/shell> ls
Startup            TMP_WSSEQKNRI.msg          db_ruiseki_runstats_all.sh   hulft_ins_log.sh  ntpdate.sh
TMP_FUKUSU.del     add_user.sh                db_toujitsu_runstats.sh      hulft_rec_ng.sh   runstats_ruishu.sh
TMP_FUKUSU.msg     bak                        db_toujitsu_runstats_all.sh  hulft_rec_ok.sh   sendmail
TMP_KNSGMST.del    chkWS.sh                   del_ctrlmst.sh               hulft_start.sh    upd_bchendflg
TMP_KNSGMST.msg    chkWSupd.sql               df.sh                        hulft_stop.sh
TMP_KNTNO.del      cron                       euctosj.sh                   log
TMP_KNTNO.msg      daily                      hulft                        mk_lblfile.sh
TMP_WSSEQKNRI.del  db_master_runstats_all.sh  hulft_dst.sh                 mk_potfile.sh
kea00sys@kea00apa:~/shell>./mk_potfile.sh 2022-04-26 28100001
kea00sys@kea00apa:~/shell>./mk_lblfile.sh 2022-04-26 (3195のトレーID)

で、10連ラベル情報とPOT情報をそれぞれ作成。
ラベルプリンターとPOT-PCで検査の方に作成されたことを確認してもらった。

※情報が作られなかった検査グループは検査側で情報がないものを確認してもらった。
ＰＣのログにはエラー情報などが出力されていなかったので確認できない。
システム側から調査する方法は不明。

--------------------------------------------------------------------
246：横田 克夫; 総研検査システム２課
2022年05月07日（土） 06:58

アラートメール対応　対応時間　20分

差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2022年05月07日（土） 06:45

20220506,"00304246700","0002696"

上記、測定結果のフラグがおかしい検体があります。
（ 検査フラグ M、結果状況コード 3 ）


現場に連絡。担当者（高梨さん）に確認し、データ問題なしで報告されているとのころ。
検査フラグを完了の E に更新しました。

select * from kekka where utkymd='2022-05-06' and irino='00304246700' and kmkcd in('0002696') and KKAJKCD='3'  

update kekka set  knsflg='E' where utkymd='2022-05-06' and irino='00304246700' and kmkcd in('0002696') and KKAJKCD='3' and knsflg='M' 


--------------------------------------------------------------------
247：小林 洋一; 総研検査システム２課
2022年05月11日（水） 16:20

問い合わせ者:自動分析課辻主任 対応時間:30分
青山会PG比抽出リストでエラーが発生しリスト出力できないので対応してほしい。
受日:2022-05-10,依頼書NO:0940039の検体がサンプルショートで結果値空白が入っていた。
空白を数値(DOUBLE)に変えようとしてエラーになっている。
VBAのバックアップを取り、結果値空白を除外するよう修正して対応しました。

\\Kea00clp05\シングル\NEWシングル-01\Excel計算ツール\青山会PG比抽出リスト.xls

修正前
    '■SQL作成
    strSQL = strSQL & "SELECT KKA.UTKYMD,KKA.IRINO,KKA.SSTCD,KKA.SSTRSJ,KKA.HJKKA FROM"
    strSQL = strSQL & " (SELECT"
    strSQL = strSQL & "    KEKKA.UTKYMD,"
    strSQL = strSQL & "    KEKKA.IRINO,"
    strSQL = strSQL & "    KANJYA.SSTCD,"
    strSQL = strSQL & "    KANJYA.SSTRSJ,"
    strSQL = strSQL & "    DOUBLE(KEKKA.HJKKA) AS HJKKA"
    strSQL = strSQL & " FROM"
    strSQL = strSQL & "    KEKKA"
    strSQL = strSQL & "    LEFT JOIN KANJYA KANJYA"
    strSQL = strSQL & "           ON KEKKA.UTKYMD = KANJYA.UTKYMD AND KEKKA.IRINO = KANJYA.IRINO"
    strSQL = strSQL & " WHERE"
    strSQL = strSQL & "    KEKKA.SRIYMD = '"
    strSQL = strSQL & vstrSriYmd
    strSQL = strSQL & "' AND"
    strSQL = strSQL & "    KEKKA.KMKCD IN ('0004125','0021996') AND"
    strSQL = strSQL & "    KEKKA.SSTCD IN ('1808900','2709000','2765300','2765400','4858400','5993700','8285700','9204900','9390700','1549101','2014001') AND"
    strSQL = strSQL & "    KEKKA.KKAJKCD = '3'
    strSQL = strSQL & "  ) KKA"
    strSQL = strSQL & " WHERE KKA.HJKKA >= 2.8 AND KKA.HJKKA <= 3.2 "
    strSQL = strSQL & " ORDER BY"
    strSQL = strSQL & "    KKA.UTKYMD,"
    strSQL = strSQL & "    KKA.IRINO"

修正後
    '■SQL作成
    strSQL = strSQL & "SELECT KKA.UTKYMD,KKA.IRINO,KKA.SSTCD,KKA.SSTRSJ,KKA.HJKKA FROM"
    strSQL = strSQL & " (SELECT"
    strSQL = strSQL & "    KEKKA.UTKYMD,"
    strSQL = strSQL & "    KEKKA.IRINO,"
    strSQL = strSQL & "    KANJYA.SSTCD,"
    strSQL = strSQL & "    KANJYA.SSTRSJ,"
    strSQL = strSQL & "    DOUBLE(KEKKA.HJKKA) AS HJKKA"
    strSQL = strSQL & " FROM"
    strSQL = strSQL & "    KEKKA"
    strSQL = strSQL & "    LEFT JOIN KANJYA KANJYA"
    strSQL = strSQL & "           ON KEKKA.UTKYMD = KANJYA.UTKYMD AND KEKKA.IRINO = KANJYA.IRINO"
    strSQL = strSQL & " WHERE"
    strSQL = strSQL & "    KEKKA.SRIYMD = '"
    strSQL = strSQL & vstrSriYmd
    strSQL = strSQL & "' AND"
    strSQL = strSQL & "    KEKKA.KMKCD IN ('0004125','0021996') AND"
    strSQL = strSQL & "    KEKKA.SSTCD IN ('1808900','2709000','2765300','2765400','4858400','5993700','8285700','9204900','9390700','1549101','2014001') AND"
    strSQL = strSQL & "    KEKKA.KKAJKCD = '3' AND"←★
    strSQL = strSQL & "    TRIM(KEKKA.HJKKA)<>''" ' 20220510 add←★
    strSQL = strSQL & "  ) KKA"
    strSQL = strSQL & " WHERE KKA.HJKKA >= 2.8 AND KKA.HJKKA <= 3.2 "
    strSQL = strSQL & " ORDER BY"
    strSQL = strSQL & "    KKA.UTKYMD,"
    strSQL = strSQL & "    KKA.IRINO"



--------------------------------------------------------------------
248：小林 洋一; 総研検査システム２課
2022年05月20日（金） 13:08

問合者=ケミストリー 青木様(内3223) 　対応時間=10分

■内容
　再検のワークシートを切ろうとしても
　現在ワークシート出力処理が行われています。しばらくお待ちいただき再度実行してください。
　とメッセージが出て、ワークシートが切れない。

■対応

select * from KNSSEQKNRI where knsgrp='KEA00SYS'　　でデータが１行表示された。

ロック的なものでこれがあるとワークシート出力が待ち合わせになるらしく、削除する。

delete from KNSSEQKNRI where knsgrp='KEA00SYS'


--------------------------------------------------------------------
249：横田 克夫; 総研検査システム２課
2022年05月28日（土） 06:44

問合者=エラーメール　対応時間=15分

[2022年 5月 28日 土曜日 06:35:04 JST]マルチ異常報告
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2022年05月28日（土） 06:36
To （2件）  	 ： 	multi_log@bml.co.jp, multi_error@bml.co.jp （←宛先を隠す）

ND101 フロンティアラック登録

上記プロセスが起動していません。確認してください。

→
１．ログを確認。
2022/05/28      06:04:47        T       kea00apa        8795    kea00sys        ND101   ND101.c sFncMakeSkipFile        610             00000000        スキップファイルを出力しました。[FILE_NAME:/apdata/today/file/rack/SKIP/SKIP_20220527_74994.dat]
2022/05/28      06:04:47        T       kea00apa        8795    kea00sys        ND101   ND101.c mainFunction    319             00000000        ファイル処理終了[A00_20220528060439.dat] レコード数[0]
2022/05/28      06:04:57        T       kea00apa        8795    kea00sys        ND101   ND101.c mainFunction    266             00000000        ファイル処理開始[/apdata/today/file/rack/A00_20220528060450.dat]
2022/05/28      06:04:57        T       kea00apa        8795    kea00sys        ND101   ND101.c sFncGetFileRecord       462             00000000        ＥＮＤ情報を受信しました。

上記メッセージを出力が最後

２．ファイルを確認
-rw-r--r-- 1 kea00sys users     29  5月 28 06:04 SKIP_20220527_74994.dat
drwxr-xr-x 2 kea00sys users 614400  5月 28 06:04 OK
-rw------- 1 kea00sys users     16  5月 28 06:04 A00_20220528060450.dat
-rw------- 1 kea00sys users      2  5月 28 06:04 A00_20220528060450.trg

kea00sys@kea00apa:/apdata/today/file/rack> cat A00_20220528060450.dat
20220527,END,22
kea00sys@kea00apa:/apdata/today/file/rack> cat A00_20220528060450.trg
0

３．ファイル待避
対象のファイルは２回目のＥＮＤ情報のみのファイルと判断し、検査内容へ影響なさそうなので
ファイル名を変更し待避する。

kea00sys@kea00apa:/apdata/today/file/rack> mv A00_20220528060450.dat A00_20220528060450.dat.aaa
kea00sys@kea00apa:/apdata/today/file/rack> mv A00_20220528060450.trg A00_20220528060450.trg.aaa

４．ND101を再起動
~/bin/proc.shよりND101を再起動
リネームしたファイル以外が処理されることを確認。


--------------------------------------------------------------------
250：小林 洋一; 総研検査システム２課
2022年05月30日（月） 16:35

問合者=自動分析課金山　対応時間=15分
select * from HKHRIRAI where  hkkhrkbn='3'
営業が属性修正を誤って入力。
身長49.7
体重49.7
体重149.7

正しい身長体重になったので計算待ちから済に変えてほしい。
身長149.7
体重49.7
下記SQLを実行。
update HKHRIRAI set hkkhrkbn='0' where kmkcd='0013094' and hkkhrkbn='3'



--------------------------------------------------------------------
251：羽生 達哉; 総研検査システム２課
2022年06月07日（火） 10:03

2022-06-06に発生したトラブルの調査

条件：
①計算項目の計算先項目
②検査結果をフィルターマスタでLT,GT報告している
③検査結果１と結果補足の値がフィルターマスタと一致していない

作成SQL（過去分の検索）
kea00sys@kea00apa:~/work/hanyu/20220606> cat check_rui.sql
select distinct ka.utkymd,ka.irino,ka.knsgrp,ka.kmkcd,ka.knskka1,ka.kkahskcd,ka.hsiflg,fl.knskka1,fl.kkahskcd
from rui_kekka ka,kkafltmst fl,calckmkmst cl
where ka.utkymd = '2022-06-02'
and ka.knsgrp = cl.knsgrp
and ka.kmkcd = cl.kmkcd
and cl.knsgrp = fl.knsgrp
and cl.kmkcd = fl.kmkcd
and not exists (select * from kkafltmst f1 where f1.sstcd = ka.sstcd)
and fl.sstcd = '0000000'
and ka.knskka1 != ' '
and ka.knsflg = 'E'
and (  (fl.kkahskcd in ('001','002') and ka.knskka1 > fl.knskka1 and ka.kkahskcd     in ('001','002'))
    or (fl.kkahskcd in ('001','002') and ka.knskka1 < fl.knskka1 and ka.kkahskcd not in ('001','002'))
    or (fl.kkahskcd in ('003','004') and ka.knskka1 < fl.knskka1 and ka.kkahskcd     in ('003','004'))
    or (fl.kkahskcd in ('003','004') and ka.knskka1 > fl.knskka1 and ka.kkahskcd not in ('003','004'))
    )
union all
select distinct ka.utkymd,ka.irino,ka.knsgrp,ka.kmkcd,ka.knskka1,ka.kkahskcd,ka.hsiflg,fl.knskka1,fl.kkahskcd
from rui_kekka ka,kkafltmst fl,calckmkmst cl
where ka.utkymd = '2022-06-02'
and ka.knsgrp = cl.knsgrp
and ka.kmkcd = cl.kmkcd
and cl.knsgrp = fl.knsgrp
and cl.kmkcd = fl.kmkcd
and fl.sstcd = ka.sstcd
and ka.knskka1 != ' '
and ka.knsflg = 'E'
and (  (fl.kkahskcd in ('001','002') and ka.knskka1 > fl.knskka1 and ka.kkahskcd     in ('001','002'))
    or (fl.kkahskcd in ('001','002') and ka.knskka1 < fl.knskka1 and ka.kkahskcd not in ('001','002'))
    or (fl.kkahskcd in ('003','004') and ka.knskka1 < fl.knskka1 and ka.kkahskcd     in ('003','004'))
    or (fl.kkahskcd in ('003','004') and ka.knskka1 > fl.knskka1 and ka.kkahskcd not in ('003','004'))
    )
for read only with ur

※当日分の検索はテーブル名をrui_kekka → kekka に変更して受付日(utkymd)の範囲を年内にする（古いテストデータが残っているため）
kea00sys@kea00apa:~/work/hanyu/20220606> cat check.sql
select distinct ka.utkymd,ka.irino,ka.knsgrp,ka.kmkcd,ka.knskka1,ka.kkahskcd,ka.hsiflg,fl.knskka1,fl.kkahskcd
from kekka ka,kkafltmst fl,calckmkmst cl
where ka.utkymd > '2022-01-01'
and ka.kmkcd = cl.kmkcd
and cl.knsgrp = fl.knsgrp
and cl.kmkcd = fl.kmkcd
and not exists (select * from kkafltmst f1 where f1.sstcd = ka.sstcd)
and fl.sstcd = '0000000'
and ka.knskka1 != ' '
and ka.knsflg = 'E'
and (  (fl.kkahskcd in ('001','002') and ka.knskka1 > fl.knskka1 and ka.kkahskcd     in ('001','002'))
    or (fl.kkahskcd in ('001','002') and ka.knskka1 < fl.knskka1 and ka.kkahskcd not in ('001','002'))
    or (fl.kkahskcd in ('003','004') and ka.knskka1 < fl.knskka1 and ka.kkahskcd     in ('003','004'))
    or (fl.kkahskcd in ('003','004') and ka.knskka1 > fl.knskka1 and ka.kkahskcd not in ('003','004'))
    )
union all
select distinct ka.utkymd,ka.irino,ka.knsgrp,ka.kmkcd,ka.knskka1,ka.kkahskcd,ka.hsiflg,fl.knskka1,fl.kkahskcd
from kekka ka,kkafltmst fl,calckmkmst cl
where ka.utkymd > '2022-01-01'
and ka.knsgrp = cl.knsgrp
and ka.kmkcd = cl.kmkcd
and cl.knsgrp = fl.knsgrp
and cl.kmkcd = fl.kmkcd
and fl.sstcd = ka.sstcd
and ka.knskka1 != ' '
and ka.knsflg = 'E'
and (  (fl.kkahskcd in ('001','002') and ka.knskka1 > fl.knskka1 and ka.kkahskcd     in ('001','002'))
    or (fl.kkahskcd in ('001','002') and ka.knskka1 < fl.knskka1 and ka.kkahskcd not in ('001','002'))
    or (fl.kkahskcd in ('003','004') and ka.knskka1 < fl.knskka1 and ka.kkahskcd     in ('003','004'))
    or (fl.kkahskcd in ('003','004') and ka.knskka1 > fl.knskka1 and ka.kkahskcd not in ('003','004'))
    )
for read only with ur

チェックは１日づつ実行
kea00sys@kea00apa:~/work/hanyu/20220606> ./export.sh 2022-06-01
と実行すると、カレントにCheck_2022-06-01.del のファイル名でexportファイルが作成される。
対象が無ければ０バイトのファイルが作成される。


--------------------------------------------------------------------
252：小林 洋一; 総研検査システム２課
2022年06月08日（水） 12:38

問合者=自動分析課和泉,対応時間(分)=30
BMの前読み装置で2MMA0009のトレーを読ませたが本来は2RIXで登録したかったのでトレーの情報をクリアしてほしい。
下記をCSEで実行。
select箇所はCtrl+Enterでバックアップしupdate,deleteを実行。
select * from KENORDER  WHERE KNSKISYMD = '2022-06-07' AND TRID = '2MMA0009' AND KNSJKFLG <> ' '
update KENORDER SET TRID = '____0000', TRPOS = 0, KNSJKFLG = ' ' WHERE KNSKISYMD = '2022-06-07' AND TRID = '2MMA0009' AND KNSJKFLG <> ' '
select * from KENPOS WHERE KNSKISYMD = '2022-06-07' AND TRID = '2MMA0009' AND RAKITJHO = 'A'
delete from KENPOS WHERE KNSKISYMD = '2022-06-07' AND TRID = '2MMA0009' AND RAKITJHO = 'A'

問い合わせ者へクリアしたことを連絡しました。

--------------------------------------------------------------------
254：小林 洋一; 総研検査システム２課
2022年06月08日（水） 14:43

252の続き
問合者=自動分析課和泉,対応時間(分)=60
BMの前読み装置で1SIN1107のトレーを読ませたが登録できないので対応してほしい。
重複エラーと表示される。
マルチの部屋にある前読み装置で2MMA0009のトレーでアッセイラックを読み取ってしまったため
重複エラーになっている。
再度ラックの情報を送信したが登録できずにエラーになった。
データ削除方法が準備されていないため対応はできないと回答。
ZSの部屋にある前読み装置であれば登録は可能なのでZSの部屋にある前読み装置で対応。
ラックファイルをコピーしZSの部屋にある前読み装置でBM8060モードでトレイ、ラックを紐付け
ワークシートを出力しSEQが更新されていることを確認。
マルチの部屋にあるBMで測定できたことを確認。
トレイの紐付けもZSの部屋にある前読み装置BM8060モードでお願いしますと伝えました。
取込した結果を確認予定

ラックファイルのコピー、移動
cd /apdata/today/file/NSWS/Send/RkInfo/Single/Ok
mv RK_220608105900_00055064.end ./../
mv RK_220608105903_00055157.end ./../
mv RK_220608105903_00055184.end ./../
mv RK_220608105903_00055327.end ./../
mv RK_220608105906_00055374.end ./../
mv RK_220608105906_00055381.end ./../
mv RK_220608105906_00055391.end ./../
mv RK_220608105909_00055446.end ./../
mv RK_220608105909_00055525.end ./../
mv RK_220608105909_00055632.end ./../
mv RK_220608105913_00055639.end ./../
mv RK_220608105913_00055657.end ./../
mv RK_220608105913_00055700.end ./../
mv RK_220608105916_00055714.end ./../
mv RK_220608105916_00055732.end ./../
mv RK_220608105916_00055757.end ./../
mv RK_220608105916_00055819.end ./../
mv RK_220608105919_00055878.end ./../
mv RK_220608105919_00055977.end ./../
mv RK_220608105919_00055996.end ./../

cd /apdata/today/file/NSWS/Send/RkInfo/Single
mv RK_220608105900_00055064.end RK_220608105900_00055064.dat
mv RK_220608105903_00055157.end RK_220608105903_00055157.dat
mv RK_220608105903_00055184.end RK_220608105903_00055184.dat
mv RK_220608105903_00055327.end RK_220608105903_00055327.dat
mv RK_220608105906_00055374.end RK_220608105906_00055374.dat
mv RK_220608105906_00055381.end RK_220608105906_00055381.dat
mv RK_220608105906_00055391.end RK_220608105906_00055391.dat
mv RK_220608105909_00055446.end RK_220608105909_00055446.dat
mv RK_220608105909_00055525.end RK_220608105909_00055525.dat
mv RK_220608105909_00055632.end RK_220608105909_00055632.dat
mv RK_220608105913_00055639.end RK_220608105913_00055639.dat
mv RK_220608105913_00055657.end RK_220608105913_00055657.dat
mv RK_220608105913_00055700.end RK_220608105913_00055700.dat
mv RK_220608105916_00055714.end RK_220608105916_00055714.dat
mv RK_220608105916_00055732.end RK_220608105916_00055732.dat
mv RK_220608105916_00055757.end RK_220608105916_00055757.dat
mv RK_220608105916_00055819.end RK_220608105916_00055819.dat
mv RK_220608105919_00055878.end RK_220608105919_00055878.dat
mv RK_220608105919_00055977.end RK_220608105919_00055977.dat
mv RK_220608105919_00055996.end RK_220608105919_00055996.dat

cd /apdata/today/file/NSWS/Send/RkInfo/Single/Err
cp -p RK_220608105900_00055064.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105903_00055157.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105903_00055184.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105903_00055327.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105906_00055374.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105906_00055381.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105906_00055391.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105909_00055446.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105909_00055525.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105909_00055632.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105913_00055639.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105913_00055657.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105913_00055700.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105916_00055714.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105916_00055732.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105916_00055757.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105916_00055819.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105919_00055878.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105919_00055977.err /apdata/today/file/NSWS/Send/RkInfo/BM8040
cp -p RK_220608105919_00055996.err /apdata/today/file/NSWS/Send/RkInfo/BM8040

cd /apdata/today/file/NSWS/Send/RkInfo/BM8040
mv RK_220608105900_00055064.err RK_220608105900_00055064.dat
mv RK_220608105903_00055157.err RK_220608105903_00055157.dat
mv RK_220608105903_00055184.err RK_220608105903_00055184.dat
mv RK_220608105903_00055327.err RK_220608105903_00055327.dat
mv RK_220608105906_00055374.err RK_220608105906_00055374.dat
mv RK_220608105906_00055381.err RK_220608105906_00055381.dat
mv RK_220608105906_00055391.err RK_220608105906_00055391.dat
mv RK_220608105909_00055446.err RK_220608105909_00055446.dat
mv RK_220608105909_00055525.err RK_220608105909_00055525.dat
mv RK_220608105909_00055632.err RK_220608105909_00055632.dat
mv RK_220608105913_00055639.err RK_220608105913_00055639.dat
mv RK_220608105913_00055657.err RK_220608105913_00055657.dat
mv RK_220608105913_00055700.err RK_220608105913_00055700.dat
mv RK_220608105916_00055714.err RK_220608105916_00055714.dat
mv RK_220608105916_00055732.err RK_220608105916_00055732.dat
mv RK_220608105916_00055757.err RK_220608105916_00055757.dat
mv RK_220608105916_00055819.err RK_220608105916_00055819.dat
mv RK_220608105919_00055878.err RK_220608105919_00055878.dat
mv RK_220608105919_00055977.err RK_220608105919_00055977.dat
mv RK_220608105919_00055996.err RK_220608105919_00055996.dat

cd /apdata/today/file/NSWS/Send/RkInfo/Single/Err
mv RK_220608105900_00055064.err ./../RK_220608105900_00055064.dat
mv RK_220608105903_00055157.err ./../RK_220608105903_00055157.dat
mv RK_220608105903_00055184.err ./../RK_220608105903_00055184.dat
mv RK_220608105903_00055327.err ./../RK_220608105903_00055327.dat
mv RK_220608105906_00055374.err ./../RK_220608105906_00055374.dat
mv RK_220608105906_00055381.err ./../RK_220608105906_00055381.dat
mv RK_220608105906_00055391.err ./../RK_220608105906_00055391.dat
mv RK_220608105909_00055446.err ./../RK_220608105909_00055446.dat
mv RK_220608105909_00055525.err ./../RK_220608105909_00055525.dat
mv RK_220608105909_00055632.err ./../RK_220608105909_00055632.dat
mv RK_220608105913_00055639.err ./../RK_220608105913_00055639.dat
mv RK_220608105913_00055657.err ./../RK_220608105913_00055657.dat
mv RK_220608105913_00055700.err ./../RK_220608105913_00055700.dat
mv RK_220608105916_00055714.err ./../RK_220608105916_00055714.dat
mv RK_220608105916_00055732.err ./../RK_220608105916_00055732.dat
mv RK_220608105916_00055757.err ./../RK_220608105916_00055757.dat
mv RK_220608105916_00055819.err ./../RK_220608105916_00055819.dat
mv RK_220608105919_00055878.err ./../RK_220608105919_00055878.dat
mv RK_220608105919_00055977.err ./../RK_220608105919_00055977.dat
mv RK_220608105919_00055996.err ./../RK_220608105919_00055996.dat

以上

IMG_1159.jpg

--------------------------------------------------------------------
255：清水 竜也; 総研検査システム１課
2022年06月08日（水） 16:31

問合者=ケミストリー 竹澤様(内3223) 　９時30分頃　対応時間=10分

■内容
　再検のワークシートを切ろうとしても
　他の端末で...しばらくお待ちくださいのようなメッセージが出て、ワークシートが切れない。

■対応
select * from KNSSEQKNRI where knsgrp='KEA00SYS'　でデータが１行表示された。

ロック的なものでこれがあるとワークシート出力ができないので、削除する。

delete from KNSSEQKNRI where knsgrp='KEA00SYS'

実施後、竹澤様に連絡を入れ、ワークシート出力をしてもらい、印刷できることを確認。

--------------------------------------------------------------------
256：清水 竜也; 総研検査システム１課
2022年06月09日（木） 19:12

校正処理、結果補足CD除去の件で、小林さん作成のシェルを実機の以下のパスに入れています。

シェル： /home/kea00sys/shell/calccheck.sh    

なお実行時、先頭で以下のメッセージを表示します。

「不正な結果補足コードとなっている結果一覧を表示します。
　表示してもよろしいですか？y/n」



--------------------------------------------------------------------
257：羽生 達哉; 総研検査システム２課
2022年06月13日（月） 10:35

問合者=ケミストリー  　6/12 8時30分頃　対応時間=2.5時間

■内容
　BM-33号機で昼間検査分のトレーを投入したところ、えらーが出て測定できない。
　オンラインプロセスを再起動したが、状況は変わらない。

■対応
　通信ログ(/home/kea00sys/appl/src/kns/DD201/dat/Log/com_33.log)を確認したが、やりとりが
　発生していないようだった。
　念のためオンラインプロセスを再起動して再度トレーを投入してもらったところ、測定が開始された。
　データに注意するように連絡して、検査を継続してもらった。

--------------------------------------------------------------------
258：羽生 達哉; 総研検査システム２課
2022年06月14日（火） 12:56

エラーメール対応

--------------------------------------------------------------------------------
[2022年 6月 14日 火曜日 06:50:04 JST] 検査結果 フラグ異常 確認

20220613,"00325529500","0000795"

上記、測定結果のフラグがおかしい検体があります。
（ 検査フラグ M、結果状況コード 3 ）
--------------------------------------------------------------------------------

update kekka
set kkajkcd = '1'
where knskisymd = '2022-06-13'
and irino = '00325529500'
and kmkcd = '0000795'
and knsflg='M'
and knssu=5
;

検査室に確認を取りたかったが、何度電話をしても出てくれないのでとりあえずフラグのみ更新。
後ほど横田課長が出社した際に、直接検査室に確認に行き問題ないと回答をもらった。

--------------------------------------------------------------------
259：清水 竜也; 総研検査システム１課
2022年06月17日（金） 19:59

問合者=ケミストリー  藤本課長　 6/17(金)  17時頃　対応時間=1時間

客先からの問い合わせで履歴チェックをしているのかどうかということから
始まった問い合わせ対応。

① シスタチン(5276)の履歴マスター設定を教えて欲しい。
　　マスタ:RRKCHKMST にて コード0005276 を確認。 
　　0.51～2.01 の設定で比による比較。約２倍の乖離かどうかでチェックしていると回答。

② 6/8受 No.065-5266 の患者について、2/1受で履歴があり、
　 結果照会画面を6/8受を表示した後、そのから画面から履歴照会ができるはずが、できない。何故か。

　 イントラ照会で該当患者を検索。6/8受、2/1受...とあり。ただカルテNo.が毎回異なっている。

　 結果照会実行のログを小林さんに確認してもらい、カルテNoまでみていることがわかった。
　 条件的にはカルテNoが等しいか、もしくは空白なら一致とみなす。と、藤本課長に回答。

　なお履歴チェックリストも、は、②と同じ条件かどうか？
　これも実行ログを小林さんに確認してもらい、②と同じであることがわかり、そう回答した。


--------------------------------------------------------------------
261：小林 洋一; 総研検査システム２課
2022年06月21日（火） 16:01

問合者=ケミストリー竹澤　対応時間=1時間
XbarR管理図を開いて下記の条件で検索すると「画面表示に失敗しました」と表示される。
受付日:2022/06/01-2022/06/21
項目:0005276 シスタチンC
分析機:ZS050
コントロールNO:1-9999

原因
生理食塩水のCS(変動係数)を算出する際に
Xbarの値が合計値/行数=0になり
CV=SD / Xbar * 100
CVの値算出に失敗、エラーが発生していました。
問い合わせ者が夜勤明けで帰宅してしまったため明日説明予定


XbarRエラー20220621.xlsx

--------------------------------------------------------------------
262：清水 竜也; 総研検査システム１課
2022年06月28日（火） 18:23

横田課長
羽生主事
皆さま

総研コアスイッチ入替によるネットワーク断の際
ケミストリーシステムで事前に停止する処理などあれば教えてください。

検査業務的にはケミストリーシステムを使用していないので
Z<-->IA間など、エリアを跨ぐ処理は特に無いと思うのですが....

清水

--------------------------------------------------------------------
263：横田 克夫; 総研検査システム２課
2022年06月28日（火） 18:43

@:清水 竜也; 総研検査システム１課

>>262
清水主任

ZとIAってマウントしていなかったでしたっけ？

横田

--------------------------------------------------------------------
264：小林 洋一; 総研検査システム２課
2022年07月05日（火） 17:11

問合者=ケミストリー倉持　対応時間=30分
初回測定
照合NG確定で再検で更新。
再検ワークシートを切って測定？
照合NG画面に出てくるはずが出てこなかった。
←手入力で対応を依頼。
14:07 照合NG画面で更新
14:26-29 2回目結果取り込み
原因、運用が不明なため手入力対応していただきました。


ケミストリ照合NG20220705.xlsx

--------------------------------------------------------------------
265：小林 洋一; 総研検査システム２課
2022年07月07日（木） 16:58

>>264
各位
お疲れ様です。小林です。

自動分析課倉持様から原因調査の催促がきました。
私は問合窓口、不具合調査でもありません。
このまま私の作業になるのであれば最優先で調査をして他作業は後回しにします。
来週には調査すると回答しました。

以上


--------------------------------------------------------------------
266：小林 洋一; 総研検査システム２課
2022年07月13日（水） 15:37

問合者=自動分析課倉持　対応時間=1時間
カルニチンの結果を照合NG画面で確定した。
確定している最中に実行ボタンを押下してしまった。
←結果の状態がおかしいため手入力結果を削除して再度照合NG確定していただきました。

照合NGエラー20220713.xlsx

--------------------------------------------------------------------
267：横田 克夫; 総研検査システム２課
2022年07月15日（金） 20:01

以下の運用をお願いしています。
-------------------------------------------------------------
補正処理時に連絡を頂きたい項目
差出人	 ： 	"横田 克夫" <k-yokota@bml.co.jp> 
送信日時	 ： 	2022年07月15日（金） 20:00
To （2件）  	 ： 	"藤本 丈志" <takeshi-f@bml.co.jp>, "辻 祐輝" <yuki_tsuji@bml.co.jp>
Cc （3件）    	 ： 	"保科 三紀夫" <hoshi-m@bml.co.jp>, "羽生 達哉" <hanyu@bml.co.jp>, "清水 竜也" <shimizu@bml.co.jp> （←宛先を隠す）
20220715_補正処理時に連絡を頂きたい項目.xlsx
藤本課長
辻主任

お疲れ様です。横田です。

本日（７／１５）ご説明させて頂きました通り、補正処理を実行した際、
正しく結果補足が設定されない可能性があります。

つきましては、補正処理実行時、システム担当者にご一報いただきたく
お願いいたします。対象は添付した一覧に記載した項目になります。

お手数をお掛けしますが、ご協力いただけますようお願いいたします。

以上、宜しくお願いいたします。

20220715_補正処理時に連絡を頂きたい項目.xlsx

--------------------------------------------------------------------
268：横田 克夫; 総研検査システム２課
2022年07月15日（金） 20:30

問合者=藤本課長　対応時間=色々な方の結構な時間

7/12受でF式（00795）がマイナスデータのまま報告済みになるケースが発生しました。

↓

・ホスト報告でエラーになって気が付いた模様。
・F式は、総コレステロール・HDL-Cho・中性脂肪の３項目の結果を使って計算。
・今回、３項目は全て自動再検対象。うち２項目の自動再検結果受信し分析機が故障。
・分析機故障に起因するイレギュラー事象が原因だった旨、藤本課長に説明。
　今期予定している次期ケミストリー案件の中の１機能で改善見込みである事を説明し了承いただく。

20220713_ケミストリーF式マイナスデータ報告.pdf

--------------------------------------------------------------------
269：島村 健汰; 総研検査システム１課
2022年07月26日（火） 17:05

問合者 = ケミストリー 倉持さん
対応時間 = 1時間45分

プリンターを新規購入したので、設定をして欲しい。

プリンタ名　　　：KEA00PRT02
IPアドレス　　　：10.1.181.112
サブネットマスク：255.255.255.0
ゲートウェイ　　：10.1.181.1

故障した旧プリンタと同じIPアドレスを割り当て
LIPS等の設定はしていない様だったので
ほぼ出荷状態に近い設定

拡張トレーを購入していなかったので
見積って買う様に説明した。

--------------------------------------------------------------------
270：横田 克夫; 総研検査システム２課
2022年07月30日（土） 11:56

問合者=藤本課長,対応時間(分)=5

日立ラボスペクトの通信異常の件
差出人	 ： 	"藤本 丈志" <takeshi-f@bml.co.jp> 
送信日時	 ： 	2022年07月29日（金） 09:29
To （2件）  	 ： 	"横田 克夫" <k-yokota@bml.co.jp>, "清水 竜也" <shimizu@bml.co.jp>
Cc （5件）    	 ： 	"伊藤 美樹夫" <mikio_ito@bml.co.jp>, "馬場 基晴" <Motoharu_Baba@bml.co.jp>, "小金 剛" <Tsuyoshi_Kogane@bml.co.jp>, "菅野 隆" <takashi-s@bml.co.jp>, "辻 祐輝" <yuki_tsuji@bml.co.jp> （←宛先を隠す）
横田課長

お疲れ様です。
7/28にLABO6号機で下記アラームが出ておりました。
検査管理課と日立で一度見てもらいましたが、
原因がわからないとのことです。
ホスト側の確認をして下さいとのことなので、
確認をお願いします。

藤本

--------------------------------------------------------------------------------------
７月２８日　０８：０５に　LABOSPECT　６号機にて下記のエラーが発生しました。
・自動再検項目選択情報受信エラー(112-000011)
・ホスト通信エラー検体情報（343-681695）
   当該検体ラックNo：８１１６９－５（再検になるようなデータではなかった）
　装置としては、配線の緩みや抜けはありませんでした。

日立ハイテクに問い合わせたところ、「ホストへの送信後の、ホストからの受信が出来なかった」というエラーなので、ホスト側の通信状態を確認して下さい。
との事でした。

↓↓↓↓↓↓↓↓↓↓以下、返信↓↓↓↓↓↓↓↓↓↓↓↓

藤本課長

お疲れ様です。横田です。

返信が遅くなり申し訳ありません。
ご連絡ありがとうございます。

会話させて頂きました通り、ホスト側の通信ログは１日しか保持していません。
その為、調査が難しい状況です。

何卒、ご理解いただけますようお願いいたします。

以上です。


--------------------------------------------------------------------
271：横田 克夫; 総研検査システム２課
2022年08月01日（月） 18:14

問合者=藤本課長,対応時間(分)=5

Re: BM8060 の　「ホストオンライン　タイムアウト」　７月２９日分について
差出人	 ： 	"藤本 丈志" <takeshi-f@bml.co.jp> 
送信日時	 ： 	2022年08月01日（月） 08:50
To （2件）  	 ： 	"横田 克夫" <k-yokota@bml.co.jp> ... 
Cc （6件）    	 ： 	"馬場 基晴" <Motoharu_Baba@bml.co.jp> ...  （→宛先をすべて表示する）
横田課長

お疲れ様です。

BM8060オンラインタイムアウトの発生状況の報告です。
ご確認よろしくお願いいたします。

自動分析課
藤本

----- Original Message -----
Subject: BM8060 の　「ホストオンライン　タイムアウト」　７月２９日分について
Date: Sat, 30 Jul 2022 18:22:55 +0900
From: "伊藤 美樹夫"<mikio_ito@bml.co.jp>
To: "藤本 丈志"<takeshi-f@bml.co.jp>
Cc: "馬場 基晴"<Motoharu_Baba@bml.co.jp>, "小金 剛"<Tsuyoshi_Kogane@bml.co.jp>
伊藤 美樹夫 wrote:
> 　自動分析課　藤本様
> 
> お疲れ様です。
> 先日来、BM8060で発生している　「ホストオンライン　タイムアウト」についてです。
> 
> ７月２９日受け検査分で　１３号機（AM　４時１７分）、２２号機（AM ８時１１分）に発生しております。
> 
> システム部ほうに調査を依頼していただいていると思いますが、引き続き調査依頼をお願いいたします。
> 

↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓

(1)BM付近の段ボールを片付けて風通しを良くした。
(2)日電にロガーを設置してもらった。

--------------------------------------------------------------------
272：清水 竜也; 総研検査システム１課
2022年08月03日（水） 17:44

保守携帯の当番、2022年の8月、10月は以下のように変更しています。

8月は横田課長、10月は清水
　　↓
8月は清水、10月は横田課長

--------------------------------------------------------------------
273：横田 克夫; 総研検査システム２課
2022年08月04日（木） 14:41

情報共有までに
------------------------------------------------------------------
Re: 管理PCエラーの件
差出人	 ： 	"藤本 丈志" <takeshi-f@bml.co.jp> 
送信日時	 ： 	2022年08月04日（木） 10:26
To  	 ： 	"佐々木信広" <n-sasaki@nissetsuko.co.jp>
Cc （6件）    	 ： 	"鈴木拓哉" <tky-suzuki@nissetsuko.co.jp>, "伊藤積成" <s-ito@nissetsuko.co.jp>, "辻 祐輝" <yuki_tsuji@bml.co.jp>, "菅野 隆" <takashi-s@bml.co.jp>, "横田 克夫" <k-yokota@bml.co.jp>, "清水 竜也" <shimizu@bml.co.jp> （←宛先を隠す）
株式会社日本設計工業
佐々木様

お世話になっております。

ご連絡ありがとうございます。
一時的に接続が切れて発生したアラームということで、
承知いたしました。

一旦、弊社担当者にも確認いたします。

BML　自動分析課
藤本

----- Original Message -----
Subject: 管理PCエラーの件
Date: Thu, 04 Aug 2022 09:16:58 +0900
From: "佐々木信広"<n-sasaki@nissetsuko.co.jp>
To: "藤本 丈志"<takeshi-f@bml.co.jp>
Cc: "鈴木拓哉"<tky-suzuki@nissetsuko.co.jp>, "伊藤積成"<s-ito@nissetsuko.co.jp>
佐々木信広 wrote:
> ㈱ビー・エム・エル　藤本様
> 
> 日本設計工業　佐々木です。
> 
> いつもお世話になります。
> 
> 以下の件につき、確認結果をご報告申し上げます。
> 　　↓
> > あと、別件で7月中旬ごろに弊社夜勤担当の涌井より、
> > カンリPCのエラー「ホストPCEthermet通信異常」の件で、
> > 連絡をしたと思いますが、その後どうなりましたでしょうか？
> 
> ◆経緯
> 　・7/22(金)a9頃、涌井様より連絡⇒夜勤者よりの申し送りあった由。
> 　・管理画面（柱に据付の画面）にて「ホストPCEthermet通信異常」が発報。
> 　・夜勤者の帰り際（a7~8頃）に発生。（検査は全て終わっていた模様）
> 
> ◆エラーの発生場所
> 　・サンプラ～BML殿上位システム間の通信(TCP/IP)にて接続異常が発生。
> 　　⇒上位との通信接続が切断された場合発報されます。
> 
> ◆弊社の調査結果
> 　・リモートにて確認、弊社側の機器に異常は認められませんでした。
> 　・ご連絡頂いた時点で上位システムとの通信も復旧。
> 　　⇒サンプラ、管理PCとも上位通信は正常におこなわれていました。
> 
> ◆想定される原因
> 　上位システムとの通信接続（BML殿構内LAN）が一瞬途切れたのでは
> 　無いかと考えられます。
> 　　⇒瞬間停電の様な物で、直後に復旧した？
> 　　　　↓
> 　・ご連絡を頂いた時点では既に検査を再開されていました。（正常稼働）
> 　・涌井様へは、経過観察頂き何かあれば連絡を頂くこととしました。
> 　　⇒その後、再発のご連絡は頂いておりません。
> 
> 以上、ご報告申し上げます。
> 
> ================================
> (株)日本設計工業　
> 　　　　　営業部門　佐々木　信広
> 
> TEL : 053-436-6161（代表）
> 　　　053-489-5925(ダイヤルイン)
> FAX : 053-414-5071
> 携帯: 090-8950-8081
> URL : http://www.nissetsuko.co.jp
> e-Mail : n-sasaki@nissetsuko.co.jp
> ================================
> 
> 
> 
> On Wed, 03 Aug 2022 09:27:32 +0900
> 藤本 丈志 <takeshi-f@bml.co.jp> wrote:
> 
> > 株式会社日本設計工業
> > 佐々木様
> > 
> > お世話になっております。
> > 
> > 消費電力の件、ありがとうございました。
> > 
> > あと、別件で7月中旬ごろに弊社夜勤担当の涌井より、
> > カンリPCのエラー「ホストPCEthermet通信異常」の件で、
> > 連絡をしたと思いますが、その後どうなりましたでしょうか？
> > 
> > ご確認よろしくお願いいたします。
> > 
> > BML
> > 藤本
> > 
> > 
> > ----- Original Message -----
> > Subject: ZSライン用コンプレッサ　電源容量
> > Date: Tue, 02 Aug 2022 11:00:39 +0900
> > From: "佐々木信広"<n-sasaki@nissetsuko.co.jp>
> > To: "BML　藤本様"<takeshi-f@bml.co.jp>
> > 佐々木信広 wrote:
> > > ㈱ビー・エム・エル　藤本様
> > > 
> > > 日本設計工業　佐々木です。
> > > 
> > > いつもお世話になります。
> > > 
> > > お問合せ頂きましたZSライン用コンプレッサの電源容量につき、下記ご連絡
> > > 申し上げます。
> > > 
> > > ・三相200V×30A　⇒6,000VA
> > > 
> > > 以上、宜しくお願い致します。
> > > 
> > > 
> > > ================================
> > > (株)日本設計工業　
> > > 　　　　　営業部門　佐々木　信広
> > > 
> > > TEL : 053-436-6161（代表）
> > > 　　　053-489-5925(ダイヤルイン)
> > > FAX : 053-414-5071
> > > 携帯: 090-8950-8081
> > > URL : http://www.nissetsuko.co.jp
> > > e-Mail : n-sasaki@nissetsuko.co.jp
> > > ================================
> > > 
> > 
> > ------------------------------------
> > 藤本　丈志 (FUJIMOTO　TAKESHI)
> > （株）ビー・エム・エル
> > 総合研究所 総研検査本部
> > 第一検査部 自動分析課 ケミストリー
> > 〒350-1101埼玉県川越市的場1361-1
> > Tel: 049-232-0460（直通）
> > Fax: 049-232-8468
> > E-mail:takeshi-f@bml.co.jp
> > ------------------------------------
> 
> 
> 

------------------------------------
藤本　丈志 (FUJIMOTO　TAKESHI)
（株）ビー・エム・エル
総合研究所 総研検査本部
第一検査部 自動分析課 ケミストリー
〒350-1101埼玉県川越市的場1361-1
Tel: 049-232-0460（直通）
Fax: 049-232-8468
E-mail:takeshi-f@bml.co.jp
------------------------------------

--------------------------------------------------------------------
274：清水 竜也; 総研検査システム１課
2022年08月23日（火） 07:27

アラートメール対応　対応時間　30分
----------------------
20220822,"00754221400","0002540"

上記、測定結果のフラグがおかしい検体があります。
（ 検査フラグ M、結果状況コード 3 ）
----------------------

検査室に連絡。TIBCゼンでエラー表示されているが
ホストを確認し問題なしで報告されているとのころ。ワクイさん。

select * from kekka where knskisymd = '2022-08-22' and irino = '00754221400' and kmkcd = '0002540'

報告済みの knsflg='E'が knssu=4 にあり、
エラーになっているのはknssu=1 側で、これを KKAJKCD='1'（中間結果）に更新。

update kekka set   KKAJKCD='1'
 where knskisymd = '2022-08-22' and irino = '00754221400' and kmkcd = '0002540' and knssu=1



--------------------------------------------------------------------
275：小林 洋一; 総研検査システム２課
2022年08月25日（木） 17:48

問合者=金山,対応時間(分)=30
検査グループ0719で報告できないものがある。

8/18
IgDのコントロール結果が4SDを超えていた。
報告指示画面
条件入力タブから番号指定で報告することで対応。

8/25
条件入力タブから番号指定で報告してみたができない。
結果状況コードXが残っていた。
データ→検査グループ単位入力(汎用)画面で結果状況コードをXからSに更新。
報告指示画面で選択できるようになった。
←更新されてしまったので調査不能。
　更新する前に連絡くださいと伝えました。

コントロール→コントロール異常確定画面にIgDが表示されない。
←調査すると回答。
　対応ができるまでは
　報告指示画面の条件入力か
　検査グループ単位入力(汎用)画面で結果状況コード更新するよう依頼しました。


--------------------------------------------------------------------
276：小林 洋一; 総研検査システム２課
2022年08月26日（金） 10:41

問合者=涌井,対応時間(分)=60
同項目で検体NO違いの結果が存在しています。
検体NOを指定して検索し直してください。と
依頼書NO単位結果入力画面に表示される。

F式の結果が入力できない。
受付日:8/25
依頼書NO:5522120
計算不可(*021)を入れて更新して報告しようとしていた。

原因
依頼書NO単位結果入力画面で検索した時にF式の行が2行表示されていたことが原因。

暫定対応
CSEを開きKEA00DBAに接続。
バックアップ(Ctrl+Shift+Enter)
select * from kekka where utkymd='2022-08-25' and irino='00552212000' and kmkcd in('0000795') and knssu='4'
結果状況コード、結果優先フラグ、採用フラグを更新。
update kekka set KKAJKCD='1',KKAYSNFLG = '',SIYFLG='' where utkymd='2022-08-25' and irino='00552212000' and kmkcd in('0000795') and knssu='4'
依頼書NO単位結果入力画面で検索した時にメッセージが表示されなくなったことを確認。

詳細は添付資料を参照ください。


ケミストリ不具合20220826.xlsx

--------------------------------------------------------------------
277：島村 健汰; 総研検査システム１課
2022年09月09日（金） 10:17

各位

UPS管理台帳を更新しました。

\\10.1.103.226\NAS_Backup\総研システム部\共用\★ＵＰＳ

⇒ 2021年度_ＵＰＳ管理表_Ver2.xls

--------------------------------------------------------------------
278：清水 竜也; 総研検査システム１課
2022年09月09日（金） 11:07

@:島村 健汰; 総研検査システム１課

>>277


ケミストリー UPS.xlsx

--------------------------------------------------------------------
279：小林 洋一; 総研検査システム２課
2022年09月21日（水） 14:50

問合者=金山,対応時間(分)=30
受付日:2022-09-13,依頼書NO:2629361の食塩摂取量が再計算待ちになっているので更新してほしい。
下記SQLをCSEで実行しバックアップ、更新し連絡しました。
select * from HKHRIRAI where  hkkhrkbn='3' and utkymd='2022-09-13' and irino='00262936100'
update HKHRIRAI set hkkhrkbn='0' where  hkkhrkbn='3' and utkymd='2022-09-13' and irino='00262936100'


--------------------------------------------------------------------
280：横田 克夫; 総研検査システム２課
2022年09月21日（水） 21:31

問合者=藤本課長,対応時間(分)=30
ZS搬送ラインの稼働率が低く、今後、稼働率を上げたい。
調査のため、ZSの依頼情報を9/6受で抽出してもらいたい。

以下の実行結果を送付
SELECT
    rui_irai.utkymd,
    rui_irai.irino,
    rui_irai.smpcd,
    rui_irai.kmkcd,
    rui_irai.trkdh
FROM
    rui_irai,rui_kekka
WHERE
    rui_kekka.utkymd='2022-09-06' AND
    rui_kekka.BSKKBN='Z050' and
    rui_irai.utkymd=rui_kekka.utkymd and 
    rui_irai.irino=rui_kekka.irino and 
    rui_irai.kmkcd=rui_kekka.kmkcd and 
    1=1

ORDER BY
    rui_irai.utkymd,
    rui_irai.irino,
    rui_irai.smpcd,
    rui_irai.kmkcd,
    rui_irai.trkdh
for read only with ur


ZS依頼(20220906受).xlsx

--------------------------------------------------------------------
281：羽生 達哉; 総研検査システム２課
2022年09月23日（金） 07:45

アラートメール対応　対応時間　30分
----------------------
20220922,"00056677000","0000409"
20220922,"00056677000","0000413"
20220922,"00056677000","0000421"
20220922,"00056677000","0000423"
20220922,"00056677000","0000425"
20220922,"00056677000","0000427"
20220922,"00056677000","0000429"
20220922,"00056677000","0000431"
20220922,"00056677000","0002696"

上記、測定結果のフラグがおかしい検体があります。
（ 検査フラグ M、結果状況コード 3 ）
----------------------

検査室に結果を確認してもらい、ホスト報告されているデータで問題ないことを確認。

select kmkcd,knssu,kkajkcd,knsflg,knskka1,knskka2,hkkdh
from kekka
where knskisymd = '2022-09-22'
and irino = '00056677000'
and kkajkcd='3'
and knsflg='M'
order by kmkcd,knssu
for read only;

KMKCD   KNSSU  KKAJKCD KNSFLG KNSKKA1      KNSKKA2                  HKKDH
------- ------ ------- ------ ------------ ------------------------ --------------------------
0000409      1 3       M              14.1                          2022-09-23-06.05.40.833560
0000413      1 3       M              1.62                          2022-09-23-06.05.40.834401
0000421      1 3       M               141                          2022-09-23-05.51.23.903044
0000423      1 3       M               3.1                          2022-09-23-05.51.23.903342
0000425      1 3       M               102                          2022-09-23-05.51.23.903611
0000427      1 3       M               8.9                          2022-09-23-06.05.40.834666
0000429      1 3       M               1.5                          2022-09-23-06.05.40.833886
0000431      1 3       M               2.0                          2022-09-23-06.05.40.834163
0002696      1 3       M              23.1                          2022-09-23-06.05.40.835142

  9 レコードが選択されました。

結果状況コードを更新

update kekka
set kkajkcd = '1'
where knskisymd = '2022-09-22'
and irino = '00056677000'
and kkajkcd='3'
and knsflg='M';


--------------------------------------------------------------------
282：小林 洋一; 総研検査システム２課
2022年09月28日（水） 17:42

問合者=菅野主任,対応時間(分)=30
受付日:2022-09-13,依頼書NO:2629361の食塩摂取量が再計算待ちになっているので更新してほしい。
下記SQLをCSEで実行しバックアップ、更新し連絡しました。
select * from kekka where utkymd='2022-09-13' and irino='00262936100' and kmkcd='0013094'
update kekka set KNSFLG='E' where utkymd='2022-09-13' and irino='00262936100' and kmkcd='0013094'
select * from rui_kekka where utkymd='2022-09-13' and irino='00262936100'

select * from HKHRIRAI where  hkkhrkbn='3' and utkymd='2022-09-13' and irino='00262936100'
update HKHRIRAI set hkkhrkbn='0' where  hkkhrkbn='3' and utkymd='2022-09-13' and irino='00262936100'

--------------------------------------------------------------------
283：清水 竜也; 総研検査システム１課
2022年09月28日（水） 21:32

9/27受で発生したALPの未報告について
一覧表作成用のsqlと、抽出したcsvファイルを添付します。
なお翌日対象の未報告一覧の作成ツール(Excel)とは
条件がことなるため手動での抽出を行った。

その後、横田課長が改行、レコード中の区切り文字、ダブルクォーテーションなど調整し
統合DBの情報をマージするツールでExcel化し、藤本課長に提出。

項目3種（一般、透析前・後）：'0013067','0013156','0013306'　
トレーを限定：'2MLT0019'　～ '2MLT0049'

なお、ALPについて今春まで使用していた 旧世代の試薬やセットされたことが原因のようで
なぜ旧世代のものがセットされたか、メーカの納品含め調査中とのこと。


sel.sql
alp

--------------------------------------------------------------------
284：小林 洋一; 総研検査システム２課
2022年09月30日（金） 11:18

問合者=藤本課長,辻主任,対応時間(分)=30
ZS搬送ラインの稼働率が低く、今後、稼働率を上げたい。
調査のため、ZSの依頼情報を9/6受で抽出してもらいたい。

以下の実行結果を送付
SELECT
    distinct
    rui_irai.utkymd,
    rui_irai.irino,
    rui_irai.smpcd,
    rui_irai.kmkcd,
    m.kmknmj,
    rui_kekka.trkdh,
    rui_kekka.bsklne
FROM
    rui_irai,rui_kekka,kmkmst as m
WHERE
    rui_kekka.utkymd='2022-09-06' AND
    rui_kekka.BSKKBN='Z050' and
    rui_irai.utkymd=rui_kekka.utkymd and 
    rui_irai.irino=rui_kekka.irino and 
    rui_irai.kmkcd=rui_kekka.kmkcd and 
    m.kmkcd=rui_irai.kmkcd and 
    m.knsgrp=rui_irai.knsgrp and 
    1=1
ORDER BY
    rui_irai.utkymd,
    rui_irai.irino,
    rui_irai.smpcd,
    rui_irai.kmkcd,
    rui_kekka.trkdh
for read only with ur



ZS依頼(20220906受)項目名測定時刻号機追加.xlsx

--------------------------------------------------------------------
285：小林 洋一; 総研検査システム２課
2022年10月04日（火） 11:22

>282:小林 洋一; 総研検査システム２課2022年09月28日（水） 17:42	
>削除する
>問合者=菅野主任,対応時間(分)=30
>受付日:2022-09-13,依頼書NO:2629361の食塩摂取量が再計算待ちになっているので更新してほしい。
>下記SQLをCSEで実行しバックアップ、更新し連絡しました。
>select * from kekka where utkymd='2022-09-13' and irino='00262936100' and kmkcd='0013094'
>update kekka set KNSFLG='E' where utkymd='2022-09-13' and irino='00262936100' and kmkcd='0013094'
>select * from rui_kekka where utkymd='2022-09-13' and irino='00262936100'
>
>select * from HKHRIRAI where  hkkhrkbn='3' and utkymd='2022-09-13' and irino='00262936100'
>update HKHRIRAI set hkkhrkbn='0' where  hkkhrkbn='3' and utkymd='2022-09-13' and irino='00262936100'
翌日(2022/09/29)結果テーブル、報告保留依頼テーブルを確認し消えたことを確認しました。
select * from rui_kekka where utkymd='2022-09-13' and irino='00262936100'
select * from HKHRIRAI where  utkymd='2022-09-13' and irino='00262936100'


--------------------------------------------------------------------
286：羽生 達哉; 総研検査システム２課
2022年10月11日（火） 10:58

問合者=自動分析課　和泉さん,対応時間(分)=30

停電後の確認でコントロールを流したが、BM33号機で取り込まれなかったので確認して欲しい。

KEA00IAW22 /home/kea00sys/appl/src/kns/DD201/dat/Log/com_33.log を確認
本日のログが9:03に開始している。
検査に確認したところコントロールを流したのは8:57だったそうなので、
確認作業が少し早かったと連絡した。
その後のログは継続して出力されているため、オンラインは問題なく動いていることを伝えた。

--------------------------------------------------------------------
287：清水 竜也; 総研検査システム１課
2022年10月11日（火） 16:12

停電後の確認・対応

kea00sys@kea00apa:~/shell/Startup> df
ファイルシス                                                      サイズ  使用  残り 使用% マウント位置
devtmpfs                                                            480M     0  480M    0% /dev
tmpfs                                                               491M     0  491M    0% /dev/shm
tmpfs                                                               491M  1.8M  490M    1% /run
tmpfs                                                               491M     0  491M    0% /sys/fs/cgroup
/dev/mapper/kea00apa--os--vg-root--lv                               7.5G  4.7G  2.4G   67% /
/dev/dasdc1                                                         232M   50M  165M   24% /boot/zipl
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    30G   13G   18G   42% /apdata
/dev/mapper/kea00apa--os--vg-opt--lv                                7.9G  2.4G  5.1G   33% /opt
/dev/mapper/kea00apa--os--vg-home--lv                               2.4G  1.6G  761M   68% /home
/dev/mapper/kea00apa--os--vg-var--lv                                2.4G  593M  1.7G   26% /var
tmpfs                                                                99M     0   99M    0% /run/user/0
tmpfs                                                                99M     0   99M    0% /run/user/1001


kea00sys@kea00apa:~/shell/Startup> sh /home/kea00sys/shell/Startup/mount_IA_all.sh
mount.nfs: /apdata/today/file/KEA00/kea00ap is busy or already mounted
mount.nfs: /apdata/aplog/DBOUT is busy or already mounted
mount.nfs: /apdata/today/file/KEA00/kea00ap is busy or already mounted
mount.nfs: /apdata/aplog/DBOUT is busy or already mounted
mount.nfs: /apdata/today/file/KEA00/kea00ap is busy or already mounted
mount.nfs: /apdata/aplog/DBOUT is busy or already mounted
mount.nfs: /apdata/today/file/KEA00/kea00ap is busy or already mounted
mount.nfs: /apdata/aplog/DBOUT is busy or already mounted
kea00sys@kea00apa:~/shell/Startup> df


kea00sys@kea00apa:~/shell/Startup> ll
合計 60
drwxr-xr-x  2 kea00sys users  4096  7月  8 18:41 ./
drwxr-xr-x 11 kea00sys users  4096  8月  3 14:16 ../
-rw-r--r--  1 kea00sys users 20916 10月 11 16:03 IA_mount.log
-rw-r--r--  1 kea00sys users  1608 12月  9  2019 IA_umount.log
-rwxr-xr-x  1 kea00sys users  1326  9月 17  2018 mount_IA_all.sh*
-rwxr-xr-x  1 kea00sys users   628  7月  8 18:41 mount_Z_all.sh*
-rw-r--r--  1 kea00sys users   178 12月 20  2018 readme.txt
-rwxr-xr-x  1 kea00sys users   958 12月  3  2019 umount_IA_all.sh*
-rwxr-xr-x  1 kea00sys users   329  7月  8 18:41 umount_Z_all.sh


kea00sys@kea00apa:~/shell/Startup> su - root
パスワード:
kea00apa:~ # sh /home/kea00sys/shell/Startup/mount_Z_all.sh   <--- ●こっちでした。
kea00apa:~ # ^C
kea00apa:~ # logout

kea00sys@kea00apa:~/shell/Startup> df
ファイルシス                                                      サイズ  使用  残り 使用% マウント位置
devtmpfs                                                            480M     0  480M    0% /dev
tmpfs                                                               491M     0  491M    0% /dev/shm
tmpfs                                                               491M  1.8M  490M    1% /run
tmpfs                                                               491M     0  491M    0% /sys/fs/cgroup
/dev/mapper/kea00apa--os--vg-root--lv                               7.5G  4.7G  2.4G   67% /
/dev/dasdc1                                                         232M   50M  165M   24% /boot/zipl
/dev/mapper/kea00apa--data--apdata--vg-kea00apa--data--apdata--lv    30G   13G   18G   42% /apdata
/dev/mapper/kea00apa--os--vg-opt--lv                                7.9G  2.4G  5.1G   33% /opt
/dev/mapper/kea00apa--os--vg-home--lv                               2.4G  1.6G  761M   68% /home
/dev/mapper/kea00apa--os--vg-var--lv                                2.4G  593M  1.7G   26% /var
tmpfs                                                                99M     0   99M    0% /run/user/0
tmpfs                                                                99M     0   99M    0% /run/user/1001
KEA00IAW08:/apdata/today/file/KEA00/KEA00IA                         9.7G  7.6G  1.6G   83% /apdata/today/file/KEA00/KEA00IAW08
KEA00IAW21:/apdata/today/file/KEA00/KEA00IA                         449G  149G  278G   35% /apdata/today/file/KEA00/KEA00IAW21
KEA00IAW22:/apdata/today/file/KEA00/KEA00IA                         449G  7.4G  419G    2% /apdata/today/file/KEA00/KEA00IAW22
KEA00IAW23:/apdata/today/file/KEA00/KEA00IA                         439G   12G  406G    3% /apdata/today/file/KEA00/KEA00IAW23
KEA00IAW24:/apdata/today/file/KEA00/KEA00IA                         439G   11G  406G    3% /apdata/today/file/KEA00/KEA00IAW24
KEA00IAW02:/apdata/today/file/KEA00/KEA00IA                          72G   31G   37G   46% /apdata/today/file/KEA00/KEA00IAW02
kea00sys@kea00apa:~/shell/Startup>



--------------------------------------------------------------------
288：小林 洋一; 総研検査システム２課
2022年10月13日（木） 22:06

問合者=自動分析課辻主任,対応時間(分)=30
純水装置が故障して何度も再測定をしていたら結果入力枠が消えてしまったので対応してほしい。
項目コード:0000889(ﾎﾀｲｶ)の結果を削除してほしい。
依頼書Ｎo単位結果入力枠が消えてしまった件
差出人	 ： 	"辻　祐輝" <yuki_tsuji@bml.co.jp> 
送信日時	 ： 	2022年10月13日（木） 21:50
To （2件）  	 ： 	"横田 克夫" <k-yokota@bml.co.jp> ... （→宛先をすべて表示する）
横田課長
小林様

お疲れ様です。
先ほど横田課長に架電した件です。
結果入力枠が消えてしまっておりますので、
対応お願いいたします。
依頼はすべてWS407です。

10/12受　
727-6448　CD889　補体価
727-6531　CD889　補体価
727-6534　CD889　補体価
459-8922　CD889　補体価
758-0654　CD889　補体価

よろしくお願いいたします。

辻

下記のSQLを実行しデータをバックアップ後に結果テーブルを削除。
依頼書NO単位入力画面で入力できるようになったことを確認していただきました。
select * from kekka where knskisymd='2022-10-12' and irino='00727644800' and kmkcd='0000889'
delete from kekka where knskisymd='2022-10-12' and irino='00727644800' and kmkcd='0000889'

select * from kekka where knskisymd='2022-10-12' and irino in('00727653100','00727653400','00459892200','00758065400') and kmkcd='0000889'
delete from kekka where knskisymd='2022-10-12' and irino in('00727653100','00727653400','00459892200','00758065400') and kmkcd='0000889'


--------------------------------------------------------------------
289：小林 洋一; 総研検査システム２課
2022年10月17日（月） 18:45

問合者=自動分析課辻主任,対応時間(分)=30
> > > ----- Original Message -----
> > > Subject: Fwd: ヘリコバクターピロリのデータの件
> > > Date: Fri, 14 Oct 2022 12:13:28 +0900
> > > From: "辻　祐輝"<yuki_tsuji@bml.co.jp>
> > > To: "小林 洋一"<you-kb@bml.co.jp>
> > > Cc: "横田 克夫"<k-yokota@bml.co.jp>, "藤本 丈志"<takeshi-f@bml.co.jp>
> > > 辻　祐輝 wrote:
> > > > 小林様
> > > > 
> > > > お疲れ様です。
> > > > 先ほど架電でお話しました件です。
> > > > 下記検体№について、
> > > > ケミストリーに依頼があった項目コードをお調べいただきたいです。
> > > > 
> > > > ナカムラ　タカアキ様　　　　　　　　　　　
> > > > 2016/10/4　511-5022　　　
> > > > 2018/9/25　511-6387　　
> > > > 2020/9/30　511-5739　　
> > > > 
> > > > よろしくお願いいたします。
> > > > 
> > > > 辻
> > > > 

過去データをIAサーバから開発機に入れて抽出、エクセルにまとめて提出しました。
10.1.181.22にログインし過去データをコピーし解凍
cp -p/mnt/usb/bak_daily/2016-10-04/KEKKA.ixf.Z /nas/20221014
uncompress KEKKA.ixf.Z
cd /nas/20221014
mv KEKKA.ixf KEKKA.ixf_20161014
cp -p/mnt/usb/bak_daily/2018-09-25/KEKKA.ixf.Z /nas/20221014
uncompress KEKKA.ixf.Z
cd /nas/20221014
mv KEKKA.ixf KEKKA.ixf_2018-09-25
cp -p/mnt/usb/bak_daily/2020-09-30/KEKKA.ixf.Z /nas/20221014
gunzip -d KEKKA.ixf.gz

kea00apkで実行。(select文をCSEで実行し保存。)
cd /nas/20221014
db2 connect to kea00db9 user kea00dbt using kea00dbt
db2 "delete from kekka"
db2 "import from KEKKA.ixf of ixf commitcount 100000 insert into kekka"
select * from kekka where utkymd='2020-09-30' and irino='00511573900'
db2 "delete from kekka"
db2 "import from KEKKA.ixf_20161014 of ixf commitcount 100000 insert into kekka"
select * from kekka where utkymd='2016-10-04' and irino='00511502200'
db2 "delete from kekka"
db2 "import from KEKKA.ixf_2018-09-25 of ixf commitcount 100000 insert into kekka"
select * from kekka where utkymd='2018-09-25' and irino='00511638700'


--------------------------------------------------------------------
291：清水 竜也; 総研検査システム１課
2022年11月05日（土） 01:15

電算課よりパトライト点灯連絡（横田課長より代打)

調査開始=23:10

daily.log を確認すると
今日は日次の裏処理が RUI_KEKKAの importで 21時半頃から止まっており、NGなパターン。
以下のリカバリーを実施。
・日次Job関連をkill
・累積DBを再起動
・リカバリー用sh を起動する。23:46開始
・電算課へパトランプ消灯の連絡。 23:48

リカバリー詳細手順は、添付の通り。



日次の累積が遅くなる件の対応.xlsx

--------------------------------------------------------------------
292：清水 竜也; 総研検査システム１課
2022年11月05日（土） 01:37

>>291
補足：

リカバリ用shは、通常の裏処理とログ終端の内容が違う。
ログを見た感じだと通常は累積データブルの期限切れデータを削除しているが
リカバリーshは、それを端折っている模様。

●リカバリ側のログ：
oldday/kekka_out/63164_____005_001667429433.dat
oldday/kekka_out/XM_63381_____004_001667407470.2.dat
oldday/kekka_out/72772_____005_001667408364.dat
[2022年 11月  5日 土曜日 01:22:49 JST][kekka_out] rm start ----->
  2022/11/05 01:27:13▲▲ EXPORTファイル(ixf, msg)圧縮＆結果out圧縮・削除 --- 終了 ▲▲
2022/11/05 01:27:13▲▲ 日次処理 --- 終了 ▲▲


●通常のログ：
2022年 11月  2日 水曜日 19:53:28 JST][RUI_CTRLKKA] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
[2022年 11月  2日 水曜日 19:57:13 JST][SHUSEI_KANJYA] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
DB20000I  TERMINATE コマンドが正常に完了しました。
  2022/11/02 19:57:13▲▲ 累積集計情報runstats --- 終了 ▲▲
2022/11/02 19:57:13▲▲ 日次処理 --- 終了 ▲▲

--------------------------------------------------------------------
293：小林 洋一; 総研検査システム２課
2022年11月08日（火） 17:59

問合者=自動分析課和泉,対応時間(分)=30
エクセル(Ｈ．ピロリ濃度　上限直値報告　検査結果一覧　出力)でエラーが発生するので対応してほしい。
ヘリコ結果一覧_上限直値報告_最新.xlsを確認、修正。
表示結果(HJKKA)に削除コメント(*500)が入っていたことが原因でSQLエラーになっていました。
下記SQLに1行追加して対応。

    '■SQL作成
    strSQL = ""
    strSQL = strSQL & " SELECT"
    strSQL = strSQL & "     KKA.UTKYMD,"
    strSQL = strSQL & "     KKA.IRINO,"
    strSQL = strSQL & "     KMK.KMKCD,"
    strSQL = strSQL & "     KMK.KMKRSJ,"
    strSQL = strSQL & "     KKA.SSTCD,"
    strSQL = strSQL & "     KKA.TRID,"
    strSQL = strSQL & "     KKA.TRPOS,"
    strSQL = strSQL & "     KKA.KNSSU,"
    strSQL = strSQL & "     KKA.KNSKKA1"
    strSQL = strSQL & " FROM"
    strSQL = strSQL & "     KEKKA KKA,"
    strSQL = strSQL & "     KMKMST KMK"
    strSQL = strSQL & " WHERE"
    strSQL = strSQL & "     KKA.KNSGRP = KMK.KNSGRP AND"
    strSQL = strSQL & "     KKA.KMKCD = KMK.KMKCD AND"
    strSQL = strSQL & "     KKA.KNSKISYMD = '"
    strSQL = strSQL & vstrSriYmd
    strSQL = strSQL & "' AND"
    strSQL = strSQL & "     KKA.KMKCD IN ('0002908','0022665') AND"
    strSQL = strSQL & "     KKA.KKAJKCD = '3' AND"
    strSQL = strSQL & "     KKA.HJKKA not like '*%' AND "   ' 20221108 add
    strSQL = strSQL & "     KKA.HJKKA <> '' AND INTEGER(KKA.HJKKA) >= 100.0 AND "
    strSQL = strSQL & "     KKA.KKAHSKCD = ''"
    strSQL = strSQL & " ORDER BY KKA.UTKYMD,KKA.IRINO,KNSSU"


--------------------------------------------------------------------
294：横田 克夫; 総研検査システム２課
2022年11月23日（水） 00:28

問合者=電算課＆エラーメール,対応時間(分)=60

[2022年 11月 23日 水曜日 00:20:01 JST]マルチ エラーログ 報告
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2022年11月23日（水） 00:20
To （2件）  	 ： 	multi_log@bml.co.jp ... （→宛先をすべて表示する）

[ /apdata/aplog/FATAL_DAILY_20221123_0015022022-11-21_20221122220659.log ]
-------------------------------------------------------------------
<<<<<  日次処理チェックメール  >>>>>
日次が正常に終わっていない可能性があります。
2022-11-21_20221122220659 ログを確認して下さい。
2022/11/22 22:05:45▼▼ 日次処理 --- 開始 ▼▼
-------------------------------------------------------------------

上記、エラーログが存在しています。確認してください。

→上記のようなエラーメールが配信される。
→日次処理のログ（/apdata/oldday/2022-11-21/daily.log）を確認すると処理が進行している。
→チェッククーロンが誤作動している模様
　/home/kea00sys/shell/cron/chk_daily_ended.sh
→チェッククーロンを停止させる。
　kea00sys@kea00apa:/apdata/aplog> ps -ef | grep ended
　kea00sys 34484 34478  0 11月22 ?       00:00:00 /bin/bash /home/kea00sys/shell/cron/chk_daily_ended.sh
　kea00sys 43134 58975  0 00:20 pts/0    00:00:00 grep --color=auto ended
　kea00sys@kea00apa:/apdata/aplog> kill -9 34484
　kea00sys@kea00apa:/apdata/aplog> ps -ef | grep ended
　kea00sys 45297 58975  0 00:23 pts/0    00:00:00 grep --color=auto ended
→電算課に対応完了の旨、連絡
→平日に再度調査が必要。

--------------------------------------------------------------------
295：横田 克夫; 総研検査システム２課
2022年11月23日（水） 01:01

>>294
パトランプ点灯が再発。

→olddayは以下を確認すると、下記の状況
kea00sys@kea00apa:/apdata/oldday> ls -l
合計 11708
drwxr-xr-x 2 kea00sys users    16384 11月 17 21:02 2022-11-16
drwxr-xr-x 2 kea00sys users    16384 11月 19 00:21 2022-11-17
drwxr-xr-x 2 kea00sys users    16384 11月 19 21:34 2022-11-18
drwxr-xr-x 2 kea00sys users    16384 11月 21 22:56 2022-11-19
drwxr-xr-x 2 kea00sys users    16384 11月 23 00:37 2022-11-21
drwxr-xr-x 2 kea00sys users     4096 11月 22 22:05 2022-11-21_20221122220659
-rw-r--r-- 1 kea00sys users       11 11月 21 23:03 checked.dat
drwxr-xr-x 2 kea00sys users 11255808 11月 23 00:01 kekka_out
drwxr-xr-x 2 kea00sys users   626688 11月 22 22:31 rack_out
-rw-r--r-- 1 kea00sys users     5228 11月 21 04:01 rui_runstats.log

→”2022-11-21_20221122220659”というディレクトリがあり。
kea00sys@kea00apa:/apdata/oldday> ls 2022-11-21_20221122220659
daily.log
kea00sys@kea00apa:/apdata/oldday> cat 2022-11-21_20221122220659/daily.log
2022/11/22 22:05:45▼▼ 日次処理 --- 開始 ▼▼
kea00sys@kea00apa:/apdata/oldday>

→このディレクトリがご検知の原因と考えられるため、ディレクトリを退避
kea00sys@kea00apa:/apdata/oldday> mkdir bak
kea00sys@kea00apa:/apdata/oldday> mv 2022-11-21_20221122220659 bak
kea00sys@kea00apa:/apdata/oldday> ls -l
合計 11708
drwxr-xr-x 2 kea00sys users    16384 11月 17 21:02 2022-11-16
drwxr-xr-x 2 kea00sys users    16384 11月 19 00:21 2022-11-17
drwxr-xr-x 2 kea00sys users    16384 11月 19 21:34 2022-11-18
drwxr-xr-x 2 kea00sys users    16384 11月 21 22:56 2022-11-19
drwxr-xr-x 2 kea00sys users    16384 11月 23 00:37 2022-11-21
drwxr-xr-x 3 kea00sys users     4096 11月 23 01:01 bak
-rw-r--r-- 1 kea00sys users       11 11月 21 23:03 checked.dat
drwxr-xr-x 2 kea00sys users 11255808 11月 23 00:01 kekka_out
drwxr-xr-x 2 kea00sys users   626688 11月 22 22:31 rack_out
-rw-r--r-- 1 kea00sys users     5228 11月 21 04:01 rui_runstats.log

→これで、エラーメールが止まるか？！..............

--------------------------------------------------------------------
296：横田 克夫; 総研検査システム２課
2022年11月23日（水） 01:04

>>295
シェル見ていると止まらない可能性があるので、ディレクトリを移動
mv bak /home/kea00sys/work/yokota

--------------------------------------------------------------------
297：横田 克夫; 総研検査システム２課
2022年11月30日（水） 20:14

問合者=エラーメール,対応時間(分)=15

[2022年 11月 30日 水曜日 20:10:09 JST]マルチ異常報告
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2022年11月30日（水） 20:11
To （2件）  	 ： 	multi_log@bml.co.jp, multi_error@bml.co.jp （←宛先を隠す）

AD102 依頼展開
AD103 患者展開
AD105 分注展開
AD106 分注展開_裏プロセス
AD107 ３ＩＤ受信
AD108 ３ＩＤ展開
BD301 供給ストッカ
BD302 回収ストッカ
BD401 サンプラ
DD401 結果登録
FD101 監視バッチ
FD103 自動校正
JD112 検査進行状況集計
GD102 HULFT送信
GD105 検査結果報告
ZD101 ログ出力
LD103 属性修正情報取得
LD104 結果要求カード作成
LD105 他サテライト結果情報取得
LD106 再計算処理
MD101_L1 ＺＳオンライン１
MD101_L2 ＺＳオンライン２
MD102_L1 ＺＳ再検判定１
MD102_L2 ＺＳ再検判定２
MD103 ＺＳ用投入トレー登録
MD104 ＺＳ用収納トレー登録
MD105 ＺＳ用結果登録
ND102 オーダーラック登録

上記プロセスが起動していません。確認してください。

↓

kea00sys@kea00apa:/apdata/oldday/2022-11-29> cat daily.log
2022/11/30 20:08:13▼▼ 日次処理 --- 開始 ▼▼
受付日は[2022-11-30]でよろしいですか(y/n)
  2022/11/30 20:08:20▼▼ 常駐プロセスの停止 --- 開始 ▼▼

   データベース接続情報

 データベース・サーバー = DB2/LINUXZ64 11.1.4.4
 SQL 許可 ID            = DB2INST1
 ローカル・データベース別名 = KEA00DB

DB20000I  SQL コマンドが正常に完了しました。
DB20000I  TERMINATE コマンドが正常に完了しました。
PROC_Z_SM=(5102 5103 5105 5107 5108 5301 6301 6302 6401 7401 9101 9103 11112 10102 10105 12101 13001 13003 13004 13005 13006

↓

日次処理が始まって、プロセス停止をご検知した模様。
特にリカバリ無し。

--------------------------------------------------------------------
298：小林 洋一; 総研検査システム２課
2022年12月02日（金） 13:49

問合者=自動分析課ケミストリ青木,対応時間(分)=30
青山会PG比抽出リストが出力できないので対応してほしい。
結果値に空白が含まれていたためDOUBLEに変換するときにエラーが発生。
VBAの下記SQLに条件を追加しました。
    '■SQL作成
    strSQL = strSQL & "SELECT KKA.UTKYMD,KKA.IRINO,KKA.SSTCD,KKA.SSTRSJ,KKA.HJKKA FROM"
    strSQL = strSQL & " (SELECT"
    strSQL = strSQL & "    KEKKA.UTKYMD,"
    strSQL = strSQL & "    KEKKA.IRINO,"
    strSQL = strSQL & "    KANJYA.SSTCD,"
    strSQL = strSQL & "    KANJYA.SSTRSJ,"
    strSQL = strSQL & "    DOUBLE(KEKKA.HJKKA) AS HJKKA"
    strSQL = strSQL & " FROM"
    strSQL = strSQL & "    KEKKA"
    strSQL = strSQL & "    LEFT JOIN KANJYA KANJYA"
    strSQL = strSQL & "           ON KEKKA.UTKYMD = KANJYA.UTKYMD AND KEKKA.IRINO = KANJYA.IRINO"
    strSQL = strSQL & " WHERE"
    strSQL = strSQL & "    KEKKA.SRIYMD = '"
    strSQL = strSQL & vstrSriYmd
    strSQL = strSQL & "' AND"
    strSQL = strSQL & "    KEKKA.KMKCD IN ('0004125','0021996') AND"
    strSQL = strSQL & "    KEKKA.SSTCD IN ('1808900','2709000','2765300','2765400','4858400','5993700','8285700','9204900','9390700','1549101','2014001') AND"
    strSQL = strSQL & "    KEKKA.KKAJKCD = '3'"
    strSQL = strSQL & "  AND length(trim(KEKKA.HJKKA))>0" '20221202 add
    strSQL = strSQL & "  AND KEKKA.HJKKA not like '*%'"   '20221202 add
    strSQL = strSQL & "  ) KKA"
    strSQL = strSQL & " WHERE KKA.HJKKA >= 2.8 AND KKA.HJKKA <= 3.2 "
    strSQL = strSQL & " ORDER BY"
    strSQL = strSQL & "    KKA.UTKYMD,"
    strSQL = strSQL & "    KKA.IRINO"

以上


--------------------------------------------------------------------
300：羽生 達哉; 総研検査システム２課
2022年12月03日（土） 12:35

問合者=自動分析課ケミストリ竹沢,対応時間(分)=60
前読み装置でトレーを誤読したので情報をリセットしてほしい

対象データをexportしてから下記SQLを実行

select * from KENORDER  WHERE KNSKISYMD = '2022-12-02' AND TRID in ('2RRX0005','2RRX0006') AND KNSJKFLG <> ' ' for read only

update KENORDER SET TRID = '____0000', TRPOS = 0, KNSJKFLG = ' ' WHERE KNSKISYMD = '2022-12-02' AND TRID in ('2RRX0005','2RRX0006') AND KNSJKFLG <> ' '

select * from KENPOS WHERE KNSKISYMD = '2022-12-02' AND TRID in ('2RRX0005','2RRX0006') AND RAKITJHO = 'A' for read only

delete from KENPOS WHERE KNSKISYMD = '2022-12-02' AND TRID in ('2RRX0005','2RRX0006') AND RAKITJHO = 'A'

--------------------------------------------------------------------
301：羽生 達哉; 総研検査システム２課
2022年12月03日（土） 15:24

>>300
これだけではだめっだった模様。
検査側で対応してもらった。

POT のSTEP3のバーコードを読み込んでしまった。

--------------------------------------------------------------------
303：羽生 達哉; 総研検査システム２課
2022年12月06日（火） 10:29

>>301
前読み装置側でトレーの削除処理が必要。

ライン側の前読み装置：トレーＩＤを変えてもらう。
ＺＳ側の前読み装置：装置側に削除処理があるので実施してもらう。

--------------------------------------------------------------------
304：羽生 達哉; 総研検査システム２課
2022年12月06日（火） 16:18

前読み装置でラック誤読時のリセット

kea00sys@kea00apk:~> cd /apdata/work/maeyomi
kea00sys@kea00apk:/apdata/work/maeyomi> ./reset.sh
で実行。

/apdata/work/maeyomi/ に日付の名前でディレクトリを作ってデータをexport後DBを更新します。

※※実行するとこんな感じです。

kea00sys@kea00apk:/apdata/work/maeyomi> ls
./  ../  reset.sh*
kea00sys@kea00apk:/apdata/work/maeyomi> ./reset.sh
--------------------------------------------------------------------------------

前読み情報のリセットをします。

--------------------------------------------------------------------------------
検査開始日を入力してください。
検査開始日(YYYY-MM-DD):2022-10-21
トレーIDを入力してください。
トレーID:2RRX0002
検査開始日:2022-10-21 トレーID:2RRX0002  でよろしいですか？
(y/n/q):y
検査開始日:2022-10-21 トレーID:2RRX0002  をリセットします

------------------------------------------------------------

データベース情報をリセットしました
ライン側の前読み装置の場合はトレーIDを変えて登録してください
ZS側の前読み装置の場合は装置側でトレー情報を削除してください

------------------------------------------------------------

kea00sys@kea00apk:/apdata/work/maeyomi> ls
./  ../  2022-12-06/  reset.sh*
kea00sys@kea00apk:/apdata/work/maeyomi> cd 2022-12-06/
kea00sys@kea00apk:/apdata/work/maeyomi/2022-12-06> ls
./  ../  KENORDER_20221206160552.del  KENORDER_20221206160552.msg  KENPOS_20221206160552.del  KENPOS_20221206160552.msg
kea00sys@kea00apk:/apdata/work/maeyomi/2022-12-06> ll
合計 36
drwxr-xr-x 2 users  4096 12月  6 16:05 ./
drwxr-xr-x 3 users  4096 12月  6 16:05 ../
-rw-r--r-- 1 users 10407 12月  6 16:05 KENORDER_20221206160552.del
-rw-r--r-- 1 users   221 12月  6 16:05 KENORDER_20221206160552.msg
-rw-r--r-- 1 users  4743 12月  6 16:05 KENPOS_20221206160552.del
-rw-r--r-- 1 users   219 12月  6 16:05 KENPOS_20221206160552.msg
kea00sys@kea00apk:/apdata/work/maeyomi/2022-12-06>


※※入力値チェックもしています。

kea00sys@kea00apk:/apdata/work/maeyomi> ./reset.sh
--------------------------------------------------------------------------------

前読み情報のリセットをします。

--------------------------------------------------------------------------------
検査開始日を入力してください。
検査開始日(YYYY-MM-DD):2022-13-01
date: `2022-13-01' は無効な日付です
日付フォーマットエラーです
検査開始日を入力してください。
検査開始日(YYYY-MM-DD):2022-12-32
date: `2022-12-32' は無効な日付です
日付フォーマットエラーです
検査開始日を入力してください。
検査開始日(YYYY-MM-DD):2022-12-10
トレーIDを入力してください。
トレーID:2RRR
トレーIDは８桁で入力です
トレーIDを入力してください。
トレーID:2RRR0001
検査開始日:2022-12-10 トレーID:2RRR0001  でよろしいですか？
(y/n/q):n
再入力します。
検査開始日を入力してください。
検査開始日(YYYY-MM-DD):2022-12-01
トレーIDを入力してください。
トレーID:7XXX0200
検査開始日:2022-12-01 トレーID:7XXX0200  でよろしいですか？
(y/n/q):y
検査開始日:2022-12-01 トレーID:7XXX0200  をリセットします
対象のデータがありません
検査開始日とトレーIDを確認してください
検査開始日:2022-12-01 トレーID:7XXX0200
kea00sys@kea00apk:/apdata/work/maeyomi>


※※入力時にQ/qで終了します

kea00sys@kea00apk:/apdata/work/maeyomi> ls
./  ../  2022-12-06/  reset.sh*
kea00sys@kea00apk:/apdata/work/maeyomi> ./reset.sh
--------------------------------------------------------------------------------

前読み情報のリセットをします。

--------------------------------------------------------------------------------
検査開始日を入力してください。
検査開始日(YYYY-MM-DD):q
kea00sys@kea00apk:/apdata/work/maeyomi> ./reset.sh
--------------------------------------------------------------------------------

前読み情報のリセットをします。

--------------------------------------------------------------------------------
検査開始日を入力してください。
検査開始日(YYYY-MM-DD):2022-01-01
トレーIDを入力してください。
トレーID:q
kea00sys@kea00apk:/apdata/work/maeyomi> ./reset.sh
--------------------------------------------------------------------------------

前読み情報のリセットをします。

--------------------------------------------------------------------------------
検査開始日を入力してください。
検査開始日(YYYY-MM-DD):2022-01-01
トレーIDを入力してください。
トレーID:12345678
検査開始日:2022-01-01 トレーID:12345678  でよろしいですか？
(y/n/q):q
kea00sys@kea00apk:/apdata/work/maeyomi>



--------------------------------------------------------------------
305：小林 洋一; 総研検査システム２課
2022年12月15日（木） 10:34

問合者=高梨,対応時間(分)=10
受付日:2022-12-09,依頼書NO:3776661の食塩摂取量が再計算待ちになっているので更新してほしい。
下記SQLをCSEで実行しバックアップ、更新し連絡しました。
select * from HKHRIRAI where  hkkhrkbn='3' and utkymd='2022-12-09' and irino='00377666100'
update HKHRIRAI set hkkhrkbn='0' where  hkkhrkbn='3' and utkymd='2022-12-09' and irino='00377666100'
select * from HKHRIRAI where utkymd='2022-12-09' and irino='00377666100'


--------------------------------------------------------------------
306：小林 洋一; 総研検査システム２課
2022年12月19日（月） 15:48

問合者=海老島,対応時間(分)=10
受付日:2022-12-14,依頼書NO:2553543の食塩摂取量が再計算待ちになっているので更新してほしい。
下記SQLをCSEで実行しバックアップ、更新し連絡しました。
select * from HKHRIRAI where  hkkhrkbn='3' and utkymd='2022-12-14' and irino='00255354300'
update HKHRIRAI set hkkhrkbn='0' where  hkkhrkbn='3' and utkymd='2022-12-14' and irino='00255354300'
select * from HKHRIRAI where utkymd='2022-12-14' and irino='00255354300'

--------------------------------------------------------------------
307：小林 洋一; 総研検査システム２課
2022年12月28日（水） 14:50

問合者=金山,対応時間(分)=10
受付日:2022-12-26,依頼書NO:2629375の食塩摂取量が再計算待ちになっているので更新してほしい。
下記SQLをCSEで実行しバックアップ、更新し連絡しました。
select * from HKHRIRAI where  hkkhrkbn='3' and utkymd='2022-12-26' and irino='00262937500'
update HKHRIRAI set hkkhrkbn='0' where  hkkhrkbn='3' and utkymd='2022-12-26' and irino='00262937500'
select * from HKHRIRAI where utkymd='2022-12-26' and irino='00262937500'


--------------------------------------------------------------------
308：清水 竜也; 総研検査システム１課
2022年12月31日（土） 14:34

作業日時：12/31　14時
Zサーバーのケミストリー区画、停止しました。
IA側はアプリの停止のみ実施しています。

なお、2022年夏に故障したUPSを交換。
同UPSにW08, W20の電源１本をつなぎ、従来の状態に戻しています。

上原さんへ
　起動よろしくお願いします。
　>>287  マウント確認




--------------------------------------------------------------------
309：上原 洋樹; 総研検査システム２課
2023年01月02日（月） 05:48

1/2 5:45
5:35に下のエラーメールが発報
ZD777 ファイル移動シェル
ZD888 オンライン起動プロセス
ZD999

IA21 号機にて、上記プロセスが起動していません。確認してください。
↓
プロセスは既に起動済みの為問題無し
[kea00sys@KEA00IAW21 aplog]$ ps -ef | grep ZD
kea00sys  2564     1  0 05:21 ?        00:00:00 /bin/bash - /home/kea00sys/bin/ZD777.sh
kea00sys  2593     1  0 05:21 ?        00:00:00 /bin/bash - /home/kea00sys/bin/ZD888.sh
kea00sys  2694     1  3 05:22 ?        00:00:59 /home/kea00sys/bin/ZD999IA /home/kea00sys/bin/ZD999IA.ini
kea00sys 13141 11755  0 05:47 pts/1    00:00:00 grep ZD
[kea00sys@KEA00IAW21 aplog]$

ファイルを確認すると2:10に作成されていた
[kea00sys@KEA00IAW21 aplog]$ ls -l FATAL_IA21.log.230102053003
-rw-r--r-- 1 kea00sys users 129  1月  2 02:10 2023 FATAL_IA21.log.230102053003
[kea00sys@KEA00IAW21 aplog]$

2:10にエラーが出力された原因については1/5確認する

--------------------------------------------------------------------
310：上原 洋樹; 総研検査システム２課
2023年01月02日（月） 07:19

>>309
手順書に、監視STOPファイルの作成と削除の手順が抜けていた。
2021年の手順書には存在していたが、作成し直した手順書に入っていなかった事が原因

"C:\Users\UEHARAHIROKI\Desktop\基幹Ｌｉｎｕｘ引継ぎ\ケミストリー\起動停止手順\ケミストリーシステム起動手順書_2021.doc"
・停止時
②	監視停止ファイルの作成。
kea00sys@kea00apa:~/shell/cron~> sh make_STOP_File.sh

・起動時
⑤	ディレクトリの移動。
⇒ cd /home/kea00sys/shell/

⑥	監視停止ファイルの削除。
⇒ rm STOP
[kea00sys@KEA00IAW21 shell]$ rm STOP

※あと、気になったのが
　21～24のチェックシェルが全部「IA21」でエラーを出力するようになっているようになっているように見えた
/home/kea00sys/shell/chk_proc_IA.sh

--------------------------------------------------------------------
311：清水 竜也; 総研検査システム１課
2023年01月04日（水） 12:43

問合者=自動分析課　和泉さん・菅野主任  対応時間(分)=30

問合内容：和泉さんより、BM33号機のコントロールが取り込まれないのでみて欲しいと連絡が入る。
聞くと31、32号機はできているとのこと。また話中、年末、zを停止した際、prcIA_onoff.sh で
33号機だけがプロセス停止できなかったことが頭をよぎる（csの該当ポートが接続されたままでは？）。
現在は３台どれもきりが良いとのことで、リモート確認前に念のためCSを再起動してもらった。

その後、リモートにて proc.shで 各号機の接続を確認すると、33号機だけ何故か停止状態であった。
すると同様の件で、菅野主任から電話あり、出社時8時半過ぎに分析機のオンライン状態をみた時は
33号機だけ接続され他はオフライン状態であったとのこと。

現在は、33号機がオフ状態であり、CSを再起動したところなので、33号機を接続状態へ
また31、32号機もCS再起動したので、一度オフラインにし再接続してくださいとお願いした。

オンラインしている該当のIA：KEA00IAW22　に入り、受信電文の
フォルダー：/home/kea00sys/appl/src/kns/DD201/dat/Log をしばらく確認していると
com_33.log、や com_31.log など 電文の受け渡しが進行しているので問題なしと判断。


--------------------------------------------------------------------
312：羽生 達哉; 総研検査システム２課
2023年01月05日（木） 11:10

@:清水 竜也; 総研検査システム１課

清水主任

お疲れ様です。
保守携帯は清水主任のロッカーへ入れてあります。

--------------------------------------------------------------------
313：清水 竜也; 総研検査システム１課
2023年01月05日（木） 11:42

@:羽生 達哉; 総研検査システム２課

>>312
わかりました。明日出社なのでそこでみます。

--------------------------------------------------------------------
315：島村 健汰; 総研検査システム１課
2023年01月06日（金） 17:02

各位

年末の保守対応で行った、DB2のイベントログの削除と再構成の作業手順書を
作成しました。

\\10.1.103.226\nas_backup\総研システム部\共用\★停電対応\システム起動停止マニュアル\A00_ケミストリー\年末対応\Zイベントログ再構成

⇒ DB2イベントログの削除＆再構成_第一版.xlsx

------------------------------------------------------

また、hinemosの監視ジョブの停止漏れがあった為、サテライト停止手順書を改訂しました。

\\10.1.103.226\nas_backup\総研システム部\共用\★停電対応\システム起動停止マニュアル\A00_ケミストリー\年末対応

⇒ 年末対応版_ケミストリーサテライト システム停止手順書_第三版.xlsx

\\10.1.103.226\nas_backup\総研システム部\共用\★停電対応\システム起動停止マニュアル\A00_ケミストリー

⇒ ケミストリーサテライト システム停止手順書_第三版.xlsx

--------------------------------------------------------------------
316：小林 洋一; 総研検査システム２課
2023年01月10日（火） 13:49

問合者=自動分析課菅野主任  対応時間(分)=30
LABOSPECT7号機でオンライン測定ができないので対応してほしい。
←分析機接続PCがオンラインになっていなかったため接続できていませんでした。


--------------------------------------------------------------------
317：清水 竜也; 総研検査システム１課
2023年01月10日（火） 19:11

アラートメール対応。〓対応時間(分)=30
また電算課より黄色のパトランプが点灯していると連絡が入る。

------------------------------
Subject: [2023年 1月 10日 火曜日 18:10:01 JST]マルチ エラーログ 報告
Date: Tue, 10 Jan 2023 18:10:15 +0900
From: kensys@bml.co.jp
To: multi_log@bml.co.jp, multi_error@bml.co.jp
kensys@bml.co.jp wrote:
> 
> [ /apdata/aplog/FATAL_CS_ERR.log ]
> -------------------------------------------------------------------
> 172.19.99.31 : 〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓
> 
> -------------------------------------------------------------------
> 
> 上記、エラーログが存在しています。確認してください。
--------------------------------

ping を打ってもやはり応答なし。

現物を確認する。

電源元を手繰ると、テーブルタップへ接続していた。
CSの他にもう一つコンセントつなげており、扇風機を接続。
タップにメインSWがあるタイプで、このSWが何故かOFFになっていた。
ONにし、CS側のSWを入れ直し。　緑色のPower LED点灯。

念のため、Z側のCUI画面で分析機のOn/Offをし直し。 LABO  #01, #02



--------------------------------------------------------------------
318：小林 洋一; 総研検査システム２課
2023年01月18日（水） 14:41

問合者=自動分析課金山  対応時間(分)=30
受日:2023/01/17
依頼No：2236808 
食塩摂取量の依頼のみケミストリにある。
計算元項目は全て岡山医学で測定しているため
ケミストリからは計算して報告できない。
今回は手入力で対応を依頼。

ラボ検査システム課井戸端さんへ連絡。
岡山医学でラボコードの登録～計算を実施するよう調整するとのことです。
ラボコードの登録が済むまでは手入力対応をお願いしますと金山さんへ伝えました。

--------------------------------------------------------------------
320：小林 洋一; 総研検査システム２課
2023年01月23日（月） 10:09

問合者=自動分析課金山  対応時間(分)=30
ラボで全て検査をしているが計算項目のみケミストリへ依頼がきた。
ケミストリでは手入力したので計算済みに更新してほしい。
受日:2023/01/20
依頼書NO:0939969
項目名:CCR:コッククロフト
項目コード:13185

下記SQLを実行し対応。
select * from HKHRIRAI where  hkkhrkbn='3' and utkymd='2023-01-20' and irino='00093996900'
update HKHRIRAI set hkkhrkbn='0' where  hkkhrkbn='3' and utkymd='2023-01-20' and irino='00093996900'
select * from HKHRIRAI where utkymd='2023-01-20' and irino='00093996900'

川越緊急でコッククロフトの登録を進めるよう井戸端さんへ依頼しました。

--------------------------------------------------------------------
321：清水 竜也; 総研検査システム１課
2023年01月27日（金） 22:24

日次アラートメール対応:   対応時間(分)=60

今日1/26は、裏JobがRUI_KEKKAの import で止まっていた。NGなパターン。

日次Jobをキャンセル。累積DBを再起動し、リカバリーJobを起動する。

対応手順は >>52 と同じ。


[2023年 1月 26日 木曜日 23:20:01 JST]マルチ エラーログ 報告
差出人 	 ：  	kensys@bml.co.jp 
送信日時 	 ：  	2023年01月26日（木） 23:20
To （2件）   ： 	multi_log@bml.co.jp ... 

[ /apdata/aplog/FATAL_DAILY_20230126_2315012023-01-25.log ]
-------------------------------------------------------------------
<<<<<  日次処理チェックメール  >>>>>
日次が正常に終わっていない可能性があります。
2023-01-25 ログを確認して下さい。
挿入された行数          = 883792
更新された行数          = 13683
拒否された行数          = 0
コミットされた行数      = 897475

[2023年  1月 26日 木曜日 22:42:14 JST][RUI_KANJYA] import start ----->

読み込まれた行数        = 107499
スキップされた行数      = 0
挿入された行数          = 104560
更新された行数          = 2939
拒否された行数          = 0
コミットされた行数      = 107499

[2023年  1月 26日 木曜日 22:52:52 JST][RUI_KEKKA] import start ----->
-------------------------------------------------------------------

上記、エラーログが存在しています。確認してください。

--------------------------------------------------------------------
322：清水 竜也; 総研検査システム１課
2023年01月27日（金） 22:48

Hinemosからのアラートメール対応  対応時間(分)=90

確認すると日次は終了し、裏JOBが実行中であった。

メール内容より70％を超えたため発報され始めたと思われる。
依頼展開処理は正常に動作しているが、横田課長に連絡し、一緒にみて頂く。

ブラウザから "10.1.50.249" で、hinemos画面参照。

-----
From: Hinemos Admin <kensys@bml.co.jp>
日付: 2023年1月27日(金) 21:00
件名: Hinemos通知(危険)
To: <kasmi777@ezweb.ne.jp>, <multi_error@bml.co.jp>

出力日時 : 2023-01-27 21:00:04
アプリケーション : ログファイル監視_表スペース（ケミストリ）
重要度 : 危険
メッセージ : 23/01/27 21:00:02 DB20001E DB2 TableSpace(DB_DATA01) is FULL UsablePgs= 71 パーセント
スコープ : kea00dba
----

対応内容としては
Hinemosで検知するDBスペース状況のファイル /var/log/kansi.log が
crontab で30分おきに起動するシェルで作成しており
その 閾値が 70 であった。これを 75に あげた。


crontab 

#DB2MONITOR BY INTEC
*/30 * * * * /opt/script/monitor/DB2MON-30.sh が

さらに 
db2_tbscount_m.sh 呼び、この中の閾値が70%であった。

 45 #                                 　　　　　　          　↓閾値！
 46 #                                                                  ↓出力ディレクトリ
 47   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_DATA01        75` " >> $DIR_T01	
 48   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_DATA02        75` " >> $DIR_T02	
 49   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_INDEX01       75` " >> $DIR_T03	
 50   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_INDEX02       75` " >> $DIR_T04	
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　●変更

20230127_DBスペース監視閾値変更.xlsx

--------------------------------------------------------------------
323：横田 克夫; 総研検査システム２課
2023年01月28日（土） 06:25

問合者=エラーメール　対応時間=15分

[2023年 1月 28日 土曜日 06:10:05 JST]マルチ異常報告
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2023年01月28日（土） 06:10
To （2件）  	 ： 	multi_log@bml.co.jp, multi_error@bml.co.jp （←宛先を隠す）

ND101 フロンティアラック登録

上記プロセスが起動していません。確認してください。


以下と同様に対応
https://bmlgrp.cybozu.com/g/message/view.csp?cid=22503&rid=134886&mid=657153&follow_id=249#follow

→

１．ログを確認。
kea00sys@kea00apa:/apdata/aplog> view ND101_20230128.log
2023/01/28  05:58:09    T   kea00apa    17749   kea00sys    ND101   ND101.c sFncMakeSkipFile    610     00000000    スキップファイルを出力しました。[FILE_NAME:/apdata/today/file/rack/SKIP/SKIP_20230127_74570.dat]
2023/01/28  05:58:09    T   kea00apa    17749   kea00sys    ND101   ND101.c sFncMakeSkipFile    610     00000000    スキップファイルを出力しました。[FILE_NAME:/apdata/today/file/rack/SKIP/SKIP_20230127_74745.dat]
2023/01/28  05:58:09    T   kea00apa    17749   kea00sys    ND101   ND101.c mainFunction    319     00000000    ファイル処理終了[A00_20230128055801.dat] レコード数[0]
2023/01/28  05:58:19    T   kea00apa    17749   kea00sys    ND101   ND101.c mainFunction    266     00000000    ファイル処理開始[/apdata/today/file/rack/A00_20230128055812.dat]
2023/01/28  05:58:19    T   kea00apa    17749   kea00sys    ND101   ND101.c sFncGetFileRecord   462     00000000    ＥＮＤ情報を受信しました。
→なぜか、END情報を受信している。

２．ファイルを確認
-rw-r--r-- 1 kea00sys users     29  1月 28 05:58 SKIP_20230127_74745.dat
drwxr-xr-x 2 kea00sys users 671744  1月 28 05:58 OK
-rw------- 1 kea00sys users     16  1月 28 05:58 A00_20230128055812.dat
-rw------- 1 kea00sys users      2  1月 28 05:58 A00_20230128055812.trg
drwxr-xr-x 2 kea00sys users  36864  1月 28 06:00 SKIP
-rw------- 1 kea00sys users   1160  1月 28 06:04 A00_20230128060423.dat
-rw------- 1 kea00sys users      3  1月 28 06:04 A00_20230128060423.trg
-rw------- 1 kea00sys users   3480  1月 28 06:07 A00_20230128060734.dat
-rw------- 1 kea00sys users      4  1月 28 06:07 A00_20230128060734.trg
-rw------- 1 kea00sys users   1160  1月 28 06:10 A00_20230128061044.dat
-rw------- 1 kea00sys users      3  1月 28 06:10 A00_20230128061044.trg
-rw------- 1 kea00sys users   1160  1月 28 06:17 A00_20230128061655.dat
-rw------- 1 kea00sys users      3  1月 28 06:17 A00_20230128061655.trg
kea00sys@kea00apa:/apdata/today/file/rack> cat A00_20230128055812.dat
20230127,END,22
kea00sys@kea00apa:/apdata/today/file/rack> cat A00_20230128055812.trg
0
kea00sys@kea00apa:/apdata/today/file/rack>
→END情報を確認


３．ファイル待避
対象のファイルは２回目のＥＮＤ情報のみのファイルと判断し、検査内容へ影響なさそうなので
ファイル名を変更し待避する。

kea00sys@kea00apa:/apdata/today/file/rack> mv A00_20230128055812.dat A00_20230128055812.dat.aaa
kea00sys@kea00apa:/apdata/today/file/rack> mv A00_20230128055812.trg A00_20230128055812.trg.aaa

４．ND101を再起動
~/bin/proc.shよりND101を再起動
リネームしたファイル以外が処理されることを確認。


--------------------------------------------------------------------
324：小林 洋一; 総研検査システム２課
2023年01月31日（火） 17:58

問合者=横田課長　対応時間=60分
分析機の調子がわるく再測定をかけた
再測定の範囲指定が誤っていたので
PG1 1回目、PG2 2回目で計算を行い
PG比が誤った値で報告された。
一覧を作成してほしい。

誤った値を確認した依頼
受日:2023-01-17
依頼書NO:5909732

下記SQLを実行しデータを抽出
select k1.utkymd,k1.irino,k1.kmkcd,k1.kmkrs,k1.knskka1 as pg1,k2.kmkcd,k2.kmkrs,k2.knskka1 as pg2,k3.kmkcd,k3.kmkrs,k3.knskka1 as hi from v_keka as k1,v_keka as k2,v_keka as k3 where k1.utkymd='2023-01-17' and
k1.utkymd=k2.utkymd and k1.irino=k2.irino and k1.utkymd=k3.utkymd and k1.irino=k3.irino and k1.knsgslbcd='001' and
k1.kmkcd='0003734' and
k2.kmkcd='0003735' and
k3.kmkcd='0003736' union all
select k1.utkymd,k1.irino,k1.kmkcd,k1.kmkrs,k1.knskka1 as pg1,k2.kmkcd,k2.kmkrs,k2.knskka1 as pg2,k3.kmkcd,k3.kmkrs,k3.knskka1 as hi from v_keka as k1,v_keka as k2,v_keka as k3 where k1.utkymd='2023-01-17' and
k1.utkymd=k2.utkymd and k1.irino=k2.irino and k1.utkymd=k3.utkymd and k1.irino=k3.irino and k1.knsgslbcd='001' and
k1.kmkcd='0022670' and
k2.kmkcd='0022671' and
k3.kmkcd='0022672' union all
select k1.utkymd,k1.irino,k1.kmkcd,k1.kmkrs,k1.knskka1 as pg1,k2.kmkcd,k2.kmkrs,k2.knskka1 as pg2,k3.kmkcd,k3.kmkrs,k3.knskka1 as hi from v_keka as k1,v_keka as k2,v_keka as k3 where k1.utkymd='2023-01-17' and
k1.utkymd=k2.utkymd and k1.irino=k2.irino and k1.utkymd=k3.utkymd and k1.irino=k3.irino and k1.knsgslbcd='001' and
k1.kmkcd='0022677' and
k2.kmkcd='0022678' and
k3.kmkcd='0022679' union all
select k1.utkymd,k1.irino,k1.kmkcd,k1.kmkrs,k1.knskka1 as pg1,k2.kmkcd,k2.kmkrs,k2.knskka1 as pg2,k3.kmkcd,k3.kmkrs,k3.knskka1 as hi from v_keka as k1,v_keka as k2,v_keka as k3 where k1.utkymd='2023-01-17' and
k1.utkymd=k2.utkymd and k1.irino=k2.irino and k1.utkymd=k3.utkymd and k1.irino=k3.irino and k1.knsgslbcd='001' and
k1.kmkcd='0021994' and
k2.kmkcd='0021995' and
k3.kmkcd='0021996' union all
select k1.utkymd,k1.irino,k1.kmkcd,k1.kmkrs,k1.knskka1 as pg1,k2.kmkcd,k2.kmkrs,k2.knskka1 as pg2,k3.kmkcd,k3.kmkrs,k3.knskka1 as hi from v_keka as k1,v_keka as k2,v_keka as k3 where k1.utkymd='2023-01-17' and
k1.utkymd=k2.utkymd and k1.irino=k2.irino and k1.utkymd=k3.utkymd and k1.irino=k3.irino and k1.knsgslbcd='001' and
k1.kmkcd='0021642' and
k2.kmkcd='0021643' and
k3.kmkcd='0021644' 

抽出した結果から属性を抽出
select * from v_pzok where utkymd='2023-01-17' and irino in(
'00590571900','00590572000','00590572200','00590572300','00590550300','00590550400','00590549900',
'00590550000','00590550100','00590514600','00590514700','00590514900','00590515000','00590515100',
'00590515200','00590512900','00590513100','00590570400','00590973100','00590973200','00590973300',
'00590972400','00590972500','00590972600','00590972700','00590544400','00590544600','00590586900',
'00590587000','00590587100','00590587200','00590587300','00590587400','00590587500','00590587600',
'00590587700','00590587800')

エクセルで計算、比較
未報告リストの形式に変換して提出しました。






PG比20230117.xlsx

--------------------------------------------------------------------
325：小林 洋一; 総研検査システム２課
2023年02月01日（水） 10:50

問合者=横田課長、自動分析課倉持　対応時間=60分
下記エラーメッセージが表示され、10連ラベルが出力できないので対応してほしい。
ワークシート画面でエラーが発生したので画面をクリアします。
エラー発生個所:10連ラベルファイル出力

ログを確認
2023/02/01	07:47:53	OPT	CS202	7200    	frmCS201						mf_SummaryBunchuRyo START
2023/02/01	07:47:53	OPT	CS202	7200    	frmCS201						SQL： SELECT    STBL.UTKYMD   ,STBL.IRINO   ,CASE       WHEN BCRMST.HJBCRMIN >  (STBL.SUM_BCRTJ+BCRMST.HJBCRBAS) THEN BCRMST.HJBCRMIN      WHEN BCRMST.HJBCRMAX <  (STBL.SUM_BCRTJ+BCRMST.HJBCRBAS) THEN BCRMST.HJBCRMAX      ELSE STBL.SUM_BCRTJ+BCRMST.HJBCRBAS    END BCRTJ FROM   (      SELECT         IRI.UTKYMD        ,IRI.IRINO        ,IRI.KNSGRP        ,SUM(KMST.BCRTJ) AS SUM_BCRTJ      FROM         IRAI IRI        ,KMKMST KMST      WHERE             IRI.KNSGRP = KMST.KNSGRP         AND IRI.KMKCD  = KMST.KMKCD         AND KMST.KAIYMD <= CURRENT DATE         AND KMST.HAIYMD >= CURRENT DATE         AND IRI.UTKYMD = '2023-01-31'         AND IRI.IRINO  = '00071652100'         AND IRI.KNSGRP = '0810            '      GROUP BY         IRI.UTKYMD        ,IRI.IRINO        ,IRI.KNSGRP   ) STBL   ,BNCRYMST BCRMST WHERE       STBL.KNSGRP = BCRMST.KNSGRP   AND BCRMST.KAIYMD <= CURRENT DATE   AND BCRMST.HAIYMD >= CURRENT DATE FOR READ ONLY
2023/02/01	07:47:53	OPT	CS202	7200    	frmCS201						mf_GetId2Else START
2023/02/01	07:47:53	OPT	CS202	7200    	frmCS201						SQL：SELECT SRIYMD,IRINO,SMPCD,ID2, ID2POS FROM BUNCHU WHERE  SRIYMD = '2023-01-31' AND IRINO = '00071652100' AND SMPCD = '0810   '  AND KNTNO not in('00071652101  ')  GROUP BY SRIYMD,IRINO,SMPCD,ID2, ID2POS  ORDER BY ID2, ID2POS  FOR READ ONLY 
2023/02/01	07:47:53	ERR	CS201	7200    	CS201	frmCS201	mf_OutputLblInfo	11563			10連ラベル情報ファイル出力失敗：パス 'X:\label\10label\A0_LBL12.use' へのアクセスが拒否されました。
2023/02/01	07:47:57	ERR	CS202	7200    	CS202	frmCS201	btnF5func	66			10連ラベル ファイル出力でエラー発生：オブジェクト参照がオブジェクト インスタンスに設定されていません。( IsNothing(mintProcIndex)=False,IsNothing(mintProcCount)=False)
2023/02/01	07:47:58	OPT	CS202	7200    	frmCS201						SknHaitaChkEnd START

2023/02/01	07:49:53	ERR	CS201	7200    	CS201	frmCS201	mf_OutputLblInfo	11563			10連ラベル情報ファイル出力失敗：既に同名のファイルが存在しています。
2023/02/01	07:52:48	ERR	CS202	7200    	CS202	frmCS201	btnF5func	66			10連ラベル ファイル出力でエラー発生：オブジェクト参照がオブジェクト インスタンスに設定されていません。( IsNothing(mintProcIndex)=False,IsNothing(mintProcCount)=False)
2023/02/01	07:52:58	OPT	CS202	7200    	frmCS201						SknHaitaChkEnd START

ファイルを確認しリネーム
kea00sys@kea00apa:/apdata/today/file/label/10label> ls -la
合計 24
drwxrwxr-x 3 kea00sys users  4096  2月  1 10:24 .
drwxrwxr-x 4 kea00sys users  4096  4月 27  2022 ..
-rw-r--r-- 1 kea00sys users  2025  2月  1 07:45 A0_LBL12.use
drwxrwxr-x 2 kea00sys users 12288  2月  1 10:24 ftp
kea00sys@kea00apa:/apdata/today/file/label/10label> mv A0_LBL12.use A0_LBL12.use_bak
kea00sys@kea00apa:/apdata/today/file/label/10label> cat A0_LBL12.use_bak
086000013086000012023013101677490100T001123ｸﾏA0   W             T003196T003197
086000023086000022023013101677450100T001125ﾎｼA0   W             T003194T003198
086000033086000032023013101677340100T001127ﾊﾙA0
086000043086000042023013101677230100T001128ﾌｶA0   W             T003201
086000053086000052023013199333022100T001609ｵﾄA0
086000063086000062023013173408530200T001834ｶﾜA0   W
086000073086000072023013173408480200T001837ﾑﾗA0   W
086000083086000082023013173408470200T001838ﾊﾀA0   W
086000093086000092023013173408460100T001839ｱﾘA0
086000103086000102023013173408430200T001840ﾏｽA0   W
086000113086000112023013173408920200T001871ﾂﾉA0   W
086000123086000122023013173408900200T001873ｻｶA0   W
086000133086000132023013173408870200T001875ﾔﾘA0   W
086000143086000142023013173408770200T001877ﾔﾈA0   W
086000153086000152023013105862410100V400014ｷﾇA0
kea00sys@kea00apa:/apdata/today/file/label/10label>

select * from knsgmst where splblid like 'A0_LBL12%' limit 10
KNSGRP	KNSGRPNM	KNSGRPRS	SECCD	KNSHOKBN	KNSSBT	BGROUP	UNYOKBN	SEQKTHSOK	SEQKTHSNG	WSSSKSOK	WSSSKSNG	MINRYO	MAXRYO	SKITRAY	MBTTRAY	SKNTRAY	SSTTRAY	KNSYB	YKCD	SKIWSID	SKNWSID	KKALSTID	SPLBLID	LSTYB1	LSTYB2	KAIYMD	HAIYMD	HNKTNTID	KSNDH
0810            	ＡＬＤ和光                              	ＡＬＤ和光          	A 	自動分析装置（ＢＭ８０６０）            	I	3	R	100	100	4	4	310	460	2810      	2810      	2810      	2810      	0111111	MLTC	CP20203b            	CP20203b            	マルチ              	A0_LBL12            	CP20203b            	CP20203b            	2007-04-02	2100-12-31	001004  	2014-12-01 00:00:00.000000
3086            	Ｈ－ＦＡＢＰ                            	Ｈ－ＦＡＢＰ        	A 	自動分析装置（ＢＭ８０６０）            	I	3	R	100	100	2	4	0	0	1FAB      	2FAB      	2FAB      	2FAB      	0100100	0006	CP20203b            	CP20203b            	マルチ              	A0_LBL12            	CP20203b            	CP20202b            	2011-09-01	2100-12-31	bmladmin	2014-12-01 00:00:00.000000
3195            	アディポネクチン                        	アディポネクチン    	A 	自動分析装置（ＢＭ８０６０）            	I	1	R	100	50	2	4	240	330	1ADN      	2ADN      	2ADN      	2ADN      	0111111	0006	CP20101             	CP20101             	マルチ              	A0_LBL12            	CP20202a            	CP20202b            	2010-09-16	2100-12-31	bmladmin	2021-04-01 00:00:00.000000

横田課長と相談。
再度10連ラベルファイルを作成するには構成がわからないためリスクが高いと判断。
手サンプリングを依頼しました。

原因は下記の様です。
ワークシート3086を作成。(他端末で実施したか可能性が高い。)
A0_LBL12.useファイルがZサーバ上に残る。
ワークシート810を作成。←同時実行時のアクセスエラー
ワークシート3195を作成。←同名ファイルが残っている


--------------------------------------------------------------------
326：横田 克夫; 総研検査システム２課
2023年02月06日（月） 08:52

問合者=2/5 8:47　竹澤氏　対応時間=10分

先日の、10連ラベルが出力できない状況が再発した。
対応をお願いしたい。

→ラベルのみを再発行する手順が確立できていないため、用手での運用をお願いし、承諾頂く。
→発生状況をヒアリングすると、やはり、小林氏が調査してくれた以下の状況となった模様
　　ワークシート3086を作成。(他端末で実施したか可能性が高い。)
　　A0_LBL12.useファイルがZサーバ上に残る。
　　ワークシート810を作成。←同時実行時のアクセスエラー
　　ワークシート3195を作成。←同名ファイルが残っている
　システムの調査結果と、竹澤氏の感覚的な話を纏めると、原因はラベル出力ファイルへの
　書き込みが競合しているのは間違いなさそう。
　→竹澤氏に説明し、ワークシート3086のラベルファイルが出力されている事を確認してから
　　次のワークシート出力を実行して頂くよう、暫定的な運用が出来ないか相談。
　→ワークシート3086は「特別リスト」を出力する運用で、確認してから次の処理を実行する
　　ことは可能との事で、暫定運用についてご理解・承諾いただいた。

--------------------------------------------------------------------
327：小林 洋一; 総研検査システム２課
2023年02月08日（水） 17:21

問合者=横田課長、自動分析課竹澤　対応時間=20分
シングル側の前読み装置で読み取れないトレーがあるので確認してほしい。
日設のプログラムがエラーで停止していたためファイルが取り込まれていなかった。
kea00sys@kea00apa:/apdata/today/file/NSWS/Send/TrInfo/ZS050> ls -lrt
合計 56
drwxrwxr-x 2 kea00sys users 4096 10月 20 20:19 Err
drwxrwxr-x 2 kea00sys users 4096  2月  8 16:07 Ok
-rwxr--r-- 1 nswkst   users 4138  2月  8 16:08 TR_230208160728_24070001.dat
-rwxr--r-- 1 nswkst   users 4138  2月  8 16:17 TR_230208161723_24070002.dat
-rwxr--r-- 1 nswkst   users 4138  2月  8 16:21 TR_230208162226_2MAI0004.dat
-rwxr--r-- 1 nswkst   users 4138  2月  8 16:25 TR_230208162531_2MAI0005.dat
-rwxr--r-- 1 nswkst   users 4138  2月  8 16:27 TR_230208162626_2MAB0002.dat
-rwxr--r-- 1 nswkst   users 4138  2月  8 16:38 TR_230208163808_24070003.dat
kea00sys@kea00apa:/apdata/today/file/NSWS/Send/TrInfo/ZS050>

日本設計伊藤様へ連絡。
ZSの搬送を再起動し取り込まれたことを確認。

--------------------------------------------------------------------
328：島村 健汰; 総研検査システム１課
2023年02月20日（月） 18:00

問合者=菅野主任

クライアントPC（KEA00CLP02（10.1.181.72））の画面に
 "Alert! Hard Drive not found" と表示されている。

⇒ 電源ボタンを押して再起動させたら起動した。
　HDDの寿命が疑わしいので以下のフォルダをバックアップした。

・HOSTSファイル
・デスクトップ
・ドキュメント
・ピクチャ
・C:\Program Files/BML ※ "Logフォルダ","NGG35tmp_DELフォルダ"はコピーでエラーになる為、割愛

\\10.1.181.166\share\クライアントバックアップ\KEA00CLP02(10.1.181.72)

入替候補のPCが届いていたので、こちらのセットアップをなるべく早めに着手予定


--------------------------------------------------------------------
329：小林 洋一; 総研検査システム２課
2023年02月24日（金） 11:47

問合者=自動分析課金山  対応時間(分)=30
食塩摂取量の計算待ちを計算済みに更新してほしい。
受日:2023/02/21
依頼書NO:2629394
項目名:食塩摂取量
項目コード:13094

下記SQLを実行し対応。
select * from HKHRIRAI where  hkkhrkbn='3' and utkymd='2023-02-21' and irino='00262939400'
update HKHRIRAI set hkkhrkbn='0' where  hkkhrkbn='3' and utkymd='2023-02-21' and irino='00262939400'
select * from HKHRIRAI where utkymd='2023-02-21' and irino='00262939400'

該当患者は体重が200キロ超えなので明日もでてしまうかもしれない。
FAXされてしまうかもしれませんが週明けの月曜に対応します。と回答しました。


--------------------------------------------------------------------
330：横田 克夫; 総研検査システム２課
2023年03月17日（金） 20:43

3/16（木）受　№134-0303　以下の検体あり。
	VVVV1022 -01	134-0303-21
	VVVV1021 -19	134-0303-00
依頼は　ビタミンAその他、アルブミンその他
Ｖ1021ラック（ALB用）とV1022ラック（VA用）にそれぞれ検体ある。
しかし、アルブミン他が遮光からサンプリング、アルブミン他用が未開封で残っていた。

ケミストリのサンプリングチューブには検体POSが1つしか表示されていなく、
アルブミン他のサンプリング時、遮光からサンプリングしてしまった。
原因調査と対策の依頼

　↓

・ケミストリのログに以下のINSERTエラーログあり。
kea00sys@kea00apa:/apdata/aplog> grep 1340303 *
AD105_ERR20230317.log:2023/03/17        07:33:29        W       kea00apa        44633   kea00sys        AD105   AD105Buntekai.c dBunchu_ins     1862            00000000        INSERT BUNCHU[処理日:2023-03-16 検体:00134030300 smpcd:0952 kmkcd:0007012] [SQLCODE=-803]

・ケミストリに配信した分注結果は、以下の通り。
kikan@kitga20a:~/Data/4/Send/A00> grep 134000303 *SBUNC003*
20230316_SBUNC003_0396.etxt:R1SDATA0        20230316000202303161340003030013400030300ｶﾒ 9Y       0     06517184866        00009520013554                                                                                                                                                                                                                                                                                                                                                                                                                                                         000UB  G                                                                                                                                                                                                                                                                                                                                                                                  
20230316_SBUNC003_0397.etxt:R1SDATA1        20230316000202303161340003030013400030300ｶﾒ1         0     06517184   VVVV10210190952                                                                                                                                                                                                                                                                                                                                                                                                                                                         0013554    1  8                                                                                                                                                                                                                                                                                                                                                                                  
20230316_SBUNC003_0397.etxt:R1SDATA1        20230316000202303161340003030013400030321ｶﾒ1         0     06517184   VVVV10220010952                                                                                                                                                                                                                                                                                                                                                                                                                                                         0013554    1  8                                                                                                                                                                                   
kikan@kitga20a:~/Data/4/Send/A00> ls -l 20230316_SBUNC003_0396.etxt
-rw-rw-r-- 1 kikan users 1155072  3月 17 07:30 20230316_SBUNC003_0396.etxt
kikan@kitga20a:~/Data/4/Send/A00> ls -l 20230316_SBUNC003_0397.etxt
-rw-rw-r-- 1 kikan users 187392  3月 17 07:33 20230316_SBUNC003_0397.etxt
kikan@kitga20a:~/Data/4/Send/A00>

・尿フロの分注結果
eagle01:/export/home/bird/test/day/unload/16/birdnfs/server/bunkeka%grep 134000303 *
send0583.end:R1SDATA0        20230316000202303161340003030013400030300巾 9Y       0     06517184866        00009520013554                                                                                                                                                                                                                                                                                                                                                                                                                                                         000UB  G                                                                                                                                                                                                                                                                                      
eagle01:/export/home/bird/test/day/unload/16/birdnfs/server/bunkeka%ls -l send0583.end
-rw-rw-rw-   1 bird     bird      764928  3月 17日  07:30 send0583.end

　↓

おそらく、尿フロで未着となり分注ポジションが空白の分注結果と、血清フロンティアから送信されたＶラックの分注結果がケミストリで競合した。
その時に「SQLCODE=-803」のエラーが出て、Ｖラックのポジション情報が破棄された模様。

　↓

尿フロから未着の情報が送られなければ良いと考え、尿分注区分を０に出来ないか藤本課長に相談。
アルブミン他はRポジションやKポジションからサンプリングしているとの事で断念。

　↓

Vラック登録後に、尿フロの運用終了を実行するように出来ないか高倉課長に相談。
木塚課長に「通常分の認識が終わりました」と館内放送があってから運用終了を実行するよう助言。
20日に木塚課長に相談予定。

--------------------------------------------------------------------
331：横田 克夫; 総研検査システム２課
2023年03月21日（火） 14:34

[2023年 3月 18日 土曜日 06:45:04 JST] 検査結果 フラグ異常 確認
差出人	 ： 	kensys@bml.co.jp 
送信日時	 ： 	2023年03月18日（土） 06:45
To （2件）  	 ： 	multi_log@bml.co.jp, multi_error@bml.co.jp （←宛先を隠す）

20230317,"00803596900","0012974"

上記、測定結果のフラグがおかしい検体があります。
（ 検査フラグ M、結果状況コード 3 ）

→倉持氏より添付の情報提供あり。

→次回以降は、情報収集が必要。

ホスト.gif
20230318_倉持氏メール.txt
ケミストリー_パトライト設置お知らせ+(1).xlsx
パトランプアラーム内容.gif

--------------------------------------------------------------------
332：小林 洋一; 総研検査システム２課
2023年04月05日（水） 13:40

問い合わせ者　倉持様　対応時間　60分
>データ入力出来ないエラー
>総研システム2課
>横田課長
>小林様
>
>お疲れ様です。対処をお願いします。
>
>4/3受　027-7679　ACE
>「データ登録に失敗しました」というメッセージがでて、データ入力出来ませんでした。
>報告はホスト入力で対応済みです。
>現在も未入力のまま検査システムに残っています。
>
>この日、ACEの再測定を大量に行っています。
>
>宜しくお願いします。

依頼書NO単位結果入力画面では未報告完了(knsflg='M')を結果から除外している。
未報告完了になっているにも関わらず修正しようとしたためエラーになってしまったと思われます。
画面のログ
2023/04/05	11:45:13	OPT	DS342	6770    	frmDS342						SQL：INSERT INTO KEKKA ( KNSKISYMD,SRIYMD,KNTNO,KNTKETFLG,KNSGRP , KMKCD,KNSSU,KNSSUEDA,IRIHSMKBN,IRIKBN , KSKTKBN,UTKYMD,IRINO,IRIKETFLG,ZSSDINO , SSTCD,TRID,TRPOS,ASYRCKID,ASYRCKPOS , OYAKMKCD,SECCD,BKFKKBN,SMPCD,BSKKBN , BSKLNE,BSKGOK,BSKSEQ,BSKERRSTS,SKTDH , NBKMKCD,TSTRFLG,ZRCD,YSNLBL,KJNO , FKHKKNOHJKBN,TBKJNO,TBKJFLG,HTKFKHMS,SKFLG , TSKFLG,TKTFLG,JISKSBR,KKFLG,KKIRIFLG , KKIRILOTNO,HSYKFLG,HSKFLG,HHKKFLG,RAWDATA , KNSKKA1,KNSKKA2,KNSKKA2KBN,KKAHSKCD,HJKKA , SDI,KKACMT1,KKACMT2,KKAJKCD,PNCRGFLG , KNSPNCRGFLG,KKAKSFLG,KKASSFLG,IJKBNM,IJKBNF , IJKBNN,TBIJKBNM,TBIJKBNF,TBIJKBNN,NBDOLBL , NBDOERR,YKDOLBL,YKDOERR,ETCLBL,ETCERR , CTRLNO,KNSSEQ,BTHNO,PLTNO,PLTSEQ , DTNRTTS,DTNRDH,KNSKRDH,HKKDH,HKKKBDH , ZKHKKYYMD,ZKHKKYTME,FRKKAFLG,GZBSFLG,HSIFLG , KKAYSNFLG,TNYRKFLG,SIYFLG,KNSFLG,RENJICFLG , SOUKN1FLG,KANRENFLG,BUNKKUFLG,KESSEIFLG,RIREKIFLG , SYOUGOFLG,KEISANFLG,PER100FLG,TOUSEKFLG,KISYAKFLG , KOUSEIFLG,SYOUNGFLG,SOUKN2FLG,FUKAPTFLG,YOBIFLG01 , TOBIFLG02,YOBIFLG03,YOBIFLG04,YOBIFLG05,SKRYCDA , SKRYCDB,SKRYCDC,KSNDH,TRKDH,SKKKA ) VALUES('2023-04-03', '2023-04-03', '00027767902  ', ' ', '0006            ', '0000506', 0, 0, '0', 'A', 'S', '2023-04-03', '00027767900', ' ', 0, '6905100', '2RIX0021  ', 80, '88963     ', 5, '0000506', 'A ', '0', '0006   ', ' ', ' ', ' ', 0, ' ' , CURRENT TIMESTAMP, ' ', 'R', '023 ', '00', '001', ' ', '   ', ' ', ' ', '0', '  ', 'ｶ ', '1              ', ' ', '0', 0, ' ', ' ', ' ', ' ', '         1.0', '                        ', '  ', '002', '0.0', '   ', '0101', ' ', '3', '0', '0', ' ', '0', '3', '3', '3', ' ', ' ', ' ', '0', ' ', '0', ' ', '0', ' ', 0, 2180, 0, 0, 0, '6770    ' , CURRENT TIMESTAMP, '1000-01-01-00.00.01.000000', '1000-01-01-00.00.01.000000', '00:00:01', '1000-01-01', '    ', '0', '0', '0', '1', '1', '1', 'S', '4', '0', '2', '0', '0', '0', '0', '1', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', '0', ' ', ' ', ' ' , CURRENT TIMESTAMP , CURRENT TIMESTAMP, '１．０以下              ' )
2023/04/05	11:45:13	ERR	DS342	6770    	DS342	frmDS342	ms_UpdateData	68			データ登録失敗：0ERROR [23505] [IBM][DB2/LINUXZ64] SQL0803N "10" で識別される主キー、ユニーク制約、またはユニーク索引を持つ表 "DB2INST1.KEKKA" の列に重複行を作成できないため、 INSERT ステートメント、UPDATE ステートメントの 1 つ以上の値、または DELETE ステートメントによって行われた外部キーの更新が無効です。  SQLSTATE=23505

下記SQLをCSEで実行しバックアップ
select * from kekka where utkymd='2023-04-03' and irino='00027767900' and knssu='0' order by kmkcd,knssu
手入力結果を削除
delete from kekka where utkymd='2023-04-03' and irino='00027767900' and knssu='0'
現場へ結果入力を依頼。
既に報告済みなので結果が入った後に報告済みに更新
update kekka set knsflg='E',kkajkcd='3' where utkymd='2023-04-03' and irino='00027767900' and knssu='0' 
 


--------------------------------------------------------------------
333：清水 竜也; 総研検査システム１課
2023年04月05日（水） 19:14

問い合わせ者:辻課長　問合せ時刻＝13:30  対応時間＝50分
問い合わせ内容：ZSの２ライン目側のオンラインでコントロールが取り込まれない。
 経緯：
 分析機の４、５、６号機のうちの１台が調子悪くなり、その号機で測定している項目を
 他の号機に設定を急遽入れ、コントロールを流し始めたが設定にミスがあり、取り込まれなかった。
 それが原因なのか、それ以降、その号機のオンラインができていない。
 
ログを調べると MD102_2_yyyymmdd.log の２ライン目に相当するログ中にコメントマスターが見つからない旨の行が大量にあった。
　/apdata/aplog/MD*    ZS関連の常駐プログラムは MD* のネーミング
　
また、オンラインの電文ファイルが 以下の ./new ディレクトリ下に50ファイル程そのままあり、
滞留しているようであった。
　/apdata/today/file/KEA00/kea00ap/ZS050/kekka_onl/new/2_QCKQC...のネーミング

滞留ファイルを削除した時点で、現場にTELしたところ、10分後にまたコントロール結果が出るとの事で、それを取り込むかまず状況をみることにした。
が、取り込まれず、./new フォルダー下で５ファイル程、滞留が再現。

コメントマスターNotFoundが大量に発生したことをきっかけに、処理自体が止まっていると思われ
ZSの常駐系の処理を再起動することに決めた。

手順：
① 念のためオンラインの電文ファイル ./new/下 の 2_QC* で 個人Dirにバックアップした後、削除
② 個人Dirに移動。 ps -U kea00sys | grep MD > pr_MD1 で実行プロセスを事前確認
       PID TTY          TIME CMD
  301 ?        00:00:56 MD102
  303 ?        00:00:59 MD102
  313 ?        00:00:04 MD103
  319 ?        00:00:02 MD104
  321 ?        00:00:16 MD105
65533 ?        00:00:16 MD101
65535 ?        00:00:15 MD101

③ ZSの常駐系の起動sh 格納dir に移動   /home/kea00sys/shell/daily　に移動。 
④ prcZS_onoff.sh -STOP
⑤ prcZS_onoff.sh -START
   個人Dirに移動。 ps -U kea00sys | grep MD > pr_MD2 で起動プロセスを確認。
   停止前に確認したプロセスと同じ分だけ起動されていることを確認。
 
この時点で、直近の電文ファイル５ファイル程が ./new  から ./end に移動し、処理された模様。
現場にTELすると同様にコントロールが取り込まれたということであった。その後、測定を再開してもらう。

30分ほど、電文ファイルや業務ログを見ていたが、順調に推移。対応完。

--------------------------------------------------------------------
335：清水 竜也; 総研検査システム１課
2023年04月06日（木） 02:44

日次アラートメール対応。また電算課より、黄色のパトランプが点灯していると連絡が入る。
時刻＝1:50  対応時間=40分

リモート確認で日次のログを確認すると、実行開始が 23:55 であった。
前日が月間のピーク日だったためか、メール発報は
以下の tar の箇所で時間がかかっていることが原因と思われる。
なおcpu消費は30～40％台で推移しているので静観する。

[2023年  4月  6日 木曜日 01:57:33 JST][*.del] gzip start ----->
[2023年  4月  6日 木曜日 01:57:33 JST][kekka_out] tar cvfz start ----->

そのまま見守っていると次のステップに進行した。

[2023年  4月  6日 木曜日 02:07:29 JST][RIREKI] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
DB20000I  TERMINATE コマンドが正常に完了しました。

順調に進み始めたので、電算課へ問題無いので
ひとまずパトランプ解除してくださいと連絡を入れる。

さらに十数分後、日次が正常終了した旨のログを確認。
また、依頼、属性ファイルも未処理のものはなく、処理済みのみである。
cpu消費も70～90％台で推移しているので問題無しと判断し、対応完了。

[2023年  4月  6日 木曜日 02:21:25 JST][SHUSEI_KANJYA] runstats start ----->
DB20000I  RUNSTATS コマンドが正常に完了しました。
DB20000I  TERMINATE コマンドが正常に完了しました。
  2023/04/06 02:21:25▲▲ 累積集計情報runstats --- 終了 ▲▲
2023/04/06 02:21:26▲▲ 日次処理 --- 終了 ▲▲

----
 [2023年 4月 6日 木曜日 01:50:01 JST]マルチ エラーログ 報告
差出人      ：      kensys@bml.co.jp 
送信日時      ：      2023年04月06日（木） 01:50
To （2件）        ：      multi_log@bml.co.jp ... （→宛先をすべて表示する）


[ /apdata/aplog/FATAL_DAILY_20230406_0145012023-04-04.log ]
-------------------------------------------------------------------
<<<<<  日次処理チェックメール  >>>>>
日次が正常に終わっていない可能性があります。
2023-04-04 ログを確認して下さい。
スキップされた行数      = 0
挿入された行数          = 232903
更新された行数          = 0
拒否された行数          = 0
コミットされた行数      = 232903

DB20000I  TERMINATE コマンドが正常に完了しました。

データベース接続情報

データベース・サーバー = DB2/LINUX 9.7.4
SQL 許可 ID            = DB2INST1
ローカル・データベース別名 = KEA00DBN

[2023年  4月  6日 木曜日 01:28:55 JST][SHU_KEKKA] import start ----->
-------------------------------------------------------------------

上記、エラーログが存在しています。確認してください。
----


--------------------------------------------------------------------
336：清水 竜也; 総研検査システム１課
2023年04月21日（金） 21:01

Hinemosからのアラートメール対応  対応時間(分)=30

確認すると日次の表が終了直前のバックアップファイルを作成しているところであった。

出力日時 : 2023-04-21 20:30:11
アプリケーション : ログファイル監視_表スペース（ケミストリ）
重要度 : 危険
メッセージ : 2023-04-21 20:30:03 DB20001E DB2 TableSpace(DB_DATA01) is FULL UsablePgs= 76 パーセント
スコープ : kea00dba
----

対応としては、Hinemosで検知するDBスペース状況のファイルが
kea00db上の  /var/log/kansi.log であり、これを
crontab で30分おきに起動するシェルで作成している。
そこの 閾値が 75 であった。応急処置として、これを 78に あげた。

crontab 

#DB2MONITOR BY INTEC
*/30 * * * * /opt/script/monitor/DB2MON-30.sh が

さらに 
db2_tbscount_m.sh 呼び、この中の閾値が70%であった。

 45 #                                 　　　　　　          　↓閾値！
 46 #                                                                  ↓出力ディレクトリ
 47   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_DATA01        78` " >> $DIR_T01	
 48   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_DATA02        78` " >> $DIR_T02	
 49   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_INDEX01       78` " >> $DIR_T03	
 50   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_INDEX02       78` " >> $DIR_T04	
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　●変更

--------------------------------------------------------------------
337：清水 竜也; 総研検査システム１課
2023年04月24日（月） 11:17

対応日時＝ 4/6 23:10  対応時間=50分

ケミストリーシステムから異常通知のFATALメールと、また電算課よりパトランプ点灯の連絡が入り、対応。
----
日次が正常に終わっていない可能性があります。
2023-04-05_20230406200912 ログを確認して下さい。
2023/04/06 20:08:18▼▼ 日次処理 --- 開始 ▼▼
----

①日次ログを確認　　　　/apdata/oldday/2023-04-05下　の　daily.log
   FATALメールと同時刻帯で日次終了の正常ログ記載あり、それを知らせる正常終了のメールも来ていたた。

② その後も、15分間隔の日次終了チェックで数回、警告メールが入る。
　/apdata/oldday下に 日付8桁のフォルダーとは別に 2023-04-05_20230406200912 と言う
　長い名前のDirがあり、そこに日次開始の１行だけのものがあった。これが誤報の原因と推測。
  そのDirを一度 smz_2023-04-05_20230406200912 に変えてみるが効果無く、警告メールが来る。
　個人フォルダーにDirごと移動。 警告メールは収まった。
　検査室の操作で日次を起動後、そのまま先に進ませず取り消しすると、このようなDirができるらしい。

--------------------------------------------------------------------
338：清水 竜也; 総研検査システム１課
2023年05月02日（火） 21:01

羽生主事

お疲れ様です。

保守携帯の転送先を羽生主事の番号に設定しました。
よろしくお願いします。

スマホ自体は後日お渡しします。

--------------------------------------------------------------------
339：小林 洋一; 総研検査システム２課
2023年05月11日（木） 10:29

問い合わせ者:海老島 対応時間(分)＝30
ケミストリのオンラインプログラムの終了ができないので対応してほしい。
開発に使用していた「KEA00IAW02.bml.co.jp」が停止していたことが原因
proc.shをバックアップし修正。
kea00sys@kea00apa:~/bin> cp -p proc.sh proc.sh_20230511
kea00sys@kea00apa:~/bin> diff proc.sh proc.sh_20230511
33,34c33
< PROC_IA_HT=(KEA00IAW21.bml.co.jp KEA00IAW22.bml.co.jp KEA00IAW23.bml.co.jp KEA00IAW24.bml.co.jp)
< #PROC_IA_HT=(KEA00IAW21.bml.co.jp KEA00IAW22.bml.co.jp KEA00IAW23.bml.co.jp KEA00IAW24.bml.co.jp KEA00IAW02.bml.co.jp)
---
> PROC_IA_HT=(KEA00IAW21.bml.co.jp KEA00IAW22.bml.co.jp KEA00IAW23.bml.co.jp KEA00IAW24.bml.co.jp KEA00IAW02.bml.co.jp)
822,823c821
<       #for i in `seq 0 4`;
<       for i in `seq 0 3`;
---
>       for i in `seq 0 4`;
kea00sys@kea00apa:~/bin>

--------------------------------------------------------------------
340：小林 洋一; 総研検査システム２課
2023年05月11日（木） 10:42

問い合わせ者:海老島 対応時間(分)＝30
ケミストリのオンラインプログラムの終了ができないので対応してほしい。
開発に使用していた「KEA00IAW02.bml.co.jp」が停止していたことが原因
※現場で使用していたのはproc.shでなくprocIA.shでした。

kea00sys@kea00apa:~/bin> cp -p procIA.sh procIA.sh_20230511
kea00sys@kea00apa:~/bin> diff procIA.sh procIA.sh_20230511
19,20c19
< PROC_IA_HT=(KEA00IAW21.bml.co.jp KEA00IAW22.bml.co.jp KEA00IAW23.bml.co.jp KEA00IAW24.bml.co.jp)
< #PROC_IA_HT=(KEA00IAW21.bml.co.jp KEA00IAW22.bml.co.jp KEA00IAW23.bml.co.jp KEA00IAW24.bml.co.jp KEA00IAW02.bml.co.jp)
---
> PROC_IA_HT=(KEA00IAW21.bml.co.jp KEA00IAW22.bml.co.jp KEA00IAW23.bml.co.jp KEA00IAW24.bml.co.jp KEA00IAW02.bml.co.jp)
581,582c580
<       #for i in `seq 0 4`;
<       for i in `seq 0 3`;
---
>       for i in `seq 0 4`;
kea00sys@kea00apa:~/bin>

--------------------------------------------------------------------
341：小林 洋一; 総研検査システム２課
2023年05月11日（木） 16:21

問合者=自動分析課金山  対応時間(分)=30
食塩摂取量の計算待ちを計算済みに更新してほしい。
受日:2023/05/09
依頼書NO:2629373
項目名:食塩摂取量
項目コード:13094

下記SQLを実行し対応。
select * from HKHRIRAI where  hkkhrkbn='3' and utkymd='2023-05-09' and irino='00262937300'
update HKHRIRAI set hkkhrkbn='0' where  hkkhrkbn='3' and utkymd='2023-05-09' and irino='00262937300'
select * from HKHRIRAI where utkymd='2023-05-09' and irino='00262937300'



--------------------------------------------------------------------
343：羽生 達哉; 総研検査システム２課
2023年05月12日（金） 09:46

kea00apaのcrontabで、chk_proc.shがコメントアウトされているのですが、
誰か変更しましたか？

--------------------------------------------------------------------
344：横田 克夫; 総研検査システム２課
2023年05月12日（金） 10:16

問合者=自動分析課　藤本課長、大塚殿,対応時間(分)=30
ZS搬送ライン用の前読み装置に読ませたトレイ(1SIN0271、1SIN0218、2RAT0360)について、以下の事象が発生する。
(1)ZS搬送ライン上で「依頼がありません」と表示される。
(2)ワークシート再出力をしても、トレイIDが出力されない。
調査してもらいたい。

→日設　伊藤様より以下の連絡あり。
通常、以下の流れ。
　1.搬送システムが以下のフォルダにファイルを作成
　　kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/lane/ttray/new
　2.上位が取り込むと以下のフォルダに処理したファイルを移動
　　kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/lane/ttray/end
　3.上位が依頼情報を以下のフォルダに作成
　　kea00apa:/apdata/today/file/KEA00/kea00ap/ZS050/lane/request/new
　4.搬送システムが取り込むと以下のフォルダに処理したファイルを移動
　　/apdata/today/file/KEA00/kea00ap/ZS050/lane/request/end
今回、「1.」のフォルダにファイルが残っている。

→羽生主事に調査を依頼し、以下の連絡。
　1.kea00apa:/apdata/aplog/MD103_20230512.logでSQLCODE:-803(ロック)が発生している
　2.その影響でプロセス(MD103)が停止している。
　3.エラーファイルは以下のフォルダに移動されている。
　　/apdata/today/file/KEA00/kea00ap/ZS050/lane/ttray/err

→以下のリカバリを実施。
　1.プロセス再起動
　　/home/kea00sys/bin/MD103 /home/kea00sys/bin/MD103.ini &
　2.エラーファイルを移動し再処理
　　mv /apdata/today/file/KEA00/kea00ap/ZS050/lane/ttray/err/1SIN0271.err /apdata/today/file/KEA00/kea00ap/ZS050/lane/ttray/new/1SIN0271.dat
　3.1SIN0218.dat  2RAT0360.dat のファイルも処理されたことを確認

→藤本課長に連絡。業務継続が可能になった事を確認して頂いた。
　また、プロセス停止の検知が遅れたため、今後改善する旨を説明した。

--------------------------------------------------------------------
345：横田 克夫; 総研検査システム２課
2023年05月12日（金） 16:30

@:羽生 達哉; 総研検査システム２課

>>343
誰かわかりませんが、コメントを外しました。

--------------------------------------------------------------------
346：清水 竜也; 総研検査システム１課
2023年05月15日（月） 10:00

@:羽生 達哉; 総研検査システム２課

羽入主事

お疲れ様です。

保守携帯、羽生主事のロッカーへ入れました。
ご確認ください。

--------------------------------------------------------------------
347：羽生 達哉; 総研検査システム２課
2023年05月16日（火） 14:23

問合者=自動分析課　和泉様、大塚殿,対応時間(分)=120
---------------------------------------------------------------------------
アプリケーションログ照会画面で、
普段見たことがない、「依頼ファイルが見つかりません」というエラーが出ていた。
出ても問題ないものか確認をお願いしたい。
--------------------------------------------------------------------------

ZS050用のMD101からの出力メッセージ。
ZS050で再検用にラックを投入した際に再検項目のないポジションに対して出力されるメッセージ。
再検項目については、測定オーダーが送信されて再検結果も受信しているので問題ない。

普段見たことがないと行っていたが、過去のログにも出ていたので気がついていないだけだと思う。
当日の朝に検査フラグエラーでパトランプが灯いたので、ログ画面を確認してたまたま気付いたのだと思う。


↓初回問い合わせ
2023/05/16    08:26:45    00000000    問合せ受信: RackID[81020] Pos[01] ME[4]
2023/05/16    08:26:46    00000000    依頼データ送信: RackID[81020] Pos[001] ME[4]
2023/05/16    08:26:47    00000000    問合せ受信: RackID[81020] Pos[02] ME[4]
2023/05/16    08:26:48    00000000    依頼データ送信: RackID[81020] Pos[002] ME[4]
2023/05/16    08:26:50    00000000    問合せ受信: RackID[81020] Pos[03] ME[4]
2023/05/16    08:26:50    00000000    依頼データ送信: RackID[81020] Pos[003] ME[4]
2023/05/16    08:26:52    00000000    問合せ受信: RackID[81020] Pos[04] ME[4]
2023/05/16    08:26:53    00000000    依頼データ送信: RackID[81020] Pos[004] ME[4]
2023/05/16    08:26:55    00000000    問合せ受信: RackID[81020] Pos[05] ME[4]
2023/05/16    08:26:55    00000000    依頼データ送信: RackID[81020] Pos[005] ME[4]
2023/05/16    08:27:50    00000000    問合せ受信: RackID[81020] Pos[01] ME[5]
2023/05/16    08:27:51    00000000    依頼データ送信: RackID[81020] Pos[001] ME[5]
2023/05/16    08:27:53    00000000    問合せ受信: RackID[81020] Pos[02] ME[5]
2023/05/16    08:27:53    00000000    依頼データ送信: RackID[81020] Pos[002] ME[5]
2023/05/16    08:27:55    00000000    問合せ受信: RackID[81020] Pos[03] ME[5]
2023/05/16    08:27:56    00000000    依頼データ送信: RackID[81020] Pos[003] ME[5]
2023/05/16    08:27:57    00000000    問合せ受信: RackID[81020] Pos[04] ME[5]
2023/05/16    08:27:58    00000000    依頼データ送信: RackID[81020] Pos[004] ME[5]
2023/05/16    08:28:00    00000000    問合せ受信: RackID[81020] Pos[05] ME[5]
2023/05/16    08:28:01    00000000    依頼データ送信: RackID[81020] Pos[005] ME[5]
2023/05/16    08:28:13    00000000    問合せ受信: RackID[81020] Pos[01] ME[6]
2023/05/16    08:28:13    00000000    依頼データ送信: RackID[81020] Pos[001] ME[6]
2023/05/16    08:28:15    00000000    問合せ受信: RackID[81020] Pos[02] ME[6]
2023/05/16    08:28:16    00000000    依頼データ送信: RackID[81020] Pos[002] ME[6]
2023/05/16    08:28:17    00000000    問合せ受信: RackID[81020] Pos[03] ME[6]
2023/05/16    08:28:18    00000000    依頼データ送信: RackID[81020] Pos[003] ME[6]
2023/05/16    08:28:20    00000000    問合せ受信: RackID[81020] Pos[04] ME[6]
2023/05/16    08:28:20    00000000    依頼データ送信: RackID[81020] Pos[004] ME[6]
2023/05/16    08:28:23    00000000    問合せ受信: RackID[81020] Pos[05] ME[6]
2023/05/16    08:28:23    00000000    依頼データ送信: RackID[81020] Pos[005] ME[6]
↓初回結果受信
2023/05/16    08:39:50    00000000    測定結果受信: KenID[8102001^N] CH[083] ME[6]
2023/05/16    08:39:53    00000000    測定結果受信: KenID[8102002^N] CH[144] ME[6]
2023/05/16    08:40:08    00000000    測定結果受信: KenID[8102001^N] CH[746] ME[4]
2023/05/16    08:40:08    00000000    測定結果受信: KenID[8102001^N] CH[501] ME[4]
2023/05/16    08:40:08    00000000    測定結果受信: KenID[8102001^N] CH[502] ME[4]
2023/05/16    08:40:08    00000000    測定結果受信: KenID[8102001^N] CH[503] ME[4]
2023/05/16    08:40:09    00000000    測定結果受信: KenID[8102003^N] CH[091] ME[4]
2023/05/16    08:40:09    00000000    測定結果受信: KenID[8102003^N] CH[746] ME[4]
2023/05/16    08:40:09    00000000    測定結果受信: KenID[8102003^N] CH[501] ME[4]
2023/05/16    08:40:09    00000000    測定結果受信: KenID[8102003^N] CH[502] ME[4]
2023/05/16    08:40:09    00000000    測定結果受信: KenID[8102003^N] CH[503] ME[4]
2023/05/16    08:40:10    00000000    測定結果受信: KenID[8102004^N] CH[091] ME[4]
2023/05/16    08:40:10    00000000    測定結果受信: KenID[8102004^N] CH[746] ME[4]
2023/05/16    08:40:10    00000000    測定結果受信: KenID[8102004^N] CH[501] ME[4]
2023/05/16    08:40:10    00000000    測定結果受信: KenID[8102004^N] CH[502] ME[4]
2023/05/16    08:40:10    00000000    測定結果受信: KenID[8102004^N] CH[503] ME[4]
2023/05/16    08:40:24    00000000    測定結果受信: KenID[8102005^N] CH[091] ME[4]
2023/05/16    08:40:24    00000000    測定結果受信: KenID[8102005^N] CH[746] ME[4]
2023/05/16    08:40:24    00000000    測定結果受信: KenID[8102005^N] CH[501] ME[4]
2023/05/16    08:40:24    00000000    測定結果受信: KenID[8102005^N] CH[502] ME[4]
2023/05/16    08:40:24    00000000    測定結果受信: KenID[8102005^N] CH[503] ME[4]
↓再検問い合わせ（ポジション５以外は債権がないのでエラーメッセージ表示）
2023/05/16    08:45:16    00000000    問合せ受信: RackID[81020] Pos[01] ME[4]
2023/05/16    08:45:17    00000000    依頼ファイルが見つかりません。"依頼無し"の依頼MSG送信 File[/apdata/today/file/KEA00/kea00ap/ZS050/irai_file/OD_81020_____001.dat_01] ME[4] ERR[2]
2023/05/16    08:45:17    00000000    依頼データ送信: RackID[81020] Pos[001] ME[4]
2023/05/16    08:45:19    00000000    問合せ受信: RackID[81020] Pos[02] ME[4]
2023/05/16    08:45:20    00000000    依頼ファイルが見つかりません。"依頼無し"の依頼MSG送信 File[/apdata/today/file/KEA00/kea00ap/ZS050/irai_file/OD_81020_____002.dat_01] ME[4] ERR[2]
2023/05/16    08:45:20    00000000    依頼データ送信: RackID[81020] Pos[002] ME[4]
2023/05/16    08:45:22    00000000    問合せ受信: RackID[81020] Pos[03] ME[4]
2023/05/16    08:45:22    00000000    依頼ファイルが見つかりません。"依頼無し"の依頼MSG送信 File[/apdata/today/file/KEA00/kea00ap/ZS050/irai_file/OD_81020_____003.dat_01] ME[4] ERR[2]
2023/05/16    08:45:22    00000000    依頼データ送信: RackID[81020] Pos[003] ME[4]
2023/05/16    08:45:24    00000000    問合せ受信: RackID[81020] Pos[04] ME[4]
2023/05/16    08:45:25    00000000    依頼ファイルが見つかりません。"依頼無し"の依頼MSG送信 File[/apdata/today/file/KEA00/kea00ap/ZS050/irai_file/OD_81020_____004.dat_01] ME[4] ERR[2]
2023/05/16    08:45:25    00000000    依頼データ送信: RackID[81020] Pos[004] ME[4]
2023/05/16    08:45:26    00000000    問合せ受信: RackID[81020] Pos[05] ME[4]
↓再検オーダー送信
2023/05/16    08:45:27    00000000    依頼データ送信: RackID[81020] Pos[005] ME[4]
2023/05/16    08:45:48    00000000    問合せ受信: RackID[81020] Pos[01] ME[5]
2023/05/16    08:45:49    00000000    依頼ファイルが見つかりません。"依頼無し"の依頼MSG送信 File[/apdata/today/file/KEA00/kea00ap/ZS050/irai_file/OD_81020_____001.dat_01] ME[5] ERR[2]
2023/05/16    08:45:49    00000000    依頼データ送信: RackID[81020] Pos[001] ME[5]
2023/05/16    08:45:51    00000000    問合せ受信: RackID[81020] Pos[02] ME[5]
2023/05/16    08:45:52    00000000    依頼ファイルが見つかりません。"依頼無し"の依頼MSG送信 File[/apdata/today/file/KEA00/kea00ap/ZS050/irai_file/OD_81020_____002.dat_01] ME[5] ERR[2]
2023/05/16    08:45:52    00000000    依頼データ送信: RackID[81020] Pos[002] ME[5]
2023/05/16    08:45:53    00000000    問合せ受信: RackID[81020] Pos[03] ME[5]
2023/05/16    08:45:54    00000000    依頼ファイルが見つかりません。"依頼無し"の依頼MSG送信 File[/apdata/today/file/KEA00/kea00ap/ZS050/irai_file/OD_81020_____003.dat_01] ME[5] ERR[2]
2023/05/16    08:45:54    00000000    依頼データ送信: RackID[81020] Pos[003] ME[5]
2023/05/16    08:45:56    00000000    問合せ受信: RackID[81020] Pos[04] ME[5]
2023/05/16    08:45:57    00000000    依頼ファイルが見つかりません。"依頼無し"の依頼MSG送信 File[/apdata/today/file/KEA00/kea00ap/ZS050/irai_file/OD_81020_____004.dat_01] ME[5] ERR[2]
2023/05/16    08:45:57    00000000    依頼データ送信: RackID[81020] Pos[004] ME[5]
2023/05/16    08:45:58    00000000    問合せ受信: RackID[81020] Pos[05] ME[5]
↓再検オーダー送信
2023/05/16    08:45:59    00000000    依頼データ送信: RackID[81020] Pos[005] ME[5]
2023/05/16    08:46:12    00000000    問合せ受信: RackID[81020] Pos[01] ME[6]
2023/05/16    08:46:12    00000000    依頼ファイルが見つかりません。"依頼無し"の依頼MSG送信 File[/apdata/today/file/KEA00/kea00ap/ZS050/irai_file/OD_81020_____001.dat_01] ME[6] ERR[2]
2023/05/16    08:46:12    00000000    依頼データ送信: RackID[81020] Pos[001] ME[6]
2023/05/16    08:46:14    00000000    問合せ受信: RackID[81020] Pos[02] ME[6]
2023/05/16    08:46:15    00000000    依頼ファイルが見つかりません。"依頼無し"の依頼MSG送信 File[/apdata/today/file/KEA00/kea00ap/ZS050/irai_file/OD_81020_____002.dat_01] ME[6] ERR[2]
2023/05/16    08:46:15    00000000    依頼データ送信: RackID[81020] Pos[002] ME[6]
2023/05/16    08:46:17    00000000    問合せ受信: RackID[81020] Pos[03] ME[6]
2023/05/16    08:46:17    00000000    依頼ファイルが見つかりません。"依頼無し"の依頼MSG送信 File[/apdata/today/file/KEA00/kea00ap/ZS050/irai_file/OD_81020_____003.dat_01] ME[6] ERR[2]
2023/05/16    08:46:17    00000000    依頼データ送信: RackID[81020] Pos[003] ME[6]
2023/05/16    08:46:19    00000000    問合せ受信: RackID[81020] Pos[04] ME[6]
2023/05/16    08:46:20    00000000    依頼ファイルが見つかりません。"依頼無し"の依頼MSG送信 File[/apdata/today/file/KEA00/kea00ap/ZS050/irai_file/OD_81020_____004.dat_01] ME[6] ERR[2]
2023/05/16    08:46:20    00000000    依頼データ送信: RackID[81020] Pos[004] ME[6]
2023/05/16    08:46:21    00000000    問合せ受信: RackID[81020] Pos[05] ME[6]
↓再検オーダー送信
2023/05/16    08:46:22    00000000    依頼データ送信: RackID[81020] Pos[005] ME[6]
↓再検結果受信
2023/05/16    08:57:46    0000000    測定結果受信: KenID[8102005^N] CH[091] ME[4]


アプリケーションログ照会画面.xls

--------------------------------------------------------------------
350：清水 竜也; 総研検査システム１課
2023年05月17日（水） 19:17

問合者=自動分析課　藤本課長　対応時間(分)=30

15時台に、集検分の報告をした。
ホストの結果更新一覧上、ファイル名が A00_0070番台から _0080番台。

昼間分の報告について
実際にホストの結果更新一覧を確認するのは、いつも夕方だが
17時台に、A00_0077 のファイルが何故かあり、全件更新エラーとなっている。
なぜだかわかりますか、という問い合わせ。

hulftログを utllist -s で確認すると、ケミストリーから17時台にも送信していた。
（ホストにも藤本課長は問合せしていて、同様のことを言っていたとのこと）

TELしている最中に周りの検査員と話し、
ケミストリー上、ファイル送信状況を確認する画面があり
普段、使うことは無いがファイル選択して、再送指示をできるらしい。
ただ指示をすると、一度、本当に再送するかの確認も表示されるので、
それを実行することもないとのことであった。
が、再度、検査員皆に、再送の操作をしていないか確認するとのこと。

同じファイル（同じ報告回数のデータ）を２度送っているため、
２度目のホスト取込は全件エラーとなっていて、実害はありませんが、
と説明し対応を終えた。


hul_0517.xlsx

--------------------------------------------------------------------
351：清水 竜也; 総研検査システム１課
2023年05月17日（水） 19:19

羽生主事

お疲れ様です。

藤本課長から、昨日(5/16)の朝のパトランプが鳴った
電解質(Na,K,Cl)の件で原因はわかりましたか？
と問い合わせがありました。

自分が日中追っかけでデータ見たところ、用手再検(2MLT)で
１台の分析機で普通に流れていたようにしかみ見えなかったですが
羽生さん、理由が何かわかりますか。
また、フラグ更新前のデータなどバックアップありますか。



--------------------------------------------------------------------
352：清水 竜也; 総研検査システム１課
2023年05月17日（水） 19:36

>>350
>>350 の件で　utllist コマンドを投げたところ
なかなか返ってこず、怖くなり、途中キャンセルした。

先頭行の日付が 2022年の1月から溜まりっぱなしで、サイズも大きい。
kea00sys@kea00apa:/opt/HULFT/etc>
-rw-rw-rw- 1 root root 655027848  5月 17 19:28 hulrcvlog.dat
-rw-rw-rw- 1 root root 911726280  5月 17 19:28 hulsndlog.dat

/dev/mapper/kea00apa--os--vg-opt--lv                                7.9G  3.2G  4.3G   43% /opt


--------------------------------------------------------------------
353：横田 克夫; 総研検査システム２課
2023年05月17日（水） 19:55

@:清水 竜也; 総研検査システム１課

>>352
黒木主任

本件、課題一覧を作成して転記をお願いします。

--------------------------------------------------------------------
354：小林 洋一; 総研検査システム２課
2023年05月18日（木） 09:21

問合者=自動分析課高梨  対応時間(分)=10
食塩摂取量の計算待ちを計算済みに更新してほしい。
受日:2023/05/10
依頼書NO:4102362
項目名:食塩摂取量
項目コード:13094

下記SQLを実行し対応。
select * from HKHRIRAI where  hkkhrkbn='3' and utkymd='2023-05-10' and irino='00410236200'
update HKHRIRAI set hkkhrkbn='0' where  hkkhrkbn='3' and utkymd='2023-05-10' and irino='00410236200'
select * from HKHRIRAI where utkymd='2023-05-10' and irino='00410236200'


--------------------------------------------------------------------
355：羽生 達哉; 総研検査システム２課
2023年05月29日（月） 12:33

問合者=電算課  対応時間(分)=60
ケミストリーのパトランプ点灯

障害通知メールも来ていたが文字化けで読めない。
ファイル名が[FATAL_CS_ERR.log]なので、ＣＳのエラーの模様。
メール本文に172.19.99.38だけ読める記述があったのでIPアドレスらしい。

①CSの確認
\\10.1.103.226\NAS_Backup\総研システム部\総研システム３課\01_ケミストリ\99_資料\ケミストリーシステムハードウェア構成_2104.xlsx
から、ＣＳの８号機らしい。

②接続号機の確認
KEA00IAW21へログイン
kea00sys@kea00apa $ ssh KEA00IAW21
kea00sys@KEA00IAW21$ cd bin
kea00sys@KEA00IAW21$ grep 172.19.99.38 *.ini
DD201_24.ini:BUNSEKI_01         172.19.99.38,10004,24
DD201_25.ini:BUNSEKI_01         172.19.99.38,10005,25
と出るのでBMの24,25号機らしい。

③オンラインの確認
kea00apaで、
kea00sys@kea00apa$ proc.sh
-> 1
-> 2
で停止しているプロセスが無いか確認。
※停止しているプロセスは無かった。
※BMの24,25号機はKEA00IAW22で起動中

④エラーメールが鬱陶しいので停止する。
エラーメール送信とパトランプ点灯は
~/shell/cron/chk_FATAL_Log.sh
が行っている。
/apdata/aplog/FATAL_CS_ERR.logを監視しているが、ファイルを作っている人がapサーバー上に見当たらない。

CSのpingチェックはIAサーバーが行っている。
KEA00IAW21へログイン
kea00sys@kea00apa $ ssh KEA00IAW21
kea00sys@KEA00IAW21$ cd shell
kea00sys@KEA00IAW21$ cat chk_CS2232.sh
#!/bin/bash
############################################################
#
# chk_CS2232.sh CS2232導通状況監視シェル
#
# 2017-04-13 Create 関家
#
############################################################

# 監視停止ファイルの設定
STOP_DIR="/home/kea00sys/shell"
STOP_FILE_NAME="STOP"
# CS一覧
CS2232_IP=(172.19.99.31 172.19.99.32 172.19.99.33 172.19.99.34 172.19.99.35 172.19.99.36 172.19.99.37 172.19.99.38)
CS2232_NUM=${#CS2232_IP[*]}                      # CS の台数
CS2232_NUM=`expr ${CS2232_NUM} - 1`

DIR_LOG="/apdata/aplog"
NAME_ERRLOG="FATAL"
#NAME_ERRLOG="TST"
EXTENSION_LOG=".log"

DIR_LOCAL="/tmp"
PS_KEKKA="cs_ping"
ERR_APPL="err_cs"

ERR_FLG="0"

# 監視停止ファイルの存在確認。(ファイルが存在する場合、チェックをしない。)
if [ -e ${STOP_DIR}/${STOP_FILE_NAME} ]; then
        echo "監視停止ファイルが存在しています。"
        exit 0
fi

for CS_NO in `seq 0 ${CS2232_NUM}`;
do
        CS2232=${CS2232_IP[${CS_NO}]}
        echo "${CS2232}"
        ping -w 10 -c 3 ${CS2232} > /dev/null
        EXITSTATUS=$?
        if [ ${EXITSTATUS} != "0" ]; then
                ERR_FLG="1"
                echo "${CS2232} : 導通が確認できません。" >> ${DIR_LOCAL}/${ERR_APPL}
                echo "" >> ${DIR_LOCAL}/${ERR_APPL}
                continue
        fi
done

if [ ${ERR_FLG} = "1" ]; then
        echo ${DIR_LOCAL}/${ERR_APPL}
        mv ${DIR_LOCAL}/${ERR_APPL} ${DIR_LOG}/${NAME_ERRLOG}_CS_ERR${EXTENSION_LOG}
fi

exit 0
kea00sys@KEA00IAW21$
IPアドレスが列挙してあるところを修正すればpingチェックは行われないが、この時点でCSの８号機にpingが通るようになっていたため
修正は見送った。

chk_CS2232.shはそれぞれのIAサーバー(21～24)で行っているが、実際にapサーバーで使われているのはKEA00IAW21のエラーログファイルだけ。
apサーバーがchk_IA_Log.shでKEA00IAW21の/apdata/aplog/FATAL_CS_ERR.logをftpで取得している。

※注意１ IAサーバーは文字コードがEUCなため、sshでログインした場合はteraterm等の設定を変更しないといろいろ文字化けする。
※注意２ エラーメールが文字化けしているのも、EUCで作成したファイルをSJISとして送信しているため。

⑤原因
CSの交換作業を行う際に、CS８号機だけ近くにコンセントが無かったのでBMのサービスコンセントから電源を取っていた。
26日の朝に、BMのメンテナンスのためにBMの大元のブレーカーを落としたのでサービスコンセントにつながっていたCS８号機も停止してしまった。
その後、ブレーカーを戻したのでCSも復旧した。
27日にCSの電源をBM戸は別のコンセントへ移す予定。

--------------------------------------------------------------------
356：島村 健汰; 総研検査システム１課
2023年05月29日（月） 15:06

>>355
27日にCSの電源をBM戸は別のコンセントへ移す予定。

⇒ 29日に該当CSの電源を床下コンセントから引いた電源タップに移設しました。
　ご迷惑をおかけして申し訳ありません。

--------------------------------------------------------------------
357：島村 健汰; 総研検査システム１課
2023年05月30日（火） 17:53

問合者=海老島 様  対応時間(分)=60
LABO9号機のタイムアウトエラー

CS交換後、コントロールの測定初めでタイムアウトエラーが発生した為
対応をお願いしたいとの事

"SND_TIMER"の設定を以下の通り変更

[kea00sys@KEA00IAW23 bin]$ diff DD203_09.ini DD203_09.ini_BAK
66c66
< SND_TIMER   25000
---
> SND_TIMER   0

[kea00sys@KEA00IAW24 bin]$ diff DD203_09.ini DD203_09.ini_BAK
66c66
< SND_TIMER   25000
---
> SND_TIMER   0

変更後、コントロールとダミーを100検体測定し、タイムアウトエラーなどが発生しない事を確認
また、電文のレスポンスが変わった事を確認（約0.025秒）

2023/05/30 14:43:43.879
BUNSEKI_09(10001):<ENQ>

2023/05/30 14:43:43.904
HOST_09(10001):<ACK>

2023/05/30 14:43:44.169
BUNSEKI_09(10001):<STX>
1H|\^&|||H09^1|||||host|RSUPL^REAL|P|1<CR>
P|1|||||||U||||||^<CR>
O|1|ffffffccffffffdfffffffb0ffffffd9                  |1013^30001^1^^QC^SC|^^^87^\^^^88^\^^^89^|||||||Q||||1|||||||20230530143339|||F<CR>
C|1|I|^^^^|G<CR>
R|1|^^^87/|149|mmol/L||N||||hitsrv|20230530143358||ISE1<CR>
C|1|I|0|<ETB>71<CR><LF>

2023/05/30 14:43:44.194
HOST_09(10001):<ACK>

2023/05/30 14:43:44.399
BUNSEKI_09(10001):<STX>
2I<CR>
R|2|^^^88/|5.7|mmol/L||N||||hitsrv|20230530143358||ISE1<CR>
C|1|I|0|I<CR>
R|3|^^^89/|112|mmol/L||N||||hitsrv|20230530143358||ISE1<CR>
C|1|I|0|I<CR>
L|1|N<CR><ETX>0B<CR><LF>

2023/05/30 14:43:44.425
HOST_09(10001):<ACK>

2023/05/30 14:43:44.539
BUNSEKI_09(10001):<EOT>

--------------------------------------------------------------------
358：黒木 俊博; 総研検査システム１課
2023年06月01日（木） 16:29

問合者：保科次長　対応時間(分)=60
純粋装置故障による影響調査

純粋装置故障により、一時、日中の検査や緊急検査ができなくなった。
その後、復旧はしているが、日中の検査で中途半端なものがないか、
ネットワークで障害が起きてないか確認してください。

①やらかした10:50頃は緊急検査も一段落したところで、他の日中の検査も測定してなかったそうです。
　中途半端なものがないか最終的には検査で未報告のものがないようにしっかり確認してもらうことを辻課長に連絡。


②ネットワークに問題がないか確認
・CSの導通を確認
・IAサーバ4台の導通を確認
・各IAサーバの通信ログを確認（添付ファイル）

9号機が影響を受けたようだが、機器管理の部署により9号機の復旧が確認された。
その後、全号機でコントロールを流して確認完了したことを検査から確認した。


20230601_純粋装置障害の影響確認.txt

--------------------------------------------------------------------
359：黒木 俊博; 総研検査システム１課
2023年06月01日（木） 16:39

Hinemosからのアラートメール対応  対応時間(分)=15

DB使用率のアラートの閾値が近付いているため現在の78%を80%に変更。

kea00dba:/opt/script/monitor #

db2_tbscount_m.sh

〇変更前
 45 #                                 　　　　　　          　↓閾値！
 46 #                                                                  ↓出力ディレクトリ
 47   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_DATA01        78` " >> $DIR_T01	
 48   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_DATA02        78` " >> $DIR_T02	
 49   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_INDEX01       78` " >> $DIR_T03	
 50   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_INDEX02       78` " >> $DIR_T04	

〇変更後
 45 #                                 　　　　　　          　↓閾値！
 46 #                                                                  ↓出力ディレクトリ
 47   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_DATA01        80` " >> $DIR_T01	
 48   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_DATA02        80` " >> $DIR_T02	
 49   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_INDEX01       80` " >> $DIR_T03	
 50   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_INDEX02       80` " >> $DIR_T04	


--------------------------------------------------------------------
360：小林 洋一; 総研検査システム２課
2023年06月05日（月） 11:36

問合者=自動分析課高梨  対応時間(分)=10
食塩摂取量の計算待ちを計算済みに更新してほしい。
受日:2023/05/29
依頼書NO:4104795
項目名:食塩摂取量
項目コード:13094

下記SQLを実行し対応。
select * from HKHRIRAI where  hkkhrkbn='3' and utkymd='2023-05-29' and irino='00410479500'
update HKHRIRAI set hkkhrkbn='0' where  hkkhrkbn='3' and utkymd='2023-05-29' and irino='00410479500'
select * from HKHRIRAI where utkymd='2023-05-29' and irino='00410479500'


--------------------------------------------------------------------
361：清水 竜也; 総研検査システム１課
2023年06月06日（火） 14:53

アラートメール対応  対応時間(分)=5

> 日時: 2023年6月6日 7:24:03 JST
> 宛先: kensys@bml.co.jp
> 件名: Re: [2023年  6月  6日 火曜日 07:20:04 JST]マルチ異常報告
> 〓
> 再起動しました。
>
> 2023年6月6日(火) 7:20 <kensys@bml.co.jp>:
>
>     BD301 供給ストッカ
>
>     上記プロセスが起動していません。確認してください。

ログフォルダーや、DBのapllog に　BD301 のログは無く、落ちた原因は不明です。


--------------------------------------------------------------------
362：清水 竜也; 総研検査システム１課
2023年06月07日（水） 15:47

藤本課長よりメール問い合わせ：

----
藤本課長

お疲れ様です。

 右辺、角カッコ[ ]で括ったのが項目コードになります。

0013113 = (([0000124]*[0000413])/([0000407]*[0000126]))*100

清水
----- Original Message -----
Subject: Re: 尿中尿酸排泄率について
Date: Tue, 06 Jun 2023 23:14:41 +0900
From: "藤本 丈志"<takeshi-f@bml.co.jp>
> 清水主任
> 
> お疲れ様です。
> 
> サテライトマスタの項目13113：尿中尿酸排泄率の計算式を抜いていただけますか？
> 検査室にある資料の計算式は下記内容と合っています。
> 
> よろしくお願いいたします。
> 
> 自動分析課
> 藤本
> 
> ----- Original Message -----
> From: "山﨑 次男"<yama-tg@bml.co.jp>
> To: "藤本 丈志"<takeshi-f@bml.co.jp>
> > 藤本課長
> > 
> > お疲れ様です。
> > 
> > 浜松営業所より尿中尿酸排泄率を実施したいとの要望がありました。
> > 名古屋では実施していませんので、総研と名古屋で項目が分かれてしまう事が想定されます。
> > 
> > SUNシステムで実績のある項目13113「尿中尿酸排泄率」はありますが、
> > 
> > 総研と計算式が同じか確認したいです。
> > 
> > 「13113 尿中尿酸排泄率　ＦＥＵＡ」の計算式は
> > 
> >  13113=(([尿中尿酸]*[血清クレアチニン])/([血清尿酸]*[尿クレアチン]))*100　となっています。    
> > 
> > 総研と計算式が同じか確認お願い出来ますでしょうか。
> > 宜しくお願い致します。
> > 
> > BML名古屋　山﨑

--------------------------------------------------------------------
363：清水 竜也; 総研検査システム１課
2023年06月10日（土） 19:26

問合者=保科次長、横田課長  対応時間(分)=計60（ケミ:15)

17時半過ぎ、保科次長より、ホストサーバーの状態が不安定で再起動すると連絡あり。
17時40分頃。検査室に確認のTELを入れていると、ホスト回復したと館内放送が流れていた。
ケミストリー含め、担当システムで対ホストでエラーが出ていないか以下、確認した。
・Hulftログ  utllist -s, utllist -s
・ホスト報告ファイル など

いずれのサテライトも特に問題なし。保科次長、横田課長 にショートメールで報告した。


host.xlsx

--------------------------------------------------------------------
364：小林 洋一; 総研検査システム２課
2023年06月13日（火） 14:47

問合者=自動分析課内山  対応時間(分)=10
食塩摂取量の計算待ちを計算済みに更新してほしい。
受日:2023/06/09
依頼書NO:0544484
項目名:食塩摂取量
項目コード:13094

下記SQLを実行し対応。
select * from HKHRIRAI where  hkkhrkbn='3' and utkymd='2023-06-09' and irino='00054448400'
update HKHRIRAI set hkkhrkbn='0' where  hkkhrkbn='3' and utkymd='2023-06-09' and irino='00054448400'
select * from HKHRIRAI where utkymd='2023-06-09' and irino='00054448400'

食塩摂取量計算ツールで結果が反映できないため手入力対応していただきました。


--------------------------------------------------------------------
365：清水 竜也; 総研検査システム１課
2023年06月20日（火） 08:06

アラートメール対応  対応時間(分)=15分
---
2023年6月20日(火) 7:30 <kensys@bml.co.jp>:
    20230619,"00442154000","0002696"
    上記、測定結果のフラグがおかしい検体があります。
    （ 検査フラグ M、結果状況コード 3 ）
---

検査室にTELし、ワクイさんが出、本項目(推算GFR)の話をすると
ホスト確認もし、データ的には問題ないとのことであった。
計算元：BUN,クレアチニンとの矛盾もないとのこと。

knssu=0のレコードが、アラート発報しており、これを
knsflg=Mから Eへ更新した。

select kmkcd, hjkka, knssu, knsflg, kkajkcd  from kekka 
where utkymd='2023-06-19'  and irino='00442154000' and kmkcd='0002696'
for read only with ur

--update  kekka  set knsflg='E'
--where utkymd='2023-06-19'  and irino='00442154000' and kmkcd='0002696' and knssu=0   


--------------------------------------------------------------------
366：清水 竜也; 総研検査システム１課
2023年06月24日（土） 08:53

問合者=大塚様（内線3223） 対応時間(分)=15

■内容
　ワークシート作成をしようとしても、他の端末で...しばらくお待ちください
　のようなメッセージが出て、ワークシートが切れない。
　なお、他の端末で実行している箇所はないとも。

■対応
　>>60 と同様の処置を実施。

　ワークシート作成のロックレコードの有無を確認。対応。

   select * from KNSSEQKNRI where knsgrp='KEA00SYS'　でデータが１行表示された。
   delete   from KNSSEQKNRI where knsgrp='KEA00SYS'

   実施後、大塚様に連絡を入れ、ワークシート出力をしてもらい、印刷できることを確認。



--------------------------------------------------------------------
367：清水 竜也; 総研検査システム１課
2023年06月25日（日） 20:49


問合者=竹澤主任  対応時間(分)=90分

胃のABC健診で本日の受日データでなく、一日前の6/23(金)受で
ケミのメニューからABC判定処理をしたが、「データ更新に失敗しました」となってしまうので
みてもらえますか、と連絡あり。

受日:2023/06/23
依頼書No:378-0476 ～ 378-0505 の連番ではないが17検体分。

ABC判定項目以外の項目(ピロリ、PG1, PG2など）はホスト報告しいつも通りであった。
その後、ケミのメニューからABC判定処理、その後、EXCEL処理するそうだが、
ABC判定処理でエラー。
ホスト確認し、状況と項目コードなど確認。ABC判定は、項目コード22666。

プログラムログを見たく、再度実行してもらう。

ip: 10.1.18.76    リモートログイン： CHEMISTRY/3237

ログ名：DS601.log
2023/06/25	18:52:18	ERR	DS601	frmDS601	mf_InsertData	68	
データ更新失敗：0ERROR [23505] [IBM][DB2/LINUXZ64] SQL0803N "10" で識別される主キー、ユニーク制約、
またはユニーク索引を持つ表 "DB2INST1.KEKKA" の列に重複行を作成できないため、 INSERT ステートメント、
UPDATE ステートメントの 1 つ以上の値、または DELETE ステートメントによって行われた外部キーの更新が無効です。  

キー重複が原因と思われる。

データを確認。
select utkymd,irino, kmkcd, knssu, knskka1, kkajkcd,knsflg, kkacmt1, skkka, ksndh from kekka 
where knskisymd = '2023-06-23' 
and irino >= '00378047600' 
and irino <= '00378050500' 
and kmkcd = '0022666'
order by irino 
for read only with ur

17件、判定項目(22666)結果が空白の状態で、レコードあり。

なお、タイムスタンプは今日6/25ではなく、6/24であった。
このレコードがあり、エラーの原因と思われる。

竹澤主任に状況説明。 １件試しにを削除してみることに。 

該当の17件、また、kekkaテーブル全件でバックアップ。
378-0476　の 項目 22666を削除。

その後、ABC判定処理をすると、いつも通りに行えた。

残り16件についても、22666を削除。
続いて、ABC判定処理も正常終了。

EXCEL処理もいつも通り行え、その後、ホスト報告。
ホスト画面で該当17件の結果をサテライト側と突合せし、問題無しとのことで、対応終了。

１日滞留させるケースは今までも普通にあるとのことだが、
今回のエラーは竹澤主任も初めてとのことで
6/24の 17時台に378万台の17件について、どのような処理・操作をしていたか
当日の担当の方に確認していただくこととなった。



--------------------------------------------------------------------
368：黒木 俊博; 総研検査システム１課
2023年07月05日（水） 13:49

問合者=金山様  対応時間(分)=90分

「6月のピーク週くらいから、特に透析週で、普段載っていないものが出力されている気がする。
　推算GFR(0007959)の再検の条件などを確認したい。」

いくつか依頼の情報を聞いた際、「かみのクリニック　透析(4725700)」の依頼に年齢が入っていないことが分かりました。

「ｅＧＦＲ　前(0007959)」が年齢の情報がなかったため計算できず、再検になり
関連項目マスタの設定により、「クレアチニン　前(0002480)」も再検になったと思われる。
また、クレアチニンのレンジチェックマスタの照合NGの上下限区分の設定「3」（1:高値、2:低値でもない理由で再検になった場合の乖離許容）で、
「0.15乖離」してるので照合NGになったと思われる。


かみのクリニック　透析(4725700)の依頼の出し方などについて、営業に確認してもらうように依頼した。

20230704_再検照合NG検体がいつもより多い調査.xlsx

--------------------------------------------------------------------
369：島村 健汰; 総研検査システム１課
2023年07月10日（月） 11:46

問合者=海老島様  対応時間(分)=15分

内容：LABO9号機のオンラインをメニューから停止する事ができない。

LABO９号機をオンラインしている、IA24号機にログイン
動いているプロセスを確認

オンラインプロセスが動いている事を確認

[kea00sys@KEA00IAW24 ~]$

⇒ ps -ef | grep DD

kea00sys  9004     1  2 11:08 ?        00:00:34 DD203 08
kea00sys 17124 16774  0 11:28 pts/2    00:00:00 grep --color=auto DD
kea00sys 17580     1  2  7月08 ?       01:08:03 DD203 06
kea00sys 17584     1  2  7月08 ?       01:08:56 DD203 07
kea00sys 17590     1  1  7月08 ?       00:36:11 DD203 09　⇒　コレ

killコマンドで停止

[kea00sys@KEA00IAW24 ~]$ 

⇒ kill -USR1 17590

停止後の確認
DD203 09 が消えたことを確認

[kea00sys@KEA00IAW24 ~]$ 

⇒ ps -ef | grep DD

kea00sys  9004     1  2 11:08 ?        00:00:39 DD203 08
kea00sys 17580     1  2  7月08 ?       01:08:08 DD203 06
kea00sys 17584     1  2  7月08 ?       01:09:00 DD203 07

念の為、APサーバ上で proc.sh を実行し、画面上でも停止扱いになっている事を確認
また、オンラインプログラムの停止と起動を実行し、正常に動作する事を確認して対応終了

kea00sys@kea00apa:~>

⇒ proc.sh

 000302:プロセス監視－プロセス停止－ＩＡサーバ

～
               [ 9] LABO- 9号機 停止  W--  [25] BM-25号機   血清  W22
～


--------------------------------------------------------------------
370：小林 洋一; 総研検査システム２課
2023年07月13日（木） 13:14

問合者=自動分析課竹澤様  対応時間(分)=20分

BM24号機のオンラインを再起動したいができないので対応してほしい。
proc.shから実行してみたができなかった。

10.1.181.42へsshで接続
[kea00sys@KEA00IAW22 Log]$ ps -ax | grep DD
Warning: bad syntax, perhaps a bogus '-'? See /usr/share/doc/procps-3.2.8/FAQ
 7780 ?        Ss    68:45 DD201 13
 7783 ?        Ss    68:44 DD201 21
 7786 ?        Ss    67:39 DD201 24
 7789 ?        Ss    68:39 DD201 25
 7792 ?        Ss    69:00 DD201 31
 7795 ?        Ss    69:01 DD201 32
 7798 ?        Ss    69:04 DD201 33
10430 pts/0    S+     0:00 grep DD
[kea00sys@KEA00IAW22 Log]$ kill -USR1 7786
[kea00sys@KEA00IAW22 Log]$ ps -ax | grep DD
Warning: bad syntax, perhaps a bogus '-'? See /usr/share/doc/procps-3.2.8/FAQ
 7780 ?        Ss    68:45 DD201 13
 7783 ?        Ss    68:45 DD201 21
 7789 ?        Ss    68:40 DD201 25
 7792 ?        Ss    69:00 DD201 31
 7795 ?        Ss    69:01 DD201 32
 7798 ?        Ss    69:05 DD201 33
10501 pts/0    S+     0:00 grep DD
[kea00sys@KEA00IAW22 Log]$ 

proc.shから起動



--------------------------------------------------------------------
371：小林 洋一; 総研検査システム２課
2023年07月14日（金） 15:55

問合者=自動分析課金山  対応時間(分)=10
食塩摂取量の計算待ちを計算済みに更新してほしい。
受日:2023/07/10
依頼書NO:2563114
項目名:食塩摂取量
項目コード:13094

下記SQLを実行し対応。
select * from HKHRIRAI where  hkkhrkbn='3' and utkymd='2023-07-10' and irino='00256311400'
update HKHRIRAI set hkkhrkbn='0' where  hkkhrkbn='3' and utkymd='2023-07-10' and irino='00256311400'
select * from HKHRIRAI where utkymd='2023-07-10' and irino='00256311400'


--------------------------------------------------------------------
372：黒木 俊博; 総研検査システム１課
2023年07月18日（火） 17:19

Hinemosからのアラートメール対応  対応時間(分)=15

DB使用率のアラートの閾値が近付いているため現在の80%を82%に変更。
su(root/bmlroot)
kea00dba:/opt/script/monitor # cp -p db2_tbscount_m.sh db2_tbscount_m.sh_BAK20230718
kea00dba:/opt/script/monitor # ./db2_tbscount_m.sh

〇変更前
 45 #                                 　　　　　　          　↓閾値！
 46 #                                                                  ↓出力ディレクトリ
 47   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_DATA01        80` " >> $DIR_T01	
 48   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_DATA02        80` " >> $DIR_T02	
 49   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_INDEX01       80` " >> $DIR_T03	
 50   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_INDEX02       80` " >> $DIR_T04	

〇変更後
 45 #                                 　　　　　　          　↓閾値！
 46 #                                                                  ↓出力ディレクトリ
 47   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_DATA01        82` " >> $DIR_T01	
 48   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_DATA02        82` " >> $DIR_T02	
 49   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_INDEX01       82` " >> $DIR_T03	
 50   echo "$TIME `$SRC_PATH/db2_tbscount.sh DB_INDEX02       82` " >> $DIR_T04	

--------------------------------------------------------------------
373：羽生 達哉; 総研検査システム２課
2023年07月19日（水） 09:12

問合者=自動分析課和泉さん  対応時間(分)=10

7/19 2:20 ＢＭ24号機でホストタイムアウトと電話連絡。
ケミストリーサーバーより、procIA.shでBM24号機の停止→起動を行った。

--------------------------------------------------------------------
374：島村 健汰; 総研検査システム１課
2023年07月19日（水） 10:06

>>373
BM24号機周辺の配線周りの状況をチェック
通信障害が発生する様な状態で無い事を確認しました。

--------------------------------------------------------------------
375：保科 三紀夫; 総研検査システム１課
2023年07月21日（金） 19:05

本日、純水装置のパイプ破損が発生しました。
※先日破損したパイプと同じ

16時頃に破損し、既に修理が完了していました。

手動で水の供給を行い、検査出来たそうですが、
検査中だった検体は、再検を行い確認の上、報告したとの事です。

夜の検査については問題ないとの事です。（竹内課長 談）


--------------------------------------------------------------------
