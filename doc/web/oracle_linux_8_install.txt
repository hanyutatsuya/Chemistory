oracle linux 8.7
Mem 4G
HDD 200G

最小Server GUI使用 でインストール

dnf のproxy
/etc/dnf/dnf.conf へ
proxy=http://iproxy.bml.co.jp:8080
を追加

# dnf update

# vi /etc/selinux/config
SELINUX=disabled     ← enforcing から disabled に変更

# reboot

# dnf -y install wget
# dnf -y install vsftpd ftp

gcc,make インストール
# dnf -y group install "Server with GUI"
# dnf -y group install "Development Tools"
# dnf -y install man-pages

# dnf -y install git vim
# dnf -y install chrony

wgetのproxy
/etc/wgetrc
の
#https_proxy=http://...
#http_proxy=http://...
#ftp_proxy=http://...
のコメントアウトを外してproxyのアドレスを記入

ネットワーク情報の確認

TEXTベースGUIツール
#nmtui

時計合わせ
/etc/chrony.conf 修正

pool 172.17.8.60 iburst  <- add

# systemctl enable chronyd
# systemctl start chronyd
# systemctl status chronyd

タイムゾーン設定
# timedatectl set-timezone Asia/Tokyo
確認
# timedatectl

vsftpdのセットアップ

# vi /etc/vsftpd/vsftpd.conf

anonymous_enable=NO
local_enable=YES
write_enable=YES
local_root=public_html
chroot_local_user=YES
chroot_list_enable=YES
chroot_list_file=/etc/vsftpd/chroot_list
listen=YES
listen_ipv6=NO
pam_service_name=vsftpd
userlist_enable=YES
use_localtime=YES

# vi /etc/vsftpd/chroot_list

# systemctl enable vsftpd
# systemctl start vsftpd
# systemctl status vsftpd

# firewall-cmd --add-service=ftp --permanent
# firewall-cmd --reload

apache のインストール

# dnf -y install httpd.x86_64 httpd-devel.x86_64 httpd-filesystem.noarch httpd-manual.noarch httpd-tools.x86_64

httpd 起動
# systemctl start httpd

httpd 起動確認
# systemctl status httpd

httpd 自動起動
# systemctl enable httpd

firewallの許可設定

# firewall-cmd --add-service=http --permanent
# firewall-cmd --reload


apache設定変更
/etc/httpd/conf/httpd.conf 修正

#ServerName www.example.com:80
↓
ServerName oplkin:80

<IfModule dir_module>
    DirectoryIndex index.html
</IfModule>
↓
<IfModule dir_module>
    DirectoryIndex index.html index.php
</IfModule>

/etc/httpd/conf.d/userdir.conf 修正

<IfModule mod_userdir.c>
    #
    # UserDir is disabled by default since it can confirm the presence
    # of a username on the system (depending on home directory
    # permissions).
    #
    UserDir disabled

    #
    # To enable requests to /~user/ to serve the user's public_html
    # directory, remove the "UserDir disabled" line above, and uncomment
    # the following line instead:
    #
    #UserDir public_html
</IfModule>
↓
<IfModule mod_userdir.c>
    #
    # UserDir is disabled by default since it can confirm the presence
    # of a username on the system (depending on home directory
    # permissions).
    #
    UserDir enabled

    #
    # To enable requests to /~user/ to serve the user's public_html
    # directory, remove the "UserDir disabled" line above, and uncomment
    # the following line instead:
    #
    UserDir public_html
</IfModule>

<Directory "/home/*/public_html">
    AllowOverride FileInfo AuthConfig Limit Indexes
    Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
    Require method GET POST OPTIONS
</Directory>
↓
<Directory "/home/*/public_html">
    #AllowOverride FileInfo AuthConfig Limit Indexes
    AllowOverride None
    Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec
    Require method GET POST OPTIONS
</Directory>


ホームディレクトリのパーッミション変更
%cd
%chmod a+rx .

httpd 自動起動
# systemctl restart httpd
起動確認
# systemctl status httpd

php インストール

# dnf -y install php.x86_64 php-xml.x86_64 php-xmlrpc.x86_64 php-pdo.x86_64 php-pgsql.x86_64
 php-fpm.x86_64 php-gd.x86_64 php-cli.x86_64 php-common.x86_64 php-json.x86_64 php-mbstring.x86_64


php設定変更
/etc/php.ini 修正

[Date]
; Defines the default timezone used by the date functions
; http://php.net/date.timezone
;date.timezone =
↓
[Date]
; Defines the default timezone used by the date functions
; http://php.net/date.timezone
date.timezone = Asia/Tokyo

phpinfoのdateの項に反映される

[Session]
…
…
…
; Initialize session on request startup.
; http://php.net/session.auto-start
session.auto_start = 0
↓
[Session]
…
…
…
; Initialize session on request startup.
; http://php.net/session.auto-start
session.auto_start = 1

セッション管理の自動スタート

再起動して反映


ユーザー作成
/etc/group
へグループbmlを追加(ID:1000)

/etc/passwd
へユーザーkea00sysを追加(ID:1000)
グループbml
パスワードkea00sys

# cd /etc
# vi group
# vi passwd
# pwconv
# passwd kea00sys
ユーザー kea00sys のパスワードを変更。
新しいパスワード:
よくないパスワード: このパスワードには一部に何らかの形でユーザー名が含まれています。
新しいパスワードを再入力してください:
passwd: すべての認証トークンが正しく更新できました。
#

ホームディレクトリ作成
# cd /home
# mkdir kea00sys
# chown kea00sys:bml kea00sys
# chmod a+rx kea00sys
#

DB2install

rootでログイン
/etc/hosts編集(これをしないとDB2のinstallでエラーになる)
自ホストのホスト名とＩＰアドレスを/etc/hostsへ登録しておく
10.1.103.194 kea00web

ケミストリーのＤＢサーバーのホスト名とＩＰアドレスも登録しておく
10.1.41.144     kea00dbk
10.1.49.103     kea00db


db2clientの場合
tar zxvf v11.5.5fp1_linuxx64_client.tar.gz
tarを展開したディレクトリのdb2setupを実行
typicalインストールだと開発ツールの一部がインストールされないので
カスタムインストールで実行する。
インスタンス作成も選択する。



express-c,db2clientともに
db2inst1ユーザーが作成されれば成功（インストール中にパスワード入力がある）
作成されない場合はオプションに間違いがあるのでやり直し。

perl用DB2モジュールをインストール

# dnf -y install perl-App-cpanminus
# export DB2_HOME=/opt/ibm/db2/v11.5
# export DB2LIB=/opt/ibm/db2/v11.5/lib64
# cpan DBD::DB2

unixODBC

# dnf -y install unixODBC.x86_64 unixODBC-devel.x86_64


DB2設定
express-c,db2client共通

db2inst1でログイン

db2 catalog tcpip node KIKNND0 remote kidbt server 50002
db2 catalog database kikan2db as KIKAN2DB at node KIKNND0
db2 terminate

バージョン違いによるインストールディレクトリ名の違いを解消するため
シンボリックリンクを張っておく
rootでログイン
cd /opt/ibm/db2
ln -s V11.5 V11.1

DB2のinstallが終わってGUIが不要になったら
systemctl set-default multi-user.target
reboot


