推算ＧＦＲ(0000579)とクレアチニン(0000413)の保留

クレアチニンから計算で推算ＧＦＲを算出(CALCKMKMSTに登録されている)
計算の際に年齢と性別が必要(CHKZOKMSTに0000579が登録されている)

クレアチニンと推算ＧＦＲは関連項目(KRKMKMSTに登録されている)
相関マスタは無し

属性エラーの場合は保留依頼情報テーブル(HKHRIRAI)に登録
登録されるのは推算ＧＦＲだけ

LD101 属性エラーチェック
LD102 属性修正情報ファイル受信
LD103 属性修正展開
LD104 結果要求カード作成
LD105 他結果情報登録
LD106 再計算処理


LD101
ロックファイル ~/bin/locl/LD103.lock ができるまでwaitする。
ロックファイルは依頼ENDが来るとLD103が作成する。

chkzokmst, irai, kanjya, kmkmstをjoinして検索
必要な属性情報にエラーが無いかチェックする
属性情報にエラーがあった場合、保留依頼情報テーブル(HKHRIRAI)に登録する
属性修正情報問い合わせのファイル(/apdata/today/file/list/HOKO.ZKSYU.FAX.INPUT.A00.SB)を作成し、ホストへFTPで送信する。
AutoFaxで営業所へ問い合わせ送信？


LD102
LD103から起動される
基幹Linuxより属性修正ファイルをftpで取得(なぜHULFTで無いのかは不明)

lftpのmirrorコマンドで/home/kikan/Data/[0-6]/File/A00/SIRAI002_*のファイルを
/apdata/today/file/shusei/tmpへ取得
前回最後に処理したファイル(~/bin/LD102_Log/SIRAI002_*)より新しいファイルがあれば
/apdata/today/file/shuseiへコピーする

コピーしたファイルを１ファイルずつ処理
属性修正フラグの立っているレコードのみを選択して
/apdata/today/online/host/Recv/shusei/SHU.data.YYYYMMDDHHMMSSファイルを作成する
最後に処理したファイルを~/bin/LD102_Log/へコピーする

LD103
月曜4:31～4:36間で停止
IAサーバーのDBを再起動するため

依頼ENDが来たら10分間隔でLD102.shを起動

属性修正ファイルをチェック /apdata/today/online/host/Recv/shusei/SHU.data.YYYYMMDDHHMMSS
属性修正ファイルが無かったらロックファイル(~/bin/locl/LD103.lock)を作成？？？
属性修正ファイルがあれば
・属性修正ファイルの情報編集
・過去分の患者情報の場合、累積ＤＢから当日分へ戻す
・患者情報を更新(慎重・体重・体重単位・性別・年齢・年齢区分)
・属性エラーチェック
・属性エラーが無い場合は再計算チェック
・属性エラーの場合は保留依頼情報テーブル(HKHRIRAI)に登録する(登録済の場合は更新)

LD104
日曜23:00～月曜9:00間で停止



年齢エラー→推算ＧＦＲ(-99)
性別エラー→推算ＧＦＲ(-9)
属性エラーの項目は報告が止まっている→わかりづらい

推算ＧＦＲ(0000579)とクレアチニン(0000413)の保留は関連エラーで止まっている?

関連項目マスタ(KRKMKMST)の
推算ＧＦＲ(0000579)→クレアチニン(0000413)
推算ＧＦＲ(0000579)→クレアチニン/JCCLS(0012928)
を無効にしてみる
廃止年月日(HAIYMD)を'2022-01-01'にUPDATEする

反対方向の関連は残す？

確認
オンライン(DD201,DD203)、校正処理、ＮＧ確定、結果入力


