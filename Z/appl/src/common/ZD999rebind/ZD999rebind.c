/******************************************************************************/
/* 　ＢＭＬ様向け検査システム                                                 */
/*                                                                            */
/* 　システム名：次世代システム                                               */
/* 　ファイル名：stocker_stop.c                                               */
/* 　概　　　要：ストッカー停止コマンド                                       */
/******************************************************************************/
/*  Ver.     日付           名前           修正内容                           */
/* -------------------------------------------------------------------------- */
/*  1.00     2006/01/15     芳賀弘幸       新規作成                           */
/******************************************************************************/

/******************************************************************************/
/* インクルード宣言                                                           */
/******************************************************************************/
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <errno.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <sys/timeb.h>
#include <sys/ipc.h>
#include <sys/shm.h>
#include <dirent.h>
#include <fcntl.h>
#include <time.h>

/******************************************************************************/
/* Define定義                                                                 */
/******************************************************************************/
#define	MYAPP_APP_NAME	"ZD999stop"

/******************************************************************************/
/* グローバル宣言                                                             */
/******************************************************************************/

/******************************************************************************/
/* 関数宣言                                                                   */
/******************************************************************************/

/******************************************************************************/
/*  関 数 名　：mainFunction()												  */
/*  機能概要　：メイン処理関数												  */
/*  入　　力　：                                                              */
/*　 第１引数 ：struct	env *   	プログラム環境構造体。		 			  */
/*  出　　力　：                                                              */
/*  復帰情報　：  0     : 成功												  */
/* 　　　　　　　-1     : 失敗												  */
/******************************************************************************/
int 
main( argc, argv )
int		 argc ;
char	*argv[] ;
{

	int		 shm_Id ;
	int		 shm_Key ;
	int		*shmData ;


	/**************************************************************************
	 ***	引数チェック	
	 *************************************************************************/
	//	引数数チェック	
	if ( argc != 2 ) {
		fprintf ( stderr, "%s : Options are different.\n", argv[0] ) ;
		fprintf ( stderr, "USEGE : %s shmkey\n", argv[0] ) ;
		exit ( 9 ) ;
	}

	shm_Key = atoi ( argv[1] ) ;

	/**************************************************************************
	 ***	共有メモリ生成	
	 *************************************************************************/
	shm_Id = shmget ( (key_t)shm_Key, sizeof(int), 0666 | IPC_CREAT ) ;
	if ( shm_Id < 0 ) {
		perror ( argv[0] ) ;
		exit ( 9 ) ;
	}

	/**************************************************************************
	 ***	共有メモリアタッチ
	 *************************************************************************/
	shmData = ( int * ) shmat ( shm_Id, 0 , 0 ) ;
	if ( shmData == ( int * )-1 ) {
		perror ( argv[0] ) ;
		exit ( 9 ) ;
	}


	/*************************************************************************
	 ***	停止フラグを立てる	
	 *************************************************************************/
	*shmData = 9 ;

	/*************************************************************************
	 ***	共有メモリデタッチ
	 *************************************************************************/
	if ( shmdt ( shmData ) == -1 ) {
		perror ( argv[0] ) ;
		exit ( 9 ) ;
	}


	/**************************************************************************
	 ***	共有メモリ破壊(不要）
	 *************************************************************************/
	/*
	if ( shmctl ( pEnv->shm_Id, IPC_RMID, NULL) < 0 ) {
		perror ( argv[0] ) ;
	}
	*/

	exit ( 0 ) ;
}

/** End of File ***************************************************************/
